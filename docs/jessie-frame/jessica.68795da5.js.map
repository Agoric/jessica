{"version":3,"sources":["node_modules/ses/node_modules/@agoric/make-hardener/index.js","node_modules/indexof/index.js","node_modules/vm-browserify/index.js","node_modules/ses/dist/ses.esm.js","../nodejs/insulate.mjs","../nodejs/sesshim.mjs","../nodejs/jessieDefaults.mjs","../../lib/slog.mjs","node_modules/process/browser.js","../nodejs/globalEnv.mjs","../../lib/indent.mjs","../../lib/boot-peg.mjs","../../lib/boot-pegast.mjs","../../lib/quasi-peg.mjs","../../lib/quasi-jessie-module.mjs","../../lib/quasi-jessie.mjs","../../lib/quasi-json.mjs","../../lib/quasi-utils.mjs","../../lib/quasi-justin.mjs","../../lib/rewrite-define.mjs","../../lib/tag-string.mjs","../../lib/translate.mjs","jessica.mjs"],"names":["makeHardener","initialFringe","freeze","getOwnPropertyDescriptors","getPrototypeOf","Object","ownKeys","Reflect","fringeSet","WeakSet","harden","root","toFreeze","Set","prototypes","Map","paths","WeakMap","enqueue","val","path","type","TypeError","has","add","set","freezeAndTraverse","obj","proto","descs","get","forEach","name","pathname","String","desc","value","p","SES","throwTantrum","s","err","msg","console","error","stack","assert","condition","message","cleanupSource","src","replace","buildChildRealm","unsafeRec","BaseRealm","initRootRealm","initCompartment","getRealmGlobal","realmEvaluate","create","defineProperties","errorConstructors","EvalError","RangeError","ReferenceError","SyntaxError","URIError","callAndWrapError","target","args","eName","eMessage","eStack","ignored","Error","ErrorConstructor","err2","Realm","constructor","makeRootRealm","options","r","prototype","makeCompartment","global","evaluate","x","endowments","toString","writable","enumerable","configurable","buildChildRealmString","createRealmFacade","unsafeEval","assign","getOwnPropertyDescriptor","getOwnPropertyNames","setPrototypeOf","apply","uncurryThis","fn","thisArg","objectHasOwnProperty","hasOwnProperty","arrayFilter","Array","filter","arrayPop","pop","arrayJoin","join","arrayConcat","concat","regexpTest","RegExp","test","stringIncludes","includes","sharedGlobalPropertyNames","getSharedGlobalDescs","unsafeGlobal","descriptors","Infinity","NaN","undefined","repairAccessors","defineProperty","objectPrototype","__lookupGetter__","ignore","toObject","asPropertyName","aFunction","accessor","__defineGetter__","prop","func","O","__defineSetter__","__lookupSetter__","repairFunctions","repairFunction","declaration","FunctionInstance","eval","e","FunctionPrototype","TamedFunction","Function","unsafeGlobalSrc","unsafeGlobalEvalSrc","createNewUnsafeGlobalForNode","require","runInNewContext","createNewUnsafeGlobalForBrowser","document","iframe","createElement","style","display","body","appendChild","contentWindow","getNewUnsafeGlobal","newUnsafeGlobalForBrowser","newUnsafeGlobalForNode","createUnsafeRec","allShims","sharedGlobalDescs","unsafeFunction","repairAccessorsShim","repairFunctionsShim","createNewUnsafeRec","createCurrentUnsafeRec","identifierPattern","keywords","getOptimizableGlobals","safeGlobal","constants","alwaysThrowHandler","Proxy","createScopeHandler","useUnsafeEvaluator","__proto__","allowUnsafeEvaluatorOnce","unsafeEvaluatorAllowed","Symbol","unscopables","importParser","rejectImportExpressions","matches","exec","linenum","split","length","buildOptimizer","createScopedEvaluatorFactory","createSafeEvaluatorFactory","scopeHandler","scopedEvaluatorFactory","factory","scopeTarget","scopeProxy","scopedEvaluator","safeEval","createSafeEvaluator","safeEvaluatorFactory","createSafeEvaluatorWhichTakesEndowments","createFunctionEvaluator","safeFunction","params","functionBody","functionParams","RealmRecForRealmInstance","getRealmRecForRealmInstance","realm","registerRealmRecForRealmInstance","realmRec","setDefaultBindings","createRealmRec","safeEvalWhichTakesEndowments","parentUnsafeRec","self","shims","newShims","shim","currentUnsafeRec","tameDate","unsafeDate","Date","newDateConstructor","new","construct","now","tameMath","Math","random","tameIntl","Intl","DateTimeFormat","NumberFormat","getCanonicalLocales","toLocaleString","tameError","isExtensible","captureStackTrace","tameRegExp","compile","unsafeRegExp","removeProperties","whitelist","gopd","gopn","keys","cleaning","getProto","hop","whiteTable","addToWhiteTable","rootValue","rootPermit","whitelistSymbols","register","permit","indexOf","namedIntrinsics","getAnonIntrinsics","anonIntrinsics","clean","prefix","num","getPermit","base","result","getAnonIntrinsics$1","aStrictGenerator","Generator","aStrictAsyncGenerator","AsyncGenerator","aStrictAsyncFunction","AsyncFunctionPrototype","registerIteratorProtos","registery","iteratorSym","iterator","anIter","anIteratorPrototype","anIterProtoBase","IteratorPrototype","sampleAnonIntrinsics","Boolean","Number","tuple","undeniable","start","ThrowTypeError","arguments","GeneratorFunction","genProtoBase","AsyncGeneratorFunction","AsyncGeneratorPrototype","AsyncIteratorPrototype","AsyncFunction","Float32Array","TypedArray","getAllPrimordials","t","j","TypedArrayWhitelist","next","ArrayIteratorPrototype","StringIteratorPrototype","MapIteratorPrototype","SetIteratorPrototype","return","throw","from","of","BYTES_PER_ELEMENT","buffer","byteLength","byteOffset","copyWithin","entries","every","fill","find","findIndex","lastIndexOf","map","reduce","reduceRight","reverse","slice","some","sort","subarray","values","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","getOwnPropertySymbols","is","isFrozen","isSealed","preventExtensions","seal","isPrototypeOf","propertyIsEnumerable","valueOf","toPrimitive","toStringTag","bind","call","hasInstance","arity","species","asyncIterator","for","isConcatSpreadable","keyFor","match","matchAll","search","EPSILON","isInteger","isSafeInteger","MAX_SAFE_INTEGER","MAX_VALUE","MIN_SAFE_INTEGER","MIN_VALUE","NEGATIVE_INFINITY","POSITIVE_INFINITY","toExponential","toFixed","toPrecision","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2","abs","acos","acosh","asin","asinh","atan","atanh","atan2","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log","log1p","log10","log2","max","min","pow","round","sign","sin","sinh","sqrt","tan","tanh","trunc","parse","UTC","getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleTimeString","toTimeString","toUTCString","getYear","setYear","toGMTString","fromCharCode","fromCodePoint","raw","charAt","charCodeAt","codePointAt","endsWith","localeCompare","normalize","padEnd","padStart","repeat","startsWith","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","substr","anchor","big","blink","bold","fixed","fontcolor","fontsize","italics","link","small","strike","sub","sup","trimLeft","trimRight","flags","ignoreCase","multiline","source","sticky","unicode","dotAll","lastIndex","isArray","push","shift","splice","unshift","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float64Array","clear","delete","size","ArrayBuffer","isView","DataView","getFloat32","getFloat64","getInt8","getInt16","getInt32","getUint8","getUint16","getUint32","setFloat32","setFloat64","setInt8","setInt16","setInt32","setUint8","setUint16","setUint32","JSON","stringify","Promise","all","race","reject","resolve","catch","then","finally","put","del","post","invoke","fapply","fcall","send","end","Q","isPassByCopy","passByCopy","makeRemote","makeFar","shorten","isPromise","async","rejected","promise","delay","memoize","defer","deleteProperty","revocable","escape","unescape","StringMap","confine","confineExpr","Nat","def","makeConsole","parentConsole","newConsole","orig","makeMakeRequire","makeRequire","config","cache","newRequire","whatArg","what","build","c","attenuatorSource","attenuator","createSESWithRealmConstructor","creatorStrings","makeSESRootRealm","wl","dateNowMode","mathRandomMode","intlMode","errorStackMode","stackTraceLimit","prepareStackTrace","regexpMode","removeProp","makeHardenerSrc","hardenerOptions","createSESInThisRealm","consoleMode","makeInsulate","nonMapped","insulate","warmTarget","warmToColdMap","wrapWithMaps","inMap","outMap","wrapped","enter","inbound","leave","outThunk","insulated","_target","_attributes","_v","_value","receiver","key","argumentsList","wrappedThis","wrappedArguments","exprSrc","env","names","closedFuncSrc","closedFunc","n","window","globalEnv","sesshim","applyMethod","thisObj","method","setComputedIndex","index","slog","makeMap","makeSet","makePromise","executor","makeWeakMap","makeWeakSet","contextArg","context","a","valname","vname","oval","makeSlog","handler","levels","doit","level","tag","contextOrTemplate","template","i","panic","alert","crit","warn","notice","info","debug","trace","cachedSetTimeout","cachedClearTimeout","process","module","exports","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","runClearTimeout","marker","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","timeout","len","run","Item","array","noop","nextTick","title","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","primEnv","mySlog","ca","reduced","prior","last","at0","at1","at2","at3","exitCode","indent","substs","newnewline","ilen","segment","lastnl","subst","$i_indent","LEFT_RECUR","RUN","ruleOrPatt","pos","_debug","posm","_memo","_hits","_misses","EAT","lastFailures","maxPos","fails","posArr","fail","newPos","FAIL","ERROR","_pos","found","FIND","tokStr","makeTokStr","failStr","sources","uri","line","DONE","v","numSubs","relpos","segnum","seglen","ACCEPT","_self","str","HOLE","SKIP","lHexDigits","uHexDigits","hexDigit","cs","q","ord","bootPeg","makePeg","bootPegAst","sexp","alphaCount","vars","nextVar","nextLabel","vtable","peg","rules","rulesSrc","peval","paramSrcs","bodySrc","empty","or","choices","labelSrc","choicesSrc","cSrc","seq","terms","posSrc","sSrc","vSrc","termsSrc","termSrc","pred","hole","val0","act","patt","sep","startSrc","pattSrc","sepSrc","sepValSrc","starSrc","super","ident","begin","cls","classStr","invert","c2","k","op","srcCs","dot","lit","peek","peekNot","expr","nameStr","quasifyParser","parserCreator","quasiMemo","quasiCurry","wm","templateTag","templateOrFlag","quasiRest","subs","baseCurry","parser","pair","done","defaultBaseGrammar","_template","metaCompile","baseRules","baseAST","parserTraitMakerSrc","makeParserTrait","parserTrait","_asExtending","quasiParser","ext","baseQuasiParser","tag0","tmplOrFlag","boundParser","parserBase","flag","extends","pegTag","closedDefaultBaseGrammar","actionExtractorTag","actions","bootPegActions","bootPegTag","astExtractorTag","defs","reparsedPegAst","b","finalPegTag","simple","list","flatArgs","flatSeq","term","kind","_","_2","optHole","optQ","makeJessieModule","jessiePeg","d","terminatedBlock","manyBodies","bs","makeJessie","justinPeg","jessieTag","_3","id","lv","rv","pe","_4","label","stat","f","o","_5","decls","ps","h","tb","pfx","fname","d2","makeJSON","es","js","qunpack","ms","qrepack","parts","argExprs","reduceElisions","$i_qunpack","binary","left","rights","prev","transformSingleQuote","qs","makeJustin","u","y","hide","separate","strs","ret","actualSep","moduleRewriteDefine","moduleAST","DEFINE","starName","EXPORTS","imports","exportVars","nImport","rewriters","as","imp","sym","doRewrite","exportDefaultX","exportX","qual","binds","bindings","import","clause","fromModule","importBind","matchArray","matchProp","kw","rewrite","matchRecord","moduleX","cur","modules","mod","rest","restObj","node","rewriter","tagString","tagged","cooked","cooked0","raw0","sources0","byte","column","tmpl","$i_bootPeg","$i_bootPegAst","$i_makePeg","$i_makeJessieModule","$i_makeJessie","$i_makeJSON","$i_makeJustin","rewriteModuleDefine","$i_rewriteModuleDefine","$i_tagString","jsonTag","justinTag","jessieModuleTag","translate","sourceText","parameters","sourceType","targetType","moduleAst","sourceURL","translatedText","globals","iSES"],"mappings":";AA0IeA,aArHf,SAASA,EAAaC,GACd,MAAA,OAAEC,EAAF,0BAAUC,EAAV,eAAqCC,GAAmBC,QACxD,QAAEC,GAAYC,QAIdC,EAAY,IAAIC,QAAQR,GA4GvBS,OA1GEA,SAAOC,GACRC,MAAAA,EAAW,IAAIC,IACfC,EAAa,IAAIC,IACjBC,EAAQ,IAAIC,QAITC,SAAAA,EAAQC,EAAKC,GAChBf,GAAAA,OAAOc,KAASA,EAElB,OAEIE,MAAAA,SAAcF,EAChBE,GAAS,WAATA,GAA8B,aAATA,EAEjB,MAAA,IAAIC,gCAAgCD,KAExCb,EAAUe,IAAIJ,IAAQP,EAASW,IAAIJ,KAKvCP,EAASY,IAAIL,GACbH,EAAMS,IAAIN,EAAKC,IAGRM,SAAAA,EAAkBC,GAQzBzB,EAAOyB,GAMDC,MAAAA,EAAQxB,EAAeuB,GACvBE,EAAQ1B,EAA0BwB,GAClCP,EAAOJ,EAAMc,IAAIH,IAAQ,UAGjB,OAAVC,GAAmBd,EAAWS,IAAIK,KACpCd,EAAWW,IAAIG,EAAOR,GACtBJ,EAAMS,IAAIG,KAAUR,gBAGtBd,EAAQuB,GAAOE,QAAQC,IACfC,MAAAA,KAAcb,KAAQc,OAAOF,KAS7BG,EAAON,EAAMG,GACf,UAAWG,EAEbjB,EAAQiB,EAAKC,SAAUH,MAEvBf,EAAQiB,EAAKL,OAAQG,UACrBf,EAAQiB,EAAKV,OAAQQ,aAqCpBtB,OARPO,EAAQP,GAtBNC,EAASmB,QAAQL,GAIjBZ,EAAWiB,QAAQ,CAACX,EAAMiB,KACpB,IAAEzB,EAASW,IAAIc,KAAM7B,EAAUe,IAAIc,GAE/B,MAAA,IAAIf,uBACKe,QAAQjB,uCAW3BR,EAASmB,QAAQvB,EAAUgB,IAAKhB,GAW3BG,GAMIX,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,aAAAA,EAAAA,IAAAA,EAAAA,EAAAA,QAAAA,QAAAA;;ACzIf,IAAA,EAAA,GAAA,QAEA,OAAA,QAAA,SAAA,EAAA,GACA,GAAA,EAAA,OAAA,EAAA,QAAA,GACA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,SAAA,EACA,GAAA,EAAA,KAAA,EAAA,OAAA,EAEA,OAAA;;ACRA,IAAA,QAAA,QAAA,WAEA,YAAA,SAAA,GACA,GAAA,OAAA,KAAA,OAAA,OAAA,KAAA,GAEA,IAAA,EAAA,GACA,IAAA,IAAA,KAAA,EAAA,EAAA,KAAA,GACA,OAAA,GAIA,QAAA,SAAA,EAAA,GACA,GAAA,EAAA,QAAA,OAAA,EAAA,QAAA,GACA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IACA,EAAA,EAAA,GAAA,EAAA,IAIA,WAAA,WACA,IAEA,OADA,OAAA,eAAA,GAAA,IAAA,IACA,SAAA,EAAA,EAAA,GACA,OAAA,eAAA,EAAA,EAAA,CACA,UAAA,EACA,YAAA,EACA,cAAA,EACA,MAAA,KAGA,MAAA,GACA,OAAA,SAAA,EAAA,EAAA,GACA,EAAA,GAAA,IAbA,GAkBA,QAAA,CAAA,QAAA,UAAA,OAAA,QAAA,YAAA,WACA,WAAA,OAAA,OAAA,MAAA,SAAA,SAAA,aACA,iBAAA,SAAA,SAAA,cAAA,YAAA,WACA,YAAA,qBAAA,YAAA,qBAAA,SACA,OAAA,WAAA,QAAA,aAAA,WAAA,YAAA,YAEA,SAAA,WACA,QAAA,UAAA,GAEA,IAAA,OAAA,QAAA,OAAA,SAAA,GACA,KAAA,gBAAA,QAAA,OAAA,IAAA,OAAA,GACA,KAAA,KAAA,GAGA,OAAA,UAAA,aAAA,SAAA,GACA,KAAA,aAAA,SACA,MAAA,IAAA,UAAA,+BAGA,IAAA,EAAA,SAAA,cAAA,UACA,EAAA,QAAA,EAAA,MAAA,IACA,EAAA,MAAA,QAAA,OAEA,SAAA,KAAA,YAAA,GAEA,IAAA,EAAA,EAAA,cACA,EAAA,EAAA,KAAA,EAAA,EAAA,YAEA,GAAA,IAEA,EAAA,KAAA,EAAA,QACA,EAAA,EAAA,MAGA,QAAA,YAAA,GAAA,SAAA,GACA,EAAA,GAAA,EAAA,KAEA,QAAA,QAAA,SAAA,GACA,EAAA,KACA,EAAA,GAAA,EAAA,MAIA,IAAA,EAAA,YAAA,GAEA,EAAA,EAAA,KAAA,EAAA,KAAA,MAmBA,OAjBA,QAAA,YAAA,GAAA,SAAA,IAIA,KAAA,IAAA,IAAA,QAAA,EAAA,MACA,EAAA,GAAA,EAAA,MAIA,QAAA,QAAA,SAAA,GACA,KAAA,GACA,WAAA,EAAA,EAAA,EAAA,MAIA,SAAA,KAAA,YAAA,GAEA,GAGA,OAAA,UAAA,iBAAA,WACA,OAAA,KAAA,KAAA,OAGA,OAAA,UAAA,gBAAA,SAAA,GACA,IAAA,EAAA,OAAA,cAAA,GACA,EAAA,KAAA,aAAA,GAMA,OAJA,QAAA,YAAA,GAAA,SAAA,GACA,EAAA,GAAA,EAAA,KAGA,GAGA,QAAA,YAAA,OAAA,WAAA,SAAA,GACA,QAAA,GAAA,OAAA,GAAA,SAAA,GACA,IAAA,EAAA,OAAA,GACA,OAAA,EAAA,GAAA,MAAA,EAAA,GAAA,MAAA,KAAA,UAAA,OAIA,QAAA,aAAA,SAAA,GACA,OAAA,QAAA,OAAA,IAGA,QAAA,cAAA,OAAA,cAAA,SAAA,GACA,IAAA,EAAA,IAAA,QAMA,MALA,iBAAA,GACA,QAAA,YAAA,GAAA,SAAA,GACA,EAAA,GAAA,EAAA,KAGA;;;ACu0FesC,aAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,aAAAA,EA/8Ff,IAAA,EAAA,EAAA,QAAA,0BA+8FeA,SAAAA,EAAAA,GAAAA,OAAAA,GAAAA,EAAAA,WAAAA,EAAAA,CAAAA,QAAAA,GAx8Ff,SAASC,EAAaC,EAAGC,GACjBC,MAAAA,wCAA4CF,IAc5CE,MAVNC,QAAQC,MAAMF,GACVD,IAEFE,QAAQC,SAASH,KAEjBE,QAAQC,SAASH,EAAII,UAKjBH,EAGR,SAASI,EAAOC,EAAWC,GACpBD,GACHR,EAAaS,GAKjB,SAASC,EAAcC,GAUdA,OAHPA,GAHAA,EAAMA,EAAIC,QAAQ,eAAgB,cAGxBA,QAAQ,qBAAsB,IAS1C,SAASC,EAAgBC,EAAWC,GAC5B,MAAA,cAAEC,EAAF,gBAAiBC,EAAjB,eAAkCC,EAAlC,cAAkDC,GAAkBJ,GAQpE,OAAEK,EAAF,iBAAUC,GAAqBvD,OAE/BwD,EAAoB,IAAI9C,IAAI,CAChC,CAAC,YAAa+C,WACd,CAAC,aAAcC,YACf,CAAC,iBAAkBC,gBACnB,CAAC,cAAeC,aAChB,CAAC,YAAa3C,WACd,CAAC,WAAY4C,YAKNC,SAAAA,EAAiBC,KAAWC,GAC/B,IACKD,OAAAA,KAAUC,GACjB,MAAO5B,GACHpC,GAAAA,OAAOoC,KAASA,EAEZA,MAAAA,EAEJ6B,IAAAA,EAAOC,EAAUC,EACjB,IAWFF,KAAW7B,EAAIT,OACfuC,KAAc9B,EAAIO,UAClBwB,KAAY/B,EAAII,OAAS0B,IAGzB,MAAOE,GAGD,MAAA,IAAIC,MAAM,iBAEZC,MAAAA,EAAmBd,EAAkB/B,IAAIwC,IAAUI,MACrD,IACI,MAAA,IAAIC,EAAiBJ,GAC3B,MAAOK,GAEDA,MADNA,EAAK/B,MAAQ2B,EACPI,IAKNC,MAAAA,EACJC,cAQQ,MAAA,IAAIxD,UAAU,8BAGfyD,qBAAcC,GAEnBA,EAAU3E,OAAO2E,GAGXC,MAAAA,EAAItB,EAAOkB,EAAMK,WAEhBD,OADPd,EAAiBZ,EAAeF,EAAW4B,EAAGD,GACvCC,EAGFE,yBAECF,MAAAA,EAAItB,EAAOkB,EAAMK,WAEhBD,OADPd,EAAiBX,EAAiBH,EAAW4B,GACtCA,EAOLG,aAKKjB,OAAAA,EAAiBV,EAAgB,MAG1C4B,SAASC,EAAGC,GAEHpB,OAAAA,EAAiBT,EAAe,KAAM4B,EAAGC,IAsB7CV,OAlBPjB,EAAiBiB,EAAO,CACtBW,SAAU,CACRpD,MAAO,IAAM,mCACbqD,UAAU,EACVC,YAAY,EACZC,cAAc,KAIlB/B,EAAiBiB,EAAMK,UAAW,CAChCM,SAAU,CACRpD,MAAO,IAAM,iBACbqD,UAAU,EACVC,YAAY,EACZC,cAAc,KAIXd,EAMT,MAAMe,EAAwB3C,oBAAgCG,MAE9D,SAASyC,EAAkBxC,EAAWC,GAC9B,MAAA,WAAEwC,GAAezC,EAgBhByC,OAAAA,EAAWF,EAAXE,CAAkCzC,EAAWC,GAWtD,MAAM,OACJyC,EADI,OAEJpC,EAFI,OAGJzD,EAHI,iBAIJ0D,EAJI,yBAKJoC,EALI,0BAMJ7F,EANI,oBAOJ8F,EAPI,eAQJ7F,EARI,eASJ8F,GACE7F,QAEE,MACJ8F,EADI,QAEJ7F,GACEC,QAeE6F,EAAcC,GAAM,CAACC,KAAYjC,IAAS8B,EAAME,EAAIC,EAASjC,GAI7DkC,EAAuBH,EAAY/F,OAAO6E,UAAUsB,gBACxDC,EAAcL,EAAYM,MAAMxB,UAAUyB,QAC1CC,EAAWR,EAAYM,MAAMxB,UAAU2B,KACvCC,EAAYV,EAAYM,MAAMxB,UAAU6B,MACxCC,EAAcZ,EAAYM,MAAMxB,UAAU+B,QAC1CC,EAAad,EAAYe,OAAOjC,UAAUkC,MAC1CC,EAAiBjB,EAAYlE,OAAOgD,UAAUoC,UAK1CC,EAA4B,CAIhC,WACA,QACA,aACA,WAEA,YACA,qBACA,YACA,qBAIA,QACA,cACA,UACA,WACA,OACA,QACA,YACA,eACA,eAEA,YACA,aACA,aACA,MACA,SACA,SACA,UACA,QACA,aACA,iBACA,SACA,MAEA,SACA,SACA,cACA,YACA,aACA,oBACA,cACA,cACA,WACA,UACA,UAKA,OACA,OACA,UAIA,SACA,WAIA,QAOF,SAASC,EAAqBC,GACtBC,MAAAA,EAAc,CAElBC,SAAU,CAAEvF,MAAOuF,EAAAA,GACnBC,IAAK,CAAExF,MAAOwF,KACdC,UAAW,CAAEzF,WAAOyF,IAGjB,IAAA,MAAM7F,KAAQuF,EAA2B,CACtCpF,MAAAA,EAAO6D,EAAyByB,EAAczF,GAChDG,IAGFW,EAAO,UAAWX,6CAAiDH,KAEnE0F,EAAY1F,GAAQ,CAClBI,MAAOD,EAAKC,MACZqD,UAAU,EACVE,cAAc,IAKb+B,OAAAA,EAoBT,SAASI,IACD,MAAA,eACJC,EADI,iBAEJnE,EAFI,yBAGJoC,EAHI,eAIJ5F,EACA8E,UAAW8C,GACT3H,OAOA,KAGD,EAAG2H,EAAgBC,kBAAkB,KACtC,MAAOC,GAEP,OAGOC,SAAAA,EAASxG,GACZA,GAAAA,MAAAA,EACI,MAAA,IAAIL,UAAW,6CAEhBjB,OAAAA,OAAOsB,GAGPyG,SAAAA,EAAezG,GAClB,MAAe,iBAARA,EACFA,KAECA,IAGH0G,SAAAA,EAAU1G,EAAK2G,GAClB,GAAe,mBAAR3G,EACHL,MAAAA,qBAAqBgH,WAEtB3G,OAAAA,EAGTiC,EAAiBoE,EAAiB,CAChCO,iBAAkB,CAChBnG,MAAO,SAA0BoG,EAAMC,GAC/BC,MAAAA,EAAIP,EAAS,MACnBJ,EAAeW,EAAGF,EAAM,CACtB1G,IAAKuG,EAAUI,EAAM,UACrB/C,YAAY,EACZC,cAAc,MAIpBgD,iBAAkB,CAChBvG,MAAO,SAA0BoG,EAAMC,GAC/BC,MAAAA,EAAIP,EAAS,MACnBJ,EAAeW,EAAGF,EAAM,CACtB/G,IAAK4G,EAAUI,EAAM,UACrB/C,YAAY,EACZC,cAAc,MAIpBsC,iBAAkB,CAChB7F,MAAO,SAA0BoG,GAC3BE,IAEAvG,EAFAuG,EAAIP,EAAS,MAGVO,IAFPF,EAAOJ,EAAeI,GAEfE,KAAOvG,EAAO6D,EAAyB0C,EAAGF,KAC/CE,EAAItI,EAAesI,GAEdvG,OAAAA,GAAQA,EAAKL,MAGxB8G,iBAAkB,CAChBxG,MAAO,SAA0BoG,GAC3BE,IAEAvG,EAFAuG,EAAIP,EAAS,MAGVO,IAFPF,EAAOJ,EAAeI,GAEfE,KAAOvG,EAAO6D,EAAyB0C,EAAGF,KAC/CE,EAAItI,EAAesI,GAEdvG,OAAAA,GAAQA,EAAKV,QA0B5B,SAASoH,IACD,MAAA,iBAAEjF,EAAF,eAAoBxD,EAApB,eAAoC8F,GAAmB7F,OAWpDyI,SAAAA,EAAe9G,EAAM+G,GACxBC,IAAAA,EACA,IAEFA,GAAmB,EAAIC,MAAMF,GAC7B,MAAOG,GACHA,GAAAA,aAAajF,YAEf,OAGIiF,MAAAA,EAEFC,MAAAA,EAAoB/I,EAAe4I,GAInCI,EAAgB,WACd,MAAA,IAAI9H,UAAU,kBAEtBsC,EAAiBwF,EAAe,CAAEpH,KAAM,CAAEI,MAAOJ,KAcjD4B,EAAiBuF,EAAmB,CAAErE,YAAa,CAAE1C,MAAOgH,KAI5DxF,EAAiBwF,EAAe,CAAElE,UAAW,CAAE9C,MAAO+G,KAElDC,IAAkBC,SAASnE,UAAUJ,aAEvCoB,EAAekD,EAAeC,SAASnE,UAAUJ,aAcrDgE,EAAe,WAAY,kBAC3BA,EAAe,oBAAqB,mBACpCA,EAAe,gBAAiB,wBAChCA,EAAe,yBAA0B,yBAa3C,MAAMQ,EAAkB,qBAClBC,EAAuB,oCAG7B,SAASC,IAQH,GAFW,IAAIH,SAAS,oDAAb,GAYR5B,OALIgC,QAAQ,MAGKC,gBAAgBH,GAM1C,SAASI,IACH,GAAoB,oBAAbC,SACF/B,OAEHgC,MAAAA,EAASD,SAASE,cAAc,UAY/BrC,OAXPoC,EAAOE,MAAMC,QAAU,OAEvBJ,SAASK,KAAKC,YAAYL,GACLA,EAAOM,cAAclB,KAAKK,GAWjD,MAAMc,EAAqB,KACnBC,MAAAA,EAA4BV,IAC5BW,EAAyBd,IAE5B,IAACa,IAA8BC,GAC/BD,GAA6BC,EAExB,MAAA,IAAI5F,MAAM,+CAEX2F,OAAAA,GAA6BC,GAStC,SAASC,EAAgB9C,EAAc+C,EAAW,IAC1CC,MAAAA,EAAoBjD,EAAqBC,GAExCvH,OAAAA,EAAO,CACZuH,aAAAA,EACAgD,kBAAAA,EACA3E,WAAY2B,EAAawB,KACzByB,eAAgBjD,EAAa4B,SAC7BmB,SAAAA,IAIJ,MAAMG,EAAsB1H,oBAAgC6E,SACtD8C,EAAsB3H,oBAAgC4F,SAI5D,SAASgC,EAAmBL,GACpB/C,MAAAA,EAAe2C,IAGdG,OAFP9C,EAAawB,KAAK0B,GAClBlD,EAAawB,KAAK2B,GACXL,EAAgB9C,EAAc+C,GAKvC,SAASM,IACDrD,MAAAA,GAAe,EAAIwB,MAAMK,GAGxBiB,OAFPzC,IACAe,IACO0B,EAAgB9C,GAezB,MAAMsD,EAAoB,qBAMpBC,EAAW,IAAInK,IAAI,CAEvB,QACA,QACA,OACA,QACA,QACA,QACA,WACA,WACA,UACA,SACA,KACA,OACA,SACA,UACA,UACA,MACA,WACA,KACA,SACA,KACA,aACA,MACA,SACA,QACA,SACA,OACA,QACA,MACA,SACA,MACA,OACA,QACA,OACA,QAGA,MACA,SAGA,OAGA,aACA,UACA,YACA,YACA,UACA,SAGA,QAEA,OACA,OACA,QAEA,OACA,cAYF,SAASoK,EAAsBC,GACvBrJ,MAAAA,EAAQ1B,EAA0B+K,GAgCjCC,OA5BW1E,EAAYR,EAAoBpE,GAAQG,IAGpDA,GAAS,SAATA,GAAmBgJ,EAASzJ,IAAIS,KAAUkF,EAAW6D,EAAmB/I,GACnE,OAAA,EAGHG,MAAAA,EAAON,EAAMG,GAEjB,OAOsB,IAAtBG,EAAKwD,eACa,IAAlBxD,EAAKsD,UAOLc,EAAqBpE,EAAM,WAYjC,MAAMiJ,EAAqB,IAAIC,MAAMnL,EAAO,IAAK,CAC/C4B,IAAIsC,EAAQoE,GACVjG,2CAAsDiG,QAkB1D,SAAS8C,EAAmBjI,GACpB,MAAA,aAAEoE,EAAF,WAAgB3B,GAAezC,EAIjCkI,IAAAA,GAAqB,EAElB,MAAA,CAILC,UAAWJ,EAEXK,2BACEF,GAAqB,GAGvBG,uBAAsB,IACbH,EAGTzJ,IAAG,CAACsC,EAAQoE,IAIG,SAATA,GAEyB,IAAvB+C,GAEFA,GAAqB,EACdzF,GAEF1B,EAAO6E,KAIZT,IAASmD,OAAOC,aAShBpD,KAAQpE,EACHA,EAAOoE,QAVZA,EAkBN/G,IAAI2C,EAAQoE,EAAMpG,GAKZmE,GAAAA,EAAqBnC,EAAQoE,GAEzB,MAAA,IAAIlH,2CAA2CY,OAAOsG,MASvD,OAHPpI,EAAegE,GAAQoE,GAAQpG,GAGxB,GAuBTb,IAAG,CAAC6C,EAAQoE,IAOG,SAATA,GAAmBA,KAAQpE,GAAUoE,KAAQf,GAgBvD,MAAMoE,EAAe,kCAErB,SAASC,EAAwBtJ,GACzBuJ,MAAAA,EAAUF,EAAaG,KAAKxJ,GAC9BuJ,GAAAA,EAAS,CAILE,MAAAA,EAAUF,EAAQ,GAAGG,MAAM,MAAMC,OACjC,MAAA,IAAIlI,+DAA+DgI,MAM7E,SAASG,EAAejB,GAElBA,OAAqB,IAArBA,EAAUgB,OAAqB,aAGlBrF,EAAUqE,EAAW,gBAGxC,SAASkB,EAA6BhJ,EAAW8H,GACzC,MAAA,eAAET,GAAmBrH,EA6BpBqH,OAAAA,wCA3BW0B,EAAejB,iHAsCnC,SAASmB,EAA2BjJ,EAAW6H,GACvC,MAAA,eAAER,GAAmBrH,EAErBkJ,EAAejB,EAAmBjI,GAElCmJ,EAAyBH,EAA6BhJ,EADjC4H,EAAsBC,IAqE1CuB,OAlEEA,SAAQlH,EAAa,IAStBmH,MAAAA,EAAc/I,EAAOuH,EAAY/K,EAA0BoF,IAC3DoH,EAAa,IAAItB,MAAMqB,EAAaH,GACpCK,EAAkBzG,EAAMqG,EAAwBtB,EAAY,CAACyB,IAM7DE,EAAW,CACf5D,KAAK/F,GAICT,IAAAA,EAFJqJ,EADA5I,KAASA,KAETqJ,EAAad,2BAET,IAEKtF,OAAAA,EAAMyG,EAAiB1B,EAAY,CAAChI,IAC3C,MAAOgG,GAGDA,MADNzG,EAAMyG,EACAA,EACE,QAGJqD,EAAab,0BACfnJ,EAAa,4CAA6CE,MAIhEwG,KAyBK4D,OAhBP3G,EAAe2G,EAAUnC,EAAexF,WAExCpC,EAAO1C,EAAeyM,GAAU/H,cAAgBuE,SAAU,iBAC1DvG,EAAO1C,EAAeyM,GAAU/H,cAAgB4F,EAAgB,uBAIhE9G,EAAiBiJ,EAAU,CACzBrH,SAAU,CACRpD,MAAOyK,EAAS,2CAChBpH,UAAU,EACVC,YAAY,EACZC,cAAc,KAIXkH,GAMX,SAASC,EAAoBC,GACpBA,OAAAA,IAGT,SAASC,EAAwCD,GACxC,MAAA,CAACzH,EAAGC,IAAewH,EAAqBxH,EAArBwH,CAAiCzH,GAO7D,SAAS2H,EAAwB5J,EAAWwJ,GACpC,MAAA,eAAEnC,EAAF,aAAkBjD,GAAiBpE,EAEnC6J,EAAe,YAAqBC,GAClCC,MAAAA,KAAkBxG,EAASuG,IAAW,KACxCE,IAAAA,KAAoBvG,EAAUqG,EAAQ,OACtC,IAACjG,EAAW,aAAcmG,GACtB,MAAA,IAAI5F,EAAaxD,YACrB,kKA2BAoD,GAFAqD,IAAAA,EAAe0C,GAEf/F,EAAegG,EAAgB,KAM3B,MAAA,IAAI5F,EAAaxD,YACrB,6DAgBG4I,OAVHQ,EAAelB,OAAS,IAI1BkB,GAAkB,YAMbR,eAFkBQ,QAAqBD,UA2BzCF,OApBPhH,EAAegH,EAAcxC,EAAexF,WAE5CpC,EAAO1C,EAAe8M,GAAcpI,cAAgBuE,SAAU,iBAC9DvG,EAAO1C,EAAe8M,GAAcpI,cAAgB4F,EAAgB,uBAEpE9G,EAAiBsJ,EAAc,CAG7BhI,UAAW,CAAE9C,MAAOsI,EAAexF,WAInCM,SAAU,CACRpD,MAAOyK,EAAS,+CAChBpH,UAAU,EACVC,YAAY,EACZC,cAAc,KAIXuH,EAKT,MAAMI,GAA2B,IAAIrM,QAErC,SAASsM,GAA4BC,GAM5BF,OAJPxK,EAAOzC,OAAOmN,KAAWA,EAAO,oCAEhC1K,EAAOwK,GAAyB/L,IAAIiM,GAAQ,gCAErCF,GAAyBxL,IAAI0L,GAGtC,SAASC,GAAiCD,EAAOE,GAE/C5K,EAAOzC,OAAOmN,KAAWA,EAAO,oCAEhC1K,GAAQwK,GAAyB/L,IAAIiM,GAAQ,uCAE7CF,GAAyB7L,IAAI+L,EAAOE,GAItC,SAASC,GAAmBlD,EAAmBS,EAAY2B,EAAUK,GACnEtJ,EAAiBsH,EAAYT,GAE7B7G,EAAiBsH,EAAY,CAC3BjC,KAAM,CACJ7G,MAAOyK,EACPpH,UAAU,EACVE,cAAc,GAEhB0D,SAAU,CACRjH,MAAO8K,EACPzH,UAAU,EACVE,cAAc,KAKpB,SAASiI,GAAevK,GAChB,MAAA,kBAAEoH,EAAF,aAAqBhD,GAAiBpE,EAEtC6H,EAAavH,EAAO8D,EAAapH,OAAO6E,WACxC6H,EAAuBT,EAA2BjJ,EAAW6H,GAC7D2B,EAAWC,EAAoBC,GAC/Bc,EAA+Bb,EACnCD,GAEIG,EAAeD,EAAwB5J,EAAWwJ,GAWjDa,OATPC,GAAmBlD,EAAmBS,EAAY2B,EAAUK,GAE3ChN,EAAO,CACtBgL,WAAAA,EACA2B,SAAAA,EACAgB,6BAAAA,EACAX,aAAAA,IAWJ,SAAS3J,GAAcuK,EAAiBC,EAAM/I,GAKtC,MAAEgJ,MAAOC,GAAajJ,EACtBwF,EAAWxD,EAAY8G,EAAgBtD,SAAUyD,GAGjD5K,EAAYwH,EAAmBL,GAG/B3F,EAAQgB,EAAkBxC,EAAWC,IAI3CD,EAAUoH,kBAAkB5F,MAAQ,CAClCzC,MAAOyC,EACPY,UAAU,EACVE,cAAc,GAKV+H,MAAAA,EAAWE,GAAevK,IAG1B,6BAAEwK,GAAiCH,EACpC,IAAA,MAAMQ,KAAQ1D,EACjBqD,EAA6BK,GAI/BT,GAAiCM,EAAML,GAOzC,SAASlK,GAAgBH,EAAW0K,GAMlCN,GAAiCM,EAHhBH,GAAevK,IAMlC,SAASI,GAAesK,GAChB,MAAA,WAAE7C,GAAeqC,GAA4BQ,GAC5C7C,OAAAA,EAGT,SAASxH,GAAcqK,EAAMzI,EAAGC,EAAa,IAIrC,MAAA,6BAAEsI,GAAiCN,GAA4BQ,GAC9DF,OAAAA,EAA6BvI,EAAGC,GAGzC,MAAMjC,GAAY,CAChBC,cAAAA,GACAC,gBAAAA,GACAC,eAAAA,GACAC,cAAAA,IAKIyK,GAAmBrD,IAOnBjG,GAAQzB,EAAgB+K,GAAkB7K,IAEhD,SAAS8K,KACDC,MAAAA,EAAaC,KAMbC,EAAqB,YAAiBlK,GACtCmK,YAAe3G,eAGV,eAGLxD,EAAK8H,OAAS,EACT5L,QAAQkO,UAAUJ,EAAYhK,cAIhC9D,QAAQkO,UAAUJ,EAAY,CAACzG,kBAGxCvH,OAAOuD,iBACL2K,EACAlO,OAAOF,0BAA0BkO,IAInCA,EAAWnJ,UAAUJ,YAAcyJ,EAEnCA,EAAmBG,IAAM,KAAM9G,KAE/B0G,KAAOC,EAGT,SAASI,KAEPC,KAAKC,OAAS,MACNnK,MAAAA,MAAM,cAMhB,SAASoK,KAOa,oBAATC,OACTA,KAAKC,eAAiB,MACdtK,MAAAA,MAAM,cAEdqK,KAAKE,aAAe,MACZvK,MAAAA,MAAM,cAEdqK,KAAKG,oBAAsB,MACnBxK,MAAAA,MAAM,eAIhBrE,OAAO6E,UAAUiK,eAAiB,MAC1B,MAAA,IAAIzK,MAAM,+BAIpB,SAAS0K,KACH,IAAC/O,OAAOgP,aAAa3K,OACjBA,MAAAA,MAAM,+BASV,UADGA,MAAM4K,kBACT,sBAAuB5K,MACnBA,MAAAA,MAAM,mDAwBhB,SAAS6K,KAEH,UADGpI,OAAOjC,UAAUsK,QACpB,YAAarI,OAAOjC,UAChBR,MAAAA,MAAM,oDAKR+K,MAAAA,EAAetI,OASjB,GANJA,OAAS,YAAmB9C,GACnB9D,OAAAA,QAAQkO,UAAUgB,EAAcpL,eAEzC8C,OAAOjC,UAAYuK,EAAavK,UAChCuK,EAAavK,UAAUJ,YAAcqC,OAEjC,OAAQA,OACJzC,MAAAA,MAAM,qCA2BhB,SAASgL,GAAiBtK,EAAQuK,GAG1BvJ,MAGJJ,yBAA0B4J,EAC1B3J,oBAAqB4J,EAFjB,KAGJC,GACEzP,OACE0P,EAAW,IAAI9O,QACf+O,EAAW3P,OAAOD,eAClB6P,EATc5J,CAAAA,GAAM,CAACC,KAAYjC,IACrC9D,QAAQ4F,MAAME,EAAIC,EAASjC,GAQjB+B,CAAY/F,OAAO6E,UAAUsB,gBAEnC0J,EAAa,IAAIjP,QAEdkP,SAAAA,EAAgBC,EAAWC,GAU5BC,MAAAA,EAAmB,EAAC,GAAM,EAAO,IAAK,kBACnCC,SAAAA,EAASnO,EAAOoO,GACnBpO,GAAAA,IAAU/B,OAAO+B,GAGjB,GAAkB,iBAAXoO,EAAP,CAQAN,GAAAA,EAAW3O,IAAIa,GACX,MAAA,IAAIsC,MAAM,+CAElBwL,EAAWzO,IAAIW,EAAOoO,GACtBV,EAAKU,GAAQzO,QAAQC,IAIbG,MAAAA,EAAOyN,EAAKxN,EAAOJ,GACrBG,GACFoO,EAASpO,EAAKC,MAAOoO,EAAOxO,WAjB1BsO,GAAAA,EAAiBG,QAAQD,GAAU,EAC/B,MAAA,IAAI9L,sDACwC8L,KAmBxDD,CAASH,EAAWC,GAoFtBF,EAAgB/K,EAAQuK,EAAUe,iBAElCP,EADaQ,kBAAkBvL,GACTuK,EAAUiB,gBA5CvBC,SAAAA,EAAMzO,EAAO0O,EAAQC,GACxB3O,GAAAA,IAAU/B,OAAO+B,GACnB,OAEE2N,GAAAA,EAASjO,IAAIM,GACf,OAGIR,MAAAA,EAAQoO,EAAS5N,GACnBR,GAAU,OAAVA,IAAmBsO,EAAW3O,IAAIK,GAG9B,MAAA,IAAI8C,8BAA8BoM,eAG1Cf,EAAStO,IAAIW,GAAO,GACpByN,EAAKzN,GAAOL,QAAQC,IACZZ,MAAAA,EAAO0P,GAAUA,EAAS,IAAM,IAAM9O,EACtCK,EAjDD2O,SAAUC,EAAMjP,GACnBwO,IAAAA,EAASN,EAAWpO,IAAImP,GACxBT,GAAAA,GACEP,EAAIO,EAAQxO,GACPwO,OAAAA,EAAOxO,GAIX,OAAM,CAEPiP,GAAS,QADbA,EAAOjB,EAASiB,IAEP,OAAA,EAGLT,IADJA,EAASN,EAAWpO,IAAImP,KACVhB,EAAIO,EAAQxO,GAAO,CACzBkP,MAAAA,EAASV,EAAOxO,GAClBkP,MAAW,MAAXA,GACKA,IAgCDF,CAAU5O,EAAOJ,GACvBK,GAAAA,EAAG,CACCF,MAAAA,EAAOyN,EAAKxN,EAAOJ,GACrBiO,EAAI9N,EAAM,SAGZ0O,EADiB1O,EAAKC,MACNhB,EAAM2P,EAAM,GACb,kBAAN1O,SAMFD,EAAMJ,IAEb6O,EAAM1O,EAAKL,OAAQV,YAAgB2P,EAAM,GACzCF,EAAM1O,EAAKV,OAAQL,YAAgB2P,EAAM,gBAGpC3O,EAAMJ,KAQnB6O,CAAMzL,EAAQ,GAAI,GAuEpB,SAAS+L,GAAoB/L,GAErBwK,MAAAA,EAAOvP,OAAO2F,yBACdgK,EAAW3P,OAAOD,eA+BdgR,SAAAA,KACJC,MAAAA,EAAYrB,EAASoB,GACXE,eAAAA,KACVC,MAAAA,EAAiBvB,EAASsB,GACjBE,eAAAA,KACTC,MAAAA,EAAyBzB,EAASwB,GAmC/BE,SAAAA,EAAuBC,EAAWV,EAAMjP,GACzC4P,MAAAA,EACHxM,EAAOuG,QAAUvG,EAAOuG,OAAOkG,UAAa,aAE3CZ,GAAAA,EAAKW,GAAc,CACfE,MAAAA,EAASb,EAAKW,KACdG,EAAsB/B,EAAS8B,GACrCH,EAAU3P,GAAQ+P,EACZC,MAAAA,EAAkBhC,EAAS+B,GAC7BC,GAAAA,IAAoB3R,OAAO6E,UACzB,GAACyM,EAAUM,mBAOR,GAAIN,EAAUM,oBAAsBD,EACnC,MAAA,IAAItN,qBAAqB1C,oBARC,CAC5BgO,GAAAA,EAASgC,KAAqB3R,OAAO6E,UACjC,MAAA,IAAIR,MACR,0DAGJiN,EAAUM,kBAAoBD,IA4H/BE,MA1KkB,CACvB,CAAC,mBAAoB7R,OAAO6E,UAAW,IACvC,CAAC,qBAAsBmE,SAASnE,UAAW,cAC3C,CAAC,kBAAmBwB,MAAMxB,UAAW,IACrC,CAAC,mBAAoBiC,OAAOjC,UAAW,KACvC,CAAC,oBAAqBiN,QAAQjN,WAAW,GACzC,CAAC,mBAAoBkN,OAAOlN,UAAW,GACvC,CAAC,mBAAoBhD,OAAOgD,UAAW,KACvC,CAAC,cAAemM,EAAWD,GAC3B,CAAC,mBAAoBG,EAAgBD,GACrC,CAAC,kBAAmBG,EAAwBD,IAG7BzP,QAAQsQ,IACVA,EAAM,GAAbrQ,MACAsQ,EAAaD,EAAM,GACrBE,IAAAA,EAAQF,EAAM,GACdE,QAAU1K,IAAV0K,GAIAD,KADJC,EAAQlS,OAAOkS,KAIXD,IAAetC,EAASuC,GAGtB,MAAA,IAAI7N,gCAAgC4N,OAyCnCJ,WACDhB,MAAAA,EAAS,GAuBXlB,GAhBJkB,EAAOsB,eAAiB5C,EAAK6C,UAAW,UAAU3Q,IAMlD4P,EAAuBR,EAAQ,GAAI,0BACnCQ,EAAuBR,EAAQ,GAAI,2BAChB,mBAARnQ,KACT2Q,EAAuBR,EAAQ,IAAInQ,IAAO,wBAEzB,mBAARF,KACT6Q,EAAuBR,EAAQ,IAAIrQ,IAAO,wBAIxCmP,EAASqB,KAAehI,SAASnE,UAC7B,MAAA,IAAIR,MAAM,kDAEZgO,MAAAA,EAAoBrB,EAAUvM,YAChCkL,GAAAA,EAAS0C,KAAuBrJ,SAASnE,UAAUJ,YAC/C,MAAA,IAAIJ,MACR,sEAKAiO,GAFJzB,EAAOwB,kBAAoBA,EACN1C,EAASqB,EAAUnM,aACnBgM,EAAOe,kBACpB,MAAA,IAAIvN,MAAM,4CAIdsL,GAAAA,EAASuB,KAAoBlI,SAASnE,UAClC,MAAA,IAAIR,MAAM,uDAEZkO,MAAAA,EAAyBrB,EAAezM,YAC1CkL,GAAAA,EAAS4C,KAA4BvJ,SAASnE,UAAUJ,YACpD,MAAA,IAAIJ,MACR,2EAGJwM,EAAO0B,uBAAyBA,EAC1BC,MAAAA,EAA0BtB,EAAerM,UAK3C8K,GAJJkB,EAAO4B,uBAAyB9C,EAAS6C,GAIrC7C,EAASkB,EAAO4B,0BAA4BzS,OAAO6E,UAC/C,MAAA,IAAIR,MACR,6DAKAsL,GAAAA,EAASyB,KAA4BpI,SAASnE,UAC1C,MAAA,IAAIR,MACR,+DAGEqO,MAAAA,EAAgBtB,EAAuB3M,YACzCkL,GAAAA,EAAS+C,KAAmB1J,SAASnE,UAAUJ,YAC3C,MAAA,IAAIJ,MACR,kEA6BGwM,OA1BPA,EAAO6B,cAAgBA,EAGtB,WACK,IAAC3N,EAAO4N,aACV,OAEIC,MAAAA,EAAajD,EAAS5K,EAAO4N,cAC/BC,GAAAA,IAAe5J,SAASnE,UAAxB+N,CAGAjD,GAAAA,EAASiD,KAAgB5J,SAASnE,UAI9B,MAAA,IAAIR,MAAM,mDAElBwM,EAAO+B,WAAaA,GAdrB,GAiBD5S,OAAOyP,KAAKoB,GAAQnP,QAAQC,IACtBkP,QAAiBrJ,IAAjBqJ,EAAOlP,GACH,MAAA,IAAI0C,8BAA8B1C,OAIrCkP,EAGFgB,GAGT,SAASgB,GAAkB9N,EAAQwL,GAQ1BjQ,MANM,CACXyE,OAAAA,EACAwL,eAAAA,GAgHJ,MAAMuC,IAAI,EACJC,IAAI,EAEV,IAAIC,GAEJ,IAAI1D,GAAY,CAQdiB,eAAgB,CACd4B,eAAgB,GAChBP,kBAAmB,CASjBqB,KAAM,IACNxO,aAAa,GAEfyO,uBAAwB,GACxBC,wBAAyB,GACzBC,qBAAsB,GACtBC,qBAAsB,GAEtBZ,uBAAwB,GAgBxBJ,kBAAmB,CAEjBvG,OAAQ,IACRjH,UAAW,CAETA,UAAW,CACToO,KAAM,IACNK,OAAQ,IACRC,MAAO,IACP9O,YAAa,OAInB8N,uBAAwB,CAEtBzG,OAAQ,IACRjH,UAAW,CAETA,UAAW,CACToO,KAAM,IACNK,OAAQ,IACRC,MAAO,IACP9O,YAAa,OAInBiO,cAAe,CAEb5G,OAAQ,IACRjH,UAAW,KAGb+N,WAAaI,GAAsB,CAEjClH,OAAQ,IACRnK,KAAM,IACN6R,KAAMV,GACNW,GAAIX,GACJY,kBAAmB,IACnB7O,UAAW,CACT8O,OAAQ,gBACRC,WAAY,gBACZC,WAAY,gBACZC,WAAY,IACZC,QAAS,IACTC,MAAO,IACPC,KAAM,IACN3N,OAAQ,IACR4N,KAAM,IACNC,UAAW,IACXzS,QAAS,IACTuF,SAAU,IACVmJ,QAAS,IACT1J,KAAM,IACN+I,KAAM,IACN2E,YAAa,IACbtI,OAAQ,gBACRuI,IAAK,IACLC,OAAQ,IACRC,YAAa,IACbC,QAAS,IACTpT,IAAK,IACLqT,MAAO,IACPC,KAAM,IACNC,KAAM,IACNC,SAAU,IACVC,OAAQ,IACRnB,kBAAmB,OAKzBrD,gBAAiB,CAQf/I,SAAUyL,GACVxL,IAAKwL,GACLvL,UAAWuL,GAKX+B,SAAUhC,GACViC,MAAOjC,GACPkC,WAAYlC,GACZmC,SAAUnC,GACVoC,UAAWpC,GACXqC,mBAAoBrC,GACpBsC,UAAWtC,GACXuC,mBAAoBvC,GAIpB9S,OAAQ,CAEN0F,OAAQoN,GACRxP,OAAQwP,GACRvP,iBAAkBuP,GAClBpL,eAAgBoL,GAChBiB,QAASjB,GACTjT,OAAQkT,GACRpN,yBAA0BmN,GAC1BhT,0BAA2BgT,GAC3BlN,oBAAqBkN,GACrBwC,sBAAuBxC,GACvB/S,eAAgB+S,GAChByC,GAAIxC,GACJ/D,aAAc8D,GACd0C,SAAU1C,GACV2C,SAAU3C,GACVrD,KAAMqD,GACN4C,kBAAmB3C,GACnB4C,KAAM5C,GACNlN,eAAgBiN,GAChB+B,OAAQ/B,GAERjO,UAAW,CAGTqD,iBAAkB4K,GAClBxK,iBAAkBwK,GAClBlL,iBAAkBkL,GAClBvK,iBAAkBuK,GAElBrO,YAAa,IACb0B,eAAgB2M,GAChB8C,cAAe9C,GACf+C,qBAAsB/C,GACtBhE,eAAgB,IAChB3J,SAAU,IACV2Q,QAAS,IAGRxK,CAAAA,OAAOkG,UAAW,IAClBlG,CAAAA,OAAOyK,aAAc,IACrBzK,CAAAA,OAAO0K,aAAc,IACrB1K,CAAAA,OAAOC,aAAc,MAI1BvC,SAAU,CAER8C,OAAQgH,GACRjO,UAAW,CACTiB,MAAOgN,GACPmD,KAAMnD,GACNoD,KAAMpD,GACLxH,CAAAA,OAAO6K,aAAc,IAGtBrK,OAAQ,IACRnK,KAAM,IACNkD,UAAW,IACXuR,MAAO,IAGN9K,CAAAA,OAAO+K,SAAU,kBAItBvE,QAAS,CAEPjN,UAAWiO,IAGbxH,OAAQ,CAENgL,cAAexD,GACfyD,IAAKzD,GACLqD,YAAarD,GACb0D,mBAAoB1D,GACpBtB,SAAUsB,GACV2D,OAAQ3D,GACR4D,MAAO5D,GACP6D,SAAU7D,GACVhQ,QAASgQ,GACT8D,OAAQ9D,GACRuD,QAASvD,GACTjH,MAAOiH,GACPiD,YAAajD,GACbkD,YAAalD,GACbvH,YAAauH,GACbjO,UAAWiO,IAGbzO,MAAO,CAELQ,UAAW,CACTlD,KAAM,IACNgB,QAAS,MAYbc,UAAW,CACToB,UAAWiO,IAEbpP,WAAY,CACVmB,UAAWiO,IAEbnP,eAAgB,CACdkB,UAAWiO,IAEblP,YAAa,CACXiB,UAAWiO,IAEb7R,UAAW,CACT4D,UAAWiO,IAEbjP,SAAU,CACRgB,UAAWiO,IAKbf,OAAQ,CAEN8E,QAAS/D,GACTgC,SAAU/B,GACV+D,UAAWhE,GACXiC,MAAOhC,GACPgE,cAAehE,GACfiE,iBAAkBjE,GAClBkE,UAAWnE,GACXoE,iBAAkBnE,GAClBoE,UAAWrE,GACXvL,IAAKuL,GACLsE,kBAAmBtE,GACnBkC,WAAYlC,GACZmC,SAAUnC,GACVuE,kBAAmBvE,GACnBjO,UAAW,CACTyS,cAAexE,GACfyE,QAASzE,GACT0E,YAAa1E,KAIjBvE,KAAM,CAEJkJ,EAAG1E,GACH2E,KAAM3E,GACN4E,IAAK5E,GACL6E,OAAQ9E,GACR+E,MAAO/E,GACPgF,GAAI/E,GACJgF,QAASjF,GACTkF,MAAOlF,GAEPmF,IAAKlF,GACLmF,KAAMpF,GACNqF,MAAOrF,GACPsF,KAAMtF,GACNuF,MAAOvF,GACPwF,KAAMxF,GACNyF,MAAOzF,GACP0F,MAAO1F,GACP2F,KAAM3F,GACN4F,KAAM3F,GACN4F,MAAO7F,GACP8F,IAAK9F,GACL+F,KAAM/F,GACNgG,IAAKhG,GACLiG,MAAOjG,GACPkG,MAAOjG,GACPkG,OAAQnG,GACRoG,MAAOpG,GACPqG,KAAMrG,GACNsG,IAAKrG,GACLsG,MAAOvG,GACPwG,MAAOvG,GACPwG,KAAMxG,GACNyG,IAAKzG,GACL0G,IAAK1G,GACL2G,IAAK3G,GACLvE,OAAQsE,GACR6G,MAAO5G,GACP6G,KAAM9G,GACN+G,IAAK/G,GACLgH,KAAMhH,GACNiH,KAAMhH,GACNiH,IAAKlH,GACLmH,KAAMnH,GACNoH,MAAOnH,IAIT9E,KAAM,CAEJI,IAAKyE,GACLqH,MAAOrH,GACPsH,IAAKtH,GACLjO,UAAW,CAETwV,QAASvH,GACTwH,OAAQxH,GACRyH,YAAazH,GACb0H,SAAU1H,GACV2H,gBAAiB3H,GACjB4H,WAAY5H,GACZ6H,SAAU7H,GACV8H,WAAY9H,GACZ+H,QAAS/H,GACTgI,kBAAmBhI,GACnBiI,WAAYjI,GACZkI,UAAWlI,GACXmI,eAAgBnI,GAChBoI,YAAapI,GACbqI,mBAAoBrI,GACpBsI,cAAetI,GACfuI,YAAavI,GACbwI,cAAexI,GACfyI,QAASzI,GACT0I,YAAa1I,GACb2I,SAAU3I,GACV4I,gBAAiB5I,GACjB6I,WAAY7I,GACZ8I,SAAU9I,GACV+I,WAAY/I,GACZgJ,QAAShJ,GACTiJ,WAAYjJ,GACZkJ,eAAgBlJ,GAChBmJ,YAAanJ,GACboJ,mBAAoBpJ,GACpBqJ,cAAerJ,GACfsJ,YAAatJ,GACbuJ,cAAevJ,GACfwJ,aAAcxJ,GACdyJ,YAAazJ,GACb0J,OAAQ1J,GACR2J,mBAAoB3J,GACpBhE,eAAgBgE,GAChB4J,mBAAoB5J,GACpB6J,aAAc7J,GACd8J,YAAa9J,GAGb+J,QAAS/J,GACTgK,QAAShK,GACTiK,YAAajK,KAMjBjR,OAAQ,CAENmb,aAAcjK,GACdkK,cAAenK,GACfoK,IAAKnK,GACLlO,UAAW,CACTsY,OAAQrK,GACRsK,WAAYtK,GACZuK,YAAavK,GACblM,OAAQkM,GACRwK,SAAUvK,GACV9L,SAAU6L,GACV1C,QAAS2C,GACTqB,YAAarB,GACbwK,cAAezK,GACf4D,MAAO5D,GACP0K,UAAW1K,GACX2K,OAAQ3K,GACR4K,SAAU5K,GACV6K,OAAQ7K,GACRhQ,QAASgQ,GACT8D,OAAQ9D,GACR2B,MAAO1B,GACPlH,MAAOiH,GACP8K,WAAY7K,GACZ8K,UAAW/K,GACXgL,kBAAmBhL,GACnBiL,kBAAmBjL,GACnBkL,YAAalL,GACbmL,YAAanL,GACboL,KAAMpL,GAGNqL,OAAQrL,GACRsL,OAAQtL,GACRuL,IAAKvL,GACLwL,MAAOxL,GACPyL,KAAMzL,GACN0L,MAAO1L,GACP2L,UAAW3L,GACX4L,SAAU5L,GACV6L,QAAS7L,GACT8L,KAAM9L,GACN+L,MAAO/L,GACPgM,OAAQhM,GACRiM,IAAKjM,GACLkM,IAAKlM,GAELmM,SAAUnM,GACVoM,UAAWpM,GAGXhH,OAAQ,MAIZhF,OAAQ,CAENjC,UAAW,CACT8G,KAAMmH,GACNqM,MAAO,gBACPpa,OAAQ,gBACRqa,WAAY,gBACX9T,CAAAA,OAAOoL,OAAQ,IAChB2I,UAAW,gBACV/T,CAAAA,OAAOxI,SAAU,IACjBwI,CAAAA,OAAOsL,QAAS,IACjB0I,OAAQ,gBACPhU,CAAAA,OAAOO,OAAQ,IAChB0T,OAAQ,gBACRxY,KAAM+L,GACN0M,QAAS,gBACTC,OAAQ,gBAGRtQ,SAAS,EAGTuQ,UAAW,IACX/a,QAAS,MAMb0B,MAAO,CAELmN,KAAMT,GACN4M,QAAS7M,GACTW,GAAIV,GACJlO,UAAW,CACT+B,OAAQkM,GACRgB,WAAYhB,GACZiB,QAASjB,GACTkB,MAAOlB,GACPmB,KAAMnB,GACNxM,OAAQyM,GACRmB,KAAMpB,GACNqB,UAAWrB,GACXpR,QAASqR,GACT9L,SAAU6L,GACV1C,QAAS2C,GACTrM,KAAMoM,GACNrD,KAAMqD,GACNsB,YAAarB,GACbsB,IAAKtB,GACLvM,IAAKuM,GACL6M,KAAM7M,GACNuB,OAAQvB,GACRwB,YAAaxB,GACbyB,QAAS1B,GACT+M,MAAO9M,GACP0B,MAAO1B,GACP2B,KAAM5B,GACN6B,KAAM7B,GACNgN,OAAQhN,GACRiN,QAAShN,GACT8B,OAAQ/B,GAGRhH,OAAQ,MAOZkU,UAAWhN,GACXiN,WAAYjN,GACZkN,kBAAmBlN,GACnBmN,WAAYnN,GACZoN,YAAapN,GACbqN,WAAYrN,GACZsN,YAAatN,GACbL,aAAcK,GACduN,aAAcvN,GAIdtS,IAAK,CAEHmE,UAAW,CACT2b,MAAOzN,GACP0N,OAAQ1N,GACRgB,QAAShB,GACTrR,QAASqR,GACTtR,IAAKsR,GACL7R,IAAK6R,GACLtD,KAAMsD,GACN3R,IAAK2R,GACL2N,KAAM,gBACN7L,OAAQ9B,KAIZvS,IAAK,CAEHqE,UAAW,CACT1D,IAAK4R,GACLyN,MAAOzN,GACP0N,OAAQ1N,GACRgB,QAAShB,GACTrR,QAASqR,GACT7R,IAAK6R,GACLtD,KAAMsD,GACN2N,KAAM,gBACN7L,OAAQ9B,KAIZnS,QAAS,CAEPiE,UAAW,CAET4b,OAAQ1N,GACRtR,IAAKsR,GACL7R,IAAK6R,GACL3R,IAAK2R,KAIT3S,QAAS,CAEPyE,UAAW,CACT1D,IAAK4R,GACL0N,OAAQ1N,GACR7R,IAAK6R,KAMT4N,YAAa,CAEXC,OAAQ9N,GACRhH,OAAQgH,GACRnR,KAAMmR,GACNjO,UAAW,CACT+O,WAAY,gBACZa,MAAO3B,KAMX+N,SAAU,CAER/U,OAAQgH,GACRnR,KAAMmR,GACNY,kBAAmB,IACnB7O,UAAW,CACT8O,OAAQ,gBACRE,WAAY,gBACZD,WAAY,gBACZkN,WAAYhO,GACZiO,WAAYjO,GACZkO,QAASlO,GACTmO,SAAUnO,GACVoO,SAAUpO,GACVqO,SAAUrO,GACVsO,UAAWtO,GACXuO,UAAWvO,GACXwO,WAAYxO,GACZyO,WAAYzO,GACZ0O,QAAS1O,GACT2O,SAAU3O,GACV4O,SAAU5O,GACV6O,SAAU7O,GACV8O,UAAW9O,GACX+O,UAAW/O,KAMfgP,KAAM,CAEJ3H,MAAOpH,GACPgP,UAAWhP,IAKbiP,QAAS,CAEPC,IAAKlP,GACLmP,KAAMnP,GACNoP,OAAQpP,GACRqP,QAASrP,GACTlO,UAAW,CACTwd,MAAOvP,GACPwP,KAAMvP,GACNwP,QAASzP,GAGTrR,IAAKqR,GACL0P,IAAK1P,GACL2P,IAAK3P,GACL4P,KAAM5P,GACN6P,OAAQ7P,GACR8P,OAAQ9P,GACR+P,MAAO/P,GAGPgQ,KAAMhQ,GACN2N,OAAQ3N,GACRiQ,IAAKjQ,KAKTkQ,EAAG,CACDf,IAAKnP,GACLoP,KAAMpP,GACNqP,OAAQrP,GACRsP,QAAStP,GAETpM,KAAMoM,GACNmQ,aAAcnQ,GACdoQ,WAAYpQ,GACZqQ,WAAYrQ,GACZsQ,QAAStQ,GAGTuQ,QAASvQ,GACTwQ,UAAWxQ,GACXyQ,MAAOzQ,GACP0Q,SAAU1Q,GACV2Q,QAAS3Q,GACT4Q,MAAO5Q,GACP6Q,QAAS7Q,GACT8Q,MAAO9Q,IAKT5S,QAAS,CAEP4F,MAAOgN,GACP1E,UAAW0E,GACXpL,eAAgBoL,GAChB+Q,eAAgB/Q,GAChBrR,IAAKqR,GACLnN,yBAA0BmN,GAC1B/S,eAAgB+S,GAChB5R,IAAK4R,GACL9D,aAAc8D,GACd7S,QAAS6S,GACT4C,kBAAmB5C,GACnB1R,IAAK0R,GACLjN,eAAgBiN,IAGlB9H,MAAO,CAEL8Y,UAAWhR,IAMbiR,OAAQjR,GACRkR,SAAUlR,GAMVmR,UAAW,CAETpf,UAAW,IAKbL,MAAO,CACLE,cAAeoO,GACfhO,gBAAiBgO,GACjBjO,UAAW,CACTE,OAAQ,gBACRC,SAAU8N,KAId7Q,IAAK,CACHiiB,QAASpR,GACTqR,YAAarR,IAGfsR,IAAKrR,GACLsR,IAAKtR,KAIT,SAASuR,GAAYC,GAWb/gB,MAAAA,EAAoB,IAAI9C,IAAI,CAChC,CAAC,YAAa+C,WACd,CAAC,aAAcC,YACf,CAAC,iBAAkBC,gBACnB,CAAC,cAAeC,aAChB,CAAC,YAAa3C,WACd,CAAC,WAAY4C,YA6CT2gB,MAAAA,EAAa,GAmCZA,MAlCa,CAClB,MACA,OACA,OACA,QACA,QACA,WACA,QACA,OACA,UACA,WAKU9iB,QAAQC,IAQdA,GAAAA,KAAQ4iB,EAAe,CACnBE,MAAAA,EAAOF,EAAc5iB,GAI3B6iB,EAAW7iB,GAAQ,YAAyBqC,IAvEvCF,SAAiBC,KAAWC,GAC/B,IACKD,KAAUC,GACjB,MAAO5B,GACHpC,GAAAA,OAAOoC,KAASA,EAEZA,MAAAA,EAEJ6B,IAAAA,EACAC,EACAC,EACA,IAWFF,KAAW7B,EAAIT,OACfuC,KAAc9B,EAAIO,UAClBwB,KAAY/B,EAAII,QAGhB,MAAO4B,GAGD,MAAA,IAAIC,MAAM,iBAEZC,MAAAA,EAAmBd,EAAkB/B,IAAIwC,IAAUI,MACrD,IACI,MAAA,IAAIC,EAAiBJ,GAC3B,MAAOK,GAEDA,MADNA,EAAK/B,MAAQ2B,EACPI,IAmCNT,CAAiB2gB,KAASzgB,OAKzBwgB,EAGT,SAASE,GAAgB9f,EAAGvE,GAsDnBskB,OArDEA,SAAYC,GACbC,MAAAA,EAAQ,IAAInkB,IAiDXokB,OAREA,SAAWC,GACZC,MAAAA,KAAUD,IAITF,OAHFA,EAAM3jB,IAAI8jB,IACbH,EAAMzjB,IAAI4jB,EAAM3kB,EA1CX4kB,SAAMD,GAQT,IAAChlB,OAAO6E,UAAUsB,eAAe+P,KAAK0O,EAAQI,GAC1C,MAAA,IAAI3gB,6BAA6B2gB,MAEnCE,MAAAA,EAAIN,EAAOI,GAIbA,GAAS,mBAATA,EACK3kB,OAAAA,EAOL,GAAa,mBAAN6kB,EACFtgB,OAAAA,EAAEI,aAAakgB,MAUlBriB,MAAAA,MAAUqiB,EAAEC,oBAEXC,OADYxgB,EAAEI,SAASnC,EACvBuiB,CAAWF,GAMOD,CAAMD,KAExBH,EAAMpjB,IAAIujB,KAWvB,SAASK,GAA8BC,EAAgB9gB,GAuF9CvC,MAJK,CACVsjB,iBAnFOA,SAAiB5gB,GAExBA,EAAU3E,OAAO2E,GACXgJ,MAAAA,EAAQ,GACR6X,EAAK1D,KAAK3H,MAAM2H,KAAKC,UAAUpd,EAAQ2K,WAAaA,KAK9B,UAAxB3K,EAAQ8gB,aACV9X,EAAMiS,SAAS7R,UAGc,UAA3BpJ,EAAQ+gB,gBACV/X,EAAMiS,SAAStR,UAMQ,UAArB3J,EAAQghB,UAEVhY,EAAMiS,SAASnR,UAGc,UAA3B9J,EAAQihB,eACVjY,EAAMiS,SAAS7Q,WAOfyW,EAAGnV,gBAAgBhM,MAAM4K,mBAAoB,EAC7CuW,EAAGnV,gBAAgBhM,MAAMwhB,iBAAkB,EAC3CL,EAAGnV,gBAAgBhM,MAAMyhB,mBAAoB,GAGpB,UAAvBnhB,EAAQohB,YACVpY,EAAMiS,SAAS1Q,UAMX8W,MAAAA,gCAA2ClV,yBACnCzB,aAA2ByS,KAAKC,UAAUyD,MACxD7X,EAAMiS,KAAKoG,GAELphB,MAAAA,EAAIJ,EAAME,cAAc,CAAEiJ,MAAAA,IAI1BsY,MAAsBtmB,EAAa,WACnCU,EAASuE,EAAEI,SAASihB,EAAXrhB,MACb4C,EACA7C,EAAQuhB,iBAONvhB,GAJMC,EAAEI,SAASsgB,GACnBa,qBAAqBvhB,EAAEG,OAAQugB,EAAgB1gB,GAGrB,UAAxBD,EAAQyhB,YAAyB,CAC7BjkB,MAAAA,MAAQmiB,MACd1f,EAAEG,OAAOzC,QAAUsC,EAAEI,SAAS7C,EAAXyC,CAActC,SAK7BiO,MAAAA,EAAiB3L,EAAEI,aAAa8L,MAAflM,CAAuCA,EAAEG,QAUzDH,OALPvE,EAJsBuE,EAAEI,aAAa6N,MAAfjO,CACpBA,EAAEG,OACFwL,IAKF3L,EAAE+f,YAActkB,EAAOuE,EAAEI,aAAa0f,MAAf9f,CAAmCA,EAAGvE,IAEtDuE,IAWX,MAAM0gB,GAAiB,4vnEAIjBrjB,GAAMojB,GAA8BC,GAAgB9gB,IAE3CvC,IAAAA,GAAAA,GAAAA,QAAAA,QAAAA;;ACn1FAokB,aAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,aAAAA,EAzGf,IAAMA,EAAe,WAACC,IAAAA,EAAY,UAAA,OAAA,QAAA,IAAA,UAAA,GAAA,UAAA,GAAA,IAAIlmB,QAC5BmmB,EAAW,SAACC,GACRC,IAAAA,EAAgB,IAAI7lB,QAiGnB8lB,OAhGc,SAAfA,EAAgBplB,EAAKqlB,EAAOC,GAC1B5mB,GAAAA,OAAOsB,KAASA,GAAOglB,EAAUplB,IAAII,GAE9BA,OAAAA,EAGLulB,IAAAA,EAAUD,EAAOnlB,IAAIH,GACvBulB,GAAAA,EACOA,OAAAA,EAILC,IAAAA,EAAQ,SAACC,GAAYL,OAAAA,EAAaK,EAASH,EAAQD,IAGnDK,EAAQ,SAACC,GACP,IACOP,OAAAA,EAAaO,IAAYN,EAAOC,GAE3C,MAAO/d,GACG6d,MAAAA,EAAa7d,EAAG8d,EAAOC,KAG/BxkB,EAAM,SAACC,GAAQ2kB,OAAAA,EAAM,WACjBN,MAAAA,EAAazlB,UAAUoB,GAAMskB,EAAOC,MAiExCM,EAAY,IAAIlc,MAAM1J,EA/DZ,CAEZoG,eAAeyf,SAAAA,EAAShf,EAAMif,GACpBhlB,MAAAA,EAA8B0f,0BAAAA,OAAAA,KAAKC,UAAUlgB,OAAOsG,IAA1D,0BAEJtC,eAAeshB,SAAAA,EAASE,GACdjlB,MAAAA,EAAN,6CAEJhB,IAAI+lB,SAAAA,EAAShf,EAAMmf,GACTllB,MAAAA,EAA2B0f,uBAAAA,OAAAA,KAAKC,UAAUlgB,OAAOsG,IAAvD,0BAKJ6G,aAAajL,SAAAA,GACF7D,OAAAA,QAAQ8O,aAAajL,IAEhC2R,kBAAkB3R,SAAAA,GACV,IAAC7D,QAAQ8O,aAAajL,GAEf,OAAA,EAGL3B,MAAAA,EAAN,kDAGJX,IAAIsC,SAAAA,EAAQoE,EAAMof,GACPP,OAAAA,EAAM,WAAM9mB,OAAAA,QAAQuB,IAAIsC,EAAQoE,EAAMof,MAEjDxnB,eAAegE,SAAAA,GACJijB,OAAAA,EAAM,WAAM9mB,OAAAA,QAAQH,eAAegE,MAE9C9D,QAAQ8D,SAAAA,GACGijB,OAAAA,EAAM,WAAM9mB,OAAAA,QAAQD,QAAQ8D,MAEvC7C,IAAI6C,SAAAA,EAAQyjB,GACDR,OAAAA,EAAM,WAAMQ,OAAAA,KAAOzjB,KAE9B4B,yBAAyB5B,SAAAA,EAAQoE,GACtB6e,OAAAA,EAAM,WAAM9mB,OAAAA,QAAQyF,yBAAyB5B,EAAQoE,MAGhErC,MAAM/B,SAAAA,EAAQkC,EAASwhB,GAGfznB,OAAOiG,KAAaA,IACpB2gB,EAAOnlB,IAAIsC,IAAY4iB,EAAMllB,IAAIwE,IAAa2gB,EAAOnlB,IAAIwE,KAGzDA,OAAUuB,GAERkgB,IAAAA,EAAcZ,EAAM7gB,GACpB0hB,EAAmBF,EAAcpT,IAAIyS,GACpCE,OAAAA,EAAM,WAAM9mB,OAAAA,QAAQ4F,MAAM/B,EAAQ2jB,EAAaC,MAE1DvZ,UAAUrK,SAAAA,EAAQC,GACR2jB,IAAAA,EAAmB3jB,EAAKqQ,IAAIyS,GAC3BE,OAAAA,EAAM,WAAM9mB,OAAAA,QAAQkO,UAAUrK,EAAQ4jB,QAW9CT,OAFPN,EAAOxlB,IAAIE,EAAK4lB,GAChBP,EAAMvlB,IAAI8lB,EAAW5lB,GACd4lB,EAEJR,CAAaF,EAjGiC,IAAI5lB,QAiGV6lB,IAI5CF,OADPD,EAAUnlB,IAAIolB,GACPA,GAEIF,EAAAA,EAAAA,QAAAA,QAAAA;;;AC/DA,IAAA,EAAA,UAAA,GAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,mDAAA,SAAA,EAAA,GAAA,GAAA,OAAA,YAAA,OAAA,IAAA,uBAAA,OAAA,UAAA,SAAA,KAAA,GAAA,OAAA,MAAA,KAAA,GAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,CAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,EAAA,QAAA,EAAA,EAAA,OAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,GAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAzCf,IAAMhmB,EAASL,OAAOH,OAwBtB,SAASqkB,EAAQ0D,EAASC,GACtBD,EAAU,GAAKA,EACTE,IAAAA,EAAQ9nB,OAAO4F,oBAAoBiiB,GAInCE,EAA6BD,aAAAA,OAAAA,EAAMphB,KAAK,KAAiCkhB,8BAAAA,OAAAA,EAG9DvS,iCAAAA,OAAAA,mBAAmBuS,GAASnT,MAAM,EAAG,IAHtD,SAOOuT,OADY,EAAIpf,MAAMmf,GACtB,WAAcD,EAAAA,EAAAA,EAAMzT,IAAI,SAAA4T,GAAKJ,OAAAA,EAAII,QAGzB,oBAAXC,OAAyBnjB,EAASmjB,QAAQ3B,SAAWlmB,EAC9C,IAAA,EAAA,CAAE6jB,QAAS7jB,EAAO6jB,GAAU7jB,OAAQA,EAAOA,IAA3C,QAAA,QAAA;;ACpCA8nB,aAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,QAAAA,QAAAA,SAAAA,QAAAA,iBAAAA,QAAAA,iBAAAA,EAvBf,IAAA,EAAA,EAAA,QAAA,mBACA,EAAA,EAAA,QAAA,kBAsBeA,SAAAA,EAAAA,GAAAA,OAAAA,GAAAA,EAAAA,WAAAA,EAAAA,CAAAA,QAAAA,GAAAA,SAAAA,IAAAA,GAAAA,oBAAAA,UAAAA,QAAAA,UAAAA,OAAAA,EAAAA,GAAAA,QAAAA,UAAAA,KAAAA,OAAAA,EAAAA,GAAAA,mBAAAA,MAAAA,OAAAA,EAAAA,IAAAA,OAAAA,KAAAA,UAAAA,SAAAA,KAAAA,QAAAA,UAAAA,KAAAA,GAAAA,gBAAAA,EAAAA,MAAAA,GAAAA,OAAAA,GAAAA,SAAAA,EAAAA,EAAAA,EAAAA,GAAAA,OAAAA,EAAAA,IAAAA,QAAAA,UAAAA,SAAAA,EAAAA,EAAAA,GAAAA,IAAAA,EAAAA,CAAAA,MAAAA,EAAAA,KAAAA,MAAAA,EAAAA,GAAAA,IAAAA,EAAAA,IAAAA,SAAAA,KAAAA,MAAAA,EAAAA,IAAAA,OAAAA,GAAAA,EAAAA,EAAAA,EAAAA,WAAAA,IAAAA,MAAAA,KAAAA,WAAAA,SAAAA,EAAAA,EAAAA,GAAAA,OAAAA,EAAAA,OAAAA,gBAAAA,SAAAA,EAAAA,GAAAA,OAAAA,EAAAA,UAAAA,EAAAA,IAAAA,EAAAA,GAAAA,SAAAA,IAAAA,IAAAA,EAAAA,EAAAA,CAAAA,cAAAA,mBAAAA,OAAAA,EAAAA,WAAAA,OAAAA,GAAAA,EAAAA,SAAAA,EAAAA,EAAAA,GAAAA,OAAAA,IAAAA,EAAAA,EAAAA,MAAAA,IAAAA,OAAAA,OAAAA,OAAAA,iBAAAA,EAAAA,CAAAA,IAAAA,CAAAA,MAAAA,OAAAA,OAAAA,OArBPjE,IAAAA,EAAoBkE,EAApBlE,QAAAA,QAAS7jB,EAAW+nB,EAAX/nB,QAAAA,OACX8nB,EAAY,GACLE,EAAchoB,EAAO,SAACioB,EAASC,EAAQvkB,GAAS9D,OAAAA,QAAQ4F,MAAMyiB,EAAQD,EAAStkB,KAmB7EmkB,QAAAA,YAAAA,EAlBR,IAAMK,EAAmBnoB,EAAO,SAACiB,EAAKmnB,EAAO3nB,GAIzCQ,MAHO,cAAVmnB,GACAC,KAAKnmB,MAAoB,IAAA,CAAEkmB,MAAAA,IAExBnnB,EAAImnB,GAAS3nB,IAcTqnB,QAAAA,iBAAAA,EAZfA,EAAUQ,QAAUtoB,EAAO,WAAI2D,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAJ,IAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAIA,EAAJ,GAAA,UAAA,GAAa3D,OAAAA,EAAWK,EAAAA,IAAOsD,MAC1DmkB,EAAUS,QAAUvoB,EAAO,WAAI2D,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAJ,IAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAIA,EAAJ,GAAA,UAAA,GAAa3D,OAAAA,EAAWG,EAAAA,IAAOwD,MAC1DmkB,EAAUU,YAAcxoB,EAAO,SAACyoB,GAAazoB,OAAAA,EAAO,IAAI2hB,QAAQ8G,MAChEX,EAAUY,YAAc1oB,EAAO,WAAI2D,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAJ,IAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAIA,EAAJ,GAAA,UAAA,GAAa3D,OAAAA,EAAWO,EAAAA,QAAWoD,MAClEmkB,EAAUa,YAAc3oB,EAAO,WAAI2D,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAJ,IAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAIA,EAAJ,GAAA,UAAA,GAAa3D,OAAAA,EAAWD,EAAAA,QAAW4D,MAElE,IAAMsiB,EAAY,IAAIlmB,QACtBkmB,EAAUnlB,IAAIqnB,GACP,IAAMjC,GAAW,EAAaD,EAAAA,SAAAA,GAItB6B,QAAAA,SAAAA,EAFfA,EAAUjE,QAAU7jB,EAAO6jB,GAC3BiE,EAAU5B,SAAW,SAACjlB,GAAQA,OAAAA,GACf6mB,IAAAA,EAAAA,EAAAA,QAAAA,QAAAA;;AC+DQ,aAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,mDAAA,SAAA,EAAA,GAAA,GAAA,OAAA,YAAA,OAAA,IAAA,uBAAA,OAAA,UAAA,SAAA,KAAA,GAAA,OAAA,MAAA,KAAA,GAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,CAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,EAAA,QAAA,EAAA,EAAA,OAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,GAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,iBAAA,cAAA,QAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OAAA,SAAA,EAAA,GAAA,OAAA,EAAA,mBAAA,QAAA,iBAAA,OAAA,SAAA,SAAA,GAAA,cAAA,GAAA,SAAA,GAAA,OAAA,GAAA,mBAAA,QAAA,EAAA,cAAA,QAAA,IAAA,OAAA,UAAA,gBAAA,IAAA,GAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,QAAA,QAAA,gBAAA,EAjFhB,IAAMc,EAAa1C,SAAS,SAAC2C,EAASC,GACvC,GAAa,WAAb,EAAOA,IAAwB,OAANA,EAEpB,MAAA,GAAKA,EACP,QAAiB3hB,IAAb2hB,EAAErd,OAEJqd,OAAAA,EAI2B,IADhCC,IAAAA,EAAStoB,EACOd,EAAAA,OAAOyP,KAAK0Z,GAAI,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAzBE,IAAAA,EAAN,EAAA,GACCA,GAAU,WAAVA,OAEG,CAAA,QAAgB7hB,IAAZ4hB,GAA6C,mBAAbD,EAAEE,GAEpCF,OAAAA,EAGPC,EAAUC,EACVvoB,EAAMghB,KAAKC,UAAUoH,EAAEE,QAAQ7hB,EAAW,IAI1C4hB,QAAY5hB,IAAZ4hB,EAEKD,OAAAA,EAGLC,GAAe,MAAfA,EAAQ,SAEL,GAAIF,EAAQhoB,IAAIkoB,GAAU,CACzBE,IAAAA,EAAOJ,EAAQznB,IAAI2nB,GACrBtoB,IAAQwoB,GACVZ,KAAKnmB,MAAsB,IAAA,CAAE6mB,QAAAA,GAAuB,CAAEtoB,IAAAA,GAAa,CAAEwoB,KAAAA,SAGvEJ,EAAQ9nB,IAAIgoB,EAAStoB,GAEhBA,OAAAA,IA2Cc,QAAA,WAAA,EAxCvB,IAAMyoB,EAAWhD,SAAS,SAAAiD,GAClBC,IAAAA,EAASd,UACTb,EAAQ,GACR4B,EAAO,SAACC,EAAOhoB,GAmBZioB,OAlBHD,GAAS,IACX7B,EAAM6B,GAAShoB,EACf8nB,EAAOroB,IAAIO,EAAMgoB,IAIVC,SAAIC,GACPX,IAAAA,EACA,IAACW,EAAkB3M,IAEd,OADPgM,EAAUP,QAAY3oB,EAAAA,OAAO+T,QAAQ8V,KAC9B,SAAC/W,GAAMqW,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAP,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAOA,EAAP,EAAA,GAAA,UAAA,GACPK,OAAAA,EAAQG,EAAO7B,EAAO2B,EAAQP,EAASpW,EAAGqW,IAG5CD,EAAUP,UARuB3kB,IAS3B8lB,IAAAA,EAAWD,EATgB7lB,EAAAA,UAAAA,OAAAA,EAAM,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAANA,EAAM,EAAA,GAAA,UAAA,GAUhCwlB,OAAAA,EAAQG,EAAO7B,EAAO2B,EAAQP,EAASY,EAAU9lB,KAKxD+lB,EAAI,EACFrB,EAAOgB,GAAM,EAAG,aAWfhB,OAVPA,EAAKsB,MAAQN,EAAKK,IAAK,SACvBrB,EAAKuB,MAAQP,EAAKK,IAAK,SACvBrB,EAAKwB,KAAOR,EAAKK,IAAK,QACtBrB,EAAKnmB,MAAQmnB,EAAKK,IAAK,SACvBrB,EAAKvG,OAASuH,EAAKK,IAAK,UACxBrB,EAAKyB,KAAOT,EAAKK,IAAK,QACtBrB,EAAK0B,OAASV,EAAKK,IAAK,UACxBrB,EAAK2B,KAAOX,EAAKK,IAAK,QACtBrB,EAAK4B,MAAQZ,EAAKK,IAAK,SACvBrB,EAAK6B,MAAQb,EAAKK,IAAK,SAChBrB,IAGMnC,EAAAA,SAASgD,GAAD,QAAA,QAAA;;;ACvFvB,IAOIiB,EACAC,EARAC,EAAUC,OAAOC,QAAU,GAU/B,SAASC,IACC,MAAA,IAAIxmB,MAAM,mCAEpB,SAASymB,IACC,MAAA,IAAIzmB,MAAM,qCAsBpB,SAAS0mB,EAAWC,GACZR,GAAAA,IAAqBS,WAEdA,OAAAA,WAAWD,EAAK,GAGvB,IAACR,IAAqBK,IAAqBL,IAAqBS,WAEzDA,OADPT,EAAmBS,WACZA,WAAWD,EAAK,GAEvB,IAEOR,OAAAA,EAAiBQ,EAAK,GAC/B,MAAMniB,GACA,IAEO2hB,OAAAA,EAAiBtU,KAAK,KAAM8U,EAAK,GAC1C,MAAMniB,GAEG2hB,OAAAA,EAAiBtU,KAAK,KAAM8U,EAAK,KAMpD,SAASE,EAAgBC,GACjBV,GAAAA,IAAuBW,aAEhBA,OAAAA,aAAaD,GAGpB,IAACV,IAAuBK,IAAwBL,IAAuBW,aAEhEA,OADPX,EAAqBW,aACdA,aAAaD,GAEpB,IAEOV,OAAAA,EAAmBU,GAC5B,MAAOtiB,GACD,IAEO4hB,OAAAA,EAAmBvU,KAAK,KAAMiV,GACvC,MAAOtiB,GAGE4hB,OAAAA,EAAmBvU,KAAK,KAAMiV,MAjEhD,WACO,IAEIX,EADsB,mBAAfS,WACYA,WAEAJ,EAEzB,MAAOhiB,GACL2hB,EAAmBK,EAEnB,IAEIJ,EADwB,mBAAjBW,aACcA,aAEAN,EAE3B,MAAOjiB,GACL4hB,EAAqBK,GAjB5B,GAwED,IAEIO,EAFAC,EAAQ,GACRC,GAAW,EAEXC,GAAc,EAElB,SAASC,IACAF,GAAaF,IAGlBE,GAAW,EACPF,EAAavf,OACbwf,EAAQD,EAAazkB,OAAO0kB,GAE5BE,GAAc,EAEdF,EAAMxf,QACN4f,KAIR,SAASA,IACDH,IAAAA,EAAAA,CAGAI,IAAAA,EAAUZ,EAAWU,GACzBF,GAAW,EAGLK,IADFA,IAAAA,EAAMN,EAAMxf,OACV8f,GAAK,CAGA,IAFPP,EAAeC,EACfA,EAAQ,KACCE,EAAaI,GACdP,GACAA,EAAaG,GAAYK,MAGjCL,GAAc,EACdI,EAAMN,EAAMxf,OAEhBuf,EAAe,KACfE,GAAW,EACXL,EAAgBS,IAiBpB,SAASG,EAAKd,EAAKe,GACVf,KAAAA,IAAMA,EACNe,KAAAA,MAAQA,EAYjB,SAASC,KA5BTtB,EAAQuB,SAAW,SAAUjB,GACrBhnB,IAAAA,EAAO,IAAIqC,MAAM+L,UAAUtG,OAAS,GACpCsG,GAAAA,UAAUtG,OAAS,EACd,IAAA,IAAIie,EAAI,EAAGA,EAAI3X,UAAUtG,OAAQie,IAClC/lB,EAAK+lB,EAAI,GAAK3X,UAAU2X,GAGhCuB,EAAM1L,KAAK,IAAIkM,EAAKd,EAAKhnB,IACJ,IAAjBsnB,EAAMxf,QAAiByf,GACvBR,EAAWW,IASnBI,EAAKjnB,UAAUgnB,IAAM,WACZb,KAAAA,IAAIllB,MAAM,KAAM,KAAKimB,QAE9BrB,EAAQwB,MAAQ,UAEhBxB,EAAQ7C,IAAM,GACd6C,EAAQyB,KAAO,GACfzB,EAAQ0B,QAAU,GAClB1B,EAAQ2B,SAAW,GAInB3B,EAAQ4B,GAAKN,EACbtB,EAAQ6B,YAAcP,EACtBtB,EAAQ8B,KAAOR,EACftB,EAAQ+B,IAAMT,EACdtB,EAAQgC,eAAiBV,EACzBtB,EAAQiC,mBAAqBX,EAC7BtB,EAAQkC,KAAOZ,EACftB,EAAQmC,gBAAkBb,EAC1BtB,EAAQoC,oBAAsBd,EAE9BtB,EAAQqC,UAAY,SAAUprB,GAAe,MAAA,IAE7C+oB,EAAQsC,QAAU,SAAUrrB,GAClB,MAAA,IAAI0C,MAAM,qCAGpBqmB,EAAQuC,IAAM,WAAqB,MAAA,KACnCvC,EAAQwC,MAAQ,SAAUC,GAChB,MAAA,IAAI9oB,MAAM,mCAEpBqmB,EAAQ0C,MAAQ,WAAoB,OAAA;;;;AChHrBjF,IAAAA,EAAAA,UAAAA,GAAAA,EAAAA,QAAAA,WAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,IAAAA,EAAAA,GAAAA,QAAAA,aAAAA,EA9Df,IAAA,EAAA,EAAA,QAAA,yBACA,OAAA,KAAA,GAAA,QAAA,SAAA,GAAA,YAAA,GAAA,eAAA,IAAA,OAAA,UAAA,eAAA,KAAA,EAAA,IAAA,OAAA,eAAA,QAAA,EAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,SAOA,IAAA,EAAA,EAAA,QAAA,uBAsDeA,SAAAA,EAAAA,GAAAA,OAAAA,GAAAA,EAAAA,WAAAA,EAAAA,CAAAA,QAAAA,GAAAA,SAAAA,EAAAA,GAAAA,OAAAA,EAAAA,IAAAA,EAAAA,IAAAA,IAAAA,SAAAA,IAAAA,MAAAA,IAAAA,UAAAA,mDAAAA,SAAAA,EAAAA,GAAAA,GAAAA,OAAAA,YAAAA,OAAAA,IAAAA,uBAAAA,OAAAA,UAAAA,SAAAA,KAAAA,GAAAA,OAAAA,MAAAA,KAAAA,GAAAA,SAAAA,EAAAA,GAAAA,GAAAA,MAAAA,QAAAA,GAAAA,CAAAA,IAAAA,IAAAA,EAAAA,EAAAA,EAAAA,IAAAA,MAAAA,EAAAA,QAAAA,EAAAA,EAAAA,OAAAA,IAAAA,EAAAA,GAAAA,EAAAA,GAAAA,OAAAA,GAAAA,SAAAA,EAAAA,GAAAA,OAAAA,EAAAA,mBAAAA,QAAAA,iBAAAA,OAAAA,SAAAA,SAAAA,GAAAA,cAAAA,GAAAA,SAAAA,GAAAA,OAAAA,GAAAA,mBAAAA,QAAAA,EAAAA,cAAAA,QAAAA,IAAAA,OAAAA,UAAAA,gBAAAA,IAAAA,GA5Df,IAAMA,EAAYnoB,OAAO0F,OAAO,GAAI2nB,EAAlB,SAElBrtB,OAAOyP,KAAK0Y,GAAWzmB,QAAQ,SAAA2nB,GAC3BtkB,EAAOskB,GAASlB,EAAUkB,KAK9B,IAAMiE,GAAS,EAAS,EAAA,SAAA,SAAC3D,EAAO7B,EAAO2B,EAAQP,EAASY,EAAU9lB,GAC1DupB,IAAAA,EACEC,EAAUxpB,EAAKsQ,OAAO,SAACmZ,EAAOtE,EAAGY,GACnCwD,GAAK,EAAWrE,EAAAA,YAAAA,EAASC,GACnBuE,IAAAA,EAAOD,EAAMA,EAAM3hB,OAAS,GAQ3B2hB,MAPW,WAAd,EAAOF,SAA0B/lB,IAAP+lB,GAC1BE,EAAMA,EAAM3hB,OAAS,GAAK4hB,EAAKxO,YAC/BuO,EAAM7N,KAAK2N,EAAIzD,EAASC,EAAI,GAAG9K,aAG/BwO,EAAMA,EAAM3hB,OAAS,GAAK4hB,EAAO7rB,OAAO0rB,GAAMzD,EAASC,EAAI,GAExD0D,GACR,CAAC3F,EAAM6B,GAAS,KAAOG,EAAS,KAC/BH,GAAAA,IAAUF,EAAOhoB,IAAI,aAEd+rB,OAAAA,EAAQ9mB,KAAK,KAEpBijB,GAAAA,GAASF,EAAOhoB,IAAI,QAAS,CAAA,IAAA,GAE7Ba,EAAAA,SAAQC,MAASirB,MAAAA,EAAAA,EAAAA,QAEhB,CAAA,IAAA,EAEKG,GAAM,IAAItpB,OAAQ7B,MAElBorB,EAAMD,EAAIlZ,MAAMkZ,EAAIvd,QAAQ,MAAQ,GACpCyd,EAAMD,EAAInZ,MAAMmZ,EAAIxd,QAAQ,MAAQ,GACpC0d,EAAMD,EAAIpZ,MAAMoZ,EAAIzd,QAAQ,QAClC9N,EAAAA,SAAQC,MAASirB,MAAAA,EAAAA,EAAAA,GAASM,OAAAA,CAAAA,KAE1BhG,GAAiB,WAAjBA,EAAM6B,GAEC3H,OAAAA,QAAQG,OAAOqL,EAAQ9mB,KAAK,MAElC,QAAsB,IAAX3B,GAA0B4kB,GAASF,EAAOhoB,IAAI,SAE1DipB,EAAQqD,SAAW,QAElB,GAAIpE,GAASF,EAAOhoB,IAAI,SAEnB+rB,MAAAA,EAAQ9mB,KAAK,KAEhB8mB,OAAAA,EAAQ9mB,KAAK,OAExByhB,EAAUO,KAAO4E,EAIjBttB,OAAOyP,KAAK0Y,GAAWzmB,QAAQ,SAAA2nB,GAC3BtkB,EAAOskB,GAASlB,EAAUkB,KAEflB,IAAAA,EAAAA,EAAAA,QAAAA,QAAAA;;AC1CQ,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA5BvB,IAAM6F,EAASzH,SAAS,SAACuD,GAAamE,IAC9Bpd,IAAAA,EAAS,GACXqd,EAAa,KAFmBD,EAAAA,UAAAA,OAAAA,EAAW,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAXA,EAAW,EAAA,GAAA,UAAA,GAG1C,IAAA,IAAIlE,EAAI,EAAGoE,EAAOF,EAAOniB,OAAQie,EAAIoE,EAAMpE,IAAK,CAC/CqE,IAAAA,EAAUtE,EAASC,GACb,IAANA,GAAWqE,EAAQ,GAAGxQ,WAAW,QACnCwQ,EAAUA,EAAQ3Z,MAAM,IAEpB4Z,IAAAA,EAASD,EAAQha,YAAY,MAC/Bia,GAAAA,GAAU,EAAG,CACfH,EAAa,KACR,IAAA,IAAInb,EAAIqb,EAAQtiB,OAASuiB,EAAQtb,EAAI,EAAGA,IAC3Cmb,GAAc,IAGlBrd,EAAO+O,KAAKwO,GAEZvsB,OAAOosB,EAAOlE,IAAIle,MAAM,MAAMnK,QAAQ,SAAC4sB,EAAOvb,GAClC,IAANA,GACFlC,EAAO+O,KAAKsO,GAEdrd,EAAO+O,KAAK0O,KAITzd,OADPA,EAAO+O,KAAKkK,EAASmE,EAAOniB,SACrB+E,EAAOnK,KAAK,MAGN6f,EAAAA,SAASyH,GAAD,QAAA,QAAA;;ACmrBA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA1sBvB,IAAA,EAAA,EAAA,QAAA,iBA0sBuB,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,yDAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,sFAAA,KAAA,CAAA,uFAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,mCAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,GAAA,OAAA,EAAA,mBAAA,QAAA,iBAAA,OAAA,SAAA,SAAA,GAAA,cAAA,GAAA,SAAA,GAAA,OAAA,GAAA,mBAAA,QAAA,EAAA,cAAA,QAAA,IAAA,OAAA,UAAA,gBAAA,IAAA,GAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,GAAA,KAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,yBAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,mDAAA,SAAA,EAAA,GAAA,GAAA,OAAA,YAAA,OAAA,IAAA,uBAAA,OAAA,UAAA,SAAA,KAAA,GAAA,OAAA,MAAA,KAAA,GAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,CAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,EAAA,QAAA,EAAA,EAAA,OAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,GAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,eAAA,eAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,gBAAA,4DAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,gBAAA,wEAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,uCAAA,aAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,2DAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,oFAAA,mBAAA,gDAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,oUAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,gDAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,eAAA,gBAAA,uCAAA,kBAAA,gDAAA,yCAAA,cAAA,SAAA,iCAAA,wBAAA,kBAAA,6CAAA,gCAAA,gCAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,gBAAA,oDAAA,4JAAA,0BAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,sEAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,eAAA,iBAAA,gBAAA,2CAAA,kDAAA,gDAAA,MAAA,uCAAA,qBAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,mCAAA,8BAAA,kBAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,cAAA,YAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,mCAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,cAAA,6BAAA,WAAA,yCAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,mBAAA,qYAAA,QAAA,8JAAA,4BAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,8BAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,GAAA,IAAA,SAAA,KAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,GAAA,IAAA,iCAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,IAAA,aAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,SAAA,aAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,gBAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,gCAAA,sBAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAAA,IAAA,IAAA,EAAA,EAAA,EAAA,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,iBAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,2BAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,UAAA,KAAA,MAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OA1sBc,IAAMA,EAASzH,SAASgI,EAAD,SAEtDC,EAAajI,SAAS,CAAEphB,SAAU,WAAM,MAAA,gBAExCspB,EAAMlI,SAAS,SAAC7Y,EAAMghB,EAAYC,EAAKhtB,GACvC+L,EAAKkhB,QACPlG,KAAK2B,KAAcsE,IAAAA,EAAQhtB,GAEzBktB,IAAAA,EAAOnhB,EAAKohB,MAAMrtB,IAAIktB,GACrBE,IACHA,EAAOlG,UACPjb,EAAKohB,MAAM1tB,IAAIutB,EAAKE,IAElBhe,IAAAA,EAASge,EAAKptB,IAAIitB,GAkBf7d,OAjBHA,GACEA,IAAW2d,GACb9F,KAAKnmB,MAAgC,IAAA,CAAEZ,KAAAA,IAEzC+L,EAAKqhB,MAAM,KAEXF,EAAKztB,IAAIstB,EAAYF,GACrB9gB,EAAKshB,QAAQ,GACa,mBAAfN,EACT7d,EAAS6d,EAAWhhB,EAAMihB,QACF,IAAfD,EACThG,KAAKnmB,MAAsBZ,IAAAA,GAE3BkP,EAASoe,EAAIvhB,EAAMihB,EAAKD,GAE1BG,EAAKztB,IAAIstB,EAAY7d,IAEhBA,IAGHqe,EAAe3I,SAAS,SAAA7Y,GACxByhB,IAAAA,EAAS,EACTC,EAAQ,GAFwB,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAGf1hB,IAAAA,IAAY,EAAZA,EAAAA,EAAKohB,MAAO,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,MAAA,GAAA,EAAA,CAAtBO,IACHR,EADyB,EAAA,MACX,GADW,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAEIA,IAAAA,IAAM,EAANA,EAAAA,EAAM,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,MAAA,GAAA,EAAA,CAAA,IAAA,EAAA,EAAA,EAAA,MAAA,GAA7BH,EAA6B,EAAA,GAAjB7d,EAAiB,EAAA,GACnCA,GAAAA,IAAW2d,EAAY,CACnBc,IAAAA,EAA6B,mBAAfZ,EACpBA,EAAW/sB,KAAK8S,MAAM,GACtBqN,KAAKC,UAAU,GAAK2M,GACA7d,EAAAA,EAAAA,EAJK,GAIlB0e,EAJkB,EAAA,GAAA,EAAA,KAKfC,KACJD,EAASJ,GACXA,EAASI,EACTH,EAAQ,CAACE,IACAC,IAAWJ,GAAUC,EAAMhf,QAAQkf,GAAQ,GACpDF,EAAMxP,KAAK0P,MAbY,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,KAHG,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAsB7B,MAAA,CAACH,EAAQC,KAGZK,EAAQlJ,SAAS,SAAC7Y,EAAMgiB,GACNR,IADe,EAAA,EACfA,EAAaxhB,GADE,GAC9BggB,EAD8B,EAAA,GACxB0B,EADwB,EAAA,GAE/BO,EAAQC,EAAKliB,EAAKoc,SAAU4D,GAC5BmC,EAASxpB,MAAMsZ,QAAQgQ,GACvBjC,MAAAA,OAAAA,EAAQoC,KAAAA,OAAAA,EAAWpiB,EAAMiiB,IACPG,wBAAAA,OAAAA,EAAWpiB,EAAMkiB,EAAKliB,EAAKoc,SAAU4D,EAAO,KAE9DqC,EAA2B,IAAjBX,EAAMtjB,OACGsjB,QAAAA,eAAAA,OAAAA,EAAM1oB,KAAK,OAC5BspB,EAAYtiB,EAAKoc,SAAjBkG,QACRtH,KAAK2B,KACD3c,IAAAA,EAAKoc,SAAS5M,IAAI5I,OAAO,SAACmZ,EAAO7oB,EAAGmlB,GAClCiG,GAAAA,EAAS,CACL7tB,IAAAA,EAAI6tB,EAAQjG,GAClB0D,GAAgBtrB,OAAAA,OAAAA,EAAE8tB,IAAO9tB,KAAAA,OAAAA,EAAE+tB,KAA3B,MAGKzC,OADPA,GAAS3L,KAAKC,UAAUnd,GAAG6P,MAAM,EAAG,IAAM,MAEzC,IAECsb,GACJrH,KAAKnmB,MAAqBstB,IAAAA,KAGtBC,EAAavJ,SAAS,SAAC7Y,EAAMiiB,GAC7BtpB,GAAAA,MAAMsZ,QAAQgQ,GAAQ,CAClBvB,IAAAA,EAAU1gB,EAAKoc,SAAS6F,EAAM,IAC1B7N,MAAAA,GAAAA,OAAAA,KAAKC,UAAUqM,EAAQuB,EAAM,KAASA,MAAAA,OAAAA,EAAM,GAAMA,KAAAA,OAAAA,EAAM,IAEhE,GAAiB,iBAAVA,EACOA,MAAAA,SAAAA,OAAAA,KAKdQ,EAAO5J,SAAS,SAAA7Y,GAChBA,GAAAA,EAAKkhB,OAAQ,CAAA,IAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IACWlhB,IAAAA,IAAY,EAAZA,EAAAA,EAAKohB,MAAO,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,MAAA,GAAA,EAAA,CAAA,IAAA,EAAA,EAAA,EAAA,MAAA,GAA1BH,EAA0B,EAAA,GAArBE,EAAqB,EAAA,GAC9BO,EAAQ,GADsB,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAEDP,IAAAA,IAAM,EAANA,EAAAA,EAAM,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,MAAA,GAAA,EAAA,CAAA,IAAA,EAAA,EAAA,EAAA,MAAA,GAA7BH,EAA6B,EAAA,GAAjB7d,EAAiB,EAAA,GACjClP,EAA6B,mBAAf+sB,EACpBA,EAAW/sB,KAAOmgB,KAAKC,UAAU2M,GAC7B7d,GAAAA,IAAW2d,EACb9F,KAAK0B,OAASzoB,IAAAA,EAAQgtB,OACjB,CACe9d,IAAAA,EAAAA,EAAAA,EADf,GACE0e,EADF,EAAA,GACUa,EADV,EAAA,GAEDA,IAAMZ,GACRJ,EAAMxP,KAAKje,GAEX+mB,KAAK4B,MAAQ3oB,IAAAA,EAAQgtB,EAAYY,EAAWa,KAZd,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAgBhChB,EAAMtjB,QAAU,GAClB4c,KAAK4B,MAASqE,IAAAA,EAAgBS,IAlBnB,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAqBf1G,KAAK2B,KAAa3c,IAAAA,EAAKqhB,MAAM,GAAerhB,EAAKshB,QAAQ,OAIvDY,EAAOrJ,SAAS,SAACuD,EAAU6E,GAK1B,IAHGzR,IAAAA,EAAQ4M,EAAR5M,IACFmT,EAAUnT,EAAIpR,OAAS,EACzBwkB,EAAS3B,EACJ4B,EAAS,EAAGA,GAAUF,EAASE,IAAU,CAC1CnC,IACAoC,EADUtT,EAAIqT,GACGzkB,OACnBwkB,GAAAA,EAASE,EACJ,MAAA,CAACD,EAAQD,GACX,GAAIA,IAAWE,GAAUD,EAASF,EAChCE,OAAAA,EAETD,GAAUE,EAAS,KAIjBC,EAASlK,SAAS,SAACmK,EAAO/B,GAEvB,MAAA,CAACA,EAAK,MAGTM,EAAM1I,SAAS,SAAC7Y,EAAMihB,EAAKgC,GAIzBhB,IAAAA,EAAQC,EAAKliB,EAAKoc,SAAU6E,GAC9BtoB,GAAAA,MAAMsZ,QAAQgQ,GAAQ,CAClBvB,IAAAA,EAAU1gB,EAAKoc,SAAS5M,IAAIyS,EAAM,IACpC,GAAe,iBAARgB,EAMF,MAAA,CAAChC,EAAM,EAAGP,EAAQuB,EAAM,KAL3BvB,GAAAA,EAAQxQ,WAAW+S,EAAKhB,EAAM,IACzB,MAAA,CAAChB,EAAMgC,EAAI7kB,OAAQ6kB,GAOzB,MAAA,CAAChC,EAAKa,MAGToB,GAAOrK,SAAS,SAAC7Y,EAAMihB,GACrBgB,IAAAA,EAAQC,EAAKliB,EAAKoc,SAAU6E,GAC9B,MAAiB,iBAAVgB,EACF,CAAChB,EAAM,EAAGgB,GAEZ,CAAChB,EAAKa,MAGTA,GAAOjJ,SAAS,CAAEphB,SAAU,WAAM,MAAA,UAClC0rB,GAAOtK,SAAS,CAAEphB,SAAU,WAAM,MAAA,UAElC2rB,GAAa,mBACbC,GAAa,SAEbC,GAAWzK,SAAS,SAAArB,GACpB6E,IAAAA,EAAI+G,GAAW1gB,QAAQ8U,GAOpB6E,OANHA,EAAI,IACNA,EAAIgH,GAAW3gB,QAAQ8U,GAAK,IAE1B6E,EAAI,GACNrB,KAAKnmB,MAAmC,IAAA,CAAE2iB,EAAAA,IAErC6E,IAGH/F,GAAWuC,SAAS,SAAA0K,GACpBA,GAAU,OAAVA,EAAG,GACE,MAAA,CAACA,EAAG,GAAI,GAIbC,IAAAA,EAAID,EAAG,GACHC,OAAAA,GACD,IAAA,IACDA,EAAI,KACJ,MAEC,IAAA,IACDA,EAAI,KACJ,MAEC,IAAA,IACDA,EAAI,KACJ,MAEC,IAAA,IACDA,EAAI,KACJ,MAEC,IAAA,IACDA,EAAI,KACJ,MAEC,IAAA,IACKC,IAAAA,EAAwB,GAAlBH,GAASC,EAAG,IAAWD,GAASC,EAAG,IAExC,MAAA,CADPC,EAAIrvB,OAAOmb,aAAamU,GACb,GAIV,MAAA,CAACD,EAAG,KAGPE,GAAU7K,SAAS,SAAC8K,EAASC,GACxBniB,SAAAA,EAAQoiB,GACXlB,IAAAA,EAAU,EAWVmB,EAAa,EACXC,EAAO,CAAC,oBACLC,SAAAA,EAAQjhB,GACTI,IAAAA,EAAYJ,GAAAA,OAAAA,EAAU+gB,KAAAA,OAAAA,KAErB3gB,OADP4gB,EAAK7R,KAAK/O,GACHA,EAOA8gB,SAAAA,EAAUlhB,GACPA,MAAAA,GAAAA,OAAAA,EAAU+gB,KAAAA,OAAAA,KAGhBI,IAAAA,EAAS,CACbC,IAAc,WAAPC,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAO,IAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAPA,EAAO,GAAA,UAAA,GAKP,IAHCC,IAAAA,EAAWD,EAAMzd,IAAI2d,GAAOtrB,KAAK,MAEjCurB,EAAY,GACTlI,EAAI,EAAGA,EAAIsG,EAAStG,IAC3BkI,EAAUrS,KAAYmK,OAAAA,OAAAA,IAUlBpoB,IAAAA,EAAOmwB,EAAM,GAAG,GACf9D,OAAAA,EACCiE,IAAAA,EAAUvrB,KAAK,MAWc/E,EAAYmgB,KAAKC,UAAUpgB,GAO9DowB,IAKJ1N,IAAI1iB,SAAAA,EAAMiI,GACFsoB,IAnDFrhB,EAmDEqhB,EAAUF,EAAMpoB,GACfokB,OAAAA,EACJrsB,IAAAA,GArDCkP,EAAY4gB,GAAAA,OAAAA,EAAK/qB,KAAK,MAA5B,KACA+qB,EAAK3lB,OAAS,EACP+E,GAqDLqhB,IAIFC,MAAQ,WACN,MAAA,iBAEF7C,KAAO,WACL,MAAA,iBAEF8C,GAAe,WAATC,IACEC,IAAAA,EAAWX,EAAU,MADvBU,EAAAA,UAAAA,OAAAA,EAAS,IAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAATA,EAAS,GAAA,UAAA,GAEPE,IAAAA,EAAaF,EAAQhe,IAAI2d,GAAO3d,IAAI,SAAAme,GAAQxE,OAAAA,EACpDwE,IAAAA,EAC0BF,KAAa5rB,KAAK,MAEnCsnB,OAAAA,EACTsE,IAAAA,EACEC,IAGFE,IAAc,WAAPC,IACCC,IAAAA,EAASjB,EAAQ,OACjBY,EAAWX,EAAU,OACrBiB,EAAOlB,EAAQ,KACfmB,EAAOnB,EAAQ,KAJhBgB,EAAAA,UAAAA,OAAAA,EAAO,IAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAPA,EAAO,GAAA,UAAA,GAKNI,IAAAA,EAAWJ,EAAMre,IAAI2d,GAAO3d,IAAI,SAAA0e,GAAW/E,OAAAA,EACnD+E,IAAAA,EAC0BT,EACNM,KAAqBlsB,KAAK,MAErCsnB,OAAAA,EACT4E,IAAAA,EACAC,EACAF,EACAL,EAEEQ,EAEID,EAGFA,EAAUD,EAGDC,EAAyBF,IAEtCK,KAAKC,SAAAA,GAE0BA,OAD7B5C,EAAU9hB,KAAKiL,IAAI6W,EAAS4C,EAAO,GACNA,sBAAAA,OAAAA,EAA7B,iBAEFC,KAAe,WAIPJ,IAAAA,EAAWlB,EAAOa,IAAPb,MAAAA,EAAjB,WACO5D,OAAAA,EACT8E,IAAAA,IAGAK,IAAIF,SAAAA,GACIN,IAAAA,EAASjB,EAAQ,OACvBrB,EAAU9hB,KAAKiL,IAAI6W,EAAS4C,EAAO,GAFxBP,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAO,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAPA,EAAO,EAAA,GAAA,UAAA,GAGZI,IAAAA,EAAWlB,EAAOa,IAAPb,MAAAA,EAAcc,GACxB1E,OAAAA,EACT2E,IAAAA,EACAG,EAEgBG,EAGkDN,IAtHrD,KA0HRS,SAAAA,EAAMC,GAEHV,IAAAA,EAASjB,EAAQ,OAEjB4B,EAAW5B,EAAQ,OACnBkB,EAAOlB,EAAQ,KACf6B,EAAUvB,EAAMoB,GAChBI,EAASxB,EAAMqB,GACfI,EAAY/B,EAAQ,UAEnB1D,OAAAA,EACT4E,IAAAA,EACAD,EACAc,EAEEH,EACAC,EAEQZ,EAGJc,EAAuBb,EAAaa,EACpBb,EACpBD,EACAa,EAEAC,EACYH,EAENV,IAvJK,KAyJRQ,SAAAA,EAAMC,GACHK,IAAAA,EAAU9B,EAAO,MAAMwB,EAAMC,GAC5BrF,OAAAA,EACT0F,IAAAA,IA5Ja,IA+JTN,SAAAA,GACKxB,OAAAA,EAAO,MAAMwB,EAAM,CAAC,UAhKhB,IAkKTA,SAAAA,GACKxB,OAAAA,EAAO,MAAMwB,EAAM,CAAC,WAnKhB,IAqKTA,SAAAA,GACKxB,OAAAA,EAAO,MAAMwB,EAAM,CAAC,WAE7BO,MAAMC,SAAAA,GAC+CA,MAAAA,4CAAAA,OAAAA,EACnD9R,WAAAA,OAAAA,KAAKC,UAAmB6R,SAAAA,OAAAA,IADxB,OAIFC,MAAQ,WAEN,MAAA,+BAEF9Q,IAAM,WAEGiL,OAAAA,EAAP,MAcF8F,IAAI7C,SAAAA,GAEE8C,IAAAA,EAAW,GAAGhK,EAAI,EAChBiK,EAAmB,MAAV/C,EAAGlH,GAIXA,IAHHiK,KACAjK,EAEGA,EAAIkH,EAAGnlB,QAAQ,CACLkY,IADK,EAAA,EACLA,GAASiN,EAAGxc,MAAMsV,IADb,GACb7E,EADa,EAAA,GAGhB+L,GAAU,MAAVA,EADJlH,GAFoB,EAAA,IAGD,GAEfA,EACe/F,IAHA,EAAA,EAGAA,GAASiN,EAAGxc,MAAMsV,IAHlB,GAGVkK,EAHU,EAAA,GAIjBlK,GAJiB,EAAA,GAOZ,IAFCtQ,IAAAA,EAAMyL,EAAE9H,WAAW,GACnB5D,EAAMya,EAAG7W,WAAW,GACjB8W,EAAIza,EAAKya,GAAK1a,EAAK0a,IAC1BH,GAAYlyB,OAAOmb,aAAakX,QAGlCH,GAAY7O,EAGViP,IAAAA,EAAKH,EAAS,KAAO,IACrBI,EAAQtS,KAAKC,UAAUgS,GACtB/F,OAAAA,EAGGoG,IAAAA,EAAwBD,IAIpCE,IAAM,WACGrG,OAAAA,EAAP,MAIFsG,IAAIrD,SAAAA,GAEKlH,IADH4G,IAAAA,EAAM,GAAG5G,EAAI,EACVA,EAAIkH,EAAGnlB,QAAQ,CACLkY,IADK,EAAA,EACLA,GAASiN,EAAGxc,MAAMsV,IADb,GACb7E,EADa,EAAA,GAEpB6E,GAFoB,EAAA,GAGpB4G,GAAOzL,EAEF8I,OAAAA,EACqBlM,IAAAA,KAAKC,UAAU4O,KAG7C4D,KAAKnB,SAAAA,GAEGT,IAAAA,EAASjB,EAAQ,OACjB6B,EAAUvB,EAAMoB,GAGfpF,OAAAA,EACT2E,IAAAA,EACAY,EAIMZ,IAEN6B,QAAQpB,SAAAA,GAEAT,IAAAA,EAASjB,EAAQ,OACjB6B,EAAUvB,EAAMoB,GAGfpF,OAAAA,EACT2E,IAAAA,EACAY,EAEMZ,KAICX,SAAAA,EAAMyC,GACT,GAAgB,iBAATA,EAAmB,CAGtBC,IAAAA,EAAU5S,KAAKC,UAAU0S,GACcA,MAAAA,sCAAAA,OAAAA,EAAcC,WAAAA,OAAAA,EAA3D,MAEIP,IAAAA,EAAKvC,EAAO6C,EAAK,IAIhBN,OAHFA,GACHzL,KAAKnmB,MAAoBkyB,IAAAA,EAAK,IAEzBN,EAAA,WAAMM,EAAAA,EAAAA,EAAKhgB,MAAM,KAGnBud,OAAAA,EAAMT,GAuCNoD,SAAAA,EAAcC,GAcdC,OAhDAA,SAAUC,EACnBF,GACQG,IAAAA,EAAKhM,cACPuB,GAAQ,EACN0K,EAAc,SAAdA,EAAeC,GACf,GAA0B,iBAAnBA,EAA6B,CAC9BA,OAAAA,GACD,IAAA,QAGD3K,GAAQ,EACR,MAEJ,QACU5B,MAAAA,KAAKnmB,MAA8B,IAAA,CAAE0yB,eAAAA,IAG1CD,OAAAA,EAEHlL,IAAAA,EAAWmL,EACbC,EAAYH,EAAGtzB,IAAIqoB,GAClBoL,IACHA,EAAYJ,EAAWhL,EAAUQ,GACjCyK,EAAG3zB,IAAI0oB,EAAUoL,IAEM,mBAAdA,GACTxM,KAAKnmB,MAAe2yB,IAAAA,EAAAA,GAAcA,GAtBEC,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAS,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAATA,EAAS,EAAA,GAAA,UAAA,GAwBxCD,OAAAA,EAAA,WAAaC,EAAAA,IAGfH,OADPA,EAAYJ,cAAgBA,EACrBI,EAiBAH,CAbEO,SAAUtL,EAAUQ,GACrB+K,IAAAA,EAAST,EAAc9K,EAAUQ,QACxB9iB,IAAX6tB,GACF3M,KAAKnmB,MAAL,KAEE+yB,IAAAA,EAAO,KACP,IACFA,EAAOD,EAAOnjB,MAAMmjB,GACZ,QACRA,EAAOE,KAAKF,GAEPC,OAAAA,GAEmBV,GAGxBY,IAAAA,EAAqBb,EAAc,SAAAc,MAEhCC,SAAAA,EAAYC,GACbC,IACAC,EAAsB1mB,EADX,CAAA,OAAUwmB,OAAAA,EAAAA,KAIrBG,EAAkB5R,QAAQ2R,EAAqB,CACnD1F,KAAAA,EACAlB,IAAAA,EACAQ,MAAAA,EACAD,KAAAA,GACAI,KAAAA,EACAnB,IAAAA,EACAoC,KAAAA,GACAf,WAAAA,IAGK,OAAA,WACCiG,IACFC,EACAC,EAFEF,EAAcD,EAAA,WAApB,EAAA,WAGMI,EAAM,SAANA,EAAMC,GAGDC,SAAAA,EAAKnB,GAEN9V,IAAAA,EAAQ,GAGLyK,SAAAA,EAAIyM,GAEP,GAAsB,iBAAfA,EAEFzM,OADPzK,EAAMS,KAAKyW,GACJzM,EAJiBuL,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAC5B,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAD4BA,EAC5B,EAAA,GAAA,UAAA,GAKQmB,IACAC,EADcN,EAAA,WAAYI,EAAAA,CAAAA,GAAelB,OAAAA,IAChBa,aAAaG,GAErCd,OADQlW,EAAM7K,OAAO,SAACtS,EAAGw0B,GAASx0B,OAAAA,EAAEw0B,IAAOD,GAahD,GATJ3M,EAAI6G,OAASA,EACb7G,EAAIqF,IAAMA,EACVrF,EAAI4F,KAAOA,GACX5F,EAAIgH,KAAOA,GACXhH,EAAIiH,KAAOA,GACXjH,EAAIoM,aAAeA,EACnBpM,EAAI6M,QAAUP,EACdtM,EAAIgL,cAAgBqB,EAAYrB,cAEF,iBAAnBK,EACFrL,OAAAA,EAAIqL,GA3BkBhH,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EACjC,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IADiCA,EACjC,EAAA,GAAA,UAAA,GA4BSrE,OAAAA,EAAA,WAAIqL,EAAAA,CAAAA,GAAmBhH,OAAAA,IAUzBmI,OARPA,EAAK3F,OAASA,EACd2F,EAAKnH,IAAMA,EACXmH,EAAK5G,KAAOA,GACZ4G,EAAKxF,KAAOA,GACZwF,EAAKvF,KAAOA,GACZuF,EAAKJ,aAAeA,EACpBI,EAAKK,QAAUP,EACfE,EAAKxB,cAAgBqB,EAAYrB,cAC1BwB,GAETJ,EAAe,SAAAG,GACPvB,IAEA8B,EADS/B,EADOoB,EAAYI,EAAgBvB,gBAU3C8B,OAPPA,EAAOjG,OAASA,EAChBiG,EAAOzH,IAAMA,EACbyH,EAAOlH,KAAOA,GACdkH,EAAO9F,KAAOA,GACd8F,EAAO7F,KAAOA,GACd6F,EAAOV,aAAeA,EACtBU,EAAOD,QAAUP,EACVQ,GAETlB,EAAmBQ,aAAeA,EAC5BW,IAAAA,EACNnB,EAGOS,OAFPU,EAAyBX,aAAeA,EACxCC,EAAcD,EAAaW,IAMzBC,IAAAA,EAAqB,SAACnB,GAAcoB,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAf,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAeA,EAAf,EAAA,GAAA,UAAA,GAA2BA,OAAAA,GACtDD,EAAmBnG,OAASA,EAC5BmG,EAAmBhG,KAAOA,GAC1BgG,EAAmB/F,KAAOA,GAGpBiG,IAAAA,EAAiBzF,EAAQuF,EAAoBlB,GAI7CqB,EADcrB,EAAYpE,GACb,WAAewF,EAAAA,EAAAA,IAG5BE,EAAkB3F,EACxB0F,EAAY,SAAAE,GAAQ,OAAA,WAAUA,OAAAA,KACxBC,EAAiB7F,EAAQ2F,OAAiBxvB,GAK1C2hB,EAAIrH,KAAKC,UAAUuP,OAAY9pB,EAAW,MAC1C2vB,EAAIrV,KAAKC,UAAUmV,OAAgB1vB,EAAW,MAQ7C4vB,OAPHjO,IAAMgO,IACRzO,KAAK2B,KAA0F,IAAA,CAAE8M,EAAAA,IACjGzO,KAAKsB,MAAL,MAIkBqH,EAAQ0F,EAAYrB,KAI3BnP,GAAAA,SAAS6K,IAAD,QAAA,QAAA;;AC9sBA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAAR7K,IAAAA,EAAAA,SAAS,CACxB,CACA,MACA,UACA,CACA,MACA,EACA,WACA,CACA,IACA,cAEA,eAGA,CACA,MACA,aACA,CACA,MACA,EACA,aACA,YACA,aACA,OACA,CACA,OACA,KAIA,CACA,MACA,aACA,CACA,MACA,EACA,CACA,KACA,WACA,YAIA,CACA,MACA,WACA,CACA,MACA,EACA,CACA,MACA,EACA,CACA,IACA,WAGA,CACA,IACA,UAIA,CACA,MACA,SACA,CACA,KACA,CACA,MACA,EACA,MACA,QAEA,CACA,MACA,EACA,MACA,UAEA,CACA,MACA,EACA,MACA,UAEA,CACA,OACA,YAIA,CACA,MACA,SACA,CACA,KACA,CACA,MACA,EACA,UACA,CACA,KACA,CACA,OACA,YAEA,CACA,OACA,aAGA,WAEA,CACA,MACA,GACA,UACA,CACA,KACA,CACA,OACA,YAEA,CACA,OACA,QAEA,CACA,OACA,UAIA,CACA,OACA,aAIA,CACA,MACA,UACA,CACA,KACA,CACA,OACA,SAEA,CACA,OACA,aACA,CACA,UACA,cAGA,CACA,MACA,GACA,OACA,aACA,SAEA,CACA,MACA,GACA,WAEA,CACA,MACA,GACA,SAEA,CACA,MACA,GACA,OAEA,CACA,MACA,GACA,SAEA,CACA,MACA,GACA,SAIA,CACA,MACA,QACA,CACA,MACA,GACA,CACA,MACA,UAEA,eAGA,CACA,MACA,aACA,CACA,OACA,CACA,SAEA,aACA,CACA,IACA,aAEA,CACA,OAEA,aAGA,CACA,MACA,aACA,CACA,OACA,CACA,MACA,aAIA,CACA,MACA,YACA,CACA,KACA,CACA,OACA,cAEA,CACA,OACA,CACA,MACA,UAKA,CACA,MACA,UACA,CACA,KACA,CACA,OACA,CACA,MACA,KAEA,CACA,SAEA,CACA,IACA,CACA,OACA,CACA,UACA,CACA,MACA,MAGA,SAGA,CACA,OAEA,CACA,MACA,KAEA,YAEA,CACA,OACA,CACA,MACA,KAEA,CACA,SAEA,CACA,IACA,CACA,OACA,CACA,UACA,CACA,MACA,MAGA,SAGA,CACA,OAEA,CACA,MACA,KAEA,cAIA,CACA,MACA,QACA,CACA,OACA,CACA,MACA,KAEA,CACA,SAEA,CACA,IACA,CACA,OACA,CACA,UACA,CACA,MACA,MAGA,UAGA,CACA,OAEA,CACA,MACA,KAEA,aAGA,CACA,MACA,QACA,CACA,KACA,CACA,OACA,OACA,CACA,MACA,KAEA,QAEA,CACA,OACA,UAIA,CACA,MACA,OACA,CACA,KACA,CACA,OACA,CACA,MACA,QAEA,CACA,MACA,gCAGA,CACA,OACA,CACA,MACA,SAEA,CACA,MACA,aAEA,CACA,MACA,cAGA,CACA,OACA,CACA,MACA,QAEA,CACA,MACA,MAGA,CACA,OACA,CACA,UACA,CACA,MACA,SAGA,CACA,UAKA,CACA,MACA,YACA,CACA,OACA,CACA,MACA,MAEA,aAGA,CACA,MACA,SACA,CACA,MACA,GACA,CACA,MACA,KAEA,aAGA,CACA,MACA,OACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,MACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,MACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,WACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,OACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,OACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,OACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,QACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,MACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,WACA,CACA,MACA,GACA,CACA,IACA,CACA,KACA,CACA,OACA,SAEA,CACA,OACA,eAMA,CACA,MACA,UACA,CACA,OACA,CACA,MACA,KAEA,CACA,IACA,CACA,OACA,CACA,UACA,aAEA,CACA,SAIA,cAGA,CACA,MACA,QACA,CACA,KACA,CACA,OACA,CACA,MACA,MAGA,CACA,OACA,CACA,MACA,QAGA,CACA,OACA,eAIA,CACA,MACA,YACA,CACA,KACA,CACA,OACA,CACA,MACA,WAGA,CACA,OACA,CACA,MACA,QAGA,CACA,OACA,CACA,MACA,UAKA,CACA,MACA,aACA,CACA,OACA,CACA,UACA,CACA,UAKA,CACA,MACA,OACA,CACA,OACA,CACA,OACA,IAEA,aAGA,CACA,MACA,QACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,MACA,CACA,OACA,CACA,MACA,KAEA,aAGA,CACA,MACA,WACA,CACA,OACA,CACA,MACA,MAEA,aAGA,CACA,MACA,WACA,CACA,OACA,CACA,MACA,MAEA,eApuBuB,QAAA,QAAA;;AC6IA,aAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,mGAAA,8DAAA,yBAAA,8DAAA,oDAAA,kDAAA,oDAAA,qDAAA,qDAAA,sIAAA,6HAAA,wJAAA,kDAAA,gDAAA,8CAAA,gDAAA,8CAAA,iFAAA,ijBAAA,wUAAA,+KAAA,8IAAA,CAAA,mGAAA,8DAAA,yBAAA,8DAAA,oDAAA,kDAAA,oDAAA,qDAAA,qDAAA,sIAAA,6HAAA,wJAAA,kDAAA,gDAAA,8CAAA,gDAAA,8CAAA,iFAAA,mkBAAA,wUAAA,oLAAA,+IAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,mDAAA,SAAA,EAAA,GAAA,GAAA,OAAA,YAAA,OAAA,IAAA,uBAAA,OAAA,UAAA,SAAA,KAAA,GAAA,OAAA,MAAA,KAAA,GAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,CAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,EAAA,QAAA,EAAA,EAAA,OAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,GAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA5HvB,IAAM8K,EAAU9K,SAAS,SACzBmQ,EACAhB,GACUjF,IAAAA,EAAuBiG,EAAvBjG,OAAQG,EAAe8F,EAAf9F,KAAMC,EAAS6F,EAAT7F,KAEbwG,SAAAA,EAAO5mB,EAAQ6mB,GAClBA,OAAgB,IAAhBA,EAAKxrB,OAAsB,CAAC,SACZ,IAAhBwrB,EAAKxrB,OAAsBwrB,EAAK,GAC5B7mB,CAAAA,GAAW6mB,OAAAA,EAAAA,IAGZC,SAAAA,EAASvzB,GACTA,OAAAA,EAAKsQ,OAAO,SAACmZ,EAAOtE,GAElBsE,OADPA,EAAM7N,KAAN6N,MAAAA,EAAc+J,EAAAA,EAAQrO,KACfsE,GACN,IAGI+J,SAAAA,EAAQC,GACXpxB,GAAAA,MAAMsZ,QAAQ8X,GAAO,CACnBA,GAAgB,IAAhBA,EAAK3rB,OACA,MAAA,GAEgB2rB,IAAAA,EAAAA,EAAAA,GAAlBC,EAJgB,EAAA,GAIPhF,EAJO,EAAA,MAAA,GAKnBgF,MAAS,QAATA,EACKH,EAAS7E,GACU,IAAjBA,EAAM5mB,QAAgBzF,MAAMsZ,QAAQ+X,GACtCF,EAAQE,GAER,CAAEA,CAAAA,GAASH,OAAAA,EAAAA,EAAS7E,MAIxB,MAAA,CAAC+E,GAGHf,OAAAA,EAIahB,IAAAA,EAEkCjF,EAClC,SAAC1G,EAAG4N,EAAG9uB,EAAG+uB,GAAO,MAAA,CAAC,MAAO7N,EAAGlhB,IAE5B,SAAAyuB,GAAQD,OAAAA,EAAO,KAAMC,IAErB,SAAAA,GAAQD,OAAAA,EAAO,MAAOC,IAEtB,SAAC7E,EAAKoF,GAAYA,OAAmB,IAAnBA,EAAQ/rB,OAC7C,CAAA,QAAW0rB,OAAAA,EAAAA,EAAQ/E,KACnB,CAAA,MAAOoF,EAAQ,IAAOL,OAAAA,EAAAA,EAAQ/E,MAEX,SAACkF,EAAGxO,GAAM,MAAA,CAAC,OAAQA,IAEnB,SAACwO,EAAGx1B,GAAM,MAAA,CAAC,OAAQA,IAEnB,SAACw1B,EAAGx1B,GAAM,MAAA,CAAC,UAAWA,IAItB,SAACixB,EAAMlC,EAAGmC,GAAQ,MAAA,CAACnC,EAAGkC,EAAMC,IAI5B,SAACD,EAAM0E,GAAS,MAAA,CAACA,EAAK,GAAI1E,IAK1B,SAACuE,EAAG9uB,EAAG+uB,GAAO/uB,OAAAA,GAEd,SAAA1G,GAAK,MAAA,CAAC,MAAOA,IAEb,SAAA+iB,GAAK,MAAA,CAAC,MAAOA,IAEb,WAAM,MAAA,CAAC,QAEP,WAAM,MAAA,CAAC,UAEP,WAAM,MAAA,CAAC,QAIP,SAACyS,EAAG5N,GAAM,MAAA,CAAC,QAASA,IAgBG,SAAA4N,GAAK9G,OAAAA,GAUL,SAAA8G,GAAK9G,OAAAA,GAM/BD,KAQJrK,EAAAA,SAAS8K,GAAD,QAAA,QAAA;;AClHA,aAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,mDAAA,SAAA,EAAA,GAAA,GAAA,OAAA,YAAA,OAAA,IAAA,uBAAA,OAAA,UAAA,SAAA,KAAA,GAAA,OAAA,MAAA,KAAA,GAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,CAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,EAAA,QAAA,EAAA,EAAA,OAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,GAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,kJAAA,wYAAA,qDAAA,YAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAvBvB,IAAM0G,EAAmBxR,SAAS,SAAAyR,GACzBA,OAAAA,EAGwC,IAAA,SAAAb,GAAK,OAAA,WAAW,MAAA,CAAC,UAAWA,KAc3B,SAAAtuB,GAAK,MAAA,CAAC,iBAAkBA,IACxB,SAAC8uB,EAAGM,GAAO,MAAA,CAAA,WAAcA,OAAAA,EAAAA,QAI5D1R,EAAAA,SAASwR,GAAD,QAAA,QAAA;;ACsTA,aAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,iFAAA,YAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,mDAAA,SAAA,EAAA,GAAA,GAAA,OAAA,YAAA,OAAA,IAAA,uBAAA,OAAA,UAAA,SAAA,KAAA,GAAA,OAAA,MAAA,KAAA,GAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,CAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,EAAA,QAAA,EAAA,EAAA,OAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,GAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,kJAAA,snBAAA,2PAAA,wDAAA,wDAAA,iPAAA,+LAAA,gEAAA,8kBAAA,kEAAA,gEAAA,gEAAA,sbAAA,gEAAA,4GAAA,gEAAA,gEAAA,gEAAA,gEAAA,4TAAA,gEAAA,iHAAA,uEAAA,uEAAA,0FAAA,+IAAA,4DAAA,4DAAA,4DAAA,4DAAA,4DAAA,4DAAA,8DAAA,qXAAA,yLAAA,2DAAA,yGAAA,iEAAA,kHAAA,2DAAA,kIAAA,2DAAA,+FAAA,2DAAA,2DAAA,2DAAA,sKAAA,kOAAA,4EAAA,8EAAA,4DAAA,kEAAA,4DAAA,4LAAA,wJAAA,iMAAA,4DAAA,kFAAA,4DAAA,yHAAA,gEAAA,mFAAA,uJAAA,uHAAA,wDAAA,wFAAA,yIAAA,yEAAA,gJAAA,qDAAA,2FAAA,qDAAA,qDAAA,qDAAA,qDAAA,gFAAA,qDAAA,4FAAA,gEAAA,yEAAA,qDAAA,4zBAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OAAA,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAAA,IAAA,IAAA,EAAA,EAAA,EAAA,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAzUvB,IAAMG,EAAkB3R,SAAS,SAAA4R,GAOxB,MAAA,CAAC,QANMA,EAAW7jB,OAAO,SAACmZ,EAAO7jB,GACtBA,IAAAA,EAAAA,EAAAA,EAD+B,GACxCwuB,EADwC,EAAA,GACpCtlB,EADoC,EAAA,GAIxC2a,OAFP2K,EAAG12B,QAAQ,SAAAy1B,GAAK1J,OAAAA,EAAM7N,KAAKuX,KAC3B1J,EAAM7N,KAAK9M,GACJ2a,GACN,OAIC4K,EAAa9R,SAAS,SAACsL,EAAKyG,GACxBzH,IAAAA,EAASyH,EAATzH,KACF0H,EAAYD,EAG6B,IAAA,SAAAnB,GAAK,OAAA,WAAW,MAAA,CAAC,SAAUA,KA0BnB,SAAAhD,GAAaA,MAAAA,OAAAA,OAAAA,IAOjB,SAACwD,EAAG9uB,EAAG+uB,GAAO,MAAA,CAAC,QAAS/uB,IACxB,SAAC8uB,EAAGC,EAAI/uB,EAAG2vB,GAAO,MAAA,CAAC,aAAc3vB,IACjC,SAAC8uB,EAAGc,GAAO,MAAA,CAAC,WAAYA,IAMhB,SAACd,EAAG3zB,GAAS,MAAA,CAAC,YAAaA,IAQ3B,SAAC00B,EAAIvE,GAAO,MAAA,CAACA,EAAIuE,IACjB,SAACA,EAAIvE,EAAIwE,GAAO,MAAA,CAACxE,EAAIuE,EAAIC,IAkBzB,SAACC,EAAIjB,EAAG9uB,EAAG+uB,GAAO,MAAA,CAAC,QAASgB,EAAI/vB,IAC9B,SAAC+vB,EAAIjB,EAAGC,EAAI/uB,EAAG2vB,GAAO,MAAA,CAAC,aAAcI,EAAI/vB,IAC3C,SAAC+vB,EAAIjB,EAAGc,GAAO,MAAA,CAAC,MAAOG,EAAIH,IAC3B,SAACG,EAAIjB,EAAGc,GAAO,MAAA,CAAC,WAAYG,EAAIH,IAiBhC,SAACd,EAAGC,EAAI1S,EAAGsT,EAAI1lB,EAAG+lB,EAAIhwB,GAAM,MAAA,CAAC,KAAMqc,EAAGpS,EAAGjK,IACzC,SAAC8uB,EAAGC,EAAI1S,EAAGsT,EAAI1lB,GAAM,MAAA,CAAC,KAAMoS,EAAGpS,IAG/B,SAACgmB,EAAOnB,EAAGoB,GAAS,MAAA,CAAC,QAASD,EAAOC,IACrC,SAACpB,EAAGR,EAAGjS,EAAG8T,GAAM,MAAA,CAAC,MAAO7B,EAAGjS,EAAG8T,IAC9B,SAACrB,EAAGR,EAAGjS,GAAM,MAAA,CAAC,MAAOiS,EAAGjS,IACxB,SAACyS,EAAGR,EAAG6B,GAAM,MAAA,CAAC,MAAO7B,OAAG3vB,EAAWwxB,IACnC,SAACrB,EAAGC,GAAO,MAAA,CAAC,aAWZ,SAACD,EAAGC,EAAI1S,EAAGsT,EAAI1lB,EAAG+lB,EAAIhwB,GAAM,MAAA,CAAC,KAAMqc,EAAGpS,EAAGjK,IACzC,SAAC8uB,EAAGC,EAAI1S,EAAGsT,EAAI1lB,GAAM,MAAA,CAAC,KAAMoS,EAAGpS,IAI9E,SAAC6kB,EAAGC,EAAIqB,EAAGhB,EAAGO,EAAI3vB,EAAGgwB,EAAI1B,GAAM,MAAA,CAAC,QAAS8B,EAAGhB,EAAGpvB,EAAGsuB,IACI,SAACQ,EAAGC,EAAIK,EAAG/S,EAAGsT,EAAIzO,EAAG8O,EAAI1B,GAAM,MAAA,CAAC,MAAOc,EAAG/S,EAAG6E,EAAGoN,IAChD,SAACQ,EAAGC,EAAI1S,EAAGsT,EAAIrB,GAAM,MAAA,CAAC,QAASjS,EAAGiS,IAExF,SAACQ,EAAGC,EAAI/uB,EAAG2vB,EAAIK,EAAIT,EAAIc,GAAO,MAAA,CAAC,SAAUrwB,EAAGuvB,IAID,SAACT,EAAGmB,EAAON,GAAO,MAAA,CAAC,WAAYM,IAC/B,SAACnB,EAAGC,GAAO,MAAA,CAAC,aACZ,SAACD,EAAGmB,EAAOlB,GAAO,MAAA,CAAC,QAASkB,IAC5B,SAACnB,EAAGC,GAAO,MAAA,CAAC,UACZ,SAACD,EAAG9uB,EAAG+uB,GAAO,MAAA,CAAC,SAAU/uB,IACzB,SAAC8uB,EAAGC,GAAO,MAAA,CAAC,WACZ,SAACD,EAAG9uB,EAAG2vB,GAAO,MAAA,CAAC,QAAS3vB,IAEzB,SAAC8uB,EAAGR,EAAGS,GAAO,MAAA,CAAC,QAAST,IAYvB,SAAChD,EAAIgF,EAAOxB,GAAM,MAAA,CAACxD,EAAIgF,IAOxB,SAACn3B,EAAG21B,EAAG9uB,GAAM,MAAA,CAAC,OAAQ7G,EAAG6G,IACzB,SAAC7G,EAAG21B,EAAG9uB,GAAM,MAAA,CAAC,OAAQ7G,EAAG6G,IAInB,SAAC8uB,EAAGyB,EAAIxB,GAAO,MAAA,CAAC,aAAcwB,IAC9B,SAACzB,EAAGyB,EAAIxB,GAAO,MAAA,CAAC,cAAewB,IAKrC,SAAAnR,GAAK,MAAA,CAAC,YAAanG,KAAK3H,MAAM8N,KAC9B,SAAAoR,GAAK,MAAA,CAAC,cAAeA,IAMrB,SAAC1B,EAAG31B,GAAM,MAAA,CAAC,OAAQA,IACnB,SAACouB,EAAGuH,EAAG9uB,GAAM,MAAA,CAAC,WAAYunB,EAAGvnB,IAI7B,SAAC8uB,EAAG31B,GAAM,MAAA,CAAC,UAAWA,IACtB,SAACkyB,EAAGyD,EAAG31B,GAAM,MAAA,CAAC,YAAakyB,EAAGlyB,IAC9B,SAACy2B,EAAId,EAAG9uB,GAAM,MAAA,CAAC,eAAgB4vB,EAAG,GAAIA,EAAI5vB,IAC1C,SAAA4vB,GAAM,MAAA,CAAC,YAAaA,EAAG,GAAIA,IAK3B,SAAC5vB,EAAG+uB,GAAO/uB,OAAAA,GAOE,SAAAywB,GAAMpB,OAAAA,EAAgBoB,IAElC,SAACrI,EAAI0G,EAAGR,EAAGS,GAAO,MAAA,CAAC,SAAU3G,EAAIkG,IAElC,SAACQ,EAAG9uB,GAAM,MAAA,CAAC,OAAQA,IAClB,SAAC8uB,EAAGC,GAAO,MAAA,CAAC,YAET,SAACD,EAAGC,EAAI51B,EAAGw2B,EAAIrB,GAAM,MAAA,CAAC,QAASn1B,EAAGm1B,IACtC,SAACQ,EAAGR,GAAM,MAAA,CAAC,UAAWA,IAOtB,SAACQ,EAAG1P,EAAG2P,EAAI51B,EAAGw2B,EAAIrB,GAAM,MAAA,CAAC,eAAgBlP,EAAGjmB,EAAGm1B,IAI/C,SAACQ,EAAG1P,EAAG2P,EAAI51B,EAAGw2B,EAAIrB,GAAM,MAAA,CAAC,eAAgBlP,EAAE,GAAIjmB,EAAGm1B,IAKjD,SAACiC,EAAIxB,EAAIT,GAAM,MAAA,CAAC,QAASiC,EAAIjC,IAC7B,SAACiC,EAAIxB,EAAI/uB,GAAM,MAAA,CAAC,SAAUuwB,EAAIvwB,IAG/B,SAAA4vB,GAAM,MAAA,CAAC,CAAC,MAAOA,KACd,SAACd,EAAGyB,EAAIxB,GAAOwB,OAAAA,GAKX,SAACzB,EAAG1P,EAAG2P,EAAIY,EAAIrB,GAAM,MAAA,CAAC,SAAUlP,EAAG,GAAIkP,IACvC,SAACQ,EAAG1P,EAAG2P,EAAI51B,EAAGw2B,EAAIrB,GAAM,MAAA,CAAC,SAAUlP,EAAG,CAACjmB,GAAIm1B,IAG1C,SAAClP,EAAG0P,EAAG31B,EAAG41B,EAAIT,GAAM,MAAA,CAAC,SAAUlP,EAAGjmB,EAAGm1B,IAOxC,SAAAQ,GAAK9G,OAAAA,GAKZ,SAAC0I,EAAKd,GAAO,MAAA,CAAC,MAAOc,EAAMd,IAC3B,SAACc,EAAKd,GAAO,MAAA,CAAC,MAAOc,EAAMd,IAGvB,SAACtE,EAAIgF,GAAU,MAAA,CAAChF,EAAIgF,IAIpB,SAAAlB,GAAK,MAAA,CAAC,OAAQnW,KAAK3H,MAAM8d,KACX,SAACuB,EAAO5B,EAAInD,EAAM+D,GACtF,MAAA,CAAC,OAAQ,CAAC,MAAOgB,GAAQ,CAAC/E,KAIsB,SAACzyB,EAAG21B,EAAG9uB,GAAM,MAAA,CAAC,OAAQ7G,EAAG6G,IACzB,SAAC7G,EAAG21B,EAAG9uB,GAAM,MAAA,CAAC,OAAQ7G,EAAG6G,IAIzB,SAAC8uB,EAAGC,EAAIK,GAAM,MAAA,CAAC,aAAc,CAAC,CAAC,KAAM,IAAKA,EAAE,OAC5C,SAAAhQ,GAAK,MAAA,CAAC,aAAcA,IACpB,SAACgQ,EAAGN,EAAGC,EAAI6B,GAAO,MAAA,CAAC,aAAc,CAAC,CAAC,KAAM,UAAWxB,EAAE,IACtG,CAAC,KAAM,IAAKwB,EAAG,OACiC,SAACxB,EAAGhQ,GAAM,MAAA,CAAC,aAAe,CAAA,CAAC,KAAM,UAAWgQ,EAAE,KAAQhQ,OAAAA,EAAAA,MACtD,SAAAgQ,GAAK,MAAA,CAAC,aAAc,CAAC,CAAC,KAAM,UAAWA,EAAE,OAGzC,SAAAA,GAAK,MAAA,CAAC,KAAMA,EAAE,GAAIA,EAAE,KACpB,SAAClO,EAAG4N,EAAGM,GAAM,MAAA,CAAC,KAAMlO,EAAGkO,EAAE,KAGV,SAACN,EAAGx1B,EAAGy1B,GAAOz1B,OAAAA,GAErB,SAACw1B,EAAGvH,EAAGwH,EAAIz1B,EAAGq2B,GAAO,MAAA,CAAC,SAAUpI,EAAGtO,KAAK3H,MAAMhY,KAEtD,SAACw1B,EAAGC,EAAI/uB,EAAG2vB,GAAO,MAAA,CAAC,gBAAiB3vB,IACpC,SAAC8uB,EAAGM,GAAO,MAAA,CAAA,UAAaA,OAAAA,EAAAA,MAwCjE,MAAA,CAACM,EALc1G,EAAI4E,QAAQ8B,EAAZ1G,CAEkB,IAAA,SAAAhpB,GAAK,OAAA,WAAWA,OAAAA,QAM3C0d,EAAAA,SAAS8R,GAAD,QAAA,QAAA;;AC1NA,aAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,kFAAA,uHAAA,kEAAA,wHAAA,0EAAA,0JAAA,yEAAA,yLAAA,uEAAA,qEAAA,qEAAA,iEAAA,uOAAA,qDAAA,ojBAAA,iCAAA,OAAA,CAAA,kFAAA,uHAAA,kEAAA,wHAAA,0EAAA,0JAAA,yEAAA,yLAAA,uEAAA,qEAAA,qEAAA,iEAAA,uOAAA,qDAAA,smBAAA,oCAAA,QAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA7GvB,IAAMqB,EAAWnT,SAAS,SAAAsL,GAChBrC,IAAAA,EAAqBqC,EAArBrC,KAAMoB,EAAeiB,EAAfjB,KAAMC,EAASgB,EAAThB,KACbgB,OAAAA,EAEqC,IAAA,SAAAzB,GAAK,OAAA,WAAWA,OAAAA,IAMlB,SAAAnI,GAAK,MAAA,CAAC,OAAQnG,KAAK3H,MAAM8N,KAGzB,SAAAoR,GAAK,MAAA,CAAC,WAAYA,IAKlB,SAAApR,GAAK,MAAA,CAAC,OAAQnG,KAAK3H,MAAM8N,KAGzB,SAAAoR,GAAK,MAAA,CAAC,WAAYA,IAKJ,SAAC1B,EAAGgC,EAAI/B,GAAO,MAAA,CAAC,QAAS+B,IAG1B,SAAChC,EAAGgC,EAAI/B,GAAO,MAAA,CAAC,QAAS+B,IAQxB,SAAChC,EAAGyB,EAAIxB,GAAO,MAAA,CAAC,SAAUwB,IAG9B,SAACzB,EAAGyB,EAAIxB,GAAO,MAAA,CAAC,SAAUwB,IAGnC,SAAClF,EAAGyD,EAAG9uB,GAAM,MAAA,CAAC,OAAQqrB,EAAGrrB,IAGzB,SAACqrB,EAAGyD,EAAG9uB,GAAM,MAAA,CAAC,OAAQqrB,EAAGrrB,IAG7B,SAAA8nB,GAC/BiJ,IAAAA,EAAK9X,KAAK3H,MAAMwW,GAClBiJ,MAAO,cAAPA,EAEKpK,EAEF,CAAC,OAAQoK,IAaoB,SAAAjC,GAAK9G,OAAAA,GAGlCD,EAgCkB,SAAA+G,GAAK9G,OAAAA,GACL,SAAA8G,GAAK9G,OAAAA,MAKnBtK,EAAAA,SAASmT,GAAD,QAAA,QAAA;;ACpGhB,aAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,mDAAA,SAAA,EAAA,GAAA,GAAA,OAAA,YAAA,OAAA,IAAA,uBAAA,OAAA,UAAA,SAAA,KAAA,GAAA,OAAA,MAAA,KAAA,GAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,CAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,EAAA,QAAA,EAAA,EAAA,OAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,GAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,eAAA,QAAA,QAAA,QAAA,aAAA,EApBA,IAAMG,EAAUtT,SAAS,SAAC8S,EAAGS,EAAIhnB,GAC9BumB,MAAAA,CAAAA,GAAMS,OAAAA,EAAAA,GAAIhnB,CAAAA,MAmBb,QAAA,QAAA,EAhBA,IAAMinB,EAAUxT,SAAS,SAAAyT,GAOzB,IAHC9c,IAAAA,EAAM,CAAC8c,EAAM,IACbC,EAAW,GACXrO,EAAMoO,EAAMluB,OACTie,EAAI,EAAGA,EAAI6B,EAAK7B,GAAK,EAC5BkQ,EAASra,KAAKoa,EAAMjQ,IACpB7M,EAAI0C,KAAKoa,EAAMjQ,EAAI,IAEfD,IAAAA,EAAe5M,GAAAA,OAAAA,GAEb,OADR4M,EAAS5M,IAAMA,EACP,CAAA,CAAC,OAAQ4M,IAAcmQ,OAAAA,KAG1B,QAAA,QAAA,EAAA,IAAMC,EAAiB3T,SAAS,SAAAoT,GAC/BnM,IAAAA,EAAU,GAD2B,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAE3BmM,IAAAA,IAAI,EAAJA,EAAAA,EAAI,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,MAAA,GAAA,EAAA,CAAT9wB,IAAAA,EAAS,EAAA,WACLrB,IAATqB,EAAE,GAEJA,EAAEnH,QAAQ,SAAAi2B,GAAKnK,OAAAA,EAAQ5N,UAAKpY,KAG5BgmB,EAAQ5N,KAAK/W,IAR0B,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAWpC2kB,OAAAA,IAXF,QAAA,eAAA;;AC6QgB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAnQvB,IAAA,EAAA,QAAA,qBAmQuB,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,iGAAA,+TAAA,wNAAA,qGAAA,+mDAAA,mKAAA,qGAAA,kEAAA,iSAAA,kIAAA,uHAAA,qHAAA,uGAAA,+DAAA,+GAAA,+DAAA,gMAAA,gEAAA,8GAAA,gEAAA,gEAAA,gIAAA,qXAAA,kSAAA,gEAAA,oEAAA,iGAAA,4IAAA,2NAAA,2NAAA,oFAAA,iEAAA,iEAAA,qWAAA,kEAAA,gEAAA,wZAAA,gPAAA,CAAA,iGAAA,+TAAA,0NAAA,sGAAA,uoDAAA,mKAAA,qGAAA,kEAAA,iSAAA,kIAAA,uHAAA,qHAAA,uGAAA,+DAAA,+GAAA,+DAAA,gMAAA,gEAAA,8GAAA,gEAAA,gEAAA,gIAAA,qXAAA,kSAAA,gEAAA,oEAAA,iGAAA,4IAAA,2NAAA,2NAAA,oFAAA,iEAAA,iEAAA,qWAAA,kEAAA,gEAAA,wZAAA,iPAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OAAA,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAAA,IAAA,IAAA,EAAA,EAAA,EAAA,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EAnQmC,IAAMqM,EAAUtT,SAAS4T,EAAD,SAE5EC,EAAS7T,SAAS,SAAC8T,EAAMC,GACtBA,OAAAA,EAAOhmB,OAAO,SAACimB,EAAD,GAAA,IAAA,EAAA,EAAA,EAAA,GAAuB,MAAA,CAAvB,EAAA,GAA4BA,EAA5B,EAAA,KAA0CF,KAG3DG,EAAuBjU,SAAS,SAAApkB,GAE7B4nB,IADHA,IAAAA,EAAI,EAAE0Q,EAAK,GACR1Q,EAAI5nB,EAAE2J,QAAQ,CACboZ,IAAAA,EAAI/iB,EAAEsS,MAAMsV,EAAGA,EAAI,GACf,OAAN7E,GAEFuV,GAAMt4B,EAAEsS,MAAMsV,EAAGA,EAAI,GACrBA,GAAK,GACU,MAAN7E,GAETuV,GAAM,MACN1Q,MAGA0Q,GAAMvV,EACN6E,KAGO0Q,MAAAA,IAAAA,OAAAA,EAAX,OAGIC,EAAanU,SAAS,SAAAsL,GAClBhB,IAAAA,EAASgB,EAAThB,KACDgB,OAAAA,EAEgD,IAAA,SAAAzB,GAAK,OAAA,WAAWA,OAAAA,IAab,SAAAuH,GAAK9G,OAAAA,GAOtB,SAAA1uB,GAAKq4B,OAAAA,EAAqBr4B,IAG9B,SAAAw1B,GAAK9G,OAAAA,GA0Df,SAAA8G,GAAK,MAAA,CAAC,YAAQnwB,IAMmB,SAACmwB,EAAGyB,EAAIxB,GAAO,MAAA,CAAC,SAAUwB,IAI1B,SAACzB,EAAGgC,EAAI/B,GAAO,MAAA,CAAC,QAAS+B,IAE3B,SAAAlB,GAAM,MAAA,CAAC,MAAOA,IAMd,SAAAA,GAAM,MAAA,CAAC,MAAOA,IAMd,SAACd,EAAG9uB,EAAG+uB,GAAO/uB,OAAAA,GAKd,SAAC8uB,EAAG9uB,EAAG+uB,GAAO/uB,OAAAA,GAKd,SAAC8uB,EAAG9uB,GAAM,MAAA,CAAC,SAAUA,IAIrB,SAAA8xB,GAAK,MAAA,CAAC,OAAQA,EAAE,GAAIA,IACpB,SAAChD,EAAG9uB,GAAM,MAAA,CAAC,YAAaA,IAIxB,SAAA8xB,GAAK,MAAA,CAAC,OAAQA,EAAE,GAAIA,IACpB,SAAChD,EAAG9uB,GAAM,MAAA,CAAC,YAAaA,IASvB,SAAAqoB,GAAK,MAAA,CAAC,QAAS,CAACA,KAChB,SAACmI,EAAGS,EAAIhnB,GAAM,MAAA,CAAC,QAAS+mB,EAAQR,EAAGS,EAAIhnB,KAIvC,SAAC6kB,EAAG9uB,EAAG2vB,GAAO,MAAA,CAAC,QAAS3vB,IACxB,SAAC8uB,EAAGc,GAAO,MAAA,CAAC,MAAOA,IACnB,SAAAvH,GAAK,MAAA,CAAC,MAAOA,IAKb,SAAAltB,GAAQ,MAAA,CAAC,OAAQA,IAQlBo2B,EAOC,SAAAnS,GAAK,MAAA,CAAC,OAAQnG,KAAK3H,MAAM8N,KACzB,SAAC0P,EAAG9uB,GAAM,MAAA,CAAUA,QAAAA,IAEnB,SAAC8uB,EAAG3zB,EAAM4zB,GAAO5zB,OAAAA,GAIlB,SAAC2zB,EAAG9uB,GAAM,MAAA,CAAC,SAAUA,IAMrB,SAACsrB,EAAItrB,GAAM,MAAA,CAACsrB,EAAItrB,IAOjB,SAAAsrB,GAAaA,MAAAA,OAAAA,OAAAA,IAKZ,SAAClvB,EAAGkvB,EAAIyG,GAAM,MAAA,CAACzG,EAAIlvB,EAAG21B,IAGtBR,EACAA,EACAA,EAOAA,EAEDA,EACAA,EAeF,SAAClV,EAAGyS,EAAG7kB,EAAG8kB,EAAI/uB,GAAM,MAAA,CAAC,OAAQqc,EAAGpS,EAAGjK,OAY9E0d,EAAAA,SAASmU,GAAD,QAAA,QAAA;;ACzKA,aAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,mDAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,CAAA,IAAA,IAAA,EAAA,EAAA,EAAA,IAAA,MAAA,EAAA,QAAA,EAAA,EAAA,OAAA,IAAA,EAAA,GAAA,EAAA,GAAA,OAAA,GAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,mBAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OAAA,SAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,IAAA,IAAA,SAAA,EAAA,GAAA,GAAA,OAAA,YAAA,OAAA,IAAA,uBAAA,OAAA,UAAA,SAAA,KAAA,GAAA,OAAA,MAAA,KAAA,GAAA,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAAA,IAAA,IAAA,EAAA,EAAA,EAAA,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAtHvB,IAAMG,EAAOtU,SAAS,SAAA8C,GAAgBA,MAAAA,MAAAA,OAAAA,KAGhCyR,EAAWvU,SAAS,SAACwU,EAAM1H,GAC3B2H,IAAAA,EAAM,GACNC,EAAY,GAFuB,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAGrBF,IAAAA,IAAM,EAANA,EAAAA,EAAM,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,MAAA,GAAA,EAAA,CAAbpK,IAAAA,EAAa,EAAA,MACV,KAARA,IACFqK,GAAOC,EAAYtK,EACnBsK,EAAY5H,IANuB,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAShC2H,OAAAA,IAGHE,EAAsB3U,SAAS,SAAC4U,GAAWC,IAI3CC,EAJ2CD,EAASP,UAAAA,OAAAA,QAAAA,IAAAA,UAAAA,GAAAA,UAAAA,GAAAA,EAAK,UACvDS,EAAUT,EAAK,WACfU,EAAU5S,UACV6S,EAAa5S,UAEf6S,EAAU,EACRC,EAAY,CAChBC,GAAGC,SAAAA,EAAKC,GACFD,MAAQ,MAARA,GACFP,EAAWQ,EACJ,IAECD,GAAAA,OAAAA,EAAQC,MAAAA,OAAAA,IAEpB5lB,KAAKoO,SAAAA,EAAKoQ,GACF9yB,IAAAA,EAAOm6B,EAAUzX,GACb1iB,MAAAA,GAAAA,OAAAA,EAAUm6B,OAAAA,OAAAA,EAAUrH,KAEhCpQ,IAAI1iB,SAAAA,GAEKA,OADP65B,EAAWr6B,IAAIQ,GACRA,GAETo6B,eAAej7B,SAAAA,GACHw6B,MAAAA,GAAAA,OAAAA,EAAqBQ,eAAAA,OAAAA,EAAUh7B,GAAzC,MAEFk7B,QAAQC,SAAAA,EAAMC,GACZV,EAAWhb,QACL2b,IAAAA,EAAWrB,EAASoB,EAAM7nB,IAAIynB,GAAY,MAC5Cp2B,EAAS,GAHM,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAIC81B,IAAAA,IAAmB,EAAnBA,EAAAA,EAAW/rB,OAAQ,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,MAAA,GAAA,EAAA,CAA5B4Z,IAAAA,EAA4B,EAAA,MACrC3jB,GAAa41B,GAAAA,OAAAA,EAAWjS,KAAAA,OAAAA,EAAWA,OAAAA,OAAAA,EAAnC,QALiB,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAQT4S,OADVT,EAAWhb,QACDyb,GAAAA,OAAAA,EAAQE,KAAAA,OAAAA,EAAcz2B,OAAAA,OAAAA,IAElC02B,OAAOC,SAAAA,EAAQC,GAEbjB,OAAW7zB,EACL20B,IAAAA,EAAWL,EAAUO,GAKvBF,YAJa30B,IAAb6zB,IACFA,EAAWR,EAAYY,OAAAA,OAAAA,OAEzBF,EAAQn6B,IAAIk7B,EAAYjB,GACpBc,EACeA,UAAAA,OAAAA,EAAed,QAAAA,OAAAA,EAAhC,OAEK,IAETkB,WAAWJ,SAAAA,GACFrB,OAAAA,EAASqB,EAAS9nB,IAAIynB,GAAY,OAE3CU,WAAW7C,SAAAA,GACEmB,MAAAA,IAAAA,OAAAA,EAASnB,EAAGtlB,IAAIynB,GAAY,MAAvC,MAEFW,UAAUC,SAAAA,EAAIv0B,GACNw0B,IAAAA,EAAUb,EAAU3zB,GACtBu0B,OAAAA,IAAOC,EACFD,EAECA,GAAAA,OAAAA,EAAOC,MAAAA,OAAAA,IAEnBC,YAAYjD,SAAAA,GACCmB,MAAAA,IAAAA,OAAAA,EAASnB,EAAGtlB,IAAIynB,GAAY,MAAvC,MAEFe,QAAQ1D,SAAAA,GACAvvB,IAAAA,EAAOuvB,EAAM7kB,OAAO,SAACmZ,EAAOqP,GAAQrP,OAAAA,EAAQqO,EAAUgB,IAAM,IAC5DC,EAAU,GACVjV,EAAQ,GAHD,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAIayT,IAAAA,IAAmB,EAAnBA,EAAAA,EAAQxnB,UAAW,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,MAAA,GAAA,EAAA,CAAA,IAAA,EAAA,EAAA,EAAA,MAAA,GAAjCipB,EAAiC,EAAA,GAA5Br7B,EAA4B,EAAA,GAC3Co7B,EAAQnd,KAAKod,GACblV,EAAMlI,KAAKje,IANA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAQPw6B,IAAAA,EAAWrB,EAAShT,EAAO,MACvBsT,MAAAA,GAAAA,OAAAA,EACdtZ,OAAAA,OAAAA,KAAKC,UAAUgb,GACdZ,QAAAA,OAAAA,EACKb,kBAAAA,OAAAA,EACN1xB,YAAAA,OAAAA,EACO0xB,aAAAA,OAAAA,EALH,UAQF2B,KAAKxI,SAAAA,GACUqH,MAAAA,MAAAA,OAAAA,EAAUrH,KAEzByI,QAAQzI,SAAAA,GACOqH,MAAAA,MAAAA,OAAAA,EAAUrH,MAIrBqH,EAAY,SAAAqB,GACZ,GAAgB,iBAATA,EACFA,OAAAA,EAEeA,IAAAA,EAAAA,EAAAA,GAAjBx7B,EAJiB,EAAA,GAIRqC,EAJQ,EAAA,MAAA,GAKlBo5B,EAAW1B,EAAU/5B,GACvB,IAACy7B,EACG1U,MAAAA,KAAKnmB,MAAwB,IAAA,CAAEZ,KAAAA,IAEhCy7B,OAAAA,EAAA,WAAYp5B,EAAAA,EAAAA,KAEd83B,OAAAA,EAAUX,KAGJ5U,EAAAA,SAAS2U,GAAD,QAAA,QAAA;;ACpFA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAnCvB,IAAMmC,EAAY9W,SAAS,SAACqD,EAAKqG,GAGtBqN,SAAAA,EAAOrI,GAAmBjxB,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EACnC,IAAA,MAAA,EAAA,EAAA,EAAA,EAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IADmCA,EACnC,EAAA,GAAA,UAAA,GACM,GAA0B,iBAAnBixB,EACFoI,OAAAA,EAAUzT,EAAIqL,GAAiBhF,GAElCnG,IAAAA,EAAWmL,EACXsI,EAASzT,EAASxV,OAAO,SAACmZ,EAAO3a,EAAGiX,GAEjC0D,OADPA,EAAM7N,KAAK9M,EAAGjR,OAAOmC,EAAK+lB,KACnB0D,GACN,IACH8P,EAAO3d,KAAKkK,EAASA,EAAShe,OAAS,IACjC0xB,IAAAA,EAAUD,EAAO72B,KAAK,IACtB+2B,EAAOz5B,EAAKsQ,OAAO,SAACmZ,EAAOwF,EAAMlJ,GAE9B0D,OADPA,EAAM7N,KAAK/d,OAAOoxB,GAAOnJ,EAAS5M,IAAI6M,EAAI,IACnC0D,GACN,CAAC3D,EAAS5M,IAAI,KAAKxW,KAAK,IACrBg3B,EAAW,CACfC,KAAM,EACNC,OAAQ,EACR1N,KAAM,EACND,IAAAA,GAEI4N,EAAO,CAACL,GAGP5T,OAFPiU,EAAK3gB,IAAM,CAACugB,GACZI,EAAK7N,QAAU,CAAC0N,GACT9T,EAAIiU,GAINP,OAFPA,EAAO1I,cAAgBhL,EAAIgL,cAC3B0I,EAAOtH,aAAepM,EAAIoM,aACnBsH,IAGM/W,EAAAA,SAAS8W,GAAD,QAAA,QAAA;;ACehB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,eAAA,EAnDP,IAAA,EAAA,EAAA,QAAA,mBACA,EAAA,EAAA,QAAA,sBACA,EAAA,EAAA,QAAA,oBAEA,EAAA,EAAA,QAAA,8BACA,EAAA,EAAA,QAAA,uBACA,EAAA,EAAA,QAAA,qBACA,EAAA,EAAA,QAAA,uBACA,EAAA,EAAA,QAAA,yBACA,EAAA,EAAA,QAAA,qBA0CO,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,4BAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,GAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,UAAA,OAAA,IAAA,CAAA,IAAA,EAAA,MAAA,UAAA,GAAA,UAAA,GAAA,GAAA,EAAA,OAAA,KAAA,GAAA,mBAAA,OAAA,wBAAA,EAAA,EAAA,OAAA,OAAA,sBAAA,GAAA,OAAA,SAAA,GAAA,OAAA,OAAA,yBAAA,EAAA,GAAA,eAAA,EAAA,QAAA,SAAA,GAAA,EAAA,EAAA,EAAA,EAAA,MAAA,OAAA,EAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,KAAA,EAAA,OAAA,eAAA,EAAA,EAAA,CAAA,MAAA,EAAA,YAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,GAAA,EAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,GAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,wBAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,IAAA,IAAA,EAAA,EAAA,CAAA,4BAAA,KAAA,OAAA,EAAA,WAAA,OAAA,GAAA,EAAA,SAAA,EAAA,EAAA,GAAA,OAAA,IAAA,EAAA,EAAA,MAAA,IAAA,OAAA,OAAA,OAAA,iBAAA,EAAA,CAAA,IAAA,CAAA,MAAA,OAAA,OAAA,OAAA,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAAA,IAAA,IAAA,EAAA,EAAA,EAAA,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EAnDiC,IAAMjM,EAAU7K,SAASuX,EAAD,SACZxM,EAAa/K,SAASwX,EAAD,SAC1B1M,EAAU9K,SAASyX,EAAD,SAECjG,EAAmBxR,SAAS0X,EAAD,SACxC5F,EAAa9R,SAAS2X,EAAD,SACzBxE,EAAWnT,SAAS4X,EAAD,SACfzD,EAAanU,SAAS6X,EAAD,SACVC,EAAsB9X,SAAS+X,EAAD,SAC5CjB,EAAY9W,SAASgY,EAAD,SAEhE7H,EAASnQ,SAAS6K,EAAQC,EAASC,IACnCkN,EAAUjY,SAASmT,EAAShD,IAC5B+H,EAAYlY,SAASmU,EAAWhE,EAAOD,QAAQ+H,KACjCjY,EAAAA,SAAS8R,EAAW3B,EAAQA,EAAOD,QAAQgI,KAqCxD,EAAA,EAAA,EAAA,GArCAlG,EAAAA,EAAAA,GACDmG,EAAkBnY,SAASwR,EAAiBrB,EAAOD,QAAQ8B,KAoCpDoG,EAAYpY,SAAS,SAACqY,EAAYC,GAE/ChW,OAAAA,YAAY,SAAAzG,GACF0c,IAAAA,EAAmCD,EAAnCC,WAAY/6B,EAAuB86B,EAAvB96B,OAAQg7B,EAAeF,EAAfE,WACxBD,GAAe,WAAfA,EACIpW,MAAAA,KAAKnmB,MAAiC,IAAA,CAAEu8B,WAAAA,IAE5C/6B,GAAW,iBAAXA,EACI2kB,MAAAA,KAAKnmB,MAA6B,IAAA,CAAEwB,OAAAA,IAGpCg7B,OAAAA,GACD,IAAA,WACKnV,IAGAoV,EAHM3B,EAAUqB,EAAiBG,EAAWI,UAGhCrV,CAAMgV,IAAAA,GAGlBM,EAAiBb,EAAoBW,EAAW,aAK/C5c,OAAAA,EAHFyc,EAAAA,GAAAA,EADO,CAEVK,eAAAA,KAID,IAAA,SAWM9c,OAVKib,EAAU9E,EAAWsG,EAAWI,UAG5CrV,CAAMgV,IAAAA,GAOCxc,EAHFyc,EAAAA,GAAAA,EADO,CAEVK,eAAgBN,KAItB,QACUlW,MAAAA,KAAKnmB,MAAiC,IAAA,CAAEw8B,WAAAA,SAxC/C,QAAA,UAAA;;AC/CA,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,OAAA,eAAA,QAAA,YAAA,CAAA,YAAA,EAAA,IAAA,WAAA,OAAA,EAAA,aAAA,QAAA,IAAA,QAAA,aAAA,EALP,IAAA,EAAA,EAAA,QAAA,uCACA,EAAA,EAAA,QAAA,4BACA,EAAA,QAAA,2BAGO,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,UAAA,OAAA,IAAA,CAAA,IAAA,EAAA,MAAA,UAAA,GAAA,UAAA,GAAA,GAAA,EAAA,OAAA,KAAA,GAAA,mBAAA,OAAA,wBAAA,EAAA,EAAA,OAAA,OAAA,sBAAA,GAAA,OAAA,SAAA,GAAA,OAAA,OAAA,yBAAA,EAAA,GAAA,eAAA,EAAA,QAAA,SAAA,GAAA,EAAA,EAAA,EAAA,EAAA,MAAA,OAAA,EAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,KAAA,EAAA,OAAA,eAAA,EAAA,EAAA,CAAA,MAAA,EAAA,YAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,GAAA,EAAA,EADA,IAAMI,EAAchX,EAAAA,GAAAA,EAAP,QAAA,CAAkB5B,SAAAA,EAAAA,WAC/B,QAAA,QAAA,EAAA,IAAMtkB,EAAMm9B,EAAZ,QAAA,QAAA,IAAA","file":"jessica.68795da5.js","sourceRoot":"..","sourcesContent":["// Adapted from SES/Caja - Copyright (C) 2011 Google Inc.\n// Copyright (C) 2018 Agoric\n\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n// based upon:\n// https://github.com/google/caja/blob/master/src/com/google/caja/ses/startSES.js\n// https://github.com/google/caja/blob/master/src/com/google/caja/ses/repairES5.js\n// then copied from proposal-frozen-realms deep-freeze.js\n// then copied from SES/src/bundle/deepFreeze.js\n\nfunction makeHardener(initialFringe) {\n  const { freeze, getOwnPropertyDescriptors, getPrototypeOf } = Object;\n  const { ownKeys } = Reflect;\n  // Objects that we won't freeze, either because we've frozen them already,\n  // or they were one of the initial roots (terminals). These objects form\n  // the \"fringe\" of the hardened object graph.\n  const fringeSet = new WeakSet(initialFringe);\n\n  function harden(root) {\n    const toFreeze = new Set();\n    const prototypes = new Map();\n    const paths = new WeakMap();\n\n    // If val is something we should be freezing but aren't yet,\n    // add it to toFreeze.\n    function enqueue(val, path) {\n      if (Object(val) !== val) {\n        // ignore primitives\n        return;\n      }\n      const type = typeof val;\n      if (type !== 'object' && type !== 'function') {\n        // future proof: break until someone figures out what it should do\n        throw new TypeError(`Unexpected typeof: ${type}`);\n      }\n      if (fringeSet.has(val) || toFreeze.has(val)) {\n        // Ignore if this is an exit, or we've already visited it\n        return;\n      }\n      // console.log(`adding ${val} to toFreeze`, val);\n      toFreeze.add(val);\n      paths.set(val, path);\n    }\n\n    function freezeAndTraverse(obj) {\n      // Immediately freeze the object to ensure reactive\n      // objects such as proxies won't add properties\n      // during traversal, before they get frozen.\n\n      // Object are verified before being enqueued,\n      // therefore this is a valid candidate.\n      // Throws if this fails (strict mode).\n      freeze(obj);\n\n      // we rely upon certain commitments of Object.freeze and proxies here\n\n      // get stable/immutable outbound links before a Proxy has a chance to do\n      // something sneaky.\n      const proto = getPrototypeOf(obj);\n      const descs = getOwnPropertyDescriptors(obj);\n      const path = paths.get(obj) || 'unknown';\n\n      // console.log(`adding ${proto} to prototypes under ${path}`);\n      if (proto !== null && !prototypes.has(proto)) {\n        prototypes.set(proto, path);\n        paths.set(proto, `${path}.__proto__`);\n      }\n\n      ownKeys(descs).forEach(name => {\n        const pathname = `${path}.${String(name)}`;\n        // todo uncurried form\n        // todo: getOwnPropertyDescriptors is guaranteed to return well-formed\n        // descriptors, but they still inherit from Object.prototype. If\n        // someone has poisoned Object.prototype to add 'value' or 'get'\n        // properties, then a simple 'if (\"value\" in desc)' or 'desc.value'\n        // test could be confused. We use hasOwnProperty to be sure about\n        // whether 'value' is present or not, which tells us for sure that this\n        // is a data property.\n        const desc = descs[name];\n        if ('value' in desc) {\n          // todo uncurried form\n          enqueue(desc.value, `${pathname}`);\n        } else {\n          enqueue(desc.get, `${pathname}(get)`);\n          enqueue(desc.set, `${pathname}(set)`);\n        }\n      });\n    }\n\n    function dequeue() {\n      // New values added before forEach() has finished will be visited.\n      toFreeze.forEach(freezeAndTraverse); // todo curried forEach\n    }\n\n    function checkPrototypes() {\n      prototypes.forEach((path, p) => {\n        if (!(toFreeze.has(p) || fringeSet.has(p))) {\n          // all reachable properties have already been frozen by this point\n          throw new TypeError(\n            `prototype ${p} of ${path} is not already in the fringeSet`,\n          );\n        }\n      });\n    }\n\n    function commit() {\n      // todo curried forEach\n      // we capture the real WeakSet.prototype.add above, in case someone\n      // changes it. The two-argument form of forEach passes the second\n      // argument as the 'this' binding, so we add to the correct set.\n      toFreeze.forEach(fringeSet.add, fringeSet);\n    }\n\n    enqueue(root);\n    dequeue();\n    // console.log(\"fringeSet\", fringeSet);\n    // console.log(\"prototype set:\", prototypes);\n    // console.log(\"toFreeze set:\", toFreeze);\n    checkPrototypes();\n    commit();\n\n    return root;\n  }\n\n  return harden;\n}\n\nexport default makeHardener;\n","\nvar indexOf = [].indexOf;\n\nmodule.exports = function(arr, obj){\n  if (indexOf) return arr.indexOf(obj);\n  for (var i = 0; i < arr.length; ++i) {\n    if (arr[i] === obj) return i;\n  }\n  return -1;\n};","var indexOf = require('indexof');\n\nvar Object_keys = function (obj) {\n    if (Object.keys) return Object.keys(obj)\n    else {\n        var res = [];\n        for (var key in obj) res.push(key)\n        return res;\n    }\n};\n\nvar forEach = function (xs, fn) {\n    if (xs.forEach) return xs.forEach(fn)\n    else for (var i = 0; i < xs.length; i++) {\n        fn(xs[i], i, xs);\n    }\n};\n\nvar defineProp = (function() {\n    try {\n        Object.defineProperty({}, '_', {});\n        return function(obj, name, value) {\n            Object.defineProperty(obj, name, {\n                writable: true,\n                enumerable: false,\n                configurable: true,\n                value: value\n            })\n        };\n    } catch(e) {\n        return function(obj, name, value) {\n            obj[name] = value;\n        };\n    }\n}());\n\nvar globals = ['Array', 'Boolean', 'Date', 'Error', 'EvalError', 'Function',\n'Infinity', 'JSON', 'Math', 'NaN', 'Number', 'Object', 'RangeError',\n'ReferenceError', 'RegExp', 'String', 'SyntaxError', 'TypeError', 'URIError',\n'decodeURI', 'decodeURIComponent', 'encodeURI', 'encodeURIComponent', 'escape',\n'eval', 'isFinite', 'isNaN', 'parseFloat', 'parseInt', 'undefined', 'unescape'];\n\nfunction Context() {}\nContext.prototype = {};\n\nvar Script = exports.Script = function NodeScript (code) {\n    if (!(this instanceof Script)) return new Script(code);\n    this.code = code;\n};\n\nScript.prototype.runInContext = function (context) {\n    if (!(context instanceof Context)) {\n        throw new TypeError(\"needs a 'context' argument.\");\n    }\n    \n    var iframe = document.createElement('iframe');\n    if (!iframe.style) iframe.style = {};\n    iframe.style.display = 'none';\n    \n    document.body.appendChild(iframe);\n    \n    var win = iframe.contentWindow;\n    var wEval = win.eval, wExecScript = win.execScript;\n\n    if (!wEval && wExecScript) {\n        // win.eval() magically appears when this is called in IE:\n        wExecScript.call(win, 'null');\n        wEval = win.eval;\n    }\n    \n    forEach(Object_keys(context), function (key) {\n        win[key] = context[key];\n    });\n    forEach(globals, function (key) {\n        if (context[key]) {\n            win[key] = context[key];\n        }\n    });\n    \n    var winKeys = Object_keys(win);\n\n    var res = wEval.call(win, this.code);\n    \n    forEach(Object_keys(win), function (key) {\n        // Avoid copying circular objects like `top` and `window` by only\n        // updating existing context properties or new properties in the `win`\n        // that was only introduced after the eval.\n        if (key in context || indexOf(winKeys, key) === -1) {\n            context[key] = win[key];\n        }\n    });\n\n    forEach(globals, function (key) {\n        if (!(key in context)) {\n            defineProp(context, key, win[key]);\n        }\n    });\n    \n    document.body.removeChild(iframe);\n    \n    return res;\n};\n\nScript.prototype.runInThisContext = function () {\n    return eval(this.code); // maybe...\n};\n\nScript.prototype.runInNewContext = function (context) {\n    var ctx = Script.createContext(context);\n    var res = this.runInContext(ctx);\n\n    forEach(Object_keys(ctx), function (key) {\n        context[key] = ctx[key];\n    });\n\n    return res;\n};\n\nforEach(Object_keys(Script.prototype), function (name) {\n    exports[name] = Script[name] = function (code) {\n        var s = Script(code);\n        return s[name].apply(s, [].slice.call(arguments, 1));\n    };\n});\n\nexports.createScript = function (code) {\n    return exports.Script(code);\n};\n\nexports.createContext = Script.createContext = function (context) {\n    var copy = new Context();\n    if(typeof context === 'object') {\n        forEach(Object_keys(context), function (key) {\n            copy[key] = context[key];\n        });\n    }\n    return copy;\n};\n","import makeHardener from '@agoric/make-hardener';\n\n// we'd like to abandon, but we can't, so just scream and break a lot of\n// stuff. However, since we aren't really aborting the process, be careful to\n// not throw an Error object which could be captured by child-Realm code and\n// used to access the (too-powerful) primal-realm Error object.\n\nfunction throwTantrum(s, err = undefined) {\n  const msg = `please report internal shim error: ${s}`;\n\n  // we want to log these 'should never happen' things.\n  // eslint-disable-next-line no-console\n  console.error(msg);\n  if (err) {\n    // eslint-disable-next-line no-console\n    console.error(`${err}`);\n    // eslint-disable-next-line no-console\n    console.error(`${err.stack}`);\n  }\n\n  // eslint-disable-next-line no-debugger\n  debugger;\n  throw msg;\n}\n\nfunction assert(condition, message) {\n  if (!condition) {\n    throwTantrum(message);\n  }\n}\n\n// Remove code modifications.\nfunction cleanupSource(src) {\n  /* START_TESTS_ONLY */\n\n  // Restore eval which is modified by esm module.\n  src = src.replace(/\\(0,[^)]+\\)/g, '(0, eval)');\n\n  // Remove code coverage which is injected by nyc module.\n  src = src.replace(/cov_[^+]+\\+\\+[;,]/g, '');\n\n  /* END_TESTS_ONLY */\n  return src;\n}\n\n// buildChildRealm is immediately turned into a string, and this function is\n// never referenced again, because it closes over the wrong intrinsics\n\nfunction buildChildRealm(unsafeRec, BaseRealm) {\n  const { initRootRealm, initCompartment, getRealmGlobal, realmEvaluate } = BaseRealm;\n\n  // This Object and Reflect are brand new, from a new unsafeRec, so no user\n  // code has been run or had a chance to manipulate them. We extract these\n  // properties for brevity, not for security. Don't ever run this function\n  // *after* user code has had a chance to pollute its environment, or it\n  // could be used to gain access to BaseRealm and primal-realm Error\n  // objects.\n  const { create, defineProperties } = Object;\n\n  const errorConstructors = new Map([\n    ['EvalError', EvalError],\n    ['RangeError', RangeError],\n    ['ReferenceError', ReferenceError],\n    ['SyntaxError', SyntaxError],\n    ['TypeError', TypeError],\n    ['URIError', URIError]\n  ]);\n\n  // Like Realm.apply except that it catches anything thrown and rethrows it\n  // as an Error from this realm\n  function callAndWrapError(target, ...args) {\n    try {\n      return target(...args);\n    } catch (err) {\n      if (Object(err) !== err) {\n        // err is a primitive value, which is safe to rethrow\n        throw err;\n      }\n      let eName, eMessage, eStack;\n      try {\n        // The child environment might seek to use 'err' to reach the\n        // parent's intrinsics and corrupt them. `${err.name}` will cause\n        // string coercion of 'err.name'. If err.name is an object (probably\n        // a String of the parent Realm), the coercion uses\n        // err.name.toString(), which is under the control of the parent. If\n        // err.name were a primitive (e.g. a number), it would use\n        // Number.toString(err.name), using the child's version of Number\n        // (which the child could modify to capture its argument for later\n        // use), however primitives don't have properties like .prototype so\n        // they aren't useful for an attack.\n        eName = `${err.name}`;\n        eMessage = `${err.message}`;\n        eStack = `${err.stack || eMessage}`;\n        // eName/eMessage/eStack are now child-realm primitive strings, and\n        // safe to expose\n      } catch (ignored) {\n        // if err.name.toString() throws, keep the (parent realm) Error away\n        // from the child\n        throw new Error('unknown error');\n      }\n      const ErrorConstructor = errorConstructors.get(eName) || Error;\n      try {\n        throw new ErrorConstructor(eMessage);\n      } catch (err2) {\n        err2.stack = eStack; // replace with the captured inner stack\n        throw err2;\n      }\n    }\n  }\n\n  class Realm {\n    constructor() {\n      // The Realm constructor is not intended to be used with the new operator\n      // or to be subclassed. It may be used as the value of an extends clause\n      // of a class definition but a super call to the Realm constructor will\n      // cause an exception.\n\n      // When Realm is called as a function, an exception is also raised because\n      // a class constructor cannot be invoked without 'new'.\n      throw new TypeError('Realm is not a constructor');\n    }\n\n    static makeRootRealm(options) {\n      // This is the exposed interface.\n      options = Object(options); // todo: sanitize\n\n      // Bypass the constructor.\n      const r = create(Realm.prototype);\n      callAndWrapError(initRootRealm, unsafeRec, r, options);\n      return r;\n    }\n\n    static makeCompartment() {\n      // Bypass the constructor.\n      const r = create(Realm.prototype);\n      callAndWrapError(initCompartment, unsafeRec, r);\n      return r;\n    }\n\n    // we omit the constructor because it is empty. All the personalization\n    // takes place in one of the two static methods,\n    // makeRootRealm/makeCompartment\n\n    get global() {\n      // this is safe against being called with strange 'this' because\n      // baseGetGlobal immediately does a trademark check (it fails unless\n      // this 'this' is present in a weakmap that is only populated with\n      // legitimate Realm instances)\n      return callAndWrapError(getRealmGlobal, this);\n    }\n\n    evaluate(x, endowments) {\n      // safe against strange 'this', as above\n      return callAndWrapError(realmEvaluate, this, x, endowments);\n    }\n  }\n\n  defineProperties(Realm, {\n    toString: {\n      value: () => 'function Realm() { [shim code] }',\n      writable: false,\n      enumerable: false,\n      configurable: true\n    }\n  });\n\n  defineProperties(Realm.prototype, {\n    toString: {\n      value: () => '[object Realm]',\n      writable: false,\n      enumerable: false,\n      configurable: true\n    }\n  });\n\n  return Realm;\n}\n\n// The parentheses means we don't bind the 'buildChildRealm' name inside the\n// child's namespace. this would accept an anonymous function declaration.\n// function expression (not a declaration) so it has a completion value.\nconst buildChildRealmString = cleanupSource(`'use strict'; (${buildChildRealm})`);\n\nfunction createRealmFacade(unsafeRec, BaseRealm) {\n  const { unsafeEval } = unsafeRec;\n\n  // The BaseRealm is the Realm class created by\n  // the shim. It's only valid for the context where\n  // it was parsed.\n\n  // The Realm facade is a lightweight class built in the\n  // context a different context, that provide a fully\n  // functional Realm class using the intrisics\n  // of that context.\n\n  // This process is simplified because all methods\n  // and properties on a realm instance already return\n  // values using the intrinsics of the realm's context.\n\n  // Invoke the BaseRealm constructor with Realm as the prototype.\n  return unsafeEval(buildChildRealmString)(unsafeRec, BaseRealm);\n}\n\n// Declare shorthand functions. Sharing these declarations across modules\n// improves both consistency and minification. Unused declarations are\n// dropped by the tree shaking process.\n\n// we capture these, not just for brevity, but for security. If any code\n// modifies Object to change what 'assign' points to, the Realm shim would be\n// corrupted.\n\nconst {\n  assign,\n  create,\n  freeze,\n  defineProperties, // Object.defineProperty is allowed to fail silentlty, use Object.defineProperties instead.\n  getOwnPropertyDescriptor,\n  getOwnPropertyDescriptors,\n  getOwnPropertyNames,\n  getPrototypeOf,\n  setPrototypeOf\n} = Object;\n\nconst {\n  apply,\n  ownKeys // Reflect.ownKeys includes Symbols and unenumerables, unlike Object.keys()\n} = Reflect;\n\n/**\n * uncurryThis()\n * See http://wiki.ecmascript.org/doku.php?id=conventions:safe_meta_programming\n * which only lives at http://web.archive.org/web/20160805225710/http://wiki.ecmascript.org/doku.php?id=conventions:safe_meta_programming\n *\n * Performance:\n * 1. The native call is about 10x faster on FF than chrome\n * 2. The version using Function.bind() is about 100x slower on FF, equal on chrome, 2x slower on Safari\n * 3. The version using a spread and Reflect.apply() is about 10x slower on FF, equal on chrome, 2x slower on Safari\n *\n * const bind = Function.prototype.bind;\n * const uncurryThis = bind.bind(bind.call);\n */\nconst uncurryThis = fn => (thisArg, ...args) => apply(fn, thisArg, args);\n\n// We also capture these for security: changes to Array.prototype after the\n// Realm shim runs shouldn't affect subsequent Realm operations.\nconst objectHasOwnProperty = uncurryThis(Object.prototype.hasOwnProperty),\n  arrayFilter = uncurryThis(Array.prototype.filter),\n  arrayPop = uncurryThis(Array.prototype.pop),\n  arrayJoin = uncurryThis(Array.prototype.join),\n  arrayConcat = uncurryThis(Array.prototype.concat),\n  regexpTest = uncurryThis(RegExp.prototype.test),\n  stringIncludes = uncurryThis(String.prototype.includes);\n\n// All the following stdlib items have the same name on both our intrinsics\n// object and on the global object. Unlike Infinity/NaN/undefined, these\n// should all be writable and configurable.\nconst sharedGlobalPropertyNames = [\n  // *** 18.2 Function Properties of the Global Object\n\n  // 'eval', // comes from safeEval instead\n  'isFinite',\n  'isNaN',\n  'parseFloat',\n  'parseInt',\n\n  'decodeURI',\n  'decodeURIComponent',\n  'encodeURI',\n  'encodeURIComponent',\n\n  // *** 18.3 Constructor Properties of the Global Object\n\n  'Array',\n  'ArrayBuffer',\n  'Boolean',\n  'DataView',\n  'Date',\n  'Error',\n  'EvalError',\n  'Float32Array',\n  'Float64Array',\n  // 'Function', // comes from safeFunction instead\n  'Int8Array',\n  'Int16Array',\n  'Int32Array',\n  'Map',\n  'Number',\n  'Object',\n  'Promise',\n  'Proxy',\n  'RangeError',\n  'ReferenceError',\n  'RegExp',\n  'Set',\n  // 'SharedArrayBuffer' // removed on Jan 5, 2018\n  'String',\n  'Symbol',\n  'SyntaxError',\n  'TypeError',\n  'Uint8Array',\n  'Uint8ClampedArray',\n  'Uint16Array',\n  'Uint32Array',\n  'URIError',\n  'WeakMap',\n  'WeakSet',\n\n  // *** 18.4 Other Properties of the Global Object\n\n  // 'Atomics', // removed on Jan 5, 2018\n  'JSON',\n  'Math',\n  'Reflect',\n\n  // *** Annex B\n\n  'escape',\n  'unescape',\n\n  // *** ECMA-402\n\n  'Intl'\n\n  // *** ESNext\n\n  // 'Realm' // Comes from createRealmGlobalObject()\n];\n\nfunction getSharedGlobalDescs(unsafeGlobal) {\n  const descriptors = {\n    // *** 18.1 Value Properties of the Global Object\n    Infinity: { value: Infinity },\n    NaN: { value: NaN },\n    undefined: { value: undefined }\n  };\n\n  for (const name of sharedGlobalPropertyNames) {\n    const desc = getOwnPropertyDescriptor(unsafeGlobal, name);\n    if (desc) {\n      // Abort if an accessor is found on the unsafe global object instead of a\n      // data property. We should never get into this non standard situation.\n      assert('value' in desc, `unexpected accessor on global property: ${name}`);\n\n      descriptors[name] = {\n        value: desc.value,\n        writable: true,\n        configurable: true\n      };\n    }\n  }\n\n  return descriptors;\n}\n\n// Adapted from SES/Caja - Copyright (C) 2011 Google Inc.\n// https://github.com/google/caja/blob/master/src/com/google/caja/ses/startSES.js\n// https://github.com/google/caja/blob/master/src/com/google/caja/ses/repairES5.js\n\n/**\n * Replace the legacy accessors of Object to comply with strict mode\n * and ES2016 semantics, we do this by redefining them while in 'use strict'.\n *\n * todo: list the issues resolved\n *\n * This function can be used in two ways: (1) invoked directly to fix the primal\n * realm's Object.prototype, and (2) converted to a string to be executed\n * inside each new RootRealm to fix their Object.prototypes. Evaluation requires\n * the function to have no dependencies, so don't import anything from the outside.\n */\n\n// todo: this file should be moved out to a separate repo and npm module.\nfunction repairAccessors() {\n  const {\n    defineProperty,\n    defineProperties,\n    getOwnPropertyDescriptor,\n    getPrototypeOf,\n    prototype: objectPrototype\n  } = Object;\n\n  // On some platforms, the implementation of these functions act as if they are\n  // in sloppy mode: if they're invoked badly, they will expose the global object,\n  // so we need to repair these for security. Thus it is our responsibility to fix\n  // this, and we need to include repairAccessors. E.g. Chrome in 2016.\n\n  try {\n    // Verify that the method is not callable.\n    // eslint-disable-next-line no-restricted-properties, no-underscore-dangle\n    (0, objectPrototype.__lookupGetter__)('x');\n  } catch (ignore) {\n    // Throws, no need to patch.\n    return;\n  }\n\n  function toObject(obj) {\n    if (obj === undefined || obj === null) {\n      throw new TypeError(`can't convert undefined or null to object`);\n    }\n    return Object(obj);\n  }\n\n  function asPropertyName(obj) {\n    if (typeof obj === 'symbol') {\n      return obj;\n    }\n    return `${obj}`;\n  }\n\n  function aFunction(obj, accessor) {\n    if (typeof obj !== 'function') {\n      throw TypeError(`invalid ${accessor} usage`);\n    }\n    return obj;\n  }\n\n  defineProperties(objectPrototype, {\n    __defineGetter__: {\n      value: function __defineGetter__(prop, func) {\n        const O = toObject(this);\n        defineProperty(O, prop, {\n          get: aFunction(func, 'getter'),\n          enumerable: true,\n          configurable: true\n        });\n      }\n    },\n    __defineSetter__: {\n      value: function __defineSetter__(prop, func) {\n        const O = toObject(this);\n        defineProperty(O, prop, {\n          set: aFunction(func, 'setter'),\n          enumerable: true,\n          configurable: true\n        });\n      }\n    },\n    __lookupGetter__: {\n      value: function __lookupGetter__(prop) {\n        let O = toObject(this);\n        prop = asPropertyName(prop);\n        let desc;\n        while (O && !(desc = getOwnPropertyDescriptor(O, prop))) {\n          O = getPrototypeOf(O);\n        }\n        return desc && desc.get;\n      }\n    },\n    __lookupSetter__: {\n      value: function __lookupSetter__(prop) {\n        let O = toObject(this);\n        prop = asPropertyName(prop);\n        let desc;\n        while (O && !(desc = getOwnPropertyDescriptor(O, prop))) {\n          O = getPrototypeOf(O);\n        }\n        return desc && desc.set;\n      }\n    }\n  });\n}\n\n// Adapted from SES/Caja\n// Copyright (C) 2011 Google Inc.\n// https://github.com/google/caja/blob/master/src/com/google/caja/ses/startSES.js\n// https://github.com/google/caja/blob/master/src/com/google/caja/ses/repairES5.js\n\n/**\n * This block replaces the original Function constructor, and the original\n * %GeneratorFunction% %AsyncFunction% and %AsyncGeneratorFunction%, with\n * safe replacements that throw if invoked.\n *\n * These are all reachable via syntax, so it isn't sufficient to just\n * replace global properties with safe versions. Our main goal is to prevent\n * access to the Function constructor through these starting points.\n\n * After this block is done, the originals must no longer be reachable, unless\n * a copy has been made, and funtions can only be created by syntax (using eval)\n * or by invoking a previously saved reference to the originals.\n */\n\n// todo: this file should be moved out to a separate repo and npm module.\nfunction repairFunctions() {\n  const { defineProperties, getPrototypeOf, setPrototypeOf } = Object;\n\n  /**\n   * The process to repair constructors:\n   * 1. Create an instance of the function by evaluating syntax\n   * 2. Obtain the prototype from the instance\n   * 3. Create a substitute tamed constructor\n   * 4. Replace the original constructor with the tamed constructor\n   * 5. Replace tamed constructor prototype property with the original one\n   * 6. Replace its [[Prototype]] slot with the tamed constructor of Function\n   */\n  function repairFunction(name, declaration) {\n    let FunctionInstance;\n    try {\n      // eslint-disable-next-line no-new-func\n      FunctionInstance = (0, eval)(declaration);\n    } catch (e) {\n      if (e instanceof SyntaxError) {\n        // Prevent failure on platforms where async and/or generators are not supported.\n        return;\n      }\n      // Re-throw\n      throw e;\n    }\n    const FunctionPrototype = getPrototypeOf(FunctionInstance);\n\n    // Prevents the evaluation of source when calling constructor on the\n    // prototype of functions.\n    const TamedFunction = function() {\n      throw new TypeError('Not available');\n    };\n    defineProperties(TamedFunction, { name: { value: name } });\n\n    // (new Error()).constructors does not inherit from Function, because Error\n    // was defined before ES6 classes. So we don't need to repair it too.\n\n    // (Error()).constructor inherit from Function, which gets a tamed constructor here.\n\n    // todo: in an ES6 class that does not inherit from anything, what does its\n    // constructor inherit from? We worry that it inherits from Function, in\n    // which case instances could give access to unsafeFunction. markm says\n    // we're fine: the constructor inherits from Object.prototype\n\n    // This line replaces the original constructor in the prototype chain\n    // with the tamed one. No copy of the original is peserved.\n    defineProperties(FunctionPrototype, { constructor: { value: TamedFunction } });\n\n    // This line sets the tamed constructor's prototype data property to\n    // the original one.\n    defineProperties(TamedFunction, { prototype: { value: FunctionPrototype } });\n\n    if (TamedFunction !== Function.prototype.constructor) {\n      // Ensures that all functions meet \"instanceof Function\" in a realm.\n      setPrototypeOf(TamedFunction, Function.prototype.constructor);\n    }\n  }\n\n  // Here, the order of operation is important: Function needs to be repaired\n  // first since the other repaired constructors need to inherit from the tamed\n  // Function function constructor.\n\n  // note: this really wants to be part of the standard, because new\n  // constructors may be added in the future, reachable from syntax, and this\n  // list must be updated to match.\n\n  // \"plain arrow functions\" inherit from Function.prototype\n\n  repairFunction('Function', '(function(){})');\n  repairFunction('GeneratorFunction', '(function*(){})');\n  repairFunction('AsyncFunction', '(async function(){})');\n  repairFunction('AsyncGeneratorFunction', '(async function*(){})');\n}\n\n// this module must never be importable outside the Realm shim itself\n\n// A \"context\" is a fresh unsafe Realm as given to us by existing platforms.\n// We need this to implement the shim. However, when Realms land for real,\n// this feature will be provided by the underlying engine instead.\n\n// note: in a node module, the top-level 'this' is not the global object\n// (it's *something* but we aren't sure what), however an indirect eval of\n// 'this' will be the correct global object.\n\nconst unsafeGlobalSrc = \"'use strict'; this\";\nconst unsafeGlobalEvalSrc = `(0, eval)(\"'use strict'; this\")`;\n\n// This method is only exported for testing purposes.\nfunction createNewUnsafeGlobalForNode() {\n  // Note that webpack and others will shim 'vm' including the method 'runInNewContext',\n  // so the presence of vm is not a useful check\n\n  // TODO: Find a better test that works with bundlers\n  // eslint-disable-next-line no-new-func\n  const isNode = new Function('try {return this===global}catch(e){ return false}')();\n\n  if (!isNode) {\n    return undefined;\n  }\n\n  // eslint-disable-next-line global-require\n  const vm = require('vm');\n\n  // Use unsafeGlobalEvalSrc to ensure we get the right 'this'.\n  const unsafeGlobal = vm.runInNewContext(unsafeGlobalEvalSrc);\n\n  return unsafeGlobal;\n}\n\n// This method is only exported for testing purposes.\nfunction createNewUnsafeGlobalForBrowser() {\n  if (typeof document === 'undefined') {\n    return undefined;\n  }\n  const iframe = document.createElement('iframe');\n  iframe.style.display = 'none';\n\n  document.body.appendChild(iframe);\n  const unsafeGlobal = iframe.contentWindow.eval(unsafeGlobalSrc);\n\n  // We keep the iframe attached to the DOM because removing it\n  // causes its global object to lose intrinsics, its eval()\n  // function to evaluate code, etc.\n\n  // TODO: can we remove and garbage-collect the iframes?\n\n  return unsafeGlobal;\n}\n\nconst getNewUnsafeGlobal = () => {\n  const newUnsafeGlobalForBrowser = createNewUnsafeGlobalForBrowser();\n  const newUnsafeGlobalForNode = createNewUnsafeGlobalForNode();\n  if (\n    (!newUnsafeGlobalForBrowser && !newUnsafeGlobalForNode) ||\n    (newUnsafeGlobalForBrowser && newUnsafeGlobalForNode)\n  ) {\n    throw new Error('unexpected platform, unable to create Realm');\n  }\n  return newUnsafeGlobalForBrowser || newUnsafeGlobalForNode;\n};\n\n// The unsafeRec is shim-specific. It acts as the mechanism to obtain a fresh\n// set of intrinsics together with their associated eval and Function\n// evaluators. These must be used as a matched set, since the evaluators are\n// tied to a set of intrinsics, aka the \"undeniables\". If it were possible to\n// mix-and-match them from different contexts, that would enable some\n// attacks.\nfunction createUnsafeRec(unsafeGlobal, allShims = []) {\n  const sharedGlobalDescs = getSharedGlobalDescs(unsafeGlobal);\n\n  return freeze({\n    unsafeGlobal,\n    sharedGlobalDescs,\n    unsafeEval: unsafeGlobal.eval,\n    unsafeFunction: unsafeGlobal.Function,\n    allShims\n  });\n}\n\nconst repairAccessorsShim = cleanupSource(`\"use strict\"; (${repairAccessors})();`);\nconst repairFunctionsShim = cleanupSource(`\"use strict\"; (${repairFunctions})();`);\n\n// Create a new unsafeRec from a brand new context, with new intrinsics and a\n// new global object\nfunction createNewUnsafeRec(allShims) {\n  const unsafeGlobal = getNewUnsafeGlobal();\n  unsafeGlobal.eval(repairAccessorsShim);\n  unsafeGlobal.eval(repairFunctionsShim);\n  return createUnsafeRec(unsafeGlobal, allShims);\n}\n\n// Create a new unsafeRec from the current context, where the Realm shim is\n// being parsed and executed, aka the \"Primal Realm\"\nfunction createCurrentUnsafeRec() {\n  const unsafeGlobal = (0, eval)(unsafeGlobalSrc);\n  repairAccessors();\n  repairFunctions();\n  return createUnsafeRec(unsafeGlobal);\n}\n\n// todo: think about how this interacts with endowments, check for conflicts\n// between the names being optimized and the ones added by endowments\n\n/**\n * Simplified validation of indentifier names: may only contain alphanumeric\n * characters (or \"$\" or \"_\"), and may not start with a digit. This is safe\n * and does not reduces the compatibility of the shim. The motivation for\n * this limitation was to decrease the complexity of the implementation,\n * and to maintain a resonable level of performance.\n * Note: \\w is equivalent [a-zA-Z_0-9]\n * See 11.6.1 Identifier Names\n */\nconst identifierPattern = /^[a-zA-Z_$][\\w$]*$/;\n\n/**\n * In JavaScript you cannot use these reserved words as variables.\n * See 11.6.1 Identifier Names\n */\nconst keywords = new Set([\n  // 11.6.2.1 Keywords\n  'await',\n  'break',\n  'case',\n  'catch',\n  'class',\n  'const',\n  'continue',\n  'debugger',\n  'default',\n  'delete',\n  'do',\n  'else',\n  'export',\n  'extends',\n  'finally',\n  'for',\n  'function',\n  'if',\n  'import',\n  'in',\n  'instanceof',\n  'new',\n  'return',\n  'super',\n  'switch',\n  'this',\n  'throw',\n  'try',\n  'typeof',\n  'var',\n  'void',\n  'while',\n  'with',\n  'yield',\n\n  // Also reserved when parsing strict mode code\n  'let',\n  'static',\n\n  // 11.6.2.2 Future Reserved Words\n  'enum',\n\n  // Also reserved when parsing strict mode code\n  'implements',\n  'package',\n  'protected',\n  'interface',\n  'private',\n  'public',\n\n  // Reserved but not mentioned in specs\n  'await',\n\n  'null',\n  'true',\n  'false',\n\n  'this',\n  'arguments'\n]);\n\n/**\n * getOptimizableGlobals()\n * What variable names might it bring into scope? These include all\n * property names which can be variable names, including the names\n * of inherited properties. It excludes symbols and names which are\n * keywords. We drop symbols safely. Currently, this shim refuses\n * service if any of the names are keywords or keyword-like. This is\n * safe and only prevent performance optimization.\n */\nfunction getOptimizableGlobals(safeGlobal) {\n  const descs = getOwnPropertyDescriptors(safeGlobal);\n\n  // getOwnPropertyNames does ignore Symbols so we don't need this extra check:\n  // typeof name === 'string' &&\n  const constants = arrayFilter(getOwnPropertyNames(descs), name => {\n    // Ensure we have a valid identifier. We use regexpTest rather than\n    // /../.test() to guard against the case where RegExp has been poisoned.\n    if (name === 'eval' || keywords.has(name) || !regexpTest(identifierPattern, name)) {\n      return false;\n    }\n\n    const desc = descs[name];\n    return (\n      //\n      // The getters will not have .writable, don't let the falsyness of\n      // 'undefined' trick us: test with === false, not ! . However descriptors\n      // inherit from the (potentially poisoned) global object, so we might see\n      // extra properties which weren't really there. Accessor properties have\n      // 'get/set/enumerable/configurable', while data properties have\n      // 'value/writable/enumerable/configurable'.\n      desc.configurable === false &&\n      desc.writable === false &&\n      //\n      // Checks for data properties because they're the only ones we can\n      // optimize (accessors are most likely non-constant). Descriptors can't\n      // can't have accessors and value properties at the same time, therefore\n      // this check is sufficient. Using explicit own property deal with the\n      // case where Object.prototype has been poisoned.\n      objectHasOwnProperty(desc, 'value')\n    );\n  });\n\n  return constants;\n}\n\n/**\n * alwaysThrowHandler is a proxy handler which throws on any trap called.\n * It's made from a proxy with a get trap that throws. Its target is\n * an immutable (frozen) object and is safe to share.\n */\nconst alwaysThrowHandler = new Proxy(freeze({}), {\n  get(target, prop) {\n    throwTantrum(`unexpected scope handler trap called: ${prop}`);\n  }\n});\n\n/**\n * ScopeHandler manages a Proxy which serves as the global scope for the\n * safeEvaluator operation (the Proxy is the argument of a 'with' binding).\n * As described in createSafeEvaluator(), it has several functions:\n * - allow the very first (and only the very first) use of 'eval' to map to\n *   the real (unsafe) eval function, so it acts as a 'direct eval' and can\n *    access its lexical scope (which maps to the 'with' binding, which the\n *   ScopeHandler also controls).\n * - ensure that all subsequent uses of 'eval' map to the safeEvaluator,\n *   which lives as the 'eval' property of the safeGlobal.\n * - route all other property lookups at the safeGlobal.\n * - hide the unsafeGlobal which lives on the scope chain above the 'with'.\n * - ensure the Proxy invariants despite some global properties being frozen.\n */\nfunction createScopeHandler(unsafeRec) {\n  const { unsafeGlobal, unsafeEval } = unsafeRec;\n\n  // This flag allow us to determine if the eval() call is an done by the\n  // realm's code or if it is user-land invocation, so we can react differently.\n  let useUnsafeEvaluator = false;\n\n  return {\n    // The scope handler throws if any trap other than get/set/has are run\n    // (e.g. getOwnPropertyDescriptors, apply, getPrototypeOf).\n    // eslint-disable-next-line no-proto\n    __proto__: alwaysThrowHandler,\n\n    allowUnsafeEvaluatorOnce() {\n      useUnsafeEvaluator = true;\n    },\n\n    unsafeEvaluatorAllowed() {\n      return useUnsafeEvaluator;\n    },\n\n    get(target, prop) {\n      // Special treatment for eval. The very first lookup of 'eval' gets the\n      // unsafe (real direct) eval, so it will get the lexical scope that uses\n      // the 'with' context.\n      if (prop === 'eval') {\n        // test that it is true rather than merely truthy\n        if (useUnsafeEvaluator === true) {\n          // revoke before use\n          useUnsafeEvaluator = false;\n          return unsafeEval;\n        }\n        return target.eval;\n      }\n\n      // todo: shim integrity, capture Symbol.unscopables\n      if (prop === Symbol.unscopables) {\n        // Safe to return a primal realm Object here because the only code that\n        // can do a get() on a non-string is the internals of with() itself,\n        // and the only thing it does is to look for properties on it. User\n        // code cannot do a lookup on non-strings.\n        return undefined;\n      }\n\n      // Properties of the global.\n      if (prop in target) {\n        return target[prop];\n      }\n\n      // Prevent the lookup for other properties.\n      return undefined;\n    },\n\n    // eslint-disable-next-line class-methods-use-this\n    set(target, prop, value) {\n      // todo: allow modifications when target.hasOwnProperty(prop) and it\n      // is writable, assuming we've already rejected overlap (see\n      // createSafeEvaluatorFactory.factory). This TypeError gets replaced with\n      // target[prop] = value\n      if (objectHasOwnProperty(target, prop)) {\n        // todo: shim integrity: TypeError, String\n        throw new TypeError(`do not modify endowments like ${String(prop)}`);\n      }\n\n      // todo (optimization): keep a reference to the shadow avoids calling\n      // getPrototypeOf on the target every time the set trap is invoked,\n      // since safeGlobal === getPrototypeOf(target).\n      getPrototypeOf(target)[prop] = value;\n\n      // Return true after successful set.\n      return true;\n    },\n\n    // we need has() to return false for some names to prevent the lookup  from\n    // climbing the scope chain and eventually reaching the unsafeGlobal\n    // object, which is bad.\n\n    // note: unscopables! every string in Object[Symbol.unscopables]\n\n    // todo: we'd like to just have has() return true for everything, and then\n    // use get() to raise a ReferenceError for anything not on the safe global.\n    // But we want to be compatible with ReferenceError in the normal case and\n    // the lack of ReferenceError in the 'typeof' case. Must either reliably\n    // distinguish these two cases (the trap behavior might be different), or\n    // we rely on a mandatory source-to-source transform to change 'typeof abc'\n    // to XXX. We already need a mandatory parse to prevent the 'import',\n    // since it's a special form instead of merely being a global variable/\n\n    // note: if we make has() return true always, then we must implement a\n    // set() trap to avoid subverting the protection of strict mode (it would\n    // accept assignments to undefined globals, when it ought to throw\n    // ReferenceError for such assignments)\n\n    has(target, prop) {\n      // proxies stringify 'prop', so no TOCTTOU danger here\n\n      // unsafeGlobal: hide all properties of unsafeGlobal at the expense of 'typeof'\n      // being wrong for those properties. For example, in the browser, evaluating\n      // 'document = 3', will add a property to  safeGlobal instead of throwing a\n      // ReferenceError.\n      if (prop === 'eval' || prop in target || prop in unsafeGlobal) {\n        return true;\n      }\n\n      return false;\n    }\n  };\n}\n\n// this \\s *must* match all kinds of syntax-defined whitespace. If e.g.\n// U+2028 (LINE SEPARATOR) or U+2029 (PARAGRAPH SEPARATOR) is treated as\n// whitespace by the parser, but not matched by /\\s/, then this would admit\n// an attack like: import\\u2028('power.js') . We're trying to distinguish\n// something like that from something like importnotreally('power.js') which\n// is perfectly safe.\n\nconst importParser = /^(.*)\\bimport\\s*(\\(|\\/\\/|\\/\\*)/m;\n\nfunction rejectImportExpressions(s) {\n  const matches = importParser.exec(s);\n  if (matches) {\n    // todo: if we have a full parser available, use it here. If there is no\n    // 'import' token in the string, we're safe.\n    // if (!parse(s).contains('import')) return;\n    const linenum = matches[1].split('\\n').length; // more or less\n    throw new SyntaxError(`possible import expression rejected around line ${linenum}`);\n  }\n}\n\n// Portions adapted from V8 - Copyright 2016 the V8 project authors.\n\nfunction buildOptimizer(constants) {\n  // No need to build an oprimizer when there are no constants.\n  if (constants.length === 0) return '';\n  // Use 'this' to avoid going through the scope proxy, which is unecessary\n  // since the optimizer only needs references to the safe global.\n  return `const {${arrayJoin(constants, ',')}} = this;`;\n}\n\nfunction createScopedEvaluatorFactory(unsafeRec, constants) {\n  const { unsafeFunction } = unsafeRec;\n\n  const optimizer = buildOptimizer(constants);\n\n  // Create a function in sloppy mode, so that we can use 'with'. It returns\n  // a function in strict mode that evaluates the provided code using direct\n  // eval, and thus in strict mode in the same scope. We must be very careful\n  // to not create new names in this scope\n\n  // 1: we use 'with' (around a Proxy) to catch all free variable names. The\n  // first 'arguments[0]' holds the Proxy which safely wraps the safeGlobal\n  // 2: 'optimizer' catches common variable names for speed\n  // 3: The inner strict function is effectively passed two parameters:\n  //    a) its arguments[0] is the source to be directly evaluated.\n  //    b) its 'this' is the this binding seen by the code being directly evaluated.\n\n  // everything in the 'optimizer' string is looked up in the proxy\n  // (including an 'arguments[0]', which points at the Proxy). 'function' is\n  // a keyword, not a variable, so it is not looked up. then 'eval' is looked\n  // up in the proxy, that's the first time it is looked up after\n  // useUnsafeEvaluator is turned on, so the proxy returns the real the\n  // unsafeEval, which satisfies the IsDirectEvalTrap predicate, so it uses\n  // the direct eval and gets the lexical scope. The second 'arguments[0]' is\n  // looked up in the context of the inner function. The *contents* of\n  // arguments[0], because we're using direct eval, are looked up in the\n  // Proxy, by which point the useUnsafeEvaluator switch has been flipped\n  // back to 'false', so any instances of 'eval' in that string will get the\n  // safe evaluator.\n\n  return unsafeFunction(`\n    with (arguments[0]) {\n      ${optimizer}\n      return function() {\n        'use strict';\n        return eval(arguments[0]);\n      };\n    }\n  `);\n}\n\nfunction createSafeEvaluatorFactory(unsafeRec, safeGlobal) {\n  const { unsafeFunction } = unsafeRec;\n\n  const scopeHandler = createScopeHandler(unsafeRec);\n  const optimizableGlobals = getOptimizableGlobals(safeGlobal);\n  const scopedEvaluatorFactory = createScopedEvaluatorFactory(unsafeRec, optimizableGlobals);\n\n  function factory(endowments = {}) {\n    // todo (shim limitation): scan endowments, throw error if endowment\n    // overlaps with the const optimization (which would otherwise\n    // incorrectly shadow endowments), or if endowments includes 'eval'. Also\n    // prohibit accessor properties (to be able to consistently explain\n    // things in terms of shimming the global lexical scope).\n    // writeable-vs-nonwritable == let-vs-const, but there's no\n    // global-lexical-scope equivalent of an accessor, outside what we can\n    // explain/spec\n    const scopeTarget = create(safeGlobal, getOwnPropertyDescriptors(endowments));\n    const scopeProxy = new Proxy(scopeTarget, scopeHandler);\n    const scopedEvaluator = apply(scopedEvaluatorFactory, safeGlobal, [scopeProxy]);\n\n    // We use the the concise method syntax to create an eval without a\n    // [[Construct]] behavior (such that the invocation \"new eval()\" throws\n    // TypeError: eval is not a constructor\"), but which still accepts a\n    // 'this' binding.\n    const safeEval = {\n      eval(src) {\n        src = `${src}`;\n        rejectImportExpressions(src);\n        scopeHandler.allowUnsafeEvaluatorOnce();\n        let err;\n        try {\n          // Ensure that \"this\" resolves to the safe global.\n          return apply(scopedEvaluator, safeGlobal, [src]);\n        } catch (e) {\n          // stash the child-code error in hopes of debugging the internal failure\n          err = e;\n          throw e;\n        } finally {\n          // belt and suspenders: the proxy switches this off immediately after\n          // the first access, but if that's not the case we abort.\n          if (scopeHandler.unsafeEvaluatorAllowed()) {\n            throwTantrum('handler did not revoke useUnsafeEvaluator', err);\n          }\n        }\n      }\n    }.eval;\n\n    // safeEval's prototype is currently the primal realm's\n    // Function.prototype, which we must not let escape. To make 'eval\n    // instanceof Function' be true inside the realm, we need to point it at\n    // the RootRealm's value.\n\n    // Ensure that eval from any compartment in a root realm is an instance\n    // of Function in any compartment of the same root realm.\n    setPrototypeOf(safeEval, unsafeFunction.prototype);\n\n    assert(getPrototypeOf(safeEval).constructor !== Function, 'hide Function');\n    assert(getPrototypeOf(safeEval).constructor !== unsafeFunction, 'hide unsafeFunction');\n\n    // note: be careful to not leak our primal Function.prototype by setting\n    // this to a plain arrow function. Now that we have safeEval, use it.\n    defineProperties(safeEval, {\n      toString: {\n        value: safeEval(\"() => 'function eval() { [shim code] }'\"),\n        writable: false,\n        enumerable: false,\n        configurable: true\n      }\n    });\n\n    return safeEval;\n  }\n\n  return factory;\n}\n\nfunction createSafeEvaluator(safeEvaluatorFactory) {\n  return safeEvaluatorFactory();\n}\n\nfunction createSafeEvaluatorWhichTakesEndowments(safeEvaluatorFactory) {\n  return (x, endowments) => safeEvaluatorFactory(endowments)(x);\n}\n\n/**\n * A safe version of the native Function which relies on\n * the safety of evalEvaluator for confinement.\n */\nfunction createFunctionEvaluator(unsafeRec, safeEval) {\n  const { unsafeFunction, unsafeGlobal } = unsafeRec;\n\n  const safeFunction = function Function(...params) {\n    const functionBody = `${arrayPop(params) || ''}`;\n    let functionParams = `${arrayJoin(params, ',')}`;\n    if (!regexpTest(/^[\\w\\s,]*$/, functionParams)) {\n      throw new unsafeGlobal.SyntaxError(\n        'shim limitation: Function arg must be simple ASCII identifiers, possibly separated by commas: no default values, pattern matches, or non-ASCII parameter names'\n      );\n      // this protects against Matt Austin's clever attack:\n      // Function(\"arg=`\", \"/*body`){});({x: this/**/\")\n      // which would turn into\n      //     (function(arg=`\n      //     /*``*/){\n      //      /*body`){});({x: this/**/\n      //     })\n      // which parses as a default argument of `\\n/*``*/){\\n/*body` , which\n      // is a pair of template literals back-to-back (so the first one\n      // nominally evaluates to the parser to use on the second one), which\n      // can't actually execute (because the first literal evals to a string,\n      // which can't be a parser function), but that doesn't matter because\n      // the function is bypassed entirely. When that gets evaluated, it\n      // defines (but does not invoke) a function, then evaluates a simple\n      // {x: this} expression, giving access to the safe global.\n    }\n\n    // Is this a real functionBody, or is someone attempting an injection\n    // attack? This will throw a SyntaxError if the string is not actually a\n    // function body. We coerce the body into a real string above to prevent\n    // someone from passing an object with a toString() that returns a safe\n    // string the first time, but an evil string the second time.\n    // eslint-disable-next-line no-new, new-cap\n    new unsafeFunction(functionBody);\n\n    if (stringIncludes(functionParams, ')')) {\n      // If the formal parameters string include ) - an illegal\n      // character - it may make the combined function expression\n      // compile. We avoid this problem by checking for this early on.\n\n      // note: v8 throws just like this does, but chrome accepts e.g. 'a = new Date()'\n      throw new unsafeGlobal.SyntaxError(\n        'shim limitation: Function arg string contains parenthesis'\n      );\n      // todo: shim integrity threat if they change SyntaxError\n    }\n\n    // todo: check to make sure this .length is safe. markm says safe.\n    if (functionParams.length > 0) {\n      // If the formal parameters include an unbalanced block comment, the\n      // function must be rejected. Since JavaScript does not allow nested\n      // comments we can include a trailing block comment to catch this.\n      functionParams += '\\n/*``*/';\n    }\n\n    // todo: fix `this` binding in Function().\n    const src = `(function(${functionParams}){\\n${functionBody}\\n})`;\n\n    return safeEval(src);\n  };\n\n  // Ensure that Function from any compartment in a root realm can be used\n  // with instance checks in any compartment of the same root realm.\n  setPrototypeOf(safeFunction, unsafeFunction.prototype);\n\n  assert(getPrototypeOf(safeFunction).constructor !== Function, 'hide Function');\n  assert(getPrototypeOf(safeFunction).constructor !== unsafeFunction, 'hide unsafeFunction');\n\n  defineProperties(safeFunction, {\n    // Ensure that any function created in any compartment in a root realm is an\n    // instance of Function in any compartment of the same root ralm.\n    prototype: { value: unsafeFunction.prototype },\n\n    // Provide a custom output without overwriting the Function.prototype.toString\n    // which is called by some third-party libraries.\n    toString: {\n      value: safeEval(\"() => 'function Function() { [shim code] }'\"),\n      writable: false,\n      enumerable: false,\n      configurable: true\n    }\n  });\n\n  return safeFunction;\n}\n\n// Mimic private members on the realm instances.\n// We define it in the same module and do not export it.\nconst RealmRecForRealmInstance = new WeakMap();\n\nfunction getRealmRecForRealmInstance(realm) {\n  // Detect non-objects.\n  assert(Object(realm) === realm, 'bad object, not a Realm instance');\n  // Realm instance has no realmRec. Should not proceed.\n  assert(RealmRecForRealmInstance.has(realm), 'Realm instance has no record');\n\n  return RealmRecForRealmInstance.get(realm);\n}\n\nfunction registerRealmRecForRealmInstance(realm, realmRec) {\n  // Detect non-objects.\n  assert(Object(realm) === realm, 'bad object, not a Realm instance');\n  // Attempt to change an existing realmRec on a realm instance. Should not proceed.\n  assert(!RealmRecForRealmInstance.has(realm), 'Realm instance already has a record');\n\n  RealmRecForRealmInstance.set(realm, realmRec);\n}\n\n// Initialize the global variables for the new Realm.\nfunction setDefaultBindings(sharedGlobalDescs, safeGlobal, safeEval, safeFunction) {\n  defineProperties(safeGlobal, sharedGlobalDescs);\n\n  defineProperties(safeGlobal, {\n    eval: {\n      value: safeEval,\n      writable: true,\n      configurable: true\n    },\n    Function: {\n      value: safeFunction,\n      writable: true,\n      configurable: true\n    }\n  });\n}\n\nfunction createRealmRec(unsafeRec) {\n  const { sharedGlobalDescs, unsafeGlobal } = unsafeRec;\n\n  const safeGlobal = create(unsafeGlobal.Object.prototype);\n  const safeEvaluatorFactory = createSafeEvaluatorFactory(unsafeRec, safeGlobal);\n  const safeEval = createSafeEvaluator(safeEvaluatorFactory);\n  const safeEvalWhichTakesEndowments = createSafeEvaluatorWhichTakesEndowments(\n    safeEvaluatorFactory\n  );\n  const safeFunction = createFunctionEvaluator(unsafeRec, safeEval);\n\n  setDefaultBindings(sharedGlobalDescs, safeGlobal, safeEval, safeFunction);\n\n  const realmRec = freeze({\n    safeGlobal,\n    safeEval,\n    safeEvalWhichTakesEndowments,\n    safeFunction\n  });\n\n  return realmRec;\n}\n\n/**\n * A root realm uses a fresh set of new intrinics. Here we first create\n * a new unsafe record, which inherits the shims. Then we proceed with\n * the creation of the realm record, and we apply the shims.\n */\nfunction initRootRealm(parentUnsafeRec, self, options) {\n  // note: 'self' is the instance of the Realm.\n\n  // todo: investigate attacks via Array.species\n  // todo: this accepts newShims='string', but it should reject that\n  const { shims: newShims } = options;\n  const allShims = arrayConcat(parentUnsafeRec.allShims, newShims);\n\n  // The unsafe record is created already repaired.\n  const unsafeRec = createNewUnsafeRec(allShims);\n\n  // eslint-disable-next-line no-use-before-define\n  const Realm = createRealmFacade(unsafeRec, BaseRealm);\n\n  // Add a Realm descriptor to sharedGlobalDescs, so it can be defined onto the\n  // safeGlobal like the rest of the globals.\n  unsafeRec.sharedGlobalDescs.Realm = {\n    value: Realm,\n    writable: true,\n    configurable: true\n  };\n\n  // Creating the realmRec provides the global object, eval() and Function()\n  // to the realm.\n  const realmRec = createRealmRec(unsafeRec);\n\n  // Apply all shims in the new RootRealm. We don't do this for compartments.\n  const { safeEvalWhichTakesEndowments } = realmRec;\n  for (const shim of allShims) {\n    safeEvalWhichTakesEndowments(shim);\n  }\n\n  // The realmRec acts as a private field on the realm instance.\n  registerRealmRecForRealmInstance(self, realmRec);\n}\n\n/**\n * A compartment shares the intrinsics of its root realm. Here, only a\n * realmRec is necessary to hold the global object, eval() and Function().\n */\nfunction initCompartment(unsafeRec, self) {\n  // note: 'self' is the instance of the Realm.\n\n  const realmRec = createRealmRec(unsafeRec);\n\n  // The realmRec acts as a private field on the realm instance.\n  registerRealmRecForRealmInstance(self, realmRec);\n}\n\nfunction getRealmGlobal(self) {\n  const { safeGlobal } = getRealmRecForRealmInstance(self);\n  return safeGlobal;\n}\n\nfunction realmEvaluate(self, x, endowments = {}) {\n  // todo: don't pass in primal-realm objects like {}, for safety. OTOH its\n  // properties are copied onto the new global 'target'.\n  // todo: figure out a way to membrane away the contents to safety.\n  const { safeEvalWhichTakesEndowments } = getRealmRecForRealmInstance(self);\n  return safeEvalWhichTakesEndowments(x, endowments);\n}\n\nconst BaseRealm = {\n  initRootRealm,\n  initCompartment,\n  getRealmGlobal,\n  realmEvaluate\n};\n\n// Create the current unsafeRec from the current \"primal\" environment (the realm\n// where the Realm shim is loaded and executed).\nconst currentUnsafeRec = createCurrentUnsafeRec();\n\n/**\n * The \"primal\" realm class is defined in the current \"primal\" environment,\n * and is part of the shim. There is no need to facade this class via evaluation\n * because both share the same intrinsics.\n */\nconst Realm = buildChildRealm(currentUnsafeRec, BaseRealm);\n\nfunction tameDate() {\n  const unsafeDate = Date;\n  // Date(anything) gives a string with the current time\n  // new Date(x) coerces x into a number and then returns a Date\n  // new Date() returns the current time, as a Date object\n  // new Date(undefined) returns a Date object which stringifies to 'Invalid Date'\n\n  const newDateConstructor = function Date(...args) {\n    if (new.target === undefined) {\n      // we were not called as a constructor\n      // this would normally return a string with the current time\n      return 'Invalid Date';\n    }\n    // constructor behavior: if we get arguments, we can safely pass them through\n    if (args.length > 0) {\n      return Reflect.construct(unsafeDate, args, new.target);\n      // todo: test that our constructor can still be subclassed\n    }\n    // no arguments: return a Date object, but invalid\n    return Reflect.construct(unsafeDate, [NaN], new.target);\n  };\n\n  Object.defineProperties(\n    newDateConstructor,\n    Object.getOwnPropertyDescriptors(unsafeDate),\n  );\n  // that will copy the .prototype too, so this next line is unnecessary\n  // newDateConstructor.prototype = unsafeDate.prototype;\n  unsafeDate.prototype.constructor = newDateConstructor;\n  // disable Date.now\n  newDateConstructor.now = () => NaN;\n\n  Date = newDateConstructor; // eslint-disable-line no-global-assign\n}\n\nfunction tameMath() {\n  // Math.random = () => 4; // https://www.xkcd.com/221\n  Math.random = () => {\n    throw Error('disabled');\n  };\n}\n\n/* global Intl */\n\nfunction tameIntl() {\n  // todo: somehow fix these. These almost certainly don't enable the reading\n  // of side-channels, but we want things to be deterministic across\n  // runtimes. Best bet is to just disallow calling these functions without\n  // an explicit locale name.\n\n  // the whitelist may have deleted Intl entirely, so tolerate that\n  if (typeof Intl !== 'undefined') {\n    Intl.DateTimeFormat = () => {\n      throw Error('disabled');\n    };\n    Intl.NumberFormat = () => {\n      throw Error('disabled');\n    };\n    Intl.getCanonicalLocales = () => {\n      throw Error('disabled');\n    };\n  }\n  // eslint-disable-next-line no-extend-native\n  Object.prototype.toLocaleString = () => {\n    throw new Error('toLocaleString suppressed');\n  };\n}\n\nfunction tameError() {\n  if (!Object.isExtensible(Error)) {\n    throw Error('huh Error is not extensible');\n  }\n  /* this worked back when we were running it on a global, but stopped\n  working when we turned it into a shim */\n  /*\n  Object.defineProperty(Error.prototype, \"stack\",\n                        { get() { return 'stack suppressed'; } });\n  */\n  delete Error.captureStackTrace;\n  if ('captureStackTrace' in Error) {\n    throw Error('hey we could not remove Error.captureStackTrace');\n  }\n\n  // we might do this in the future\n  /*\n  const unsafeError = Error;\n  const newErrorConstructor = function Error(...args) {\n    return Reflect.construct(unsafeError, args, new.target);\n  };\n\n  newErrorConstructor.prototype = unsafeError.prototype;\n  newErrorConstructor.prototype.construct = newErrorConstructor;\n\n  Error = newErrorConstructor;\n\n  EvalError.__proto__ = newErrorConstructor;\n  RangeError.__proto__ = newErrorConstructor;\n  ReferenceError.__proto__ = newErrorConstructor;\n  SyntaxError.__proto__ = newErrorConstructor;\n  TypeError.__proto__ = newErrorConstructor;\n  URIError.__proto__ = newErrorConstructor;\n  */\n}\n\nfunction tameRegExp() {\n  delete RegExp.prototype.compile;\n  if ('compile' in RegExp.prototype) {\n    throw Error('hey we could not remove RegExp.prototype.compile');\n  }\n\n  // We want to delete RegExp.$1, as well as any other surprising properties.\n  // On some engines we can't just do 'delete RegExp.$1'.\n  const unsafeRegExp = RegExp;\n\n  // eslint-disable-next-line no-global-assign\n  RegExp = function RegExp(...args) {\n    return Reflect.construct(unsafeRegExp, args, new.target);\n  };\n  RegExp.prototype = unsafeRegExp.prototype;\n  unsafeRegExp.prototype.constructor = RegExp;\n\n  if ('$1' in RegExp) {\n    throw Error('hey we could not remove RegExp.$1');\n  }\n}\n\n/* global getAnonIntrinsics */\n\n// Copyright (C) 2011 Google Inc.\n// Copyright (C) 2018 Agoric\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/* This is evaluated in an environment in which getAnonIntrinsics() is\n   already defined (by prepending the definition of getAnonIntrinsics to the\n   stringified removeProperties()), hence we don't use the following\n   import */\n// import { getAnonIntrinsics } from './anonIntrinsics.js';\n\nfunction removeProperties(global, whitelist) {\n  // walk global object, test against whitelist, delete\n\n  const uncurryThis = fn => (thisArg, ...args) =>\n    Reflect.apply(fn, thisArg, args);\n  const {\n    getOwnPropertyDescriptor: gopd,\n    getOwnPropertyNames: gopn,\n    keys,\n  } = Object;\n  const cleaning = new WeakMap();\n  const getProto = Object.getPrototypeOf;\n  const hop = uncurryThis(Object.prototype.hasOwnProperty);\n\n  const whiteTable = new WeakMap();\n\n  function addToWhiteTable(rootValue, rootPermit) {\n    /**\n     * The whiteTable should map from each path-accessible primordial\n     * object to the permit object that describes how it should be\n     * cleaned.\n     *\n     * We initialize the whiteTable only so that {@code getPermit} can\n     * process \"*\" inheritance using the whitelist, by walking actual\n     * inheritance chains.\n     */\n    const whitelistSymbols = [true, false, '*', 'maybeAccessor'];\n    function register(value, permit) {\n      if (value !== Object(value)) {\n        return;\n      }\n      if (typeof permit !== 'object') {\n        if (whitelistSymbols.indexOf(permit) < 0) {\n          throw new Error(\n            `syntax error in whitelist; unexpected value: ${permit}`,\n          );\n        }\n        return;\n      }\n      if (whiteTable.has(value)) {\n        throw new Error('primordial reachable through multiple paths');\n      }\n      whiteTable.set(value, permit);\n      keys(permit).forEach(name => {\n        // Use gopd to avoid invoking an accessor property.\n        // Accessor properties for which permit !== 'maybeAccessor'\n        // are caught later by clean().\n        const desc = gopd(value, name);\n        if (desc) {\n          register(desc.value, permit[name]);\n        }\n      });\n    }\n    register(rootValue, rootPermit);\n  }\n\n  /**\n   * Should the property named {@code name} be whitelisted on the\n   * {@code base} object, and if so, with what Permit?\n   *\n   * <p>If it should be permitted, return the Permit (where Permit =\n   * true | \"maybeAccessor\" | \"*\" | Record(Permit)), all of which are\n   * truthy. If it should not be permitted, return false.\n   */\n  function getPermit(base, name) {\n    let permit = whiteTable.get(base);\n    if (permit) {\n      if (hop(permit, name)) {\n        return permit[name];\n      }\n    }\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      base = getProto(base); // eslint-disable-line no-param-reassign\n      if (base === null) {\n        return false;\n      }\n      permit = whiteTable.get(base);\n      if (permit && hop(permit, name)) {\n        const result = permit[name];\n        if (result === '*') {\n          return result;\n        }\n        return false;\n      }\n    }\n  }\n\n  /**\n   * Removes all non-whitelisted properties found by recursively and\n   * reflectively walking own property chains.\n   *\n   * <p>Inherited properties are not checked, because we require that\n   * inherited-from objects are otherwise reachable by this traversal.\n   */\n  function clean(value, prefix, num) {\n    if (value !== Object(value)) {\n      return;\n    }\n    if (cleaning.get(value)) {\n      return;\n    }\n\n    const proto = getProto(value);\n    if (proto !== null && !whiteTable.has(proto)) {\n      // reportItemProblem(rootReports, ses.severities.NOT_ISOLATED,\n      //                  'unexpected intrinsic', prefix + '.__proto__');\n      throw new Error(`unexpected intrinsic ${prefix}.__proto__`);\n    }\n\n    cleaning.set(value, true);\n    gopn(value).forEach(name => {\n      const path = prefix + (prefix ? '.' : '') + name;\n      const p = getPermit(value, name);\n      if (p) {\n        const desc = gopd(value, name);\n        if (hop(desc, 'value')) {\n          // Is a data property\n          const subValue = desc.value;\n          clean(subValue, path, num + 1);\n        } else if (p !== 'maybeAccessor') {\n          // We are not saying that it is safe for the prop to be\n          // unexpectedly an accessor; rather, it will be deleted\n          // and thus made safe.\n          // reportProperty(ses.severities.SAFE_SPEC_VIOLATION,\n          //               'Not a data property', path);\n          delete value[name]; // eslint-disable-line no-param-reassign\n        } else {\n          clean(desc.get, `${path}<getter>`, num + 1);\n          clean(desc.set, `${path}<setter>`, num + 1);\n        }\n      } else {\n        delete value[name]; // eslint-disable-line no-param-reassign\n      }\n    });\n  }\n\n  addToWhiteTable(global, whitelist.namedIntrinsics);\n  const intr = getAnonIntrinsics(global);\n  addToWhiteTable(intr, whitelist.anonIntrinsics);\n  clean(global, '', 0);\n}\n\n// Copyright (C) 2011 Google Inc.\n// Copyright (C) 2018 Agoric\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// https://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n// TODO(erights): We should test for\n// We now have a reason to omit Proxy from the whitelist.\n// The makeBrandTester in repairES5 uses Allen's trick at\n// https://esdiscuss.org/topic/tostringtag-spoofing-for-null-and-undefined#content-59\n// , but testing reveals that, on FF 35.0.1, a proxy on an exotic\n// object X will pass this brand test when X will. This is fixed as of\n// FF Nightly 38.0a1.\n\n/**\n * <p>Qualifying platforms generally include all JavaScript platforms\n * shown on <a href=\"http://kangax.github.com/es5-compat-table/\"\n * >ECMAScript 5 compatibility table</a> that implement {@code\n * Object.getOwnPropertyNames}. At the time of this writing,\n * qualifying browsers already include the latest released versions of\n * Internet Explorer (9), Firefox (4), Chrome (11), and Safari\n * (5.0.5), their corresponding standalone (e.g., server-side) JavaScript\n * engines, Rhino 1.73, and BESEN.\n *\n * <p>On such not-quite-ES5 platforms, some elements of these\n * emulations may lose SES safety, as enumerated in the comment on\n * each problem record in the {@code baseProblems} and {@code\n * supportedProblems} array below. The platform must at least provide\n * {@code Object.getOwnPropertyNames}, because it cannot reasonably be\n * emulated.\n *\n * <p>This file is useful by itself, as it has no dependencies on the\n * rest of SES. It creates no new global bindings, but merely repairs\n * standard globals or standard elements reachable from standard\n * globals. If the future-standard {@code WeakMap} global is present,\n * as it is currently on FF7.0a1, then it will repair it in place. The\n * one non-standard element that this file uses is {@code console} if\n * present, in order to report the repairs it found necessary, in\n * which case we use its {@code log, info, warn}, and {@code error}\n * methods. If {@code console.log} is absent, then this file performs\n * its repairs silently.\n *\n * <p>Generally, this file should be run as the first script in a\n * JavaScript context (i.e. a browser frame), as it relies on other\n * primordial objects and methods not yet being perturbed.\n *\n * <p>TODO(erights): This file tries to protect itself from some\n * post-initialization perturbation by stashing some of the\n * primordials it needs for later use, but this attempt is currently\n * incomplete. We need to revisit this when we support Confined-ES5,\n * as a variant of SES in which the primordials are not frozen. See\n * previous failed attempt at <a\n * href=\"https://codereview.appspot.com/5278046/\" >Speeds up\n * WeakMap. Preparing to support unfrozen primordials.</a>. From\n * analysis of this failed attempt, it seems that the only practical\n * way to support CES is by use of two frames, where most of initSES\n * runs in a SES frame, and so can avoid worrying about most of these\n * perturbations.\n */\nfunction getAnonIntrinsics$1(global) {\n\n  const gopd = Object.getOwnPropertyDescriptor;\n  const getProto = Object.getPrototypeOf;\n\n  // ////////////// Undeniables and Intrinsics //////////////\n\n  /**\n   * The undeniables are the primordial objects which are ambiently\n   * reachable via compositions of strict syntax, primitive wrapping\n   * (new Object(x)), and prototype navigation (the equivalent of\n   * Object.getPrototypeOf(x) or x.__proto__). Although we could in\n   * theory monkey patch primitive wrapping or prototype navigation,\n   * we won't. Hence, without parsing, the following are undeniable no\n   * matter what <i>other</i> monkey patching we do to the primordial\n   * environment.\n   */\n\n  // The first element of each undeniableTuple is a string used to\n  // name the undeniable object for reporting purposes. It has no\n  // other programmatic use.\n  //\n  // The second element of each undeniableTuple should be the\n  // undeniable itself.\n  //\n  // The optional third element of the undeniableTuple, if present,\n  // should be an example of syntax, rather than use of a monkey\n  // patchable API, evaluating to a value from which the undeniable\n  // object in the second element can be reached by only the\n  // following steps:\n  // If the value is primitve, convert to an Object wrapper.\n  // Is the resulting object either the undeniable object, or does\n  // it inherit directly from the undeniable object?\n\n  function* aStrictGenerator() {} // eslint-disable-line no-empty-function\n  const Generator = getProto(aStrictGenerator);\n  async function* aStrictAsyncGenerator() {} // eslint-disable-line no-empty-function\n  const AsyncGenerator = getProto(aStrictAsyncGenerator);\n  async function aStrictAsyncFunction() {} // eslint-disable-line no-empty-function\n  const AsyncFunctionPrototype = getProto(aStrictAsyncFunction);\n\n  // TODO: this is dead code, but could be useful: make this the\n  // 'undeniables' object available via some API.\n\n  const undeniableTuples = [\n    ['Object.prototype', Object.prototype, {}],\n    ['Function.prototype', Function.prototype, function foo() {}],\n    ['Array.prototype', Array.prototype, []],\n    ['RegExp.prototype', RegExp.prototype, /x/],\n    ['Boolean.prototype', Boolean.prototype, true],\n    ['Number.prototype', Number.prototype, 1],\n    ['String.prototype', String.prototype, 'x'],\n    ['%Generator%', Generator, aStrictGenerator],\n    ['%AsyncGenerator%', AsyncGenerator, aStrictAsyncGenerator],\n    ['%AsyncFunction%', AsyncFunctionPrototype, aStrictAsyncFunction],\n  ];\n\n  undeniableTuples.forEach(tuple => {\n    const name = tuple[0];\n    const undeniable = tuple[1];\n    let start = tuple[2];\n    if (start === undefined) {\n      return;\n    }\n    start = Object(start);\n    if (undeniable === start) {\n      return;\n    }\n    if (undeniable === getProto(start)) {\n      return;\n    }\n    throw new Error(`Unexpected undeniable: ${undeniable}`);\n  });\n\n  function registerIteratorProtos(registery, base, name) {\n    const iteratorSym =\n      (global.Symbol && global.Symbol.iterator) || '@@iterator'; // used instead of a symbol on FF35\n\n    if (base[iteratorSym]) {\n      const anIter = base[iteratorSym]();\n      const anIteratorPrototype = getProto(anIter);\n      registery[name] = anIteratorPrototype; // eslint-disable-line no-param-reassign\n      const anIterProtoBase = getProto(anIteratorPrototype);\n      if (anIterProtoBase !== Object.prototype) {\n        if (!registery.IteratorPrototype) {\n          if (getProto(anIterProtoBase) !== Object.prototype) {\n            throw new Error(\n              '%IteratorPrototype%.__proto__ was not Object.prototype',\n            );\n          }\n          registery.IteratorPrototype = anIterProtoBase; // eslint-disable-line no-param-reassign\n        } else if (registery.IteratorPrototype !== anIterProtoBase) {\n          throw new Error(`unexpected %${name}%.__proto__`);\n        }\n      }\n    }\n  }\n\n  /**\n   * Get the intrinsics not otherwise reachable by named own property\n   * traversal. See\n   * https://people.mozilla.org/~jorendorff/es6-draft.html#sec-well-known-intrinsic-objects\n   * and the instrinsics section of whitelist.js\n   *\n   * <p>Unlike getUndeniables(), the result of sampleAnonIntrinsics()\n   * does depend on the current state of the primordials, so we must\n   * run this again after all other relevant monkey patching is done,\n   * in order to properly initialize cajaVM.intrinsics\n   */\n\n  // TODO: we can probably unwrap this into the outer function, and stop\n  // using a separately named 'sampleAnonIntrinsics'\n  function sampleAnonIntrinsics() {\n    const result = {};\n\n    // If there are still other ThrowTypeError objects left after\n    // noFuncPoison-ing, this should be caught by\n    // test_THROWTYPEERROR_NOT_UNIQUE below, so we assume here that\n    // this is the only surviving ThrowTypeError intrinsic.\n    // eslint-disable-next-line prefer-rest-params\n    result.ThrowTypeError = gopd(arguments, 'callee').get;\n\n    // Get the ES6 %ArrayIteratorPrototype%,\n    // %StringIteratorPrototype%, %MapIteratorPrototype%,\n    // %SetIteratorPrototype% and %IteratorPrototype% intrinsics, if\n    // present.\n    registerIteratorProtos(result, [], 'ArrayIteratorPrototype');\n    registerIteratorProtos(result, '', 'StringIteratorPrototype');\n    if (typeof Map === 'function') {\n      registerIteratorProtos(result, new Map(), 'MapIteratorPrototype');\n    }\n    if (typeof Set === 'function') {\n      registerIteratorProtos(result, new Set(), 'SetIteratorPrototype');\n    }\n\n    // Get the ES6 %GeneratorFunction% intrinsic, if present.\n    if (getProto(Generator) !== Function.prototype) {\n      throw new Error('Generator.__proto__ was not Function.prototype');\n    }\n    const GeneratorFunction = Generator.constructor;\n    if (getProto(GeneratorFunction) !== Function.prototype.constructor) {\n      throw new Error(\n        'GeneratorFunction.__proto__ was not Function.prototype.constructor',\n      );\n    }\n    result.GeneratorFunction = GeneratorFunction;\n    const genProtoBase = getProto(Generator.prototype);\n    if (genProtoBase !== result.IteratorPrototype) {\n      throw new Error('Unexpected Generator.prototype.__proto__');\n    }\n\n    // Get the ES6 %AsyncGeneratorFunction% intrinsic, if present.\n    if (getProto(AsyncGenerator) !== Function.prototype) {\n      throw new Error('AsyncGenerator.__proto__ was not Function.prototype');\n    }\n    const AsyncGeneratorFunction = AsyncGenerator.constructor;\n    if (getProto(AsyncGeneratorFunction) !== Function.prototype.constructor) {\n      throw new Error(\n        'AsyncGeneratorFunction.__proto__ was not Function.prototype.constructor',\n      );\n    }\n    result.AsyncGeneratorFunction = AsyncGeneratorFunction;\n    const AsyncGeneratorPrototype = AsyncGenerator.prototype;\n    result.AsyncIteratorPrototype = getProto(AsyncGeneratorPrototype);\n    // it appears that the only way to get an AsyncIteratorPrototype is\n    // through this getProto() process, so there's nothing to check it\n    // against\n    if (getProto(result.AsyncIteratorPrototype) !== Object.prototype) {\n      throw new Error(\n        'AsyncIteratorPrototype.__proto__ was not Object.prototype',\n      );\n    }\n\n    // Get the ES6 %AsyncFunction% intrinsic, if present.\n    if (getProto(AsyncFunctionPrototype) !== Function.prototype) {\n      throw new Error(\n        'AsyncFunctionPrototype.__proto__ was not Function.prototype',\n      );\n    }\n    const AsyncFunction = AsyncFunctionPrototype.constructor;\n    if (getProto(AsyncFunction) !== Function.prototype.constructor) {\n      throw new Error(\n        'AsyncFunction.__proto__ was not Function.prototype.constructor',\n      );\n    }\n    result.AsyncFunction = AsyncFunction;\n\n    // Get the ES6 %TypedArray% intrinsic, if present.\n    (function getTypedArray() {\n      if (!global.Float32Array) {\n        return;\n      }\n      const TypedArray = getProto(global.Float32Array);\n      if (TypedArray === Function.prototype) {\n        return;\n      }\n      if (getProto(TypedArray) !== Function.prototype) {\n        // http://bespin.cz/~ondras/html/classv8_1_1ArrayBufferView.html\n        // has me worried that someone might make such an intermediate\n        // object visible.\n        throw new Error('TypedArray.__proto__ was not Function.prototype');\n      }\n      result.TypedArray = TypedArray;\n    })();\n\n    Object.keys(result).forEach(name => {\n      if (result[name] === undefined) {\n        throw new Error(`Malformed intrinsic: ${name}`);\n      }\n    });\n\n    return result;\n  }\n\n  return sampleAnonIntrinsics();\n}\n\nfunction getAllPrimordials(global, anonIntrinsics) {\n\n  const root = {\n    global, // global plus all the namedIntrinsics\n    anonIntrinsics,\n  };\n  // todo: re-examine exactly which \"global\" we're freezing\n\n  return root;\n}\n\n// Copyright (C) 2011 Google Inc.\n// Copyright (C) 2018 Agoric\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview Exports {@code ses.whitelist}, a recursively defined\n * JSON record enumerating all the naming paths in the ES5.1 spec,\n * those de-facto extensions that we judge to be safe, and SES and\n * Dr. SES extensions provided by the SES runtime.\n *\n * <p>Assumes only ES3. Compatible with ES5, ES5-strict, or\n * anticipated ES6.\n *\n * //provides ses.whitelist\n * @author Mark S. Miller,\n * @overrides ses, whitelistModule\n */\n\n/**\n * <p>Each JSON record enumerates the disposition of the properties on\n * some corresponding primordial object, with the root record\n * representing the global object. For each such record, the values\n * associated with its property names can be\n * <ul>\n * <li>Another record, in which case this property is simply\n *     whitelisted and that next record represents the disposition of\n *     the object which is its value. For example, {@code \"Object\"}\n *     leads to another record explaining what properties {@code\n *     \"Object\"} may have and how each such property, if present,\n *     and its value should be tamed.\n * <li>true, in which case this property is simply whitelisted. The\n *     value associated with that property is still traversed and\n *     tamed, but only according to the taming of the objects that\n *     object inherits from. For example, {@code \"Object.freeze\"} leads\n *     to true, meaning that the {@code \"freeze\"} property of {@code\n *     Object} should be whitelisted and the value of the property (a\n *     function) should be further tamed only according to the\n *     markings of the other objects it inherits from, like {@code\n *     \"Function.prototype\"} and {@code \"Object.prototype\").\n *     If the property is an accessor property, it is not\n *     whitelisted (as invoking an accessor might not be meaningful,\n *     yet the accessor might return a value needing taming).\n * <li>\"maybeAccessor\", in which case this accessor property is simply\n *     whitelisted and its getter and/or setter are tamed according to\n *     inheritance. If the property is not an accessor property, its\n *     value is tamed according to inheritance.\n * <li>\"*\", in which case this property on this object is whitelisted,\n *     as is this property as inherited by all objects that inherit\n *     from this object. The values associated with all such properties\n *     are still traversed and tamed, but only according to the taming\n *     of the objects that object inherits from. For example, {@code\n *     \"Object.prototype.constructor\"} leads to \"*\", meaning that we\n *     whitelist the {@code \"constructor\"} property on {@code\n *     Object.prototype} and on every object that inherits from {@code\n *     Object.prototype} that does not have a conflicting mark. Each\n *     of these is tamed as if with true, so that the value of the\n *     property is further tamed according to what other objects it\n *     inherits from.\n * <li>false, which suppresses permission inherited via \"*\".\n * </ul>\n *\n * <p>TODO: We want to do for constructor: something weaker than '*',\n * but rather more like what we do for [[Prototype]] links, which is\n * that it is whitelisted only if it points at an object which is\n * otherwise reachable by a whitelisted path.\n *\n * <p>The members of the whitelist are either\n * <ul>\n * <li>(uncommented) defined by the ES5.1 normative standard text,\n * <li>(questionable) provides a source of non-determinism, in\n *     violation of pure object-capability rules, but allowed anyway\n *     since we've given up on restricting JavaScript to a\n *     deterministic subset.\n * <li>(ES5 Appendix B) common elements of de facto JavaScript\n *     described by the non-normative Appendix B.\n * <li>(Harmless whatwg) extensions documented at\n *     <a href=\"http://wiki.whatwg.org/wiki/Web_ECMAScript\"\n *     >http://wiki.whatwg.org/wiki/Web_ECMAScript</a> that seem to be\n *     harmless. Note that the RegExp constructor extensions on that\n *     page are <b>not harmless</b> and so must not be whitelisted.\n * <li>(ES-Harmony proposal) accepted as \"proposal\" status for\n *     EcmaScript-Harmony.\n * </ul>\n *\n * <p>With the above encoding, there are some sensible whitelists we\n * cannot express, such as marking a property both with \"*\" and a JSON\n * record. This is an expedient decision based only on not having\n * encountered such a need. Should we need this extra expressiveness,\n * we'll need to refactor to enable a different encoding.\n *\n * <p>We factor out {@code true} into the variable {@code t} just to\n * get a bit better compression from simple minifiers.\n */\n\nconst t = true;\nconst j = true; // included in the Jessie runtime\n\nlet TypedArrayWhitelist; // defined and used below\n\nvar whitelist = {\n  // The accessible intrinsics which are not reachable by own\n  // property name traversal are listed here so that they are\n  // processed by the whitelist, although this also makes them\n  // accessible by this path.  See\n  // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-well-known-intrinsic-objects\n  // Of these, ThrowTypeError is the only one from ES5. All the\n  // rest were introduced in ES6.\n  anonIntrinsics: {\n    ThrowTypeError: {},\n    IteratorPrototype: {\n      // 25.1\n      // Technically, for SES-on-ES5, we should not need to\n      // whitelist 'next'. However, browsers are accidentally\n      // relying on it\n      // https://bugs.chromium.org/p/v8/issues/detail?id=4769#\n      // https://bugs.webkit.org/show_bug.cgi?id=154475\n      // and we will be whitelisting it as we transition to ES6\n      // anyway, so we unconditionally whitelist it now.\n      next: '*',\n      constructor: false,\n    },\n    ArrayIteratorPrototype: {},\n    StringIteratorPrototype: {},\n    MapIteratorPrototype: {},\n    SetIteratorPrototype: {},\n    // AsyncIteratorPrototype does not inherit from IteratorPrototype\n    AsyncIteratorPrototype: {},\n\n    // The %GeneratorFunction% intrinsic is the constructor of\n    // generator functions, so %GeneratorFunction%.prototype is\n    // the %Generator% intrinsic, which all generator functions\n    // inherit from. A generator function is effectively the\n    // constructor of its generator instances, so, for each\n    // generator function (e.g., \"g1\" on the diagram at\n    // http://people.mozilla.org/~jorendorff/figure-2.png )\n    // its .prototype is a prototype that its instances inherit\n    // from. Paralleling this structure, %Generator%.prototype,\n    // i.e., %GeneratorFunction%.prototype.prototype, is the\n    // object that all these generator function prototypes inherit\n    // from. The .next, .return and .throw that generator\n    // instances respond to are actually the builtin methods they\n    // inherit from this object.\n    GeneratorFunction: {\n      // 25.2\n      length: '*', // Not sure why this is needed\n      prototype: {\n        // 25.4\n        prototype: {\n          next: '*',\n          return: '*',\n          throw: '*',\n          constructor: '*', // Not sure why this is needed\n        },\n      },\n    },\n    AsyncGeneratorFunction: {\n      // 25.3\n      length: '*',\n      prototype: {\n        // 25.5\n        prototype: {\n          next: '*',\n          return: '*',\n          throw: '*',\n          constructor: '*', // Not sure why this is needed\n        },\n      },\n    },\n    AsyncFunction: {\n      // 25.7\n      length: '*',\n      prototype: '*',\n    },\n\n    TypedArray: (TypedArrayWhitelist = {\n      // 22.2\n      length: '*', // does not inherit from Function.prototype on Chrome\n      name: '*', // ditto\n      from: t,\n      of: t,\n      BYTES_PER_ELEMENT: '*',\n      prototype: {\n        buffer: 'maybeAccessor',\n        byteLength: 'maybeAccessor',\n        byteOffset: 'maybeAccessor',\n        copyWithin: '*',\n        entries: '*',\n        every: '*',\n        fill: '*',\n        filter: '*',\n        find: '*',\n        findIndex: '*',\n        forEach: '*',\n        includes: '*',\n        indexOf: '*',\n        join: '*',\n        keys: '*',\n        lastIndexOf: '*',\n        length: 'maybeAccessor',\n        map: '*',\n        reduce: '*',\n        reduceRight: '*',\n        reverse: '*',\n        set: '*',\n        slice: '*',\n        some: '*',\n        sort: '*',\n        subarray: '*',\n        values: '*',\n        BYTES_PER_ELEMENT: '*',\n      },\n    }),\n  },\n\n  namedIntrinsics: {\n    // In order according to\n    // http://www.ecma-international.org/ecma-262/ with chapter\n    // numbers where applicable\n\n    // 18 The Global Object\n\n    // 18.1\n    Infinity: j,\n    NaN: j,\n    undefined: j,\n\n    // 18.2\n    // eval: t,                      // Whitelisting under separate control\n    // by TAME_GLOBAL_EVAL in startSES.js\n    isFinite: t,\n    isNaN: t,\n    parseFloat: t,\n    parseInt: t,\n    decodeURI: t,\n    decodeURIComponent: t,\n    encodeURI: t,\n    encodeURIComponent: t,\n\n    // 19 Fundamental Objects\n\n    Object: {\n      // 19.1\n      assign: t, // ES-Harmony\n      create: t,\n      defineProperties: t, // ES-Harmony\n      defineProperty: t,\n      entries: t, // ES-Harmony\n      freeze: j,\n      getOwnPropertyDescriptor: t,\n      getOwnPropertyDescriptors: t, // proposed ES-Harmony\n      getOwnPropertyNames: t,\n      getOwnPropertySymbols: t, // ES-Harmony\n      getPrototypeOf: t,\n      is: j, // ES-Harmony\n      isExtensible: t,\n      isFrozen: t,\n      isSealed: t,\n      keys: t,\n      preventExtensions: j,\n      seal: j,\n      setPrototypeOf: t, // ES-Harmony\n      values: t, // ES-Harmony\n\n      prototype: {\n        // B.2.2\n        // __proto__: t, whitelisted manually in startSES.js\n        __defineGetter__: t,\n        __defineSetter__: t,\n        __lookupGetter__: t,\n        __lookupSetter__: t,\n\n        constructor: '*',\n        hasOwnProperty: t,\n        isPrototypeOf: t,\n        propertyIsEnumerable: t,\n        toLocaleString: '*',\n        toString: '*',\n        valueOf: '*',\n\n        // Generally allowed\n        [Symbol.iterator]: '*',\n        [Symbol.toPrimitive]: '*',\n        [Symbol.toStringTag]: '*',\n        [Symbol.unscopables]: '*',\n      },\n    },\n\n    Function: {\n      // 19.2\n      length: t,\n      prototype: {\n        apply: t,\n        bind: t,\n        call: t,\n        [Symbol.hasInstance]: '*',\n\n        // 19.2.4 instances\n        length: '*',\n        name: '*', // ES-Harmony\n        prototype: '*',\n        arity: '*', // non-std, deprecated in favor of length\n\n        // Generally allowed\n        [Symbol.species]: 'maybeAccessor', // ES-Harmony?\n      },\n    },\n\n    Boolean: {\n      // 19.3\n      prototype: t,\n    },\n\n    Symbol: {\n      // 19.4               all ES-Harmony\n      asyncIterator: t, // proposed? ES-Harmony\n      for: t,\n      hasInstance: t,\n      isConcatSpreadable: t,\n      iterator: t,\n      keyFor: t,\n      match: t,\n      matchAll: t,\n      replace: t,\n      search: t,\n      species: t,\n      split: t,\n      toPrimitive: t,\n      toStringTag: t,\n      unscopables: t,\n      prototype: t,\n    },\n\n    Error: {\n      // 19.5\n      prototype: {\n        name: '*',\n        message: '*',\n      },\n    },\n    // In ES6 the *Error \"subclasses\" of Error inherit from Error,\n    // since constructor inheritance generally mirrors prototype\n    // inheritance. As explained at\n    // https://code.google.com/p/google-caja/issues/detail?id=1963 ,\n    // debug.js hides away the Error constructor itself, and so needs\n    // to rewire these \"subclass\" constructors. Until we have a more\n    // general mechanism, please maintain this list of whitelisted\n    // subclasses in sync with the list in debug.js of subclasses to\n    // be rewired.\n    EvalError: {\n      prototype: t,\n    },\n    RangeError: {\n      prototype: t,\n    },\n    ReferenceError: {\n      prototype: t,\n    },\n    SyntaxError: {\n      prototype: t,\n    },\n    TypeError: {\n      prototype: t,\n    },\n    URIError: {\n      prototype: t,\n    },\n\n    // 20 Numbers and Dates\n\n    Number: {\n      // 20.1\n      EPSILON: t, // ES-Harmony\n      isFinite: j, // ES-Harmony\n      isInteger: t, // ES-Harmony\n      isNaN: j, // ES-Harmony\n      isSafeInteger: j, // ES-Harmony\n      MAX_SAFE_INTEGER: j, // ES-Harmony\n      MAX_VALUE: t,\n      MIN_SAFE_INTEGER: j, // ES-Harmony\n      MIN_VALUE: t,\n      NaN: t,\n      NEGATIVE_INFINITY: t,\n      parseFloat: t, // ES-Harmony\n      parseInt: t, // ES-Harmony\n      POSITIVE_INFINITY: t,\n      prototype: {\n        toExponential: t,\n        toFixed: t,\n        toPrecision: t,\n      },\n    },\n\n    Math: {\n      // 20.2\n      E: j,\n      LN10: j,\n      LN2: j,\n      LOG10E: t,\n      LOG2E: t,\n      PI: j,\n      SQRT1_2: t,\n      SQRT2: t,\n\n      abs: j,\n      acos: t,\n      acosh: t, // ES-Harmony\n      asin: t,\n      asinh: t, // ES-Harmony\n      atan: t,\n      atanh: t, // ES-Harmony\n      atan2: t,\n      cbrt: t, // ES-Harmony\n      ceil: j,\n      clz32: t, // ES-Harmony\n      cos: t,\n      cosh: t, // ES-Harmony\n      exp: t,\n      expm1: t, // ES-Harmony\n      floor: j,\n      fround: t, // ES-Harmony\n      hypot: t, // ES-Harmony\n      imul: t, // ES-Harmony\n      log: j,\n      log1p: t, // ES-Harmony\n      log10: j, // ES-Harmony\n      log2: j, // ES-Harmony\n      max: j,\n      min: j,\n      pow: j,\n      random: t, // questionable\n      round: j,\n      sign: t, // ES-Harmony\n      sin: t,\n      sinh: t, // ES-Harmony\n      sqrt: j,\n      tan: t,\n      tanh: t, // ES-Harmony\n      trunc: j, // ES-Harmony\n    },\n\n    // no-arg Date constructor is questionable\n    Date: {\n      // 20.3\n      now: t, // questionable\n      parse: t,\n      UTC: t,\n      prototype: {\n        // Note: coordinate this list with maintanence of repairES5.js\n        getDate: t,\n        getDay: t,\n        getFullYear: t,\n        getHours: t,\n        getMilliseconds: t,\n        getMinutes: t,\n        getMonth: t,\n        getSeconds: t,\n        getTime: t,\n        getTimezoneOffset: t,\n        getUTCDate: t,\n        getUTCDay: t,\n        getUTCFullYear: t,\n        getUTCHours: t,\n        getUTCMilliseconds: t,\n        getUTCMinutes: t,\n        getUTCMonth: t,\n        getUTCSeconds: t,\n        setDate: t,\n        setFullYear: t,\n        setHours: t,\n        setMilliseconds: t,\n        setMinutes: t,\n        setMonth: t,\n        setSeconds: t,\n        setTime: t,\n        setUTCDate: t,\n        setUTCFullYear: t,\n        setUTCHours: t,\n        setUTCMilliseconds: t,\n        setUTCMinutes: t,\n        setUTCMonth: t,\n        setUTCSeconds: t,\n        toDateString: t,\n        toISOString: t,\n        toJSON: t,\n        toLocaleDateString: t,\n        toLocaleString: t,\n        toLocaleTimeString: t,\n        toTimeString: t,\n        toUTCString: t,\n\n        // B.2.4\n        getYear: t,\n        setYear: t,\n        toGMTString: t,\n      },\n    },\n\n    // 21 Text Processing\n\n    String: {\n      // 21.2\n      fromCharCode: j,\n      fromCodePoint: t, // ES-Harmony\n      raw: j, // ES-Harmony\n      prototype: {\n        charAt: t,\n        charCodeAt: t,\n        codePointAt: t, // ES-Harmony\n        concat: t,\n        endsWith: j, // ES-Harmony\n        includes: t, // ES-Harmony\n        indexOf: j,\n        lastIndexOf: j,\n        localeCompare: t,\n        match: t,\n        normalize: t, // ES-Harmony\n        padEnd: t, // ES-Harmony\n        padStart: t, // ES-Harmony\n        repeat: t, // ES-Harmony\n        replace: t,\n        search: t,\n        slice: j,\n        split: t,\n        startsWith: j, // ES-Harmony\n        substring: t,\n        toLocaleLowerCase: t,\n        toLocaleUpperCase: t,\n        toLowerCase: t,\n        toUpperCase: t,\n        trim: t,\n\n        // B.2.3\n        substr: t,\n        anchor: t,\n        big: t,\n        blink: t,\n        bold: t,\n        fixed: t,\n        fontcolor: t,\n        fontsize: t,\n        italics: t,\n        link: t,\n        small: t,\n        strike: t,\n        sub: t,\n        sup: t,\n\n        trimLeft: t, // non-standard\n        trimRight: t, // non-standard\n\n        // 21.1.4 instances\n        length: '*',\n      },\n    },\n\n    RegExp: {\n      // 21.2\n      prototype: {\n        exec: t,\n        flags: 'maybeAccessor',\n        global: 'maybeAccessor',\n        ignoreCase: 'maybeAccessor',\n        [Symbol.match]: '*', // ES-Harmony\n        multiline: 'maybeAccessor',\n        [Symbol.replace]: '*', // ES-Harmony\n        [Symbol.search]: '*', // ES-Harmony\n        source: 'maybeAccessor',\n        [Symbol.split]: '*', // ES-Harmony\n        sticky: 'maybeAccessor',\n        test: t,\n        unicode: 'maybeAccessor', // ES-Harmony\n        dotAll: 'maybeAccessor', // proposed ES-Harmony\n\n        // B.2.5\n        compile: false, // UNSAFE. Purposely suppressed\n\n        // 21.2.6 instances\n        lastIndex: '*',\n        options: '*', // non-std\n      },\n    },\n\n    // 22 Indexed Collections\n\n    Array: {\n      // 22.1\n      from: j,\n      isArray: t,\n      of: j, // ES-Harmony?\n      prototype: {\n        concat: t,\n        copyWithin: t, // ES-Harmony\n        entries: t, // ES-Harmony\n        every: t,\n        fill: t, // ES-Harmony\n        filter: j,\n        find: t, // ES-Harmony\n        findIndex: t, // ES-Harmony\n        forEach: j,\n        includes: t, // ES-Harmony\n        indexOf: j,\n        join: t,\n        keys: t, // ES-Harmony\n        lastIndexOf: j,\n        map: j,\n        pop: j,\n        push: j,\n        reduce: j,\n        reduceRight: j,\n        reverse: t,\n        shift: j,\n        slice: j,\n        some: t,\n        sort: t,\n        splice: t,\n        unshift: j,\n        values: t, // ES-Harmony\n\n        // 22.1.4 instances\n        length: '*',\n      },\n    },\n\n    // 22.2 Typed Array stuff\n    // TODO: Not yet organized according to spec order\n\n    Int8Array: TypedArrayWhitelist,\n    Uint8Array: TypedArrayWhitelist,\n    Uint8ClampedArray: TypedArrayWhitelist,\n    Int16Array: TypedArrayWhitelist,\n    Uint16Array: TypedArrayWhitelist,\n    Int32Array: TypedArrayWhitelist,\n    Uint32Array: TypedArrayWhitelist,\n    Float32Array: TypedArrayWhitelist,\n    Float64Array: TypedArrayWhitelist,\n\n    // 23 Keyed Collections          all ES-Harmony\n\n    Map: {\n      // 23.1\n      prototype: {\n        clear: j,\n        delete: j,\n        entries: j,\n        forEach: j,\n        get: j,\n        has: j,\n        keys: j,\n        set: j,\n        size: 'maybeAccessor',\n        values: j,\n      },\n    },\n\n    Set: {\n      // 23.2\n      prototype: {\n        add: j,\n        clear: j,\n        delete: j,\n        entries: j,\n        forEach: j,\n        has: j,\n        keys: j,\n        size: 'maybeAccessor',\n        values: j,\n      },\n    },\n\n    WeakMap: {\n      // 23.3\n      prototype: {\n        // Note: coordinate this list with maintenance of repairES5.js\n        delete: j,\n        get: j,\n        has: j,\n        set: j,\n      },\n    },\n\n    WeakSet: {\n      // 23.4\n      prototype: {\n        add: j,\n        delete: j,\n        has: j,\n      },\n    },\n\n    // 24 Structured Data\n\n    ArrayBuffer: {\n      // 24.1            all ES-Harmony\n      isView: t,\n      length: t, // does not inherit from Function.prototype on Chrome\n      name: t, // ditto\n      prototype: {\n        byteLength: 'maybeAccessor',\n        slice: t,\n      },\n    },\n\n    // 24.2 TODO: Omitting SharedArrayBuffer for now\n\n    DataView: {\n      // 24.3               all ES-Harmony\n      length: t, // does not inherit from Function.prototype on Chrome\n      name: t, // ditto\n      BYTES_PER_ELEMENT: '*', // non-standard. really?\n      prototype: {\n        buffer: 'maybeAccessor',\n        byteOffset: 'maybeAccessor',\n        byteLength: 'maybeAccessor',\n        getFloat32: t,\n        getFloat64: t,\n        getInt8: t,\n        getInt16: t,\n        getInt32: t,\n        getUint8: t,\n        getUint16: t,\n        getUint32: t,\n        setFloat32: t,\n        setFloat64: t,\n        setInt8: t,\n        setInt16: t,\n        setInt32: t,\n        setUint8: t,\n        setUint16: t,\n        setUint32: t,\n      },\n    },\n\n    // 24.4 TODO: Omitting Atomics for now\n\n    JSON: {\n      // 24.5\n      parse: j,\n      stringify: j,\n    },\n\n    // 25 Control Abstraction Objects\n\n    Promise: {\n      // 25.4\n      all: j,\n      race: j,\n      reject: j,\n      resolve: j,\n      prototype: {\n        catch: t,\n        then: j,\n        finally: t, // proposed ES-Harmony\n\n        // nanoq.js\n        get: t,\n        put: t,\n        del: t,\n        post: t,\n        invoke: t,\n        fapply: t,\n        fcall: t,\n\n        // Temporary compat with the old makeQ.js\n        send: t,\n        delete: t,\n        end: t,\n      },\n    },\n\n    // nanoq.js\n    Q: {\n      all: t,\n      race: t,\n      reject: t,\n      resolve: t,\n\n      join: t,\n      isPassByCopy: t,\n      passByCopy: t,\n      makeRemote: t,\n      makeFar: t,\n\n      // Temporary compat with the old makeQ.js\n      shorten: t,\n      isPromise: t,\n      async: t,\n      rejected: t,\n      promise: t,\n      delay: t,\n      memoize: t,\n      defer: t,\n    },\n\n    // 26 Reflection\n\n    Reflect: {\n      // 26.1\n      apply: t,\n      construct: t,\n      defineProperty: t,\n      deleteProperty: t,\n      get: t,\n      getOwnPropertyDescriptor: t,\n      getPrototypeOf: t,\n      has: t,\n      isExtensible: t,\n      ownKeys: t,\n      preventExtensions: t,\n      set: t,\n      setPrototypeOf: t,\n    },\n\n    Proxy: {\n      // 26.2\n      revocable: t,\n    },\n\n    // Appendix B\n\n    // B.2.1\n    escape: t,\n    unescape: t,\n\n    // B.2.5 (RegExp.prototype.compile) is marked 'false' up in 21.2\n\n    // Other\n\n    StringMap: {\n      // A specialized approximation of ES-Harmony's Map.\n      prototype: {}, // Technically, the methods should be on the prototype,\n      // but doing so while preserving encapsulation will be\n      // needlessly expensive for current usage.\n    },\n\n    Realm: {\n      makeRootRealm: t,\n      makeCompartment: t,\n      prototype: {\n        global: 'maybeAccessor',\n        evaluate: t,\n      },\n    },\n\n    SES: {\n      confine: t,\n      confineExpr: t,\n    },\n\n    Nat: j,\n    def: j,\n  },\n};\n\nfunction makeConsole(parentConsole) {\n  /* 'parentConsole' is the parent Realm's original 'console' object. We must\n     wrap it, exposing a 'console' with a 'console.log' (and perhaps others)\n     to the local realm, without allowing access to the original 'console',\n     its return values, or its exception objects, any of which could be used\n     to break confinement via the unsafe Function constructor. */\n\n  // callAndWrapError is copied from proposal-realms/shim/src/realmFacade.js\n  // Like Realm.apply except that it catches anything thrown and rethrows it\n  // as an Error from this realm\n\n  const errorConstructors = new Map([\n    ['EvalError', EvalError],\n    ['RangeError', RangeError],\n    ['ReferenceError', ReferenceError],\n    ['SyntaxError', SyntaxError],\n    ['TypeError', TypeError],\n    ['URIError', URIError],\n  ]);\n\n  function callAndWrapError(target, ...args) {\n    try {\n      return target(...args);\n    } catch (err) {\n      if (Object(err) !== err) {\n        // err is a primitive value, which is safe to rethrow\n        throw err;\n      }\n      let eName;\n      let eMessage;\n      let eStack;\n      try {\n        // The child environment might seek to use 'err' to reach the\n        // parent's intrinsics and corrupt them. `${err.name}` will cause\n        // string coercion of 'err.name'. If err.name is an object (probably\n        // a String of the parent Realm), the coercion uses\n        // err.name.toString(), which is under the control of the parent. If\n        // err.name were a primitive (e.g. a number), it would use\n        // Number.toString(err.name), using the child's version of Number\n        // (which the child could modify to capture its argument for later\n        // use), however primitives don't have properties like .prototype so\n        // they aren't useful for an attack.\n        eName = `${err.name}`;\n        eMessage = `${err.message}`;\n        eStack = `${err.stack}`;\n        // eName/eMessage/eStack are now child-realm primitive strings, and\n        // safe to expose\n      } catch (ignored) {\n        // if err.name.toString() throws, keep the (parent realm) Error away\n        // from the child\n        throw new Error('unknown error');\n      }\n      const ErrorConstructor = errorConstructors.get(eName) || Error;\n      try {\n        throw new ErrorConstructor(eMessage);\n      } catch (err2) {\n        err2.stack = eStack; // replace with the captured inner stack\n        throw err2;\n      }\n    }\n  }\n\n  const newConsole = {};\n  const passThrough = [\n    'log',\n    'info',\n    'warn',\n    'error',\n    'group',\n    'groupEnd',\n    'trace',\n    'time',\n    'timeLog',\n    'timeEnd',\n  ];\n  // TODO: those are the properties that MDN documents. Node.js has a bunch\n  // of additional ones that I didn't include, which might be appropriate.\n\n  passThrough.forEach(name => {\n    // TODO: do we reveal the presence/absence of these properties to the\n    // child realm, thus exposing nondeterminism (and a hint of what platform\n    // you might be on) when it is constructed with {consoleMode: allow} ? Or\n    // should we expose the same set all the time, but silently ignore calls\n    // to the missing ones, to hide that variation? We might even consider\n    // adding console.* to the child realm all the time, even without\n    // consoleMode:allow, but ignore the calls unless the mode is enabled.\n    if (name in parentConsole) {\n      const orig = parentConsole[name];\n      // TODO: in a stack trace, this appears as\n      // \"Object.newConsole.(anonymous function) [as trace]\"\n      // can we make that \"newConsole.trace\" ?\n      newConsole[name] = function newerConsole(...args) {\n        callAndWrapError(orig, ...args);\n      };\n    }\n  });\n\n  return newConsole;\n}\n\nfunction makeMakeRequire(r, harden) {\n  function makeRequire(config) {\n    const cache = new Map();\n\n    function build(what) {\n      // This approach denies callers the ability to use inheritance to\n      // manage their config objects, but a simple \"if (what in config)\"\n      // predicate would also be truthy for e.g. \"toString\" and other\n      // properties of Object.prototype, and require('toString') should be\n      // legal if and only if the config object included an own-property\n      // named 'toString'. Incidentally, this could have been\n      // \"config.hasOwnProperty(what)\" but eslint complained.\n      if (!Object.prototype.hasOwnProperty.call(config, what)) {\n        throw new Error(`Cannot find module '${what}'`);\n      }\n      const c = config[what];\n\n      // some modules are hard-coded ways to access functionality that SES\n      // provides directly\n      if (what === '@agoric/harden') {\n        return harden;\n      }\n\n      // If the config points at a simple function, it must be a pure\n      // function with no dependencies (i.e. no 'require' or 'import', no\n      // calls to other functions defined in the same file but outside the\n      // function body). We stringify it and evaluate it inside this realm.\n      if (typeof c === 'function') {\n        return r.evaluate(`(${c})`);\n      }\n\n      // else we treat it as an object with an 'attenuatorSource' property\n      // that defines an attenuator function, which we evaluate. We then\n      // invoke it with the config object, which can contain authorities that\n      // it can wrap. The return value from this invocation is the module\n      // object that gets returned from require(). The attenuator function\n      // and the module it returns are in-realm, the authorities it wraps\n      // will be out-of-realm.\n      const src = `(${c.attenuatorSource})`;\n      const attenuator = r.evaluate(src);\n      return attenuator(c);\n    }\n\n    function newRequire(whatArg) {\n      const what = `${whatArg}`;\n      if (!cache.has(what)) {\n        cache.set(what, harden(build(what)));\n      }\n      return cache.get(what);\n    }\n\n    return newRequire;\n  }\n\n  return makeRequire;\n}\n\n// Copyright (C) 2018 Agoric\n\nfunction createSESWithRealmConstructor(creatorStrings, Realm) {\n  function makeSESRootRealm(options) {\n    // eslint-disable-next-line no-param-reassign\n    options = Object(options); // Todo: sanitize\n    const shims = [];\n    const wl = JSON.parse(JSON.stringify(options.whitelist || whitelist));\n\n    // \"allow\" enables real Date.now(), anything else gets NaN\n    // (it'd be nice to allow a fixed numeric value, but too hard to\n    // implement right now)\n    if (options.dateNowMode !== 'allow') {\n      shims.push(`(${tameDate})();`);\n    }\n\n    if (options.mathRandomMode !== 'allow') {\n      shims.push(`(${tameMath})();`);\n    }\n\n    // Intl is disabled entirely for now, deleted by removeProperties. If we\n    // want to bring it back (under the control of this option), we'll need\n    // to add it to the whitelist too, as well as taming it properly.\n    if (options.intlMode !== 'allow') {\n      // this shim also disables Object.prototype.toLocaleString\n      shims.push(`(${tameIntl})();`);\n    }\n\n    if (options.errorStackMode !== 'allow') {\n      shims.push(`(${tameError})();`);\n    } else {\n      // if removeProperties cleans these things from Error, v8 won't provide\n      // stack traces or even toString on exceptions, and then Node.js prints\n      // uncaught exceptions as \"undefined\" instead of a type/message/stack.\n      // So if we're allowing stack traces, make sure the whitelist is\n      // augmented to include them.\n      wl.namedIntrinsics.Error.captureStackTrace = true;\n      wl.namedIntrinsics.Error.stackTraceLimit = true;\n      wl.namedIntrinsics.Error.prepareStackTrace = true;\n    }\n\n    if (options.regexpMode !== 'allow') {\n      shims.push(`(${tameRegExp})();`);\n    }\n\n    // The getAnonIntrinsics function might be renamed by e.g. rollup. The\n    // removeProperties() function references it by name, so we need to force\n    // it to have a specific name.\n    const removeProp = `const getAnonIntrinsics = (${getAnonIntrinsics$1});\n               (${removeProperties})(this, ${JSON.stringify(wl)})`;\n    shims.push(removeProp);\n\n    const r = Realm.makeRootRealm({ shims });\n\n    // Build a harden() with an empty fringe. It will be populated later when\n    // we call harden(allIntrinsics).\n    const makeHardenerSrc = `(${makeHardener})`;\n    const harden = r.evaluate(makeHardenerSrc)(\n      undefined,\n      options.hardenerOptions,\n    );\n\n    const b = r.evaluate(creatorStrings);\n    b.createSESInThisRealm(r.global, creatorStrings, r);\n    // b.removeProperties(r.global);\n\n    if (options.consoleMode === 'allow') {\n      const s = `(${makeConsole})`;\n      r.global.console = r.evaluate(s)(console);\n    }\n\n    // Finally freeze all the primordials, and the global object. This must\n    // be the last thing we do that modifies the Realm's globals.\n    const anonIntrinsics = r.evaluate(`(${getAnonIntrinsics$1})`)(r.global);\n    const allIntrinsics = r.evaluate(`(${getAllPrimordials})`)(\n      r.global,\n      anonIntrinsics,\n    );\n    harden(allIntrinsics);\n\n    // build the makeRequire helper, glue it to the new Realm\n    r.makeRequire = harden(r.evaluate(`(${makeMakeRequire})`)(r, harden));\n\n    return r;\n  }\n  const SES = {\n    makeSESRootRealm,\n  };\n\n  return SES;\n}\n\n// Copyright (C) 2018 Agoric\n\nconst creatorStrings = \"(function (exports) {\\n  'use strict';\\n\\n  // Adapted from SES/Caja - Copyright (C) 2011 Google Inc.\\n  // Copyright (C) 2018 Agoric\\n\\n  // Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\n  // you may not use this file except in compliance with the License.\\n  // You may obtain a copy of the License at\\n  //\\n  // http://www.apache.org/licenses/LICENSE-2.0\\n  //\\n  // Unless required by applicable law or agreed to in writing, software\\n  // distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  // See the License for the specific language governing permissions and\\n  // limitations under the License.\\n\\n  // based upon:\\n  // https://github.com/google/caja/blob/master/src/com/google/caja/ses/startSES.js\\n  // https://github.com/google/caja/blob/master/src/com/google/caja/ses/repairES5.js\\n  // then copied from proposal-frozen-realms deep-freeze.js\\n  // then copied from SES/src/bundle/deepFreeze.js\\n\\n  /**\\n   * @typedef HardenerOptions\\n   * @type {object}\\n   * @property {WeakSet=} fringeSet WeakSet to use for the fringeSet\\n   * @property {Function=} naivePrepareObject Call with object before hardening\\n   */\\n\\n  /**\\n   * Create a `harden` function.\\n   *\\n   * @param {Iterable} initialFringe Objects considered already hardened\\n   * @param {HardenerOptions=} options Options for creation\\n   */\\n  function makeHardener(initialFringe, options = {}) {\\n    const { freeze, getOwnPropertyDescriptors, getPrototypeOf } = Object;\\n    const { ownKeys } = Reflect;\\n\\n    // Objects that we won't freeze, either because we've frozen them already,\\n    // or they were one of the initial roots (terminals). These objects form\\n    // the \\\"fringe\\\" of the hardened object graph.\\n    let { fringeSet } = options;\\n    if (fringeSet) {\\n      if (\\n        typeof fringeSet.add !== 'function' ||\\n        typeof fringeSet.has !== 'function'\\n      ) {\\n        throw new TypeError(\\n          `options.fringeSet must have add() and has() methods`,\\n        );\\n      }\\n\\n      // Populate the supplied fringeSet with our initialFringe.\\n      if (initialFringe) {\\n        for (const fringe of initialFringe) {\\n          fringeSet.add(fringe);\\n        }\\n      }\\n    } else {\\n      // Use a new empty fringe.\\n      fringeSet = new WeakSet(initialFringe);\\n    }\\n\\n    const naivePrepareObject = options && options.naivePrepareObject;\\n\\n    function harden(root) {\\n      const toFreeze = new Set();\\n      const prototypes = new Map();\\n      const paths = new WeakMap();\\n\\n      // If val is something we should be freezing but aren't yet,\\n      // add it to toFreeze.\\n      function enqueue(val, path) {\\n        if (Object(val) !== val) {\\n          // ignore primitives\\n          return;\\n        }\\n        const type = typeof val;\\n        if (type !== 'object' && type !== 'function') {\\n          // future proof: break until someone figures out what it should do\\n          throw new TypeError(`Unexpected typeof: ${type}`);\\n        }\\n        if (fringeSet.has(val) || toFreeze.has(val)) {\\n          // Ignore if this is an exit, or we've already visited it\\n          return;\\n        }\\n        // console.log(`adding ${val} to toFreeze`, val);\\n        toFreeze.add(val);\\n        paths.set(val, path);\\n      }\\n\\n      function freezeAndTraverse(obj) {\\n        // Apply the naive preparer if they specified one.\\n        if (naivePrepareObject) {\\n          naivePrepareObject(obj);\\n        }\\n\\n        // Now freeze the object to ensure reactive\\n        // objects such as proxies won't add properties\\n        // during traversal, before they get frozen.\\n\\n        // Object are verified before being enqueued,\\n        // therefore this is a valid candidate.\\n        // Throws if this fails (strict mode).\\n        freeze(obj);\\n\\n        // we rely upon certain commitments of Object.freeze and proxies here\\n\\n        // get stable/immutable outbound links before a Proxy has a chance to do\\n        // something sneaky.\\n        const proto = getPrototypeOf(obj);\\n        const descs = getOwnPropertyDescriptors(obj);\\n        const path = paths.get(obj) || 'unknown';\\n\\n        // console.log(`adding ${proto} to prototypes under ${path}`);\\n        if (proto !== null && !prototypes.has(proto)) {\\n          prototypes.set(proto, path);\\n          paths.set(proto, `${path}.__proto__`);\\n        }\\n\\n        ownKeys(descs).forEach(name => {\\n          const pathname = `${path}.${String(name)}`;\\n          // todo uncurried form\\n          // todo: getOwnPropertyDescriptors is guaranteed to return well-formed\\n          // descriptors, but they still inherit from Object.prototype. If\\n          // someone has poisoned Object.prototype to add 'value' or 'get'\\n          // properties, then a simple 'if (\\\"value\\\" in desc)' or 'desc.value'\\n          // test could be confused. We use hasOwnProperty to be sure about\\n          // whether 'value' is present or not, which tells us for sure that this\\n          // is a data property.\\n          const desc = descs[name];\\n          if ('value' in desc) {\\n            // todo uncurried form\\n            enqueue(desc.value, `${pathname}`);\\n          } else {\\n            enqueue(desc.get, `${pathname}(get)`);\\n            enqueue(desc.set, `${pathname}(set)`);\\n          }\\n        });\\n      }\\n\\n      function dequeue() {\\n        // New values added before forEach() has finished will be visited.\\n        toFreeze.forEach(freezeAndTraverse); // todo curried forEach\\n      }\\n\\n      function checkPrototypes() {\\n        prototypes.forEach((path, p) => {\\n          if (!(toFreeze.has(p) || fringeSet.has(p))) {\\n            // all reachable properties have already been frozen by this point\\n            let msg;\\n            try {\\n              msg = `prototype ${p} of ${path} is not already in the fringeSet`;\\n            } catch (e) {\\n              // `${(async _=>_).__proto__}` fails in most engines\\n              msg =\\n                'a prototype of something is not already in the fringeset (and .toString failed)';\\n              try {\\n                console.log(msg);\\n                console.log('the prototype:', p);\\n                console.log('of something:', path);\\n              } catch (_e) {\\n                // console.log might be missing in restrictive SES realms\\n              }\\n            }\\n            throw new TypeError(msg);\\n          }\\n        });\\n      }\\n\\n      function commit() {\\n        // todo curried forEach\\n        // we capture the real WeakSet.prototype.add above, in case someone\\n        // changes it. The two-argument form of forEach passes the second\\n        // argument as the 'this' binding, so we add to the correct set.\\n        toFreeze.forEach(fringeSet.add, fringeSet);\\n      }\\n\\n      enqueue(root);\\n      dequeue();\\n      // console.log(\\\"fringeSet\\\", fringeSet);\\n      // console.log(\\\"prototype set:\\\", prototypes);\\n      // console.log(\\\"toFreeze set:\\\", toFreeze);\\n      checkPrototypes();\\n      commit();\\n\\n      return root;\\n    }\\n\\n    return harden;\\n  }\\n\\n  function tameDate() {\\n    const unsafeDate = Date;\\n    // Date(anything) gives a string with the current time\\n    // new Date(x) coerces x into a number and then returns a Date\\n    // new Date() returns the current time, as a Date object\\n    // new Date(undefined) returns a Date object which stringifies to 'Invalid Date'\\n\\n    const newDateConstructor = function Date(...args) {\\n      if (new.target === undefined) {\\n        // we were not called as a constructor\\n        // this would normally return a string with the current time\\n        return 'Invalid Date';\\n      }\\n      // constructor behavior: if we get arguments, we can safely pass them through\\n      if (args.length > 0) {\\n        return Reflect.construct(unsafeDate, args, new.target);\\n        // todo: test that our constructor can still be subclassed\\n      }\\n      // no arguments: return a Date object, but invalid\\n      return Reflect.construct(unsafeDate, [NaN], new.target);\\n    };\\n\\n    Object.defineProperties(\\n      newDateConstructor,\\n      Object.getOwnPropertyDescriptors(unsafeDate),\\n    );\\n    // that will copy the .prototype too, so this next line is unnecessary\\n    // newDateConstructor.prototype = unsafeDate.prototype;\\n    unsafeDate.prototype.constructor = newDateConstructor;\\n    // disable Date.now\\n    newDateConstructor.now = () => NaN;\\n\\n    Date = newDateConstructor; // eslint-disable-line no-global-assign\\n  }\\n\\n  function tameMath() {\\n    // Math.random = () => 4; // https://www.xkcd.com/221\\n    Math.random = () => {\\n      throw Error('disabled');\\n    };\\n  }\\n\\n  /* global Intl */\\n\\n  function tameIntl() {\\n    // todo: somehow fix these. These almost certainly don't enable the reading\\n    // of side-channels, but we want things to be deterministic across\\n    // runtimes. Best bet is to just disallow calling these functions without\\n    // an explicit locale name.\\n\\n    // the whitelist may have deleted Intl entirely, so tolerate that\\n    if (typeof Intl !== 'undefined') {\\n      Intl.DateTimeFormat = () => {\\n        throw Error('disabled');\\n      };\\n      Intl.NumberFormat = () => {\\n        throw Error('disabled');\\n      };\\n      Intl.getCanonicalLocales = () => {\\n        throw Error('disabled');\\n      };\\n    }\\n    // eslint-disable-next-line no-extend-native\\n    Object.prototype.toLocaleString = () => {\\n      throw new Error('toLocaleString suppressed');\\n    };\\n  }\\n\\n  function tameError() {\\n    if (!Object.isExtensible(Error)) {\\n      throw Error('huh Error is not extensible');\\n    }\\n    /* this worked back when we were running it on a global, but stopped\\n    working when we turned it into a shim */\\n    /*\\n    Object.defineProperty(Error.prototype, \\\"stack\\\",\\n                          { get() { return 'stack suppressed'; } });\\n    */\\n    delete Error.captureStackTrace;\\n    if ('captureStackTrace' in Error) {\\n      throw Error('hey we could not remove Error.captureStackTrace');\\n    }\\n\\n    // we might do this in the future\\n    /*\\n    const unsafeError = Error;\\n    const newErrorConstructor = function Error(...args) {\\n      return Reflect.construct(unsafeError, args, new.target);\\n    };\\n\\n    newErrorConstructor.prototype = unsafeError.prototype;\\n    newErrorConstructor.prototype.construct = newErrorConstructor;\\n\\n    Error = newErrorConstructor;\\n\\n    EvalError.__proto__ = newErrorConstructor;\\n    RangeError.__proto__ = newErrorConstructor;\\n    ReferenceError.__proto__ = newErrorConstructor;\\n    SyntaxError.__proto__ = newErrorConstructor;\\n    TypeError.__proto__ = newErrorConstructor;\\n    URIError.__proto__ = newErrorConstructor;\\n    */\\n  }\\n\\n  function tameRegExp() {\\n    delete RegExp.prototype.compile;\\n    if ('compile' in RegExp.prototype) {\\n      throw Error('hey we could not remove RegExp.prototype.compile');\\n    }\\n\\n    // We want to delete RegExp.$1, as well as any other surprising properties.\\n    // On some engines we can't just do 'delete RegExp.$1'.\\n    const unsafeRegExp = RegExp;\\n\\n    // eslint-disable-next-line no-global-assign\\n    RegExp = function RegExp(...args) {\\n      return Reflect.construct(unsafeRegExp, args, new.target);\\n    };\\n    RegExp.prototype = unsafeRegExp.prototype;\\n    unsafeRegExp.prototype.constructor = RegExp;\\n\\n    if ('$1' in RegExp) {\\n      throw Error('hey we could not remove RegExp.$1');\\n    }\\n  }\\n\\n  /* global getAnonIntrinsics */\\n\\n  // Copyright (C) 2011 Google Inc.\\n  // Copyright (C) 2018 Agoric\\n  //\\n  // Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\n  // you may not use this file except in compliance with the License.\\n  // You may obtain a copy of the License at\\n  //\\n  // http://www.apache.org/licenses/LICENSE-2.0\\n  //\\n  // Unless required by applicable law or agreed to in writing, software\\n  // distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  // See the License for the specific language governing permissions and\\n  // limitations under the License.\\n\\n  /* This is evaluated in an environment in which getAnonIntrinsics() is\\n     already defined (by prepending the definition of getAnonIntrinsics to the\\n     stringified removeProperties()), hence we don't use the following\\n     import */\\n  // import { getAnonIntrinsics } from './anonIntrinsics.js';\\n\\n  function removeProperties(global, whitelist) {\\n    // walk global object, test against whitelist, delete\\n\\n    const uncurryThis = fn => (thisArg, ...args) =>\\n      Reflect.apply(fn, thisArg, args);\\n    const {\\n      getOwnPropertyDescriptor: gopd,\\n      getOwnPropertyNames: gopn,\\n      keys,\\n    } = Object;\\n    const cleaning = new WeakMap();\\n    const getProto = Object.getPrototypeOf;\\n    const hop = uncurryThis(Object.prototype.hasOwnProperty);\\n\\n    const whiteTable = new WeakMap();\\n\\n    function addToWhiteTable(rootValue, rootPermit) {\\n      /**\\n       * The whiteTable should map from each path-accessible primordial\\n       * object to the permit object that describes how it should be\\n       * cleaned.\\n       *\\n       * We initialize the whiteTable only so that {@code getPermit} can\\n       * process \\\"*\\\" inheritance using the whitelist, by walking actual\\n       * inheritance chains.\\n       */\\n      const whitelistSymbols = [true, false, '*', 'maybeAccessor'];\\n      function register(value, permit) {\\n        if (value !== Object(value)) {\\n          return;\\n        }\\n        if (typeof permit !== 'object') {\\n          if (whitelistSymbols.indexOf(permit) < 0) {\\n            throw new Error(\\n              `syntax error in whitelist; unexpected value: ${permit}`,\\n            );\\n          }\\n          return;\\n        }\\n        if (whiteTable.has(value)) {\\n          throw new Error('primordial reachable through multiple paths');\\n        }\\n        whiteTable.set(value, permit);\\n        keys(permit).forEach(name => {\\n          // Use gopd to avoid invoking an accessor property.\\n          // Accessor properties for which permit !== 'maybeAccessor'\\n          // are caught later by clean().\\n          const desc = gopd(value, name);\\n          if (desc) {\\n            register(desc.value, permit[name]);\\n          }\\n        });\\n      }\\n      register(rootValue, rootPermit);\\n    }\\n\\n    /**\\n     * Should the property named {@code name} be whitelisted on the\\n     * {@code base} object, and if so, with what Permit?\\n     *\\n     * <p>If it should be permitted, return the Permit (where Permit =\\n     * true | \\\"maybeAccessor\\\" | \\\"*\\\" | Record(Permit)), all of which are\\n     * truthy. If it should not be permitted, return false.\\n     */\\n    function getPermit(base, name) {\\n      let permit = whiteTable.get(base);\\n      if (permit) {\\n        if (hop(permit, name)) {\\n          return permit[name];\\n        }\\n      }\\n      // eslint-disable-next-line no-constant-condition\\n      while (true) {\\n        base = getProto(base); // eslint-disable-line no-param-reassign\\n        if (base === null) {\\n          return false;\\n        }\\n        permit = whiteTable.get(base);\\n        if (permit && hop(permit, name)) {\\n          const result = permit[name];\\n          if (result === '*') {\\n            return result;\\n          }\\n          return false;\\n        }\\n      }\\n    }\\n\\n    /**\\n     * Removes all non-whitelisted properties found by recursively and\\n     * reflectively walking own property chains.\\n     *\\n     * <p>Inherited properties are not checked, because we require that\\n     * inherited-from objects are otherwise reachable by this traversal.\\n     */\\n    function clean(value, prefix, num) {\\n      if (value !== Object(value)) {\\n        return;\\n      }\\n      if (cleaning.get(value)) {\\n        return;\\n      }\\n\\n      const proto = getProto(value);\\n      if (proto !== null && !whiteTable.has(proto)) {\\n        // reportItemProblem(rootReports, ses.severities.NOT_ISOLATED,\\n        //                  'unexpected intrinsic', prefix + '.__proto__');\\n        throw new Error(`unexpected intrinsic ${prefix}.__proto__`);\\n      }\\n\\n      cleaning.set(value, true);\\n      gopn(value).forEach(name => {\\n        const path = prefix + (prefix ? '.' : '') + name;\\n        const p = getPermit(value, name);\\n        if (p) {\\n          const desc = gopd(value, name);\\n          if (hop(desc, 'value')) {\\n            // Is a data property\\n            const subValue = desc.value;\\n            clean(subValue, path, num + 1);\\n          } else if (p !== 'maybeAccessor') {\\n            // We are not saying that it is safe for the prop to be\\n            // unexpectedly an accessor; rather, it will be deleted\\n            // and thus made safe.\\n            // reportProperty(ses.severities.SAFE_SPEC_VIOLATION,\\n            //               'Not a data property', path);\\n            delete value[name]; // eslint-disable-line no-param-reassign\\n          } else {\\n            clean(desc.get, `${path}<getter>`, num + 1);\\n            clean(desc.set, `${path}<setter>`, num + 1);\\n          }\\n        } else {\\n          delete value[name]; // eslint-disable-line no-param-reassign\\n        }\\n      });\\n    }\\n\\n    addToWhiteTable(global, whitelist.namedIntrinsics);\\n    const intr = getAnonIntrinsics(global);\\n    addToWhiteTable(intr, whitelist.anonIntrinsics);\\n    clean(global, '', 0);\\n  }\\n\\n  // Copyright (C) 2011 Google Inc.\\n  // Copyright (C) 2018 Agoric\\n  //\\n  // Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\n  // you may not use this file except in compliance with the License.\\n  // You may obtain a copy of the License at\\n  //\\n  // https://www.apache.org/licenses/LICENSE-2.0\\n  //\\n  // Unless required by applicable law or agreed to in writing, software\\n  // distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  // See the License for the specific language governing permissions and\\n  // limitations under the License.\\n\\n  // TODO(erights): We should test for\\n  // We now have a reason to omit Proxy from the whitelist.\\n  // The makeBrandTester in repairES5 uses Allen's trick at\\n  // https://esdiscuss.org/topic/tostringtag-spoofing-for-null-and-undefined#content-59\\n  // , but testing reveals that, on FF 35.0.1, a proxy on an exotic\\n  // object X will pass this brand test when X will. This is fixed as of\\n  // FF Nightly 38.0a1.\\n\\n  /**\\n   * <p>Qualifying platforms generally include all JavaScript platforms\\n   * shown on <a href=\\\"http://kangax.github.com/es5-compat-table/\\\"\\n   * >ECMAScript 5 compatibility table</a> that implement {@code\\n   * Object.getOwnPropertyNames}. At the time of this writing,\\n   * qualifying browsers already include the latest released versions of\\n   * Internet Explorer (9), Firefox (4), Chrome (11), and Safari\\n   * (5.0.5), their corresponding standalone (e.g., server-side) JavaScript\\n   * engines, Rhino 1.73, and BESEN.\\n   *\\n   * <p>On such not-quite-ES5 platforms, some elements of these\\n   * emulations may lose SES safety, as enumerated in the comment on\\n   * each problem record in the {@code baseProblems} and {@code\\n   * supportedProblems} array below. The platform must at least provide\\n   * {@code Object.getOwnPropertyNames}, because it cannot reasonably be\\n   * emulated.\\n   *\\n   * <p>This file is useful by itself, as it has no dependencies on the\\n   * rest of SES. It creates no new global bindings, but merely repairs\\n   * standard globals or standard elements reachable from standard\\n   * globals. If the future-standard {@code WeakMap} global is present,\\n   * as it is currently on FF7.0a1, then it will repair it in place. The\\n   * one non-standard element that this file uses is {@code console} if\\n   * present, in order to report the repairs it found necessary, in\\n   * which case we use its {@code log, info, warn}, and {@code error}\\n   * methods. If {@code console.log} is absent, then this file performs\\n   * its repairs silently.\\n   *\\n   * <p>Generally, this file should be run as the first script in a\\n   * JavaScript context (i.e. a browser frame), as it relies on other\\n   * primordial objects and methods not yet being perturbed.\\n   *\\n   * <p>TODO(erights): This file tries to protect itself from some\\n   * post-initialization perturbation by stashing some of the\\n   * primordials it needs for later use, but this attempt is currently\\n   * incomplete. We need to revisit this when we support Confined-ES5,\\n   * as a variant of SES in which the primordials are not frozen. See\\n   * previous failed attempt at <a\\n   * href=\\\"https://codereview.appspot.com/5278046/\\\" >Speeds up\\n   * WeakMap. Preparing to support unfrozen primordials.</a>. From\\n   * analysis of this failed attempt, it seems that the only practical\\n   * way to support CES is by use of two frames, where most of initSES\\n   * runs in a SES frame, and so can avoid worrying about most of these\\n   * perturbations.\\n   */\\n  function getAnonIntrinsics$1(global) {\\n\\n    const gopd = Object.getOwnPropertyDescriptor;\\n    const getProto = Object.getPrototypeOf;\\n\\n    // ////////////// Undeniables and Intrinsics //////////////\\n\\n    /**\\n     * The undeniables are the primordial objects which are ambiently\\n     * reachable via compositions of strict syntax, primitive wrapping\\n     * (new Object(x)), and prototype navigation (the equivalent of\\n     * Object.getPrototypeOf(x) or x.__proto__). Although we could in\\n     * theory monkey patch primitive wrapping or prototype navigation,\\n     * we won't. Hence, without parsing, the following are undeniable no\\n     * matter what <i>other</i> monkey patching we do to the primordial\\n     * environment.\\n     */\\n\\n    // The first element of each undeniableTuple is a string used to\\n    // name the undeniable object for reporting purposes. It has no\\n    // other programmatic use.\\n    //\\n    // The second element of each undeniableTuple should be the\\n    // undeniable itself.\\n    //\\n    // The optional third element of the undeniableTuple, if present,\\n    // should be an example of syntax, rather than use of a monkey\\n    // patchable API, evaluating to a value from which the undeniable\\n    // object in the second element can be reached by only the\\n    // following steps:\\n    // If the value is primitve, convert to an Object wrapper.\\n    // Is the resulting object either the undeniable object, or does\\n    // it inherit directly from the undeniable object?\\n\\n    function* aStrictGenerator() {} // eslint-disable-line no-empty-function\\n    const Generator = getProto(aStrictGenerator);\\n    async function* aStrictAsyncGenerator() {} // eslint-disable-line no-empty-function\\n    const AsyncGenerator = getProto(aStrictAsyncGenerator);\\n    async function aStrictAsyncFunction() {} // eslint-disable-line no-empty-function\\n    const AsyncFunctionPrototype = getProto(aStrictAsyncFunction);\\n\\n    // TODO: this is dead code, but could be useful: make this the\\n    // 'undeniables' object available via some API.\\n\\n    const undeniableTuples = [\\n      ['Object.prototype', Object.prototype, {}],\\n      ['Function.prototype', Function.prototype, function foo() {}],\\n      ['Array.prototype', Array.prototype, []],\\n      ['RegExp.prototype', RegExp.prototype, /x/],\\n      ['Boolean.prototype', Boolean.prototype, true],\\n      ['Number.prototype', Number.prototype, 1],\\n      ['String.prototype', String.prototype, 'x'],\\n      ['%Generator%', Generator, aStrictGenerator],\\n      ['%AsyncGenerator%', AsyncGenerator, aStrictAsyncGenerator],\\n      ['%AsyncFunction%', AsyncFunctionPrototype, aStrictAsyncFunction],\\n    ];\\n\\n    undeniableTuples.forEach(tuple => {\\n      const name = tuple[0];\\n      const undeniable = tuple[1];\\n      let start = tuple[2];\\n      if (start === undefined) {\\n        return;\\n      }\\n      start = Object(start);\\n      if (undeniable === start) {\\n        return;\\n      }\\n      if (undeniable === getProto(start)) {\\n        return;\\n      }\\n      throw new Error(`Unexpected undeniable: ${undeniable}`);\\n    });\\n\\n    function registerIteratorProtos(registery, base, name) {\\n      const iteratorSym =\\n        (global.Symbol && global.Symbol.iterator) || '@@iterator'; // used instead of a symbol on FF35\\n\\n      if (base[iteratorSym]) {\\n        const anIter = base[iteratorSym]();\\n        const anIteratorPrototype = getProto(anIter);\\n        registery[name] = anIteratorPrototype; // eslint-disable-line no-param-reassign\\n        const anIterProtoBase = getProto(anIteratorPrototype);\\n        if (anIterProtoBase !== Object.prototype) {\\n          if (!registery.IteratorPrototype) {\\n            if (getProto(anIterProtoBase) !== Object.prototype) {\\n              throw new Error(\\n                '%IteratorPrototype%.__proto__ was not Object.prototype',\\n              );\\n            }\\n            registery.IteratorPrototype = anIterProtoBase; // eslint-disable-line no-param-reassign\\n          } else if (registery.IteratorPrototype !== anIterProtoBase) {\\n            throw new Error(`unexpected %${name}%.__proto__`);\\n          }\\n        }\\n      }\\n    }\\n\\n    /**\\n     * Get the intrinsics not otherwise reachable by named own property\\n     * traversal. See\\n     * https://people.mozilla.org/~jorendorff/es6-draft.html#sec-well-known-intrinsic-objects\\n     * and the instrinsics section of whitelist.js\\n     *\\n     * <p>Unlike getUndeniables(), the result of sampleAnonIntrinsics()\\n     * does depend on the current state of the primordials, so we must\\n     * run this again after all other relevant monkey patching is done,\\n     * in order to properly initialize cajaVM.intrinsics\\n     */\\n\\n    // TODO: we can probably unwrap this into the outer function, and stop\\n    // using a separately named 'sampleAnonIntrinsics'\\n    function sampleAnonIntrinsics() {\\n      const result = {};\\n\\n      // If there are still other ThrowTypeError objects left after\\n      // noFuncPoison-ing, this should be caught by\\n      // test_THROWTYPEERROR_NOT_UNIQUE below, so we assume here that\\n      // this is the only surviving ThrowTypeError intrinsic.\\n      // eslint-disable-next-line prefer-rest-params\\n      result.ThrowTypeError = gopd(arguments, 'callee').get;\\n\\n      // Get the ES6 %ArrayIteratorPrototype%,\\n      // %StringIteratorPrototype%, %MapIteratorPrototype%,\\n      // %SetIteratorPrototype% and %IteratorPrototype% intrinsics, if\\n      // present.\\n      registerIteratorProtos(result, [], 'ArrayIteratorPrototype');\\n      registerIteratorProtos(result, '', 'StringIteratorPrototype');\\n      if (typeof Map === 'function') {\\n        registerIteratorProtos(result, new Map(), 'MapIteratorPrototype');\\n      }\\n      if (typeof Set === 'function') {\\n        registerIteratorProtos(result, new Set(), 'SetIteratorPrototype');\\n      }\\n\\n      // Get the ES6 %GeneratorFunction% intrinsic, if present.\\n      if (getProto(Generator) !== Function.prototype) {\\n        throw new Error('Generator.__proto__ was not Function.prototype');\\n      }\\n      const GeneratorFunction = Generator.constructor;\\n      if (getProto(GeneratorFunction) !== Function.prototype.constructor) {\\n        throw new Error(\\n          'GeneratorFunction.__proto__ was not Function.prototype.constructor',\\n        );\\n      }\\n      result.GeneratorFunction = GeneratorFunction;\\n      const genProtoBase = getProto(Generator.prototype);\\n      if (genProtoBase !== result.IteratorPrototype) {\\n        throw new Error('Unexpected Generator.prototype.__proto__');\\n      }\\n\\n      // Get the ES6 %AsyncGeneratorFunction% intrinsic, if present.\\n      if (getProto(AsyncGenerator) !== Function.prototype) {\\n        throw new Error('AsyncGenerator.__proto__ was not Function.prototype');\\n      }\\n      const AsyncGeneratorFunction = AsyncGenerator.constructor;\\n      if (getProto(AsyncGeneratorFunction) !== Function.prototype.constructor) {\\n        throw new Error(\\n          'AsyncGeneratorFunction.__proto__ was not Function.prototype.constructor',\\n        );\\n      }\\n      result.AsyncGeneratorFunction = AsyncGeneratorFunction;\\n      const AsyncGeneratorPrototype = AsyncGenerator.prototype;\\n      result.AsyncIteratorPrototype = getProto(AsyncGeneratorPrototype);\\n      // it appears that the only way to get an AsyncIteratorPrototype is\\n      // through this getProto() process, so there's nothing to check it\\n      // against\\n      if (getProto(result.AsyncIteratorPrototype) !== Object.prototype) {\\n        throw new Error(\\n          'AsyncIteratorPrototype.__proto__ was not Object.prototype',\\n        );\\n      }\\n\\n      // Get the ES6 %AsyncFunction% intrinsic, if present.\\n      if (getProto(AsyncFunctionPrototype) !== Function.prototype) {\\n        throw new Error(\\n          'AsyncFunctionPrototype.__proto__ was not Function.prototype',\\n        );\\n      }\\n      const AsyncFunction = AsyncFunctionPrototype.constructor;\\n      if (getProto(AsyncFunction) !== Function.prototype.constructor) {\\n        throw new Error(\\n          'AsyncFunction.__proto__ was not Function.prototype.constructor',\\n        );\\n      }\\n      result.AsyncFunction = AsyncFunction;\\n\\n      // Get the ES6 %TypedArray% intrinsic, if present.\\n      (function getTypedArray() {\\n        if (!global.Float32Array) {\\n          return;\\n        }\\n        const TypedArray = getProto(global.Float32Array);\\n        if (TypedArray === Function.prototype) {\\n          return;\\n        }\\n        if (getProto(TypedArray) !== Function.prototype) {\\n          // http://bespin.cz/~ondras/html/classv8_1_1ArrayBufferView.html\\n          // has me worried that someone might make such an intermediate\\n          // object visible.\\n          throw new Error('TypedArray.__proto__ was not Function.prototype');\\n        }\\n        result.TypedArray = TypedArray;\\n      })();\\n\\n      Object.keys(result).forEach(name => {\\n        if (result[name] === undefined) {\\n          throw new Error(`Malformed intrinsic: ${name}`);\\n        }\\n      });\\n\\n      return result;\\n    }\\n\\n    return sampleAnonIntrinsics();\\n  }\\n\\n  function getAllPrimordials(global, anonIntrinsics) {\\n\\n    const root = {\\n      global, // global plus all the namedIntrinsics\\n      anonIntrinsics,\\n    };\\n    // todo: re-examine exactly which \\\"global\\\" we're freezing\\n\\n    return root;\\n  }\\n\\n  // Copyright (C) 2011 Google Inc.\\n  // Copyright (C) 2018 Agoric\\n  //\\n  // Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\n  // you may not use this file except in compliance with the License.\\n  // You may obtain a copy of the License at\\n  //\\n  // http://www.apache.org/licenses/LICENSE-2.0\\n  //\\n  // Unless required by applicable law or agreed to in writing, software\\n  // distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n  // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n  // See the License for the specific language governing permissions and\\n  // limitations under the License.\\n\\n  /**\\n   * @fileoverview Exports {@code ses.whitelist}, a recursively defined\\n   * JSON record enumerating all the naming paths in the ES5.1 spec,\\n   * those de-facto extensions that we judge to be safe, and SES and\\n   * Dr. SES extensions provided by the SES runtime.\\n   *\\n   * <p>Assumes only ES3. Compatible with ES5, ES5-strict, or\\n   * anticipated ES6.\\n   *\\n   * //provides ses.whitelist\\n   * @author Mark S. Miller,\\n   * @overrides ses, whitelistModule\\n   */\\n\\n  /**\\n   * <p>Each JSON record enumerates the disposition of the properties on\\n   * some corresponding primordial object, with the root record\\n   * representing the global object. For each such record, the values\\n   * associated with its property names can be\\n   * <ul>\\n   * <li>Another record, in which case this property is simply\\n   *     whitelisted and that next record represents the disposition of\\n   *     the object which is its value. For example, {@code \\\"Object\\\"}\\n   *     leads to another record explaining what properties {@code\\n   *     \\\"Object\\\"} may have and how each such property, if present,\\n   *     and its value should be tamed.\\n   * <li>true, in which case this property is simply whitelisted. The\\n   *     value associated with that property is still traversed and\\n   *     tamed, but only according to the taming of the objects that\\n   *     object inherits from. For example, {@code \\\"Object.freeze\\\"} leads\\n   *     to true, meaning that the {@code \\\"freeze\\\"} property of {@code\\n   *     Object} should be whitelisted and the value of the property (a\\n   *     function) should be further tamed only according to the\\n   *     markings of the other objects it inherits from, like {@code\\n   *     \\\"Function.prototype\\\"} and {@code \\\"Object.prototype\\\").\\n   *     If the property is an accessor property, it is not\\n   *     whitelisted (as invoking an accessor might not be meaningful,\\n   *     yet the accessor might return a value needing taming).\\n   * <li>\\\"maybeAccessor\\\", in which case this accessor property is simply\\n   *     whitelisted and its getter and/or setter are tamed according to\\n   *     inheritance. If the property is not an accessor property, its\\n   *     value is tamed according to inheritance.\\n   * <li>\\\"*\\\", in which case this property on this object is whitelisted,\\n   *     as is this property as inherited by all objects that inherit\\n   *     from this object. The values associated with all such properties\\n   *     are still traversed and tamed, but only according to the taming\\n   *     of the objects that object inherits from. For example, {@code\\n   *     \\\"Object.prototype.constructor\\\"} leads to \\\"*\\\", meaning that we\\n   *     whitelist the {@code \\\"constructor\\\"} property on {@code\\n   *     Object.prototype} and on every object that inherits from {@code\\n   *     Object.prototype} that does not have a conflicting mark. Each\\n   *     of these is tamed as if with true, so that the value of the\\n   *     property is further tamed according to what other objects it\\n   *     inherits from.\\n   * <li>false, which suppresses permission inherited via \\\"*\\\".\\n   * </ul>\\n   *\\n   * <p>TODO: We want to do for constructor: something weaker than '*',\\n   * but rather more like what we do for [[Prototype]] links, which is\\n   * that it is whitelisted only if it points at an object which is\\n   * otherwise reachable by a whitelisted path.\\n   *\\n   * <p>The members of the whitelist are either\\n   * <ul>\\n   * <li>(uncommented) defined by the ES5.1 normative standard text,\\n   * <li>(questionable) provides a source of non-determinism, in\\n   *     violation of pure object-capability rules, but allowed anyway\\n   *     since we've given up on restricting JavaScript to a\\n   *     deterministic subset.\\n   * <li>(ES5 Appendix B) common elements of de facto JavaScript\\n   *     described by the non-normative Appendix B.\\n   * <li>(Harmless whatwg) extensions documented at\\n   *     <a href=\\\"http://wiki.whatwg.org/wiki/Web_ECMAScript\\\"\\n   *     >http://wiki.whatwg.org/wiki/Web_ECMAScript</a> that seem to be\\n   *     harmless. Note that the RegExp constructor extensions on that\\n   *     page are <b>not harmless</b> and so must not be whitelisted.\\n   * <li>(ES-Harmony proposal) accepted as \\\"proposal\\\" status for\\n   *     EcmaScript-Harmony.\\n   * </ul>\\n   *\\n   * <p>With the above encoding, there are some sensible whitelists we\\n   * cannot express, such as marking a property both with \\\"*\\\" and a JSON\\n   * record. This is an expedient decision based only on not having\\n   * encountered such a need. Should we need this extra expressiveness,\\n   * we'll need to refactor to enable a different encoding.\\n   *\\n   * <p>We factor out {@code true} into the variable {@code t} just to\\n   * get a bit better compression from simple minifiers.\\n   */\\n\\n  const t = true;\\n  const j = true; // included in the Jessie runtime\\n\\n  let TypedArrayWhitelist; // defined and used below\\n\\n  var whitelist = {\\n    // The accessible intrinsics which are not reachable by own\\n    // property name traversal are listed here so that they are\\n    // processed by the whitelist, although this also makes them\\n    // accessible by this path.  See\\n    // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-well-known-intrinsic-objects\\n    // Of these, ThrowTypeError is the only one from ES5. All the\\n    // rest were introduced in ES6.\\n    anonIntrinsics: {\\n      ThrowTypeError: {},\\n      IteratorPrototype: {\\n        // 25.1\\n        // Technically, for SES-on-ES5, we should not need to\\n        // whitelist 'next'. However, browsers are accidentally\\n        // relying on it\\n        // https://bugs.chromium.org/p/v8/issues/detail?id=4769#\\n        // https://bugs.webkit.org/show_bug.cgi?id=154475\\n        // and we will be whitelisting it as we transition to ES6\\n        // anyway, so we unconditionally whitelist it now.\\n        next: '*',\\n        constructor: false,\\n      },\\n      ArrayIteratorPrototype: {},\\n      StringIteratorPrototype: {},\\n      MapIteratorPrototype: {},\\n      SetIteratorPrototype: {},\\n      // AsyncIteratorPrototype does not inherit from IteratorPrototype\\n      AsyncIteratorPrototype: {},\\n\\n      // The %GeneratorFunction% intrinsic is the constructor of\\n      // generator functions, so %GeneratorFunction%.prototype is\\n      // the %Generator% intrinsic, which all generator functions\\n      // inherit from. A generator function is effectively the\\n      // constructor of its generator instances, so, for each\\n      // generator function (e.g., \\\"g1\\\" on the diagram at\\n      // http://people.mozilla.org/~jorendorff/figure-2.png )\\n      // its .prototype is a prototype that its instances inherit\\n      // from. Paralleling this structure, %Generator%.prototype,\\n      // i.e., %GeneratorFunction%.prototype.prototype, is the\\n      // object that all these generator function prototypes inherit\\n      // from. The .next, .return and .throw that generator\\n      // instances respond to are actually the builtin methods they\\n      // inherit from this object.\\n      GeneratorFunction: {\\n        // 25.2\\n        length: '*', // Not sure why this is needed\\n        prototype: {\\n          // 25.4\\n          prototype: {\\n            next: '*',\\n            return: '*',\\n            throw: '*',\\n            constructor: '*', // Not sure why this is needed\\n          },\\n        },\\n      },\\n      AsyncGeneratorFunction: {\\n        // 25.3\\n        length: '*',\\n        prototype: {\\n          // 25.5\\n          prototype: {\\n            next: '*',\\n            return: '*',\\n            throw: '*',\\n            constructor: '*', // Not sure why this is needed\\n          },\\n        },\\n      },\\n      AsyncFunction: {\\n        // 25.7\\n        length: '*',\\n        prototype: '*',\\n      },\\n\\n      TypedArray: (TypedArrayWhitelist = {\\n        // 22.2\\n        length: '*', // does not inherit from Function.prototype on Chrome\\n        name: '*', // ditto\\n        from: t,\\n        of: t,\\n        BYTES_PER_ELEMENT: '*',\\n        prototype: {\\n          buffer: 'maybeAccessor',\\n          byteLength: 'maybeAccessor',\\n          byteOffset: 'maybeAccessor',\\n          copyWithin: '*',\\n          entries: '*',\\n          every: '*',\\n          fill: '*',\\n          filter: '*',\\n          find: '*',\\n          findIndex: '*',\\n          forEach: '*',\\n          includes: '*',\\n          indexOf: '*',\\n          join: '*',\\n          keys: '*',\\n          lastIndexOf: '*',\\n          length: 'maybeAccessor',\\n          map: '*',\\n          reduce: '*',\\n          reduceRight: '*',\\n          reverse: '*',\\n          set: '*',\\n          slice: '*',\\n          some: '*',\\n          sort: '*',\\n          subarray: '*',\\n          values: '*',\\n          BYTES_PER_ELEMENT: '*',\\n        },\\n      }),\\n    },\\n\\n    namedIntrinsics: {\\n      // In order according to\\n      // http://www.ecma-international.org/ecma-262/ with chapter\\n      // numbers where applicable\\n\\n      // 18 The Global Object\\n\\n      // 18.1\\n      Infinity: j,\\n      NaN: j,\\n      undefined: j,\\n\\n      // 18.2\\n      // eval: t,                      // Whitelisting under separate control\\n      // by TAME_GLOBAL_EVAL in startSES.js\\n      isFinite: t,\\n      isNaN: t,\\n      parseFloat: t,\\n      parseInt: t,\\n      decodeURI: t,\\n      decodeURIComponent: t,\\n      encodeURI: t,\\n      encodeURIComponent: t,\\n\\n      // 19 Fundamental Objects\\n\\n      Object: {\\n        // 19.1\\n        assign: t, // ES-Harmony\\n        create: t,\\n        defineProperties: t, // ES-Harmony\\n        defineProperty: t,\\n        entries: t, // ES-Harmony\\n        freeze: j,\\n        getOwnPropertyDescriptor: t,\\n        getOwnPropertyDescriptors: t, // proposed ES-Harmony\\n        getOwnPropertyNames: t,\\n        getOwnPropertySymbols: t, // ES-Harmony\\n        getPrototypeOf: t,\\n        is: j, // ES-Harmony\\n        isExtensible: t,\\n        isFrozen: t,\\n        isSealed: t,\\n        keys: t,\\n        preventExtensions: j,\\n        seal: j,\\n        setPrototypeOf: t, // ES-Harmony\\n        values: t, // ES-Harmony\\n\\n        prototype: {\\n          // B.2.2\\n          // __proto__: t, whitelisted manually in startSES.js\\n          __defineGetter__: t,\\n          __defineSetter__: t,\\n          __lookupGetter__: t,\\n          __lookupSetter__: t,\\n\\n          constructor: '*',\\n          hasOwnProperty: t,\\n          isPrototypeOf: t,\\n          propertyIsEnumerable: t,\\n          toLocaleString: '*',\\n          toString: '*',\\n          valueOf: '*',\\n\\n          // Generally allowed\\n          [Symbol.iterator]: '*',\\n          [Symbol.toPrimitive]: '*',\\n          [Symbol.toStringTag]: '*',\\n          [Symbol.unscopables]: '*',\\n        },\\n      },\\n\\n      Function: {\\n        // 19.2\\n        length: t,\\n        prototype: {\\n          apply: t,\\n          bind: t,\\n          call: t,\\n          [Symbol.hasInstance]: '*',\\n\\n          // 19.2.4 instances\\n          length: '*',\\n          name: '*', // ES-Harmony\\n          prototype: '*',\\n          arity: '*', // non-std, deprecated in favor of length\\n\\n          // Generally allowed\\n          [Symbol.species]: 'maybeAccessor', // ES-Harmony?\\n        },\\n      },\\n\\n      Boolean: {\\n        // 19.3\\n        prototype: t,\\n      },\\n\\n      Symbol: {\\n        // 19.4               all ES-Harmony\\n        asyncIterator: t, // proposed? ES-Harmony\\n        for: t,\\n        hasInstance: t,\\n        isConcatSpreadable: t,\\n        iterator: t,\\n        keyFor: t,\\n        match: t,\\n        matchAll: t,\\n        replace: t,\\n        search: t,\\n        species: t,\\n        split: t,\\n        toPrimitive: t,\\n        toStringTag: t,\\n        unscopables: t,\\n        prototype: t,\\n      },\\n\\n      Error: {\\n        // 19.5\\n        prototype: {\\n          name: '*',\\n          message: '*',\\n        },\\n      },\\n      // In ES6 the *Error \\\"subclasses\\\" of Error inherit from Error,\\n      // since constructor inheritance generally mirrors prototype\\n      // inheritance. As explained at\\n      // https://code.google.com/p/google-caja/issues/detail?id=1963 ,\\n      // debug.js hides away the Error constructor itself, and so needs\\n      // to rewire these \\\"subclass\\\" constructors. Until we have a more\\n      // general mechanism, please maintain this list of whitelisted\\n      // subclasses in sync with the list in debug.js of subclasses to\\n      // be rewired.\\n      EvalError: {\\n        prototype: t,\\n      },\\n      RangeError: {\\n        prototype: t,\\n      },\\n      ReferenceError: {\\n        prototype: t,\\n      },\\n      SyntaxError: {\\n        prototype: t,\\n      },\\n      TypeError: {\\n        prototype: t,\\n      },\\n      URIError: {\\n        prototype: t,\\n      },\\n\\n      // 20 Numbers and Dates\\n\\n      Number: {\\n        // 20.1\\n        EPSILON: t, // ES-Harmony\\n        isFinite: j, // ES-Harmony\\n        isInteger: t, // ES-Harmony\\n        isNaN: j, // ES-Harmony\\n        isSafeInteger: j, // ES-Harmony\\n        MAX_SAFE_INTEGER: j, // ES-Harmony\\n        MAX_VALUE: t,\\n        MIN_SAFE_INTEGER: j, // ES-Harmony\\n        MIN_VALUE: t,\\n        NaN: t,\\n        NEGATIVE_INFINITY: t,\\n        parseFloat: t, // ES-Harmony\\n        parseInt: t, // ES-Harmony\\n        POSITIVE_INFINITY: t,\\n        prototype: {\\n          toExponential: t,\\n          toFixed: t,\\n          toPrecision: t,\\n        },\\n      },\\n\\n      Math: {\\n        // 20.2\\n        E: j,\\n        LN10: j,\\n        LN2: j,\\n        LOG10E: t,\\n        LOG2E: t,\\n        PI: j,\\n        SQRT1_2: t,\\n        SQRT2: t,\\n\\n        abs: j,\\n        acos: t,\\n        acosh: t, // ES-Harmony\\n        asin: t,\\n        asinh: t, // ES-Harmony\\n        atan: t,\\n        atanh: t, // ES-Harmony\\n        atan2: t,\\n        cbrt: t, // ES-Harmony\\n        ceil: j,\\n        clz32: t, // ES-Harmony\\n        cos: t,\\n        cosh: t, // ES-Harmony\\n        exp: t,\\n        expm1: t, // ES-Harmony\\n        floor: j,\\n        fround: t, // ES-Harmony\\n        hypot: t, // ES-Harmony\\n        imul: t, // ES-Harmony\\n        log: j,\\n        log1p: t, // ES-Harmony\\n        log10: j, // ES-Harmony\\n        log2: j, // ES-Harmony\\n        max: j,\\n        min: j,\\n        pow: j,\\n        random: t, // questionable\\n        round: j,\\n        sign: t, // ES-Harmony\\n        sin: t,\\n        sinh: t, // ES-Harmony\\n        sqrt: j,\\n        tan: t,\\n        tanh: t, // ES-Harmony\\n        trunc: j, // ES-Harmony\\n      },\\n\\n      // no-arg Date constructor is questionable\\n      Date: {\\n        // 20.3\\n        now: t, // questionable\\n        parse: t,\\n        UTC: t,\\n        prototype: {\\n          // Note: coordinate this list with maintanence of repairES5.js\\n          getDate: t,\\n          getDay: t,\\n          getFullYear: t,\\n          getHours: t,\\n          getMilliseconds: t,\\n          getMinutes: t,\\n          getMonth: t,\\n          getSeconds: t,\\n          getTime: t,\\n          getTimezoneOffset: t,\\n          getUTCDate: t,\\n          getUTCDay: t,\\n          getUTCFullYear: t,\\n          getUTCHours: t,\\n          getUTCMilliseconds: t,\\n          getUTCMinutes: t,\\n          getUTCMonth: t,\\n          getUTCSeconds: t,\\n          setDate: t,\\n          setFullYear: t,\\n          setHours: t,\\n          setMilliseconds: t,\\n          setMinutes: t,\\n          setMonth: t,\\n          setSeconds: t,\\n          setTime: t,\\n          setUTCDate: t,\\n          setUTCFullYear: t,\\n          setUTCHours: t,\\n          setUTCMilliseconds: t,\\n          setUTCMinutes: t,\\n          setUTCMonth: t,\\n          setUTCSeconds: t,\\n          toDateString: t,\\n          toISOString: t,\\n          toJSON: t,\\n          toLocaleDateString: t,\\n          toLocaleString: t,\\n          toLocaleTimeString: t,\\n          toTimeString: t,\\n          toUTCString: t,\\n\\n          // B.2.4\\n          getYear: t,\\n          setYear: t,\\n          toGMTString: t,\\n        },\\n      },\\n\\n      // 21 Text Processing\\n\\n      String: {\\n        // 21.2\\n        fromCharCode: j,\\n        fromCodePoint: t, // ES-Harmony\\n        raw: j, // ES-Harmony\\n        prototype: {\\n          charAt: t,\\n          charCodeAt: t,\\n          codePointAt: t, // ES-Harmony\\n          concat: t,\\n          endsWith: j, // ES-Harmony\\n          includes: t, // ES-Harmony\\n          indexOf: j,\\n          lastIndexOf: j,\\n          localeCompare: t,\\n          match: t,\\n          normalize: t, // ES-Harmony\\n          padEnd: t, // ES-Harmony\\n          padStart: t, // ES-Harmony\\n          repeat: t, // ES-Harmony\\n          replace: t,\\n          search: t,\\n          slice: j,\\n          split: t,\\n          startsWith: j, // ES-Harmony\\n          substring: t,\\n          toLocaleLowerCase: t,\\n          toLocaleUpperCase: t,\\n          toLowerCase: t,\\n          toUpperCase: t,\\n          trim: t,\\n\\n          // B.2.3\\n          substr: t,\\n          anchor: t,\\n          big: t,\\n          blink: t,\\n          bold: t,\\n          fixed: t,\\n          fontcolor: t,\\n          fontsize: t,\\n          italics: t,\\n          link: t,\\n          small: t,\\n          strike: t,\\n          sub: t,\\n          sup: t,\\n\\n          trimLeft: t, // non-standard\\n          trimRight: t, // non-standard\\n\\n          // 21.1.4 instances\\n          length: '*',\\n        },\\n      },\\n\\n      RegExp: {\\n        // 21.2\\n        prototype: {\\n          exec: t,\\n          flags: 'maybeAccessor',\\n          global: 'maybeAccessor',\\n          ignoreCase: 'maybeAccessor',\\n          [Symbol.match]: '*', // ES-Harmony\\n          multiline: 'maybeAccessor',\\n          [Symbol.replace]: '*', // ES-Harmony\\n          [Symbol.search]: '*', // ES-Harmony\\n          source: 'maybeAccessor',\\n          [Symbol.split]: '*', // ES-Harmony\\n          sticky: 'maybeAccessor',\\n          test: t,\\n          unicode: 'maybeAccessor', // ES-Harmony\\n          dotAll: 'maybeAccessor', // proposed ES-Harmony\\n\\n          // B.2.5\\n          compile: false, // UNSAFE. Purposely suppressed\\n\\n          // 21.2.6 instances\\n          lastIndex: '*',\\n          options: '*', // non-std\\n        },\\n      },\\n\\n      // 22 Indexed Collections\\n\\n      Array: {\\n        // 22.1\\n        from: j,\\n        isArray: t,\\n        of: j, // ES-Harmony?\\n        prototype: {\\n          concat: t,\\n          copyWithin: t, // ES-Harmony\\n          entries: t, // ES-Harmony\\n          every: t,\\n          fill: t, // ES-Harmony\\n          filter: j,\\n          find: t, // ES-Harmony\\n          findIndex: t, // ES-Harmony\\n          forEach: j,\\n          includes: t, // ES-Harmony\\n          indexOf: j,\\n          join: t,\\n          keys: t, // ES-Harmony\\n          lastIndexOf: j,\\n          map: j,\\n          pop: j,\\n          push: j,\\n          reduce: j,\\n          reduceRight: j,\\n          reverse: t,\\n          shift: j,\\n          slice: j,\\n          some: t,\\n          sort: t,\\n          splice: t,\\n          unshift: j,\\n          values: t, // ES-Harmony\\n\\n          // 22.1.4 instances\\n          length: '*',\\n        },\\n      },\\n\\n      // 22.2 Typed Array stuff\\n      // TODO: Not yet organized according to spec order\\n\\n      Int8Array: TypedArrayWhitelist,\\n      Uint8Array: TypedArrayWhitelist,\\n      Uint8ClampedArray: TypedArrayWhitelist,\\n      Int16Array: TypedArrayWhitelist,\\n      Uint16Array: TypedArrayWhitelist,\\n      Int32Array: TypedArrayWhitelist,\\n      Uint32Array: TypedArrayWhitelist,\\n      Float32Array: TypedArrayWhitelist,\\n      Float64Array: TypedArrayWhitelist,\\n\\n      // 23 Keyed Collections          all ES-Harmony\\n\\n      Map: {\\n        // 23.1\\n        prototype: {\\n          clear: j,\\n          delete: j,\\n          entries: j,\\n          forEach: j,\\n          get: j,\\n          has: j,\\n          keys: j,\\n          set: j,\\n          size: 'maybeAccessor',\\n          values: j,\\n        },\\n      },\\n\\n      Set: {\\n        // 23.2\\n        prototype: {\\n          add: j,\\n          clear: j,\\n          delete: j,\\n          entries: j,\\n          forEach: j,\\n          has: j,\\n          keys: j,\\n          size: 'maybeAccessor',\\n          values: j,\\n        },\\n      },\\n\\n      WeakMap: {\\n        // 23.3\\n        prototype: {\\n          // Note: coordinate this list with maintenance of repairES5.js\\n          delete: j,\\n          get: j,\\n          has: j,\\n          set: j,\\n        },\\n      },\\n\\n      WeakSet: {\\n        // 23.4\\n        prototype: {\\n          add: j,\\n          delete: j,\\n          has: j,\\n        },\\n      },\\n\\n      // 24 Structured Data\\n\\n      ArrayBuffer: {\\n        // 24.1            all ES-Harmony\\n        isView: t,\\n        length: t, // does not inherit from Function.prototype on Chrome\\n        name: t, // ditto\\n        prototype: {\\n          byteLength: 'maybeAccessor',\\n          slice: t,\\n        },\\n      },\\n\\n      // 24.2 TODO: Omitting SharedArrayBuffer for now\\n\\n      DataView: {\\n        // 24.3               all ES-Harmony\\n        length: t, // does not inherit from Function.prototype on Chrome\\n        name: t, // ditto\\n        BYTES_PER_ELEMENT: '*', // non-standard. really?\\n        prototype: {\\n          buffer: 'maybeAccessor',\\n          byteOffset: 'maybeAccessor',\\n          byteLength: 'maybeAccessor',\\n          getFloat32: t,\\n          getFloat64: t,\\n          getInt8: t,\\n          getInt16: t,\\n          getInt32: t,\\n          getUint8: t,\\n          getUint16: t,\\n          getUint32: t,\\n          setFloat32: t,\\n          setFloat64: t,\\n          setInt8: t,\\n          setInt16: t,\\n          setInt32: t,\\n          setUint8: t,\\n          setUint16: t,\\n          setUint32: t,\\n        },\\n      },\\n\\n      // 24.4 TODO: Omitting Atomics for now\\n\\n      JSON: {\\n        // 24.5\\n        parse: j,\\n        stringify: j,\\n      },\\n\\n      // 25 Control Abstraction Objects\\n\\n      Promise: {\\n        // 25.4\\n        all: j,\\n        race: j,\\n        reject: j,\\n        resolve: j,\\n        prototype: {\\n          catch: t,\\n          then: j,\\n          finally: t, // proposed ES-Harmony\\n\\n          // nanoq.js\\n          get: t,\\n          put: t,\\n          del: t,\\n          post: t,\\n          invoke: t,\\n          fapply: t,\\n          fcall: t,\\n\\n          // Temporary compat with the old makeQ.js\\n          send: t,\\n          delete: t,\\n          end: t,\\n        },\\n      },\\n\\n      // nanoq.js\\n      Q: {\\n        all: t,\\n        race: t,\\n        reject: t,\\n        resolve: t,\\n\\n        join: t,\\n        isPassByCopy: t,\\n        passByCopy: t,\\n        makeRemote: t,\\n        makeFar: t,\\n\\n        // Temporary compat with the old makeQ.js\\n        shorten: t,\\n        isPromise: t,\\n        async: t,\\n        rejected: t,\\n        promise: t,\\n        delay: t,\\n        memoize: t,\\n        defer: t,\\n      },\\n\\n      // 26 Reflection\\n\\n      Reflect: {\\n        // 26.1\\n        apply: t,\\n        construct: t,\\n        defineProperty: t,\\n        deleteProperty: t,\\n        get: t,\\n        getOwnPropertyDescriptor: t,\\n        getPrototypeOf: t,\\n        has: t,\\n        isExtensible: t,\\n        ownKeys: t,\\n        preventExtensions: t,\\n        set: t,\\n        setPrototypeOf: t,\\n      },\\n\\n      Proxy: {\\n        // 26.2\\n        revocable: t,\\n      },\\n\\n      // Appendix B\\n\\n      // B.2.1\\n      escape: t,\\n      unescape: t,\\n\\n      // B.2.5 (RegExp.prototype.compile) is marked 'false' up in 21.2\\n\\n      // Other\\n\\n      StringMap: {\\n        // A specialized approximation of ES-Harmony's Map.\\n        prototype: {}, // Technically, the methods should be on the prototype,\\n        // but doing so while preserving encapsulation will be\\n        // needlessly expensive for current usage.\\n      },\\n\\n      Realm: {\\n        makeRootRealm: t,\\n        makeCompartment: t,\\n        prototype: {\\n          global: 'maybeAccessor',\\n          evaluate: t,\\n        },\\n      },\\n\\n      SES: {\\n        confine: t,\\n        confineExpr: t,\\n      },\\n\\n      Nat: j,\\n      def: j,\\n    },\\n  };\\n\\n  function makeConsole(parentConsole) {\\n    /* 'parentConsole' is the parent Realm's original 'console' object. We must\\n       wrap it, exposing a 'console' with a 'console.log' (and perhaps others)\\n       to the local realm, without allowing access to the original 'console',\\n       its return values, or its exception objects, any of which could be used\\n       to break confinement via the unsafe Function constructor. */\\n\\n    // callAndWrapError is copied from proposal-realms/shim/src/realmFacade.js\\n    // Like Realm.apply except that it catches anything thrown and rethrows it\\n    // as an Error from this realm\\n\\n    const errorConstructors = new Map([\\n      ['EvalError', EvalError],\\n      ['RangeError', RangeError],\\n      ['ReferenceError', ReferenceError],\\n      ['SyntaxError', SyntaxError],\\n      ['TypeError', TypeError],\\n      ['URIError', URIError],\\n    ]);\\n\\n    function callAndWrapError(target, ...args) {\\n      try {\\n        return target(...args);\\n      } catch (err) {\\n        if (Object(err) !== err) {\\n          // err is a primitive value, which is safe to rethrow\\n          throw err;\\n        }\\n        let eName;\\n        let eMessage;\\n        let eStack;\\n        try {\\n          // The child environment might seek to use 'err' to reach the\\n          // parent's intrinsics and corrupt them. `${err.name}` will cause\\n          // string coercion of 'err.name'. If err.name is an object (probably\\n          // a String of the parent Realm), the coercion uses\\n          // err.name.toString(), which is under the control of the parent. If\\n          // err.name were a primitive (e.g. a number), it would use\\n          // Number.toString(err.name), using the child's version of Number\\n          // (which the child could modify to capture its argument for later\\n          // use), however primitives don't have properties like .prototype so\\n          // they aren't useful for an attack.\\n          eName = `${err.name}`;\\n          eMessage = `${err.message}`;\\n          eStack = `${err.stack}`;\\n          // eName/eMessage/eStack are now child-realm primitive strings, and\\n          // safe to expose\\n        } catch (ignored) {\\n          // if err.name.toString() throws, keep the (parent realm) Error away\\n          // from the child\\n          throw new Error('unknown error');\\n        }\\n        const ErrorConstructor = errorConstructors.get(eName) || Error;\\n        try {\\n          throw new ErrorConstructor(eMessage);\\n        } catch (err2) {\\n          err2.stack = eStack; // replace with the captured inner stack\\n          throw err2;\\n        }\\n      }\\n    }\\n\\n    const newConsole = {};\\n    const passThrough = [\\n      'log',\\n      'info',\\n      'warn',\\n      'error',\\n      'group',\\n      'groupEnd',\\n      'trace',\\n      'time',\\n      'timeLog',\\n      'timeEnd',\\n    ];\\n    // TODO: those are the properties that MDN documents. Node.js has a bunch\\n    // of additional ones that I didn't include, which might be appropriate.\\n\\n    passThrough.forEach(name => {\\n      // TODO: do we reveal the presence/absence of these properties to the\\n      // child realm, thus exposing nondeterminism (and a hint of what platform\\n      // you might be on) when it is constructed with {consoleMode: allow} ? Or\\n      // should we expose the same set all the time, but silently ignore calls\\n      // to the missing ones, to hide that variation? We might even consider\\n      // adding console.* to the child realm all the time, even without\\n      // consoleMode:allow, but ignore the calls unless the mode is enabled.\\n      if (name in parentConsole) {\\n        const orig = parentConsole[name];\\n        // TODO: in a stack trace, this appears as\\n        // \\\"Object.newConsole.(anonymous function) [as trace]\\\"\\n        // can we make that \\\"newConsole.trace\\\" ?\\n        newConsole[name] = function newerConsole(...args) {\\n          callAndWrapError(orig, ...args);\\n        };\\n      }\\n    });\\n\\n    return newConsole;\\n  }\\n\\n  function makeMakeRequire(r, harden) {\\n    function makeRequire(config) {\\n      const cache = new Map();\\n\\n      function build(what) {\\n        // This approach denies callers the ability to use inheritance to\\n        // manage their config objects, but a simple \\\"if (what in config)\\\"\\n        // predicate would also be truthy for e.g. \\\"toString\\\" and other\\n        // properties of Object.prototype, and require('toString') should be\\n        // legal if and only if the config object included an own-property\\n        // named 'toString'. Incidentally, this could have been\\n        // \\\"config.hasOwnProperty(what)\\\" but eslint complained.\\n        if (!Object.prototype.hasOwnProperty.call(config, what)) {\\n          throw new Error(`Cannot find module '${what}'`);\\n        }\\n        const c = config[what];\\n\\n        // some modules are hard-coded ways to access functionality that SES\\n        // provides directly\\n        if (what === '@agoric/harden') {\\n          return harden;\\n        }\\n\\n        // If the config points at a simple function, it must be a pure\\n        // function with no dependencies (i.e. no 'require' or 'import', no\\n        // calls to other functions defined in the same file but outside the\\n        // function body). We stringify it and evaluate it inside this realm.\\n        if (typeof c === 'function') {\\n          return r.evaluate(`(${c})`);\\n        }\\n\\n        // else we treat it as an object with an 'attenuatorSource' property\\n        // that defines an attenuator function, which we evaluate. We then\\n        // invoke it with the config object, which can contain authorities that\\n        // it can wrap. The return value from this invocation is the module\\n        // object that gets returned from require(). The attenuator function\\n        // and the module it returns are in-realm, the authorities it wraps\\n        // will be out-of-realm.\\n        const src = `(${c.attenuatorSource})`;\\n        const attenuator = r.evaluate(src);\\n        return attenuator(c);\\n      }\\n\\n      function newRequire(whatArg) {\\n        const what = `${whatArg}`;\\n        if (!cache.has(what)) {\\n          cache.set(what, harden(build(what)));\\n        }\\n        return cache.get(what);\\n      }\\n\\n      return newRequire;\\n    }\\n\\n    return makeRequire;\\n  }\\n\\n  // Copyright (C) 2018 Agoric\\n\\n  function createSESWithRealmConstructor(creatorStrings, Realm) {\\n    function makeSESRootRealm(options) {\\n      // eslint-disable-next-line no-param-reassign\\n      options = Object(options); // Todo: sanitize\\n      const shims = [];\\n      const wl = JSON.parse(JSON.stringify(options.whitelist || whitelist));\\n\\n      // \\\"allow\\\" enables real Date.now(), anything else gets NaN\\n      // (it'd be nice to allow a fixed numeric value, but too hard to\\n      // implement right now)\\n      if (options.dateNowMode !== 'allow') {\\n        shims.push(`(${tameDate})();`);\\n      }\\n\\n      if (options.mathRandomMode !== 'allow') {\\n        shims.push(`(${tameMath})();`);\\n      }\\n\\n      // Intl is disabled entirely for now, deleted by removeProperties. If we\\n      // want to bring it back (under the control of this option), we'll need\\n      // to add it to the whitelist too, as well as taming it properly.\\n      if (options.intlMode !== 'allow') {\\n        // this shim also disables Object.prototype.toLocaleString\\n        shims.push(`(${tameIntl})();`);\\n      }\\n\\n      if (options.errorStackMode !== 'allow') {\\n        shims.push(`(${tameError})();`);\\n      } else {\\n        // if removeProperties cleans these things from Error, v8 won't provide\\n        // stack traces or even toString on exceptions, and then Node.js prints\\n        // uncaught exceptions as \\\"undefined\\\" instead of a type/message/stack.\\n        // So if we're allowing stack traces, make sure the whitelist is\\n        // augmented to include them.\\n        wl.namedIntrinsics.Error.captureStackTrace = true;\\n        wl.namedIntrinsics.Error.stackTraceLimit = true;\\n        wl.namedIntrinsics.Error.prepareStackTrace = true;\\n      }\\n\\n      if (options.regexpMode !== 'allow') {\\n        shims.push(`(${tameRegExp})();`);\\n      }\\n\\n      // The getAnonIntrinsics function might be renamed by e.g. rollup. The\\n      // removeProperties() function references it by name, so we need to force\\n      // it to have a specific name.\\n      const removeProp = `const getAnonIntrinsics = (${getAnonIntrinsics$1});\\n               (${removeProperties})(this, ${JSON.stringify(wl)})`;\\n      shims.push(removeProp);\\n\\n      const r = Realm.makeRootRealm({ shims });\\n\\n      // Build a harden() with an empty fringe. It will be populated later when\\n      // we call harden(allIntrinsics).\\n      const makeHardenerSrc = `(${makeHardener})`;\\n      const harden = r.evaluate(makeHardenerSrc)(\\n        undefined,\\n        options.hardenerOptions,\\n      );\\n\\n      const b = r.evaluate(creatorStrings);\\n      b.createSESInThisRealm(r.global, creatorStrings, r);\\n      // b.removeProperties(r.global);\\n\\n      if (options.consoleMode === 'allow') {\\n        const s = `(${makeConsole})`;\\n        r.global.console = r.evaluate(s)(console);\\n      }\\n\\n      // Finally freeze all the primordials, and the global object. This must\\n      // be the last thing we do that modifies the Realm's globals.\\n      const anonIntrinsics = r.evaluate(`(${getAnonIntrinsics$1})`)(r.global);\\n      const allIntrinsics = r.evaluate(`(${getAllPrimordials})`)(\\n        r.global,\\n        anonIntrinsics,\\n      );\\n      harden(allIntrinsics);\\n\\n      // build the makeRequire helper, glue it to the new Realm\\n      r.makeRequire = harden(r.evaluate(`(${makeMakeRequire})`)(r, harden));\\n\\n      return r;\\n    }\\n    const SES = {\\n      makeSESRootRealm,\\n    };\\n\\n    return SES;\\n  }\\n\\n  function createSESInThisRealm(global, creatorStrings, parentRealm) {\\n    // eslint-disable-next-line no-param-reassign,no-undef\\n    global.SES = createSESWithRealmConstructor(creatorStrings, Realm);\\n    // todo: wrap exceptions, effectively undoing the wrapping that\\n    // Realm.evaluate does\\n\\n    const errorConstructors = new Map([\\n      ['EvalError', EvalError],\\n      ['RangeError', RangeError],\\n      ['ReferenceError', ReferenceError],\\n      ['SyntaxError', SyntaxError],\\n      ['TypeError', TypeError],\\n      ['URIError', URIError],\\n    ]);\\n\\n    // callAndWrapError is copied from the Realm shim. Our SES.confine (from\\n    // inside the realm) delegates to Realm.evaluate (from outside the realm),\\n    // but we need the exceptions to come from our own realm, so we use this to\\n    // reverse the shim's own callAndWrapError. TODO: look for a reasonable way\\n    // to avoid the double-wrapping, maybe by changing the shim/Realms-spec to\\n    // provide the safeEvaluator as a Realm.evaluate method (inside a realm).\\n    // That would make this trivial: global.SES = Realm.evaluate (modulo\\n    // potential 'this' issues)\\n\\n    // the comments here were written from the POV of a parent defending itself\\n    // against a malicious child realm. In this case, we are the child.\\n\\n    function callAndWrapError(target, ...args) {\\n      try {\\n        return target(...args);\\n      } catch (err) {\\n        if (Object(err) !== err) {\\n          // err is a primitive value, which is safe to rethrow\\n          throw err;\\n        }\\n        let eName;\\n        let eMessage;\\n        let eStack;\\n        try {\\n          // The child environment might seek to use 'err' to reach the\\n          // parent's intrinsics and corrupt them. `${err.name}` will cause\\n          // string coercion of 'err.name'. If err.name is an object (probably\\n          // a String of the parent Realm), the coercion uses\\n          // err.name.toString(), which is under the control of the parent. If\\n          // err.name were a primitive (e.g. a number), it would use\\n          // Number.toString(err.name), using the child's version of Number\\n          // (which the child could modify to capture its argument for later\\n          // use), however primitives don't have properties like .prototype so\\n          // they aren't useful for an attack.\\n          eName = `${err.name}`;\\n          eMessage = `${err.message}`;\\n          eStack = `${err.stack}`;\\n          // eName/eMessage/eStack are now child-realm primitive strings, and\\n          // safe to expose\\n        } catch (ignored) {\\n          // if err.name.toString() throws, keep the (parent realm) Error away\\n          // from the child\\n          throw new Error('unknown error');\\n        }\\n        const ErrorConstructor = errorConstructors.get(eName) || Error;\\n        try {\\n          throw new ErrorConstructor(eMessage);\\n        } catch (err2) {\\n          err2.stack = eStack; // replace with the captured inner stack\\n          throw err2;\\n        }\\n      }\\n    }\\n\\n    // We must not allow other child code to access that object. SES.confine\\n    // closes over the parent's Realm object so it shouldn't be accessible from\\n    // the outside.\\n\\n    // eslint-disable-next-line no-param-reassign\\n    global.SES.confine = (code, endowments) =>\\n      callAndWrapError(() => parentRealm.evaluate(code, endowments));\\n    // eslint-disable-next-line no-param-reassign\\n    global.SES.confineExpr = (code, endowments) =>\\n      callAndWrapError(() => parentRealm.evaluate(`(${code})`, endowments));\\n  }\\n\\n  // Copyright (C) 2018 Agoric\\n\\n  exports.createSESInThisRealm = createSESInThisRealm;\\n  exports.createSESWithRealmConstructor = createSESWithRealmConstructor;\\n\\n  return exports;\\n\\n}({}))\";\n\n// Copyright (C) 2018 Agoric\n\nconst SES = createSESWithRealmConstructor(creatorStrings, Realm);\n\nexport default SES;\n","// Prevent write access, and ensure objects don't pass the barrier\n// between warm (inside warmTarget or the return values of its descendants)\n// and cold (outside warmTarget), unless they are also insulated.\n//\n// The cold/warm identity maps are created fresh for each actual insulate()\n// call, but not for the silent wrapping of returns, throws, this, and\n// arguments.  This allows wrapping/unwrapping of values that transition\n// the delineated insulation boundary with read-only Proxies rather\n// having to harden them on every transition and losing useful but\n// harmless mutability.\n//\n// The proxying provided by insulate() is orthogonal to harden() and\n// Object.freeze.  You can still call harden() on your own data and\n// pass it into insulated() functions, but not on proxies that have\n// originated in an insulated() function, as that data belongs to\n// somebody else).\n//\n// The nonMapped set is a list of global identities that should never\n// be wrapped.  It is included for bootstrap purposes.\nconst makeInsulate = (nonMapped = new WeakSet()) => {\n    const insulate = (warmTarget) => {\n        const warmToColdMap = new WeakMap(), coldToWarmMap = new WeakMap();\n        const wrapWithMaps = (obj, inMap, outMap) => {\n            if (Object(obj) !== obj || nonMapped.has(obj)) {\n                // It's a neutral (primitive) type.\n                return obj;\n            }\n            // We are sending out the object, so find it in the cache.\n            const wrapped = outMap.get(obj);\n            if (wrapped) {\n                return wrapped;\n            }\n            // If we want an object to come in, we reverse the map (our\n            // inside is the object's outside).\n            const enter = (inbound) => wrapWithMaps(inbound, outMap, inMap);\n            // If we want send an object out, we keep the order (our inside\n            // is the object's inside).\n            const leave = (outThunk) => {\n                try {\n                    return wrapWithMaps(outThunk(), inMap, outMap);\n                }\n                catch (e) {\n                    throw wrapWithMaps(e, inMap, outMap);\n                }\n            };\n            const err = (msg) => leave(() => {\n                throw wrapWithMaps(TypeError(msg), inMap, outMap);\n            });\n            const handler = {\n                // Traps that make sure our object is read-only.\n                defineProperty(_target, prop, _attributes) {\n                    throw err(`Cannot define property ${JSON.stringify(String(prop))} on insulated object`);\n                },\n                setPrototypeOf(_target, _v) {\n                    throw err(`Cannot set prototype of insulated object`);\n                },\n                set(_target, prop, _value) {\n                    throw err(`Cannot set property ${JSON.stringify(String(prop))} on insulated object`);\n                },\n                // We maintain our extensible state, both for the\n                // Proxy invariants and because we don't want to modify\n                // the target AT ALL!\n                isExtensible(target) {\n                    return Reflect.isExtensible(target);\n                },\n                preventExtensions(target) {\n                    if (!Reflect.isExtensible(target)) {\n                        // Already prevented extensions, so succeed.\n                        return true;\n                    }\n                    // This is a mutation.  Not allowed.\n                    throw err(`Cannot prevent extensions of insulated object`);\n                },\n                // The traps that have a reasonably simple implementation:\n                get(target, prop, receiver) {\n                    return leave(() => Reflect.get(target, prop, receiver));\n                },\n                getPrototypeOf(target) {\n                    return leave(() => Reflect.getPrototypeOf(target));\n                },\n                ownKeys(target) {\n                    return leave(() => Reflect.ownKeys(target));\n                },\n                has(target, key) {\n                    return leave(() => key in target);\n                },\n                getOwnPropertyDescriptor(target, prop) {\n                    return leave(() => Reflect.getOwnPropertyDescriptor(target, prop));\n                },\n                // The recursively-wrapping traps.\n                apply(target, thisArg, argumentsList) {\n                    // If the target is from outside, but thisArg is not from outside,\n                    // we have insulation-crossing `this` capture.\n                    if (Object(thisArg) === thisArg &&\n                        outMap.get(target) && !inMap.get(thisArg) && !outMap.get(thisArg)) {\n                        // Block accidental `this`-capture, but don't break\n                        // callers that ignore `this` anyways.\n                        thisArg = undefined;\n                    }\n                    const wrappedThis = enter(thisArg);\n                    const wrappedArguments = argumentsList.map(enter);\n                    return leave(() => Reflect.apply(target, wrappedThis, wrappedArguments));\n                },\n                construct(target, args) {\n                    const wrappedArguments = args.map(enter);\n                    return leave(() => Reflect.construct(target, wrappedArguments));\n                },\n            };\n            // Now we can construct an insulated object, which\n            // makes it effectively read-only and transitively\n            // maintains the temperatures of the inside and outside.\n            const insulated = new Proxy(obj, handler);\n            // We're putting the insulated object outside, so mark it\n            // for our future inputs/outputs.\n            outMap.set(obj, insulated);\n            inMap.set(insulated, obj);\n            return insulated;\n        };\n        return wrapWithMaps(warmTarget, coldToWarmMap, warmToColdMap);\n    };\n    // Prevent infinite regress.\n    nonMapped.add(insulate);\n    return insulate;\n};\nexport default makeInsulate;\n","/**\n * By requiring sesshim.js, if you are not already in a SES\n * environment, you obtain a trivial polyfil of a small bit of SES's\n * API with none of its security. At the moment, you get only\n * <tt>def</tt> and <tt>confine</tt>, but with little of their\n * functionality. More API and more functionality will be provided on\n * an as-needed basis by my current uses, though I will try not to\n * break old clients that were compatible with both SES and\n * sesshim.js.\n *\n * <p>Currently, even if you are already in a SES environment,\n * sesshim.js will ignore that and do the same thing. Once actual SES\n * works on node/iojs/ES6, sesshim.js should test if it is in such an\n * environment, and re-export SES's versions of the APIs that\n * sesshim.js does provide, or wrappings that adapt them to ES6.\n */\n/**\n * The faux version of SES's <tt>harden</tt> is currently just a\n * synonym for Object.freeze.\n */\nconst harden = Object.freeze;\n/**\n * The faux version of SES's <tt>confine</tt> evals an\n * expression in an environment consisting of the global environment\n * as enhanced and shadowed by the own properties of the\n * <tt>env</tt> object. Unlike real <tt>confine</tt>, <ul>\n * <li>The faux <tt>confine</tt> does not have a third\n *     <tt>opt_options</tt> parameter. An options argument can of\n *     course be provided by the caller, but it will be ignored.\n * <li>The expression can be in the subset of ES6 supported by\n *     Babel.\n * <li>All dangerous globals that are not shadowed, such as \"window\"\n *     or \"document\", are still accessible by the evaled expression.\n * <li>The current binding of these properties at the time that\n *     <tt>confine</tt> is called are used as the initial\n *     bindings. Further changes to either the properties or the\n *     bindings are not tracked by the other.\n * <li>In the evaled expression, <tt>this</tt> is bound to\n *     <tt>undefined</tt>.\n * </ul>\n * When sesshim.js is enhanced to use SES if present, this confine\n * should wrap SES's confine rather than export it directly, in\n * order to continue to support ES6 expressions.\n */\nfunction confine(exprSrc, env) {\n    exprSrc = '' + exprSrc;\n    const names = Object.getOwnPropertyNames(env);\n    // Note: no newline prior to ${exprSrc}, so that line numbers for\n    // errors within exprSrc are accurate. Column numbers on the first\n    // line won't be, but will on following lines.\n    const closedFuncSrc = `(function(${names.join(',')}) { \"use strict\"; return (${exprSrc}\n);\n})\n//# sourceURL=data:${encodeURIComponent(exprSrc).slice(0, 48)}...\n`;\n    // tslint:disable-next-line:no-unused-expression\n    const closedFunc = (1, eval)(closedFuncSrc);\n    return closedFunc(...names.map(n => env[n]));\n}\n// FIXME: For bootstrapping Jessie modules.\n(typeof window === 'undefined' ? global : window).insulate = harden;\nexport default { confine: harden(confine), harden: harden(harden) };\n","/// <reference path=\"../../typings/ses.d.ts\"/>\n/// <reference path=\"node_modules/@types/node/ts3.1/index.d.ts\"/>\nimport makeInsulate from './insulate.mjs';\nimport sesshim from './sesshim.mjs';\nconst { confine, harden } = sesshim;\nconst globalEnv = {};\nexport const applyMethod = harden((thisObj, method, args) => Reflect.apply(method, thisObj, args));\nexport const setComputedIndex = harden((obj, index, val) => {\n    if (index === '__proto__') {\n        slog.error `Cannot set ${{ index }} object member`;\n    }\n    return obj[index] = val;\n});\nglobalEnv.makeMap = harden((...args) => harden(new Map(...args)));\nglobalEnv.makeSet = harden((...args) => harden(new Set(...args)));\nglobalEnv.makePromise = harden((executor) => harden(new Promise(executor)));\nglobalEnv.makeWeakMap = harden((...args) => harden(new WeakMap(...args)));\nglobalEnv.makeWeakSet = harden((...args) => harden(new WeakSet(...args)));\n// Don't insulate the arguments to setComputedIndex or the primitive endowments.\nconst nonMapped = new WeakSet();\nnonMapped.add(setComputedIndex);\nexport const insulate = makeInsulate(nonMapped);\n// Needed by the parser.\nglobalEnv.confine = harden(confine);\nglobalEnv.insulate = (obj) => obj;\nexport default globalEnv;\n","// DO NOT EDIT - Generated automatically from slog.mjs.ts by tessc\n\n\n\n\n\n\nexport const contextArg = insulate((context, a) => {\n  if (typeof a !== 'object' || a === null) {\n    // Just stringify the argument.\n    return '' + a;\n  } else if (a.length !== undefined) {\n    // Take the value as the (anonymous) array.\n    return a;\n  }\n  // Deconstruct the argument object.\n  let valname, val;\n  for (const vname of Object.keys(a)) {\n    if (vname === 'format') {\n      // format = a[vname];\n    } else if (valname !== undefined || typeof a[vname] === 'function') {\n      // Too many members or seems to be an active object.\n      return a;\n    } else {\n      // We have at least one non-format member.\n      valname = vname;\n      val = JSON.stringify(a[vname], undefined, 2);\n    }\n  }\n\n  if (valname === undefined) {\n    // No non-format arguments.\n    return a;\n  }\n\n  if (valname[0] === '_') {\n    // Do nothing.\n  } else if (context.has(valname)) {\n    const oval = context.get(valname);\n    if (val !== oval) {\n      slog.error`Context value ${{ valname }} mismatch: ${{ val }} vs. ${{ oval }}`;\n    }\n  } else {\n    context.set(valname, val);\n  }\n  return val;\n});\n\nconst makeSlog = insulate(handler => {\n  const levels = makeMap();\n  const names = [];\n  const doit = (level, name) => {\n    if (level >= 0) {\n      names[level] = name;\n      levels.set(name, level);\n    }\n\n\n    function tag(contextOrTemplate, ...args) {\n      let context;\n      if (!contextOrTemplate.raw) {\n        context = makeMap([...Object.entries(contextOrTemplate)]);\n        return (t, ...a) =>\n        handler(level, names, levels, context, t, a);\n      }\n      // No specified context, this is the template tag.\n      context = makeMap();\n      const template = contextOrTemplate;\n      return handler(level, names, levels, context, template, args);\n    }\n    return tag;\n  };\n\n  let i = 0;\n  const slog = doit(-1, 'stringify');\n  slog.panic = doit(i++, 'panic');\n  slog.alert = doit(i++, 'alert');\n  slog.crit = doit(i++, 'crit');\n  slog.error = doit(i++, 'error');\n  slog.reject = doit(i++, 'reject');\n  slog.warn = doit(i++, 'warn');\n  slog.notice = doit(i++, 'notice');\n  slog.info = doit(i++, 'info');\n  slog.debug = doit(i++, 'debug');\n  slog.trace = doit(i++, 'trace');\n  return slog;\n});\n\nexport default insulate(makeSlog);","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","// We set global variables to emulate a Jessie environment in a\n// vanilla Node.js script.  This allows us to import modules directly\n// if they are written in Jessie (as all the jessica/ directory is).\n//\n// NOTE: Don't ever do this in a library module, it's only allowed when\n// we are a main program, and we're changing global state for the\n// entire process.\n/// <reference path=\"../../typings/ses.d.ts\"/>\n/// <reference path=\"node_modules/@types/node/ts3.1/index.d.ts\"/>\nimport primEnv from './jessieDefaults.mjs';\nexport * from './jessieDefaults.mjs';\nconst globalEnv = Object.assign({}, primEnv);\n// Export the bootstrapped primitives.\nObject.keys(globalEnv).forEach(vname => {\n    global[vname] = globalEnv[vname];\n});\n// slog writes to console\nimport makeSlog, { contextArg } from '../../lib/slog.mjs';\n// Create a logger.\nconst mySlog = makeSlog((level, names, levels, context, template, args) => {\n    let ca;\n    const reduced = args.reduce((prior, a, i) => {\n        ca = contextArg(context, a);\n        const last = prior[prior.length - 1];\n        if (typeof ca === 'object' && ca !== undefined) {\n            prior[prior.length - 1] = last.trimRight();\n            prior.push(ca, template[i + 1].trimLeft());\n        }\n        else {\n            prior[prior.length - 1] = last + String(ca) + template[i + 1];\n        }\n        return prior;\n    }, [names[level] + ': ' + template[0]]);\n    if (level === levels.get('stringify')) {\n        // Just stringify.\n        return reduced.join(' ');\n    }\n    if (level >= levels.get('warn')) {\n        // Use console.error to provide an inspectable result.\n        console.error(...reduced);\n    }\n    else {\n        // Record a location, too.\n        const at0 = new Error().stack;\n        // Remove the current entry and our parent.\n        const at1 = at0.slice(at0.indexOf('\\n') + 1);\n        const at2 = at1.slice(at1.indexOf('\\n') + 1);\n        const at3 = at2.slice(at2.indexOf('\\n'));\n        console.error(...reduced, at3);\n    }\n    if (names[level] === 'reject') {\n        // Just return a promise rejection.\n        return Promise.reject(reduced.join(' '));\n    }\n    else if (typeof global !== 'undefined' && level <= levels.get('panic')) {\n        // At least allow turns to finish.\n        process.exitCode = 99;\n    }\n    else if (level <= levels.get('error')) {\n        // Throw an exception without revealing stack.\n        throw reduced.join(' ');\n    }\n    return reduced.join(' ');\n});\nglobalEnv.slog = mySlog;\n// Export the environment as global endowments.  This is only possible\n// because we are in control of the main program, and we are setting\n// this policy for all our modules.\nObject.keys(globalEnv).forEach(vname => {\n    global[vname] = globalEnv[vname];\n});\nexport default globalEnv;\n","// DO NOT EDIT - Generated automatically from indent.mjs.ts by tessc\nconst indent = insulate((template, ...substs) => {\n  const result = [];\n  let newnewline = '\\n';\n  for (let i = 0, ilen = substs.length; i < ilen; i++) {\n    let segment = template[i];\n    if (i === 0 && segment[0].startsWith('\\n')) {\n      segment = segment.slice(1);\n    }\n    const lastnl = segment.lastIndexOf('\\n');\n    if (lastnl >= 0) {\n      newnewline = '\\n';\n      for (let j = segment.length - lastnl; j > 0; j--) {\n        newnewline += ' ';\n      }\n    }\n    result.push(segment);\n    // We don't have regexps at our disposal in Jessie.\n    String(substs[i]).split('\\n').forEach((subst, j) => {\n      if (j !== 0) {\n        result.push(newnewline);\n      }\n      result.push(subst);\n    });\n  }\n  result.push(template[substs.length]);\n  return result.join('');\n});\n\nexport default insulate(indent);","// DO NOT EDIT - Generated automatically from boot-peg.mjs.ts by tessc\n// A lot of this code is lifted from:\n// https://github.com/erights/quasiParserGenerator/tree/master/src/bootbnf.js\n\n/// <reference path=\"peg.d.ts\"/>\n\nimport $i_indent from './indent.mjs';const indent = insulate($i_indent);\n\nconst LEFT_RECUR = insulate({ toString: () => 'LEFT_RECUR' });\n\nconst RUN = insulate((self, ruleOrPatt, pos, name) => {\n  if (self._debug) {\n    slog.info`run(f, ${pos}, ${name})`;\n  }\n  let posm = self._memo.get(pos);\n  if (!posm) {\n    posm = makeMap();\n    self._memo.set(pos, posm);\n  }\n  let result = posm.get(ruleOrPatt);\n  if (result) {\n    if (result === LEFT_RECUR) {\n      slog.error`Left recursion on rule: ${{ name }}`;\n    }\n    self._hits(1);\n  } else {\n    posm.set(ruleOrPatt, LEFT_RECUR);\n    self._misses(1);\n    if (typeof ruleOrPatt === 'function') {\n      result = ruleOrPatt(self, pos);\n    } else if (ruleOrPatt === void 0) {\n      slog.error`Rule missing: ${name}`;\n    } else {\n      result = EAT(self, pos, ruleOrPatt);\n    }\n    posm.set(ruleOrPatt, result);\n  }\n  return result;\n});\n\nconst lastFailures = insulate(self => {\n  let maxPos = 0;\n  let fails = [];\n  for (const posArr of self._memo) {\n    const posm = posArr[1];\n    for (const [ruleOrPatt, result] of posm) {\n      if (result !== LEFT_RECUR) {\n        const fail = typeof ruleOrPatt === 'function' ?\n        ruleOrPatt.name.slice(5) :\n        JSON.stringify('' + ruleOrPatt);\n        const [newPos, v] = result;\n        if (v === FAIL) {\n          if (newPos > maxPos) {\n            maxPos = newPos;\n            fails = [fail];\n          } else if (newPos === maxPos && fails.indexOf(fail) < 0) {\n            fails.push(fail);\n          }\n        }\n      }\n    }\n  }\n  return [maxPos, fails];\n});\n\nconst ERROR = insulate((self, _pos) => {\n  const [last, fails] = lastFailures(self);\n  const found = FIND(self.template, last);\n  const tokStr = Array.isArray(found) ?\n  `at ${last} ${makeTokStr(self, found)}` :\n  `unexpected EOF after ${makeTokStr(self, FIND(self.template, last - 1))}`;\n\n  const failStr = fails.length === 0 ?\n  `stuck` : `looking for ${fails.join(', ')}`;\n  const { sources } = self.template;\n  slog.info`-------template--------\n    ${self.template.raw.reduce((prior, r, i) => {\n    if (sources) {\n      const s = sources[i];\n      prior += `    ${s.uri}:${s.line}: `;\n    }\n    prior += JSON.stringify(r).slice(0, 50) + '\\n';\n    return prior;\n  }, '')}\n    -------\n    ${failStr}`;\n  slog.error`Syntax error ${tokStr}`;\n});\n\nconst makeTokStr = insulate((self, found) => {\n  if (Array.isArray(found)) {\n    const segment = self.template[found[0]];\n    return `${JSON.stringify(segment[found[1]])} #${found[0]}:${found[1]}`;\n  }\n  if (typeof found === 'number') {\n    return `hole #${found}`;\n  }\n  return undefined;\n});\n\nconst DONE = insulate(self => {\n  if (self._debug) {\n    for (const [pos, posm] of self._memo) {\n      const fails = [];\n      for (const [ruleOrPatt, result] of posm) {\n        const name = typeof ruleOrPatt === 'function' ?\n        ruleOrPatt.name : JSON.stringify(ruleOrPatt);\n        if (result === LEFT_RECUR) {\n          slog.notice`${name}(${pos}) => left recursion detector`;\n        } else {\n          const [newPos, v] = result;\n          if (v === FAIL) {\n            fails.push(name);\n          } else {\n            slog.debug`${name}(${pos}) => [${newPos}, ${v}]`;\n          }\n        }\n      }\n      if (fails.length >= 1) {\n        slog.debug`@${pos} => FAIL [${fails}]`;\n      }\n    }\n    slog.info`hits: ${self._hits(0)}, misses: ${self._misses(0)}`;\n  }\n});\n\nconst FIND = insulate((template, pos) =>\n{\n  const { raw } = template;\n  const numSubs = raw.length - 1;\n  let relpos = pos;\n  for (let segnum = 0; segnum <= numSubs; segnum++) {\n    const segment = raw[segnum];\n    const seglen = segment.length;\n    if (relpos < seglen) {\n      return [segnum, relpos];\n    } else if (relpos === seglen && segnum < numSubs) {\n      return segnum; // as hole number\n    }\n    relpos -= seglen + 1; // \"+1\" for the skipped hole\n  }\n});\n\nconst ACCEPT = insulate((_self, pos) => {\n  // Not really needed: useful for incremental compilation.\n  return [pos, []];\n});\n\nconst EAT = insulate((self, pos, str) => {\n  // if (self._debug) {\n  //    slog.warn`Have ${self.template}`;\n  // }\n  const found = FIND(self.template, pos);\n  if (Array.isArray(found)) {\n    const segment = self.template.raw[found[0]];\n    if (typeof str === 'string') {\n      if (segment.startsWith(str, found[1])) {\n        return [pos + str.length, str];\n      }\n    } else {\n      // Just return the next character.\n      return [pos + 1, segment[found[1]]];\n    }\n  }\n  return [pos, FAIL];\n});\n\nconst HOLE = insulate((self, pos) => {\n  const found = FIND(self.template, pos);\n  if (typeof found === 'number') {\n    return [pos + 1, found];\n  }\n  return [pos, FAIL];\n});\n\nconst FAIL = insulate({ toString: () => 'FAIL' });\nconst SKIP = insulate({ toString: () => 'SKIP' });\n\nconst lHexDigits = '0123456789abcdef';\nconst uHexDigits = 'ABCDEF';\n\nconst hexDigit = insulate(c => {\n  let i = lHexDigits.indexOf(c);\n  if (i < 0) {\n    i = uHexDigits.indexOf(c) + 10;\n  }\n  if (i < 0) {\n    slog.error`Invalid hexadecimal number ${{ c }}`;\n  }\n  return i;\n});\n\nconst unescape = insulate(cs => {\n  if (cs[0] !== '\\\\') {\n    return [cs[0], 1];\n  }\n\n  // It's an escape.\n  let q = cs[1];\n  switch (q) {\n    case 'b':{\n        q = '\\b';\n        break;\n      }\n    case 'f':{\n        q = '\\f';\n        break;\n      }\n    case 'n':{\n        q = '\\n';\n        break;\n      }\n    case 'r':{\n        q = '\\r';\n        break;\n      }\n    case 't':{\n        q = '\\t';\n        break;\n      }\n    case 'x':{\n        const ord = hexDigit(cs[2]) * 16 + hexDigit(cs[3]);\n        q = String.fromCharCode(ord);\n        return [q, 4];\n      }}\n\n\n  return [q, 2];\n});\n\nconst bootPeg = insulate((makePeg, bootPegAst) => {\n  function compile(sexp) {\n    let numSubs = 0; // # of holes implied by sexp, so far\n\n    // generated names\n    // act_${i}      action parameter\n    // rule_${name}  method from peg rule\n    // seq_${i}      sequence failure label\n    // or_${i}       choice success label\n    // pos_${i}      backtrack token index\n    // s_${i}        accumulated list of values\n    // v_${i}        set to s_${i} on fall thru path\n\n    let alphaCount = 0;\n    const vars = ['let value = FAIL'];\n    function nextVar(prefix) {\n      const result = `${prefix}_${alphaCount++}`;\n      vars.push(result);\n      return result;\n    }\n    function takeVarsSrc() {\n      const result = `${vars.join(', ')};`;\n      vars.length = 1;\n      return result;\n    }\n    function nextLabel(prefix) {\n      return `${prefix}_${alphaCount++}`;\n    }\n\n    const vtable = {\n      peg(...rules) {\n        // The following line also initializes numSubs\n        const rulesSrc = rules.map(peval).join('\\n');\n\n        const paramSrcs = [];\n        for (let i = 0; i < numSubs; i++) {\n          paramSrcs.push(`act_${i}`);\n        }\n        // rules[0] is the ast of the first rule, which has the form\n        // [\"def\", ruleName, body], so rules[0][1] is the name of\n        // the start rule. We prepend \"rule_\" to get the name of the\n        // JS method that implements the start rule. We invoke it\n        // with (0) so that it will parse starting at position 0. It\n        // returns a pair of the final position (after the last\n        // non-EOF token parsed), and the semantic value. On failure\n        // to parse, the semantic value will be FAIL.\n        const name = rules[0][1];\n        return indent`\n    (function(${paramSrcs.join(', ')}) {\n      let myHits = 0, myMisses = 0;\n      return baseMemo => (template, debug) => {\n          const BaseParser = baseMemo({});\n          return {...BaseParser,\n        template,\n        _memo: makeMap(),\n        _hits: (i) => myHits += i,\n        _misses: (i) => myMisses += i,\n        _debug: debug,\n        start: (self) => {\n          const pair = RUN(self, self.rule_${name}, 0, ${JSON.stringify(name)});\n          if (pair[1] === FAIL) {\n            ERROR(self, pair[0]);\n          }\n          return pair[1];\n        },\n        done: DONE,\n        ${rulesSrc}\n    }};\n    })\n    `;\n      },\n      def(name, body) {\n        const bodySrc = peval(body);\n        return indent`\n    rule_${name}: (self, pos) => {\n      ${takeVarsSrc()}\n      ${bodySrc}\n      return [pos, value];\n    },`;\n      },\n      empty() {\n        return `value = SKIP;`;\n      },\n      fail() {\n        return `value = FAIL;`;\n      },\n      or(...choices) {\n        const labelSrc = nextLabel('or');\n        const choicesSrc = choices.map(peval).map(cSrc => indent`\n    ${cSrc}\n    if (value !== FAIL) break ${labelSrc};`).join('\\n');\n\n        return indent`\n    ${labelSrc}: {\n      ${choicesSrc}\n    }`;\n      },\n      seq(...terms) {\n        const posSrc = nextVar('pos');\n        const labelSrc = nextLabel('seq');\n        const sSrc = nextVar('s');\n        const vSrc = nextVar('v');\n        const termsSrc = terms.map(peval).map(termSrc => indent`\n    ${termSrc}\n    if (value === FAIL) break ${labelSrc};\n    if (value !== SKIP) ${sSrc}.push(value);`).join('\\n');\n\n        return indent`\n    ${sSrc} = [];\n    ${vSrc} = FAIL;\n    ${posSrc} = pos;\n    ${labelSrc}: {\n      let beginPos, yytext;\n      ${termsSrc}\n      if (yytext !== undefined) {\n          ${vSrc} = [yytext];\n      }\n      else {\n        ${vSrc} = ${sSrc};\n      }\n    }\n    if ((value = ${vSrc}) === FAIL) pos = ${posSrc};`;\n      },\n      pred(hole) {\n        numSubs = Math.max(numSubs, hole + 1);\n        return `[pos, value] = act_${hole}(self, pos);`;\n      },\n      val0(...terms) {\n        // FIXME: Find a better way to specify where < foo > can\n        // provide a default semantic action, and to warn\n        // when it is in the wrong context.\n        const termsSrc = vtable.seq(...terms);\n        return indent`\n    ${termsSrc}\n    if (value !== FAIL && value.length === 1) value = value[0];`;\n      },\n      act(hole, ...terms) {\n        const posSrc = nextVar('pos');\n        numSubs = Math.max(numSubs, hole + 1);\n        const termsSrc = vtable.seq(...terms);\n        return indent`\n    ${posSrc} = pos;\n    ${termsSrc}\n    if (value !== FAIL) {\n        value = act_${hole}(...value);\n        if (Array.isArray(value)) {\n            value = [...value];\n            value._pegPosition = makeTokStr(self, FIND(self.template, ${posSrc}));\n        }\n    }`;\n      },\n      '**'(patt, sep) {\n        // for backtracking\n        const posSrc = nextVar('pos');\n        // a non-advancing success only repeats once.\n        const startSrc = nextVar('pos');\n        const sSrc = nextVar('s');\n        const pattSrc = peval(patt);\n        const sepSrc = peval(sep);\n        const sepValSrc = nextVar('sepVal');\n        // after first iteration, backtrack to before the separator\n        return indent`\n    ${sSrc} = [];\n    ${posSrc} = pos;\n    ${sepValSrc} = SKIP;\n    while (true) {\n      ${startSrc} = pos;\n      ${pattSrc}\n      if (value === FAIL) {\n        pos = ${posSrc};\n        break;\n      }\n      if (${sepValSrc} !== SKIP) ${sSrc}.push(${sepValSrc});\n      if (value !== SKIP) ${sSrc}.push(value);\n      ${posSrc} = pos;\n      ${sepSrc}\n      if (value === FAIL) break;\n      ${sepValSrc} = value;\n      if (pos === ${startSrc}) break;\n    }\n    value = ${sSrc};`;\n      },\n      '++'(patt, sep) {\n        const starSrc = vtable['**'](patt, sep);\n        return indent`\n    ${starSrc}\n    if (value.length === 0) value = FAIL;`;\n      },\n      '?'(patt) {\n        return vtable['**'](patt, ['fail']);\n      },\n      '*'(patt) {\n        return vtable['**'](patt, ['empty']);\n      },\n      '+'(patt) {\n        return vtable['++'](patt, ['empty']);\n      },\n      super(ident) {\n        return `[pos, value] = RUN(self, BaseParser.rule_${ident}, pos, ${\n        JSON.stringify(`super.${ident}`)});`;\n      },\n      // PEG extensions.\n      begin() {\n        // Mark the current pos.\n        return `beginPos = pos; value = [];`;\n      },\n      end() {\n        // Use the specified beginPos to extract a string\n        return indent`\n    if (beginPos !== undefined) {\n        yytext = '';\n        while (beginPos < pos) {\n            [beginPos, value] = EAT(self, beginPos);\n            if (value === FAIL) {\n                break;\n            }\n            yytext += value;\n        }\n        beginPos = undefined;\n        value = [];\n    }`;\n      },\n      cls(cs) {\n        // Character class.\n        let classStr = '',i = 0;\n        const invert = cs[i] === '^';\n        if (invert) {\n          ++i;\n        }\n        while (i < cs.length) {\n          const [c, j] = unescape(cs.slice(i));\n          i += j;\n          if (cs[i] === '-') {\n            // It's a range.\n            ++i;\n            const [c2, j2] = unescape(cs.slice(i));\n            i += j2;\n            const min = c.charCodeAt(0);\n            const max = c2.charCodeAt(0);\n            for (let k = min; k <= max; k++) {\n              classStr += String.fromCharCode(k);\n            }\n          } else {\n            classStr += c;\n          }\n        }\n        const op = invert ? '>=' : '<';\n        const srcCs = JSON.stringify(classStr);\n        return indent`\n    [pos, value] = EAT(self, pos);\n    if (value !== FAIL) {\n        value = ${srcCs}.indexOf(value) ${op} 0 ? FAIL : value;\n    }\n                `;\n      },\n      dot() {\n        return indent`\n    [pos, value] = EAT(self, pos);\n                `;\n      },\n      lit(cs) {\n        let str = '',i = 0;\n        while (i < cs.length) {\n          const [c, j] = unescape(cs.slice(i));\n          i += j;\n          str += c;\n        }\n        return indent`\n    [pos, value] = EAT(self, pos, ${JSON.stringify(str)});\n    `;\n      },\n      peek(patt) {\n        // for backtracking\n        const posSrc = nextVar('pos');\n        const pattSrc = peval(patt);\n        // if the pattern matches, restore, else FAIL\n        // always rewind.\n        return indent`\n    ${posSrc} = pos;\n    ${pattSrc}\n    if (value !== FAIL) {\n        value = SKIP;\n    }\n    pos = ${posSrc};`;\n      },\n      peekNot(patt) {\n        // for backtracking\n        const posSrc = nextVar('pos');\n        const pattSrc = peval(patt);\n        // if the pattern matches, FAIL, else success,\n        // always rewind.\n        return indent`\n    ${posSrc} = pos;\n    ${pattSrc}\n    value = (value === FAIL) ? SKIP : FAIL;\n    pos = ${posSrc};`;\n      } };\n\n\n    function peval(expr) {\n      if (typeof expr === 'string') {\n        // We only match idents... literal strings are protected\n        // by ['lit', s].\n        const nameStr = JSON.stringify(expr);\n        return `[pos, value] = RUN(self, self.rule_${expr}, pos, ${nameStr});`;\n      }\n      const op = vtable[expr[0]];\n      if (!op) {\n        slog.error`Cannot find ${expr[0]} in vtable`;\n      }\n      return op(...expr.slice(1));\n    }\n\n    return peval(sexp);\n  }\n\n\n\n  function quasiMemo(quasiCurry,\n  parserCreator) {\n    const wm = makeWeakMap();\n    let debug = false;\n    const templateTag = (templateOrFlag, ...subs) => {\n      if (typeof templateOrFlag === 'string') {\n        switch (templateOrFlag) {\n          case 'DEBUG':{\n              // Called as tag('DEBUG')`template string`\n              // Turn on debug mode.\n              debug = true;\n              break;\n            }\n          default:{\n              throw slog.error`Unrecognized tag flag ${{ templateOrFlag }}`;\n            }}\n\n        return templateTag;\n      }\n      const template = templateOrFlag;\n      let quasiRest = wm.get(template);\n      if (!quasiRest) {\n        quasiRest = quasiCurry(template, debug);\n        wm.set(template, quasiRest);\n      }\n      if (typeof quasiRest !== 'function') {\n        slog.error`${typeof quasiRest}: ${quasiRest}`;\n      }\n      return quasiRest(...subs);\n    };\n    templateTag.parserCreator = parserCreator;\n    return templateTag;\n  }\n\n  function quasifyParser(parserCreator) {\n    function baseCurry(template, debug) {\n      const parser = parserCreator(template, debug);\n      if (parser === undefined) {\n        slog.error`Cannot curry baseParserCreator`;\n      }\n      let pair = null;\n      try {\n        pair = parser.start(parser);\n      } finally {\n        parser.done(parser); // hook for logging debug output\n      }\n      return pair;\n    }\n    return quasiMemo(baseCurry, parserCreator);\n  }\n\n  const defaultBaseGrammar = quasifyParser(_template => undefined);\n\n  function metaCompile(baseRules) {\n    const baseAST = ['peg', ...baseRules];\n    const parserTraitMakerSrc = compile(baseAST);\n    // slog.trace`SOURCES: ${parserTraitMakerSrc}\\n`;\n\n    const makeParserTrait = confine(parserTraitMakerSrc, {\n      DONE,\n      EAT,\n      ERROR,\n      FAIL,\n      FIND,\n      RUN,\n      SKIP,\n      makeTokStr });\n\n\n    return function parserTag(...baseActions) {\n      const parserTrait = makeParserTrait(...baseActions);\n      let _asExtending;\n      let quasiParser;\n      const ext = baseQuasiParser => {\n\n\n        function tag0(templateOrFlag, ...substs)\n        {\n          const flags = [];\n\n\n          function tag(tmplOrFlag, ...subs)\n          {\n            if (typeof tmplOrFlag === 'string') {\n              flags.push(tmplOrFlag);\n              return tag;\n            }\n            const boundParser = quasiParser(tmplOrFlag, ...subs);\n            const parserBase = boundParser._asExtending(baseQuasiParser);\n            const parser = flags.reduce((p, flag) => p(flag), parserBase);\n            return parser;\n          }\n\n          tag.ACCEPT = ACCEPT;\n          tag.EAT = EAT;\n          tag.FAIL = FAIL;\n          tag.HOLE = HOLE;\n          tag.SKIP = SKIP;\n          tag._asExtending = _asExtending;\n          tag.extends = ext;\n          tag.parserCreator = quasiParser.parserCreator;\n\n          if (typeof templateOrFlag === 'string') {\n            return tag(templateOrFlag);\n          }\n          return tag(templateOrFlag, ...substs);\n        }\n        tag0.ACCEPT = ACCEPT;\n        tag0.EAT = EAT;\n        tag0.FAIL = FAIL;\n        tag0.HOLE = HOLE;\n        tag0.SKIP = SKIP;\n        tag0._asExtending = _asExtending;\n        tag0.extends = ext;\n        tag0.parserCreator = quasiParser.parserCreator;\n        return tag0;\n      };\n      _asExtending = baseQuasiParser => {\n        const parserCreator = parserTrait(baseQuasiParser.parserCreator);\n        const parser = quasifyParser(parserCreator);\n        const pegTag = parser;\n        pegTag.ACCEPT = ACCEPT;\n        pegTag.EAT = EAT;\n        pegTag.FAIL = FAIL;\n        pegTag.HOLE = HOLE;\n        pegTag.SKIP = SKIP;\n        pegTag._asExtending = _asExtending;\n        pegTag.extends = ext;\n        return pegTag;\n      };\n      defaultBaseGrammar._asExtending = _asExtending;\n      const closedDefaultBaseGrammar =\n      defaultBaseGrammar;\n      closedDefaultBaseGrammar._asExtending = _asExtending;\n      quasiParser = _asExtending(closedDefaultBaseGrammar);\n      return quasiParser;\n    };\n  }\n\n  // Bootstrap the compiler with the precompiled pegAst.\n  const actionExtractorTag = (_template, ...actions) => actions;\n  actionExtractorTag.ACCEPT = ACCEPT;\n  actionExtractorTag.HOLE = HOLE;\n  actionExtractorTag.SKIP = SKIP;\n\n  // Extract the actions, binding them to the metaCompile function.\n  const bootPegActions = makePeg(actionExtractorTag, metaCompile);\n\n  // Create the parser tag from the AST and the actions.\n  const compiledAst = metaCompile(bootPegAst);\n  const bootPegTag = compiledAst(...bootPegActions);\n\n  // Use the parser tag to create another parser tag that returns the AST.\n  const astExtractorTag = makePeg(\n  bootPegTag, defs => (..._) => defs);\n  const reparsedPegAst = makePeg(astExtractorTag, undefined);\n\n  // Compare our bootPegTag output to bootPegAst, to help ensure it is\n  // correct.  This doesn't defend against a malicious bootPeg,\n  // but it does prevent silly mistakes.\n  const a = JSON.stringify(bootPegAst, undefined, '  ');\n  const b = JSON.stringify(reparsedPegAst, undefined, '  ');\n  if (a !== b) {\n    slog.info`// boot-pegast.mjs.ts - AUTOMATICALLY GENERATED by boot-peg.mjs.ts\\nexport default ${{ b }};`;\n    slog.panic`reparsedPegAst does not match src/boot-pegast.mjs.ts`;\n  }\n\n  // Use the metaCompiler to generate another parser.\n  const finalPegTag = makePeg(bootPegTag, metaCompile);\n  return finalPegTag;\n});\n\nexport default insulate(bootPeg);","// DO NOT EDIT - Generated automatically from boot-pegast.mjs.ts by tessc\n// boot-pegast.mjs.ts - AUTOMATICALLY GENERATED by boot-env.mjs.ts\nexport default insulate([\n[\n\"def\",\n\"Grammar\",\n[\n\"act\",\n0,\n\"_Spacing\",\n[\n\"+\",\n\"Definition\"],\n\n\"_EndOfFile\"]],\n\n\n[\n\"def\",\n\"Definition\",\n[\n\"act\",\n2,\n\"Identifier\",\n\"LEFTARROW\",\n\"Expression\",\n\"SEMI\",\n[\n\"pred\",\n1]]],\n\n\n\n[\n\"def\",\n\"Expression\",\n[\n\"act\",\n3,\n[\n\"**\",\n\"Sequence\",\n\"_SLASH\"]]],\n\n\n\n[\n\"def\",\n\"Sequence\",\n[\n\"act\",\n5,\n[\n\"act\",\n4,\n[\n\"*\",\n\"Prefix\"]],\n\n\n[\n\"?\",\n\"HOLE\"]]],\n\n\n\n[\n\"def\",\n\"Prefix\",\n[\n\"or\",\n[\n\"act\",\n6,\n\"AND\",\n\"HOLE\"],\n\n[\n\"act\",\n7,\n\"AND\",\n\"Suffix\"],\n\n[\n\"act\",\n8,\n\"NOT\",\n\"Suffix\"],\n\n[\n\"val0\",\n\"Suffix\"]]],\n\n\n\n[\n\"def\",\n\"Suffix\",\n[\n\"or\",\n[\n\"act\",\n9,\n\"Primary\",\n[\n\"or\",\n[\n\"val0\",\n\"STARSTAR\"],\n\n[\n\"val0\",\n\"PLUSPLUS\"]],\n\n\n\"Primary\"],\n\n[\n\"act\",\n10,\n\"Primary\",\n[\n\"or\",\n[\n\"val0\",\n\"QUESTION\"],\n\n[\n\"val0\",\n\"STAR\"],\n\n[\n\"val0\",\n\"PLUS\"]]],\n\n\n\n[\n\"val0\",\n\"Primary\"]]],\n\n\n\n[\n\"def\",\n\"Primary\",\n[\n\"or\",\n[\n\"val0\",\n\"Super\"],\n\n[\n\"val0\",\n\"Identifier\",\n[\n\"peekNot\",\n\"LEFTARROW\"]],\n\n\n[\n\"act\",\n11,\n\"OPEN\",\n\"Expression\",\n\"CLOSE\"],\n\n[\n\"act\",\n12,\n\"Literal\"],\n\n[\n\"act\",\n13,\n\"Class\"],\n\n[\n\"act\",\n14,\n\"DOT\"],\n\n[\n\"act\",\n15,\n\"BEGIN\"],\n\n[\n\"act\",\n16,\n\"END\"]]],\n\n\n\n[\n\"def\",\n\"Super\",\n[\n\"act\",\n17,\n[\n\"lit\",\n\"super.\"],\n\n\"Identifier\"]],\n\n\n[\n\"def\",\n\"Identifier\",\n[\n\"val0\",\n[\n\"begin\"],\n\n\"IdentStart\",\n[\n\"*\",\n\"IdentCont\"],\n\n[\n\"end\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"IdentStart\",\n[\n\"val0\",\n[\n\"cls\",\n\"a-zA-Z_\"]]],\n\n\n\n[\n\"def\",\n\"IdentCont\",\n[\n\"or\",\n[\n\"val0\",\n\"IdentStart\"],\n\n[\n\"val0\",\n[\n\"cls\",\n\"0-9\"]]]],\n\n\n\n\n[\n\"def\",\n\"Literal\",\n[\n\"or\",\n[\n\"val0\",\n[\n\"cls\",\n\"'\"],\n\n[\n\"begin\"],\n\n[\n\"*\",\n[\n\"val0\",\n[\n\"peekNot\",\n[\n\"cls\",\n\"'\"]],\n\n\n\"Char\"]],\n\n\n[\n\"end\"],\n\n[\n\"cls\",\n\"'\"],\n\n\"_Spacing\"],\n\n[\n\"val0\",\n[\n\"cls\",\n\"\\\"\"],\n\n[\n\"begin\"],\n\n[\n\"*\",\n[\n\"val0\",\n[\n\"peekNot\",\n[\n\"cls\",\n\"\\\"\"]],\n\n\n\"Char\"]],\n\n\n[\n\"end\"],\n\n[\n\"cls\",\n\"\\\"\"],\n\n\"_Spacing\"]]],\n\n\n\n[\n\"def\",\n\"Class\",\n[\n\"val0\",\n[\n\"lit\",\n\"[\"],\n\n[\n\"begin\"],\n\n[\n\"*\",\n[\n\"val0\",\n[\n\"peekNot\",\n[\n\"lit\",\n\"]\"]],\n\n\n\"Range\"]],\n\n\n[\n\"end\"],\n\n[\n\"lit\",\n\"]\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"Range\",\n[\n\"or\",\n[\n\"val0\",\n\"Char\",\n[\n\"lit\",\n\"-\"],\n\n\"Char\"],\n\n[\n\"val0\",\n\"Char\"]]],\n\n\n\n[\n\"def\",\n\"Char\",\n[\n\"or\",\n[\n\"val0\",\n[\n\"lit\",\n\"\\\\\\\\\"],\n\n[\n\"cls\",\n\"abefnrtv'\\\"\\\\[\\\\]\\\\\\\\\\\\`\\\\$\"]],\n\n\n[\n\"val0\",\n[\n\"lit\",\n\"\\\\\\\\x\"],\n\n[\n\"cls\",\n\"0-9a-fA-F\"],\n\n[\n\"cls\",\n\"0-9a-fA-F\"]],\n\n\n[\n\"val0\",\n[\n\"lit\",\n\"\\\\\\\\\"],\n\n[\n\"lit\",\n\"-\"]],\n\n\n[\n\"val0\",\n[\n\"peekNot\",\n[\n\"lit\",\n\"\\\\\\\\\"]],\n\n\n[\n\"dot\"]]]],\n\n\n\n\n[\n\"def\",\n\"LEFTARROW\",\n[\n\"val0\",\n[\n\"lit\",\n\"<-\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"_SLASH\",\n[\n\"act\",\n18,\n[\n\"lit\",\n\"/\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"SEMI\",\n[\n\"val0\",\n[\n\"lit\",\n\";\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"AND\",\n[\n\"val0\",\n[\n\"lit\",\n\"&\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"NOT\",\n[\n\"val0\",\n[\n\"lit\",\n\"~\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"QUESTION\",\n[\n\"val0\",\n[\n\"lit\",\n\"?\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"STAR\",\n[\n\"val0\",\n[\n\"lit\",\n\"*\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"PLUS\",\n[\n\"val0\",\n[\n\"lit\",\n\"+\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"OPEN\",\n[\n\"val0\",\n[\n\"lit\",\n\"(\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"CLOSE\",\n[\n\"val0\",\n[\n\"lit\",\n\")\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"DOT\",\n[\n\"val0\",\n[\n\"lit\",\n\".\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"_Spacing\",\n[\n\"act\",\n19,\n[\n\"*\",\n[\n\"or\",\n[\n\"val0\",\n\"Space\"],\n\n[\n\"val0\",\n\"Comment\"]]]]],\n\n\n\n\n\n[\n\"def\",\n\"Comment\",\n[\n\"val0\",\n[\n\"lit\",\n\"#\"],\n\n[\n\"*\",\n[\n\"val0\",\n[\n\"peekNot\",\n\"EndOfLine\"],\n\n[\n\"dot\"]]],\n\n\n\n\"EndOfLine\"]],\n\n\n[\n\"def\",\n\"Space\",\n[\n\"or\",\n[\n\"val0\",\n[\n\"lit\",\n\" \"]],\n\n\n[\n\"val0\",\n[\n\"lit\",\n\"\\\\t\"]],\n\n\n[\n\"val0\",\n\"EndOfLine\"]]],\n\n\n\n[\n\"def\",\n\"EndOfLine\",\n[\n\"or\",\n[\n\"val0\",\n[\n\"lit\",\n\"\\\\r\\\\n\"]],\n\n\n[\n\"val0\",\n[\n\"lit\",\n\"\\\\n\"]],\n\n\n[\n\"val0\",\n[\n\"lit\",\n\"\\\\r\"]]]],\n\n\n\n\n[\n\"def\",\n\"_EndOfFile\",\n[\n\"val0\",\n[\n\"peekNot\",\n[\n\"dot\"]]]],\n\n\n\n\n[\n\"def\",\n\"HOLE\",\n[\n\"val0\",\n[\n\"pred\",\n20],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"BEGIN\",\n[\n\"val0\",\n[\n\"lit\",\n\"<\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"END\",\n[\n\"val0\",\n[\n\"lit\",\n\">\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"PLUSPLUS\",\n[\n\"val0\",\n[\n\"lit\",\n\"++\"],\n\n\"_Spacing\"]],\n\n\n[\n\"def\",\n\"STARSTAR\",\n[\n\"val0\",\n[\n\"lit\",\n\"**\"],\n\n\"_Spacing\"]]]);","// DO NOT EDIT - Generated automatically from quasi-peg.mjs.ts by tessc\n// PEG quasi Grammar for PEG quasi Grammars\n// Michael FIG <michael+jessica@fig.org>, 2019-01-05\n//\n// This grammar is adapted from:\n// http://piumarta.com/software/peg/peg-0.1.18/src/peg.peg\n//\n// Modified for Jessica to support:\n//   Semantic actions provided in tagged template HOLEs\n//   '~' for negative lookahead (instead of '!')\n//   ';' terminator for definitions\n//   '**' and '++' for separators\n//   'super.RULE' syntax for extended grammars\n//   '\\xFF' instead of octal character literals\n// which are adapted from:\n// https://github.com/erights/quasiParserGenerator\n\n/// <reference path=\"peg.d.ts\"/>\n\nconst makePeg = insulate((\npegTag,\nmetaCompile) => {\n  const { ACCEPT, HOLE, SKIP } = pegTag;\n\n  function simple(prefix, list) {\n    if (list.length === 0) {return ['empty'];}\n    if (list.length === 1) {return list[0];}\n    return [prefix, ...list];\n  }\n\n  function flatArgs(args) {\n    return args.reduce((prior, a) => {\n      prior.push(...flatSeq(a));\n      return prior;\n    }, []);\n  }\n\n  function flatSeq(term) {\n    if (Array.isArray(term)) {\n      if (term.length === 0) {\n        return [];\n      }\n      const [kind, ...terms] = term;\n      if (kind === 'seq') {\n        return flatArgs(terms);\n      } else if (terms.length === 0 && Array.isArray(kind)) {\n        return flatSeq(kind);\n      } else {\n        return [[kind, ...flatArgs(terms)]];\n      }\n    }\n\n    return [term];\n  }\n\n  return pegTag`\n# Hierarchical syntax\n\nGrammar      <- _Spacing Definition+ _EndOfFile\n                    ${metaCompile};\n\nDefinition   <- Identifier LEFTARROW Expression SEMI &${ACCEPT}\n                    ${(i, _, e, _2) => ['def', i, e]};\nExpression   <- Sequence ** _SLASH\n                    ${list => simple('or', list)};\nSequence     <- (Prefix*\n                    ${list => simple('seq', list)})\n                 HOLE?\n                    ${(seq, optHole) => optHole.length === 0 ?\n  ['val0', ...flatSeq(seq)] :\n  ['act', optHole[0], ...flatSeq(seq)]};\nPrefix       <- AND HOLE\n                    ${(_, a) => ['pred', a]}\n              / AND Suffix\n                    ${(_, s) => ['peek', s]}\n              / NOT Suffix\n                    ${(_, s) => ['peekNot', s]}\n              /     Suffix;\nSuffix       <- Primary (STARSTAR\n                        / PLUSPLUS) Primary\n                    ${(patt, q, sep) => [q, patt, sep]}\n              / Primary (QUESTION\n                        / STAR\n                        / PLUS)\n                    ${(patt, optQ) => [optQ[0], patt]}\n              / Primary;\nPrimary      <- Super\n              / Identifier ~LEFTARROW\n              / OPEN Expression CLOSE\n                    ${(_, e, _2) => e}\n              / Literal\n                    ${s => ['lit', s]}\n              / Class\n                    ${c => ['cls', c]}\n              / DOT\n                    ${() => ['dot']}\n              / BEGIN\n                    ${() => ['begin']}\n              / END\n                    ${() => ['end']}\n              ;\n\nSuper        <- 'super.' Identifier\n                    ${(_, i) => ['super', i]};\n\n# Lexical syntax\n\nIdentifier   <- < IdentStart IdentCont* > _Spacing;\nIdentStart   <- [a-zA-Z_];\nIdentCont    <- IdentStart / [0-9];\nLiteral      <- ['] < (~['] Char )* > ['] _Spacing\n              / [\"] < (~[\"] Char )* > [\"] _Spacing;\nClass        <- '[' < (~']' Range)* > ']' _Spacing;\nRange        <- Char '-' Char / Char;\nChar         <- '\\\\' [abefnrtv'\"\\[\\]\\\\\\`\\$]\n              / '\\\\x' [0-9a-fA-F][0-9a-fA-F]\n              / '\\\\' '-'\n              / ~'\\\\' .;\nLEFTARROW    <- '<-' _Spacing;\n_SLASH        <- '/' _Spacing              ${_ => SKIP};\nSEMI         <- ';' _Spacing;\nAND          <- '&' _Spacing;\nNOT          <- '~' _Spacing;\nQUESTION     <- '?' _Spacing;\nSTAR         <- '*' _Spacing;\nPLUS         <- '+' _Spacing;\nOPEN         <- '(' _Spacing;\nCLOSE        <- ')' _Spacing;\nDOT          <- '.' _Spacing;\n_Spacing      <- (Space / Comment)*        ${_ => SKIP};\nComment      <- '#' (~EndOfLine .)* EndOfLine;\nSpace        <- ' ' / '\\t' / EndOfLine;\nEndOfLine    <- '\\r\\n' / '\\n' / '\\r';\n_EndOfFile    <- ~.;\n\nHOLE         <- &${HOLE} _Spacing;\nBEGIN        <- '<' _Spacing;\nEND          <- '>' _Spacing;\nPLUSPLUS     <- '++' _Spacing;\nSTARSTAR     <- '**' _Spacing;\n`;\n});\n\nexport default insulate(makePeg);","// DO NOT EDIT - Generated automatically from quasi-jessie-module.mjs.ts by tessc\n// An extension of the Jessie grammar to facilitate rewriting\n// imports/exports as AMD.\n\n/// <reference path=\"peg.d.ts\"/>\n\nconst makeJessieModule = insulate(jessiePeg => {\n  return jessiePeg`\n    # Override rather than inherit start production.\n    # Only module syntax is permitted.\n    start <- _WS moduleBody _EOF               ${b => (..._a) => ['moduleX', b]};\n\n    # A.5 Scripts and Modules\n\n    insulatedExpr <- < super.insulatedExpr >;\n\n    moduleBody <- moduleItem*;\n    moduleItem <-\n      < SEMI >\n    / importDecl    # Same AST as in Jessie.\n    / exportDecl    # Similar AST, but insulatedExpr is source string.\n    / < moduleDeclaration >;  # Source string.\n\n    exportDecl <-\n      EXPORT DEFAULT < exportableExpr > SEMI    ${e => ['exportDefaultX', e]}\n    / EXPORT moduleDeclaration                  ${(_, d) => ['exportX', ...d]};\n    `;\n});\n\nexport default insulate(makeJessieModule);","// DO NOT EDIT - Generated automatically from quasi-jessie.mjs.ts by tessc\n// Subsets of JavaScript, starting from the grammar as defined at\n// http://www.ecma-international.org/ecma-262/9.0/#sec-grammar-summary\n\n// See https://github.com/Agoric/Jessie/blob/master/README.md\n// for documentation of the Jessie grammar defined here.\n\n/// <reference path=\"peg.d.ts\"/>\n\n\nconst terminatedBlock = insulate(manyBodies => {\n  const stmts = manyBodies.reduce((prior, body) => {\n    const [bs, t] = body;\n    bs.forEach(b => prior.push(b));\n    prior.push(t);\n    return prior;\n  }, []);\n  return ['block', stmts];\n});\n\nconst makeJessie = insulate((peg, justinPeg) => {\n  const { SKIP } = justinPeg;\n  const jessieTag = justinPeg`\n    # Override rather than inherit start production.\n    # Only module syntax is permitted.\n    start <- _WS moduleBody _EOF               ${b => (..._a) => ['module', b]};\n\n    # A.1 Lexical Grammar\n\n    # For proposed eventual send expressions\n    LATER <- _NO_NEWLINE \"!\" _WS;\n\n    # A.2 Expressions\n\n    # Jessie primaryExpr does not include \"this\", ClassExpression,\n    # GeneratorExpression, AsyncFunctionExpression,\n    # AsyncGenerarorExpression, or RegularExpressionLiteral.\n    primaryExpr <-\n      super.primaryExpr\n    / functionExpr;\n\n    propDef <-\n      methodDef\n    / super.propDef;\n\n    purePropDef <-\n      methodDef\n    / super.purePropDef;\n\n    # Recognize pre-increment/decrement.\n    prePre <-\n      (PLUSPLUS / MINUSMINUS)                          ${op => `pre:${op}`}\n    / super.prePre;\n\n    # Extend to recognize proposed eventual get syntax,\n    # as well as computed indices and postfix increment/decrement.\n    memberPostOp <-\n      super.memberPostOp\n    / LEFT_BRACKET assignExpr RIGHT_BRACKET        ${(_, e, _2) => ['index', e]}\n    / LATER LEFT_BRACKET assignExpr RIGHT_BRACKET  ${(_, _2, e, _3) => ['indexLater', e]}\n    / LATER IDENT_NAME                             ${(_, id) => ['getLater', id]};\n\n    # Extend to recognize proposed eventual send syntax.\n    # We distinguish b!foo(x) from calling b!foo by a post-parsing pass\n    callPostOp <-\n      super.callPostOp\n    / LATER args                                           ${(_, args) => ['callLater', args]};\n\n    postOp <- (PLUSPLUS / MINUSMINUS) _WS;\n\n    # to be extended\n    assignExpr <-\n      arrowFunc\n    / functionExpr\n    / lValue postOp                                        ${(lv, op) => [op, lv]}\n    / lValue (EQUALS / assignOp) assignExpr                ${(lv, op, rv) => [op, lv, rv]}\n    / super.assignExpr\n    / primaryExpr;\n\n    # An expression without side-effects.\n    pureExpr <-\n      arrowFunc\n    / super.pureExpr;\n\n    # In Jessie, an lValue is only a variable, a computed index-named\n    # property (an array element), or a statically string-named\n    # property.\n    # We allow assignment to statically string-named fields, since it\n    # is useful during initialization and prevented thereafter by\n    # mandatory tamper-proofing.\n\n    # to be overridden or extended\n    lValue <-\n      primaryExpr LEFT_BRACKET indexExpr RIGHT_BRACKET     ${(pe, _, e, _2) => ['index', pe, e]}\n    / primaryExpr LATER LEFT_BRACKET indexExpr RIGHT_BRACKET ${(pe, _, _2, e, _3) => ['indexLater', pe, e]}\n    / primaryExpr DOT IDENT_NAME                           ${(pe, _, id) => ['get', pe, id]}\n    / primaryExpr LATER IDENT_NAME                         ${(pe, _, id) => ['getLater', pe, id]}\n    / useVar;\n\n    assignOp <-\n      (\"*=\" / \"/=\" / \"%=\" / \"+=\" / \"-=\"\n    / \"<<=\" / \">>=\" / \">>>=\"\n    / \"&=\" / \"^=\" / \"|=\"\n    / \"**=\") _WS;\n\n\n    # A.3 Statements\n\n    # to be extended.\n    # The exprStatement production must go last, so PEG's prioritized\n    # choice will interpret {} as a block rather than an expression.\n    statement <-\n      block\n    / IF LEFT_PAREN expr RIGHT_PAREN arm ELSE elseArm      ${(_, _2, c, _3, t, _4, e) => ['if', c, t, e]}\n    / IF LEFT_PAREN expr RIGHT_PAREN arm                   ${(_, _2, c, _3, t) => ['if', c, t]}\n    / breakableStatement\n    / terminator\n    / IDENT COLON statement                                ${(label, _, stat) => ['label', label, stat]}\n    / TRY block catcher finalizer                          ${(_, b, c, f) => ['try', b, c, f]}\n    / TRY block catcher                                    ${(_, b, c) => ['try', b, c]}\n    / TRY block finalizer                                  ${(_, b, f) => ['try', b, undefined, f]}\n    / DEBUGGER SEMI                                        ${(_, _2) => ['debugger']}\n    / exprStatement;\n\n    # to be overridden.  In Jessie, only blocks are accepted as arms\n    # of flow-of-control statements.\n    arm <- block;\n\n    # Allows for\n    # if (...) {} else if (...) {} else if (...) {};\n    elseArm <-\n      arm\n    / IF LEFT_PAREN expr RIGHT_PAREN arm ELSE elseArm      ${(_, _2, c, _3, t, _4, e) => ['if', c, t, e]}\n    / IF LEFT_PAREN expr RIGHT_PAREN arm                   ${(_, _2, c, _3, t) => ['if', c, t]};\n\n    breakableStatement <-\n      FOR LEFT_PAREN declOp forOfBinding OF expr RIGHT_PAREN arm\n            ${(_, _2, o, d, _3, e, _4, b) => ['forOf', o, d, e, b]}\n    / FOR LEFT_PAREN declaration expr? SEMI expr? RIGHT_PAREN arm ${(_, _2, d, c, _3, i, _4, b) => ['for', d, c, i, b]}\n    / WHILE LEFT_PAREN expr RIGHT_PAREN arm                       ${(_, _2, c, _3, b) => ['while', c, b]}\n    / SWITCH LEFT_PAREN expr RIGHT_PAREN LEFT_BRACE clause* RIGHT_BRACE\n            ${(_, _2, e, _3, _4, bs, _5) => ['switch', e, bs]};\n\n    # Each case clause must end in a terminating statement.\n    terminator <-\n      \"continue\" _NO_NEWLINE IDENT SEMI                ${(_, label, _3) => ['continue', label]}\n    / \"continue\" _WS SEMI                              ${(_, _2) => ['continue']}\n    / \"break\" _NO_NEWLINE IDENT SEMI                   ${(_, label, _2) => ['break', label]}\n    / \"break\" _WS SEMI                                 ${(_, _2) => ['break']}\n    / \"return\" _NO_NEWLINE expr SEMI                   ${(_, e, _2) => ['return', e]}\n    / \"return\" _WS SEMI                                ${(_, _2) => ['return']}\n    / \"throw\" _NO_NEWLINE expr SEMI                    ${(_, e, _3) => ['throw', e]};\n\n    block <- LEFT_BRACE body RIGHT_BRACE              ${(_, b, _2) => ['block', b]};\n    body <- statementItem*;\n\n    # declaration must come first, so that PEG will prioritize\n    # function declarations over exprStatement.\n    statementItem <-\n      declaration\n    / statement;\n\n    # No \"class\" declaration.\n    # No generator, async, or async iterator function.\n    declaration <-\n      declOp binding ** _COMMA SEMI                    ${(op, decls, _) => [op, decls]}\n    / functionDecl;\n\n    declOp <- (\"const\" / \"let\") _WSN;\n\n    forOfBinding <- bindingPattern / defVar;\n    binding <-\n      bindingPattern EQUALS assignExpr                ${(p, _, e) => ['bind', p, e]}\n    / defVar EQUALS assignExpr                        ${(p, _, e) => ['bind', p, e]}\n    / defVar;\n\n    bindingPattern <-\n      LEFT_BRACKET elementParam ** _COMMA RIGHT_BRACKET     ${(_, ps, _2) => ['matchArray', ps]}\n    / LEFT_BRACE propParam ** _COMMA RIGHT_BRACE            ${(_, ps, _2) => ['matchRecord', ps]};\n\n    pattern <-\n      bindingPattern\n    / defVar\n    / dataLiteral                                     ${n => ['matchData', JSON.parse(n)]}\n    / HOLE                                            ${h => ['patternHole', h]};\n\n    # to be overridden\n    elementParam <- param;\n\n    param <-\n      ELLIPSIS pattern                                ${(_, p) => ['rest', p]}\n    / defVar EQUALS assignExpr                        ${(v, _, e) => ['optional', v, e]}\n    / pattern;\n\n    propParam <-\n      ELLIPSIS pattern                                ${(_, p) => ['restObj', p]}\n    / propName COLON pattern                          ${(k, _, p) => ['matchProp', k, p]}\n    / defVar EQUALS assignExpr                        ${(id, _, e) => ['optionalProp', id[1], id, e]}\n    / defVar                                          ${id => ['matchProp', id[1], id]};\n\n    # Use PEG prioritized choice.\n    # TODO emit diagnostic for failure cases.\n    exprStatement <-\n      ~cantStartExprStatement expr SEMI               ${(e, _2) => e};\n\n    cantStartExprStatement <-\n      (\"{\" / \"function\" / \"async\" _NO_NEWLINE \"function\"\n    / \"class\" / \"let\" / \"[\") _WSN;\n\n    # to be overridden\n    terminatedBody <- ((~terminator statementItem)* terminator)+   ${tb => terminatedBlock(tb)};\n    clause <-\n      caseLabel+ LEFT_BRACE terminatedBody RIGHT_BRACE ${(cs, _, b, _2) => ['clause', cs, b]};\n    caseLabel <-\n      CASE expr COLON                                 ${(_, e) => ['case', e]}\n    / DEFAULT _WS COLON                                ${(_, _2) => ['default']};\n\n    catcher <- CATCH LEFT_PAREN pattern RIGHT_PAREN block ${(_, _2, p, _3, b) => ['catch', p, b]};\n    finalizer <- FINALLY block                        ${(_, b) => ['finally', b]};\n\n\n    # A.4 Functions and Classes\n\n    functionDecl <-\n      FUNCTION defVar LEFT_PAREN param ** _COMMA RIGHT_PAREN block\n                                                      ${(_, n, _2, p, _3, b) => ['functionDecl', n, p, b]};\n\n    functionExpr <-\n      FUNCTION defVar? LEFT_PAREN param ** _COMMA RIGHT_PAREN block\n                                                      ${(_, n, _2, p, _3, b) => ['functionExpr', n[0], p, b]};\n\n    # The assignExpr form must come after the block form, to make proper use\n    # of PEG prioritized choice.\n    arrowFunc <-\n      arrowParams _NO_NEWLINE ARROW block              ${(ps, _2, b) => ['arrow', ps, b]}\n    / arrowParams _NO_NEWLINE ARROW assignExpr         ${(ps, _2, e) => ['lambda', ps, e]};\n\n    arrowParams <-\n      IDENT                                           ${id => [['def', id]]}\n    / LEFT_PAREN param ** _COMMA RIGHT_PAREN           ${(_, ps, _2) => ps};\n\n    # to be extended\n    methodDef <-\n      method\n    / GET propName LEFT_PAREN RIGHT_PAREN block            ${(_, n, _2, _3, b) => ['getter', n, [], b]}\n    / SET propName LEFT_PAREN param RIGHT_PAREN block      ${(_, n, _2, p, _3, b) => ['setter', n, [p], b]};\n\n    method <-\n      propName LEFT_PAREN param ** _COMMA RIGHT_PAREN block ${(n, _, p, _2, b) => ['method', n, p, b]};\n\n\n    # A.5 Scripts and Modules\n\n    moduleBody <- moduleItem*;\n    moduleItem <-\n      SEMI                                               ${_ => SKIP}\n    / importDecl\n    / exportDecl\n    / moduleDeclaration;\n\n    useImport <- IMPORT_PFX IDENT                 ${(pfx, id) => ['use', pfx + id]};\n    defImport <- IMPORT_PFX IDENT                 ${(pfx, id) => ['def', pfx + id]};\n\n    moduleDeclaration <-\n      \"const\" _WSN moduleBinding ** _COMMA SEMI       ${(op, decls) => [op, decls]};\n\n    # An insulated expression without side-effects.\n    insulatedExpr <-\n      dataLiteral                                     ${d => ['data', JSON.parse(d)]}\n    / \"insulate\" _WS LEFT_PAREN (pureExpr / useImport) RIGHT_PAREN  ${(fname, _2, expr, _3) =>\n  ['call', ['use', fname], [expr]]};\n\n    # Jessie modules only allow insulated module-level bindings.\n    moduleBinding <-\n      bindingPattern EQUALS insulatedExpr       ${(p, _, e) => ['bind', p, e]}\n    / defVar EQUALS insulatedExpr               ${(p, _, e) => ['bind', p, e]}\n    / defVar;\n\n    importClause <-\n      STAR AS defImport                         ${(_, _2, d) => ['importBind', [['as', '*', d[1]]]]}\n    / namedImports                              ${n => ['importBind', n]}\n    / defImport _COMMA STAR AS defImport        ${(d, _, _2, d2) => ['importBind', [['as', 'default', d[1]],\n  ['as', '*', d2[1]]]]}\n    / defImport _COMMA namedImports             ${(d, n) => ['importBind', [['as', 'default', d[1]], ...n]]}\n    / defImport                                 ${d => ['importBind', [['as', 'default', d[1]]]]};\n\n    importSpecifier <-\n      defImport                                 ${d => ['as', d[1], d[1]]}\n    / IDENT_NAME AS defImport                   ${(i, _, d) => ['as', i, d[1]]};\n\n    namedImports <-\n      LEFT_BRACE importSpecifier ** _COMMA _COMMA? RIGHT_BRACE ${(_, s, _2) => s};\n\n    importDecl <- IMPORT importClause FROM STRING SEMI  ${(_, v, _2, s, _3) => ['import', v, JSON.parse(s)]};\n    exportDecl <-\n      EXPORT DEFAULT exportableExpr SEMI        ${(_, _2, e, _3) => ['exportDefault', e]}\n    / EXPORT moduleDeclaration                  ${(_, d) => ['export', ...d]};\n\n    # to be extended\n    exportableExpr <- insulatedExpr;\n\n    # Lexical syntax\n    ARROW <- \"=>\" _WS;\n    AS <- \"as\" _WSN;\n    DEBUGGER <- \"debugger\" _WSN;\n    PLUSPLUS <- \"++\" _WSN;\n    MINUSMINUS <- \"--\" _WSN;\n    CASE <- \"case\" _WSN;\n    IF <- \"if\" _WSN;\n    ELSE <- \"else\" _WSN;\n    FOR <- \"for\" _WSN;\n    OF <- \"of\" _WSN;\n    WHILE <- \"while\" _WSN;\n    BREAK <- \"break\" _WSN;\n    CONTINUE <- \"continue\" _WSN;\n    SWITCH <- \"switch\" _WSN;\n    TRY <- \"try\" _WSN;\n    CATCH <- \"catch\" _WSN;\n    FINALLY <- \"finally\" _WSN;\n    GET <- \"get\" _WSN;\n    SET <- \"set\" _WSN;\n    IMPORT <- \"import\" _WSN;\n    EXPORT <- \"export\" _WSN;\n    FROM <- \"from\" _WSN;\n    FUNCTION <- \"function\" _WSN;\n    DEFAULT <- \"default\" _WSN;\n    EQUALS <- \"=\" _WS;\n    SEMI <- \";\" _WS;\n    STAR <- \"*\" _WS;\n    `;\n\n  const jessieExprTag = peg.extends(jessieTag)`\n    # Jump to the expr production.\n    start <- _WS expr _EOF              ${e => (..._a) => e};\n    `;\n\n  return [jessieTag, jessieExprTag];\n});\n\nexport default insulate(makeJessie);","// DO NOT EDIT - Generated automatically from quasi-json.mjs.ts by tessc\n// Subsets of JavaScript, starting from the grammar as defined at\n// http://www.ecma-international.org/ecma-262/9.0/#sec-grammar-summary\n\n// Defined to be extended into the Jessie grammar.\n// See https://github.com/Agoric/Jessie/blob/master/README.md\n// for documentation of the Jessie grammar.\n\n// See also json.org\n\n/// <reference path=\"peg.d.ts\"/>\n\nconst makeJSON = insulate(peg => {\n  const { FAIL, HOLE, SKIP } = peg;\n  return peg`\n# to be overridden or inherited\nstart <- _WS assignExpr _EOF                ${v => (..._a) => v};\n\n# to be extended\nprimaryExpr <- dataStructure;\n\ndataStructure <-\n  dataLiteral                             ${n => ['data', JSON.parse(n)]}\n/ array\n/ record\n/ HOLE                                    ${h => ['exprHole', h]};\n\n# An expression without side-effects.\n# to be extended\npureExpr <-\n  dataLiteral                             ${n => ['data', JSON.parse(n)]}\n/ pureArray\n/ pureRecord\n/ HOLE                                    ${h => ['exprHole', h]};\n\ndataLiteral <- ((\"null\" / \"false\" / \"true\") _WSN / NUMBER / STRING) _WS;\n\npureArray <-\n  LEFT_BRACKET pureExpr ** _COMMA _COMMA? RIGHT_BRACKET ${(_, es, _2) => ['array', es]};\n\narray <-\n  LEFT_BRACKET element ** _COMMA _COMMA? RIGHT_BRACKET ${(_, es, _2) => ['array', es]};\n\n# to be extended\nelement <- assignExpr;\n\n# The JavaScript and JSON grammars calls records \"objects\"\n\npureRecord <-\n  LEFT_BRACE purePropDef ** _COMMA _COMMA? RIGHT_BRACE  ${(_, ps, _2) => ['record', ps]};\n\nrecord <-\n  LEFT_BRACE propDef ** _COMMA _COMMA? RIGHT_BRACE  ${(_, ps, _2) => ['record', ps]};\n\n# to be extended\npurePropDef <- propName COLON pureExpr     ${(k, _, e) => ['prop', k, e]};\n\n# to be extended\npropDef <- propName COLON assignExpr       ${(k, _, e) => ['prop', k, e]};\n\n# to be extended\npropName <- STRING                     ${str => {\n    const js = JSON.parse(str);\n    if (js === '__proto__') {\n      // Don't allow __proto__ behaviour attacks.\n      return FAIL;\n    }\n    return ['data', js];\n  }};\n\n# to be overridden\nassignExpr <- primaryExpr;\n\n# Lexical syntax\n\n_EOF <- ~.;\nLEFT_BRACKET <- \"[\" _WS;\nRIGHT_BRACKET <- \"]\" _WS;\nLEFT_BRACE <- \"{\" _WS;\nRIGHT_BRACE <- \"}\" _WS;\n_COMMA <- \",\" _WS                     ${_ => SKIP};\nCOLON <- \":\" _WS;\nMINUS <- \"-\" _WS;\nHOLE <- &${HOLE} _WS;\n\nSTRING <- < '\"' (~'\"' character)* '\"' > _WS;\n\nutf8 <-\n  [\\xc2-\\xdf] utf8cont\n/ [\\xe0-\\xef] utf8cont utf8cont\n/ [\\xf0-\\xf4] utf8cont utf8cont utf8cont;\n\nutf8cont <- [\\x80-\\xbf];\n\ncharacter <-\n  escape\n/ '\\\\u' hex hex hex hex\n/ ~'\\\\' ([\\x20-\\x7f] / utf8);\n\nescape <- '\\\\' ['\"\\\\bfnrt];\nhex <- digit / [a-fA-F];\n\nNUMBER <- < int frac? exp? > _WSN;\n\nint <- [1-9] digit+\n/ digit\n/ MINUS digit\n/ MINUS [1-9] digit+;\n\ndigit <- [0-9];\n\nfrac <- '.' digit+;\nexp <- [Ee] [+\\-]? digit+;\n\n# _WSN is whitespace or a non-ident character.\n_WSN <- ~[$A-Za-z_] _WS    ${_ => SKIP};\n_WS <- [\\t\\n\\r ]*          ${_ => SKIP};\n`;\n\n});\n\nexport default insulate(makeJSON);","// DO NOT EDIT - Generated automatically from quasi-utils.mjs.ts by tessc\nexport const qunpack = insulate((h, ms, t) => {\n  return [h, ...ms, t];\n});\n\nexport const qrepack = insulate(parts => {\n  // TODO bug: We only provide the raw form at this time. I\n  // apologize once again for allowing a cooked form into the\n  // standard.\n  const raw = [parts[0]];\n  const argExprs = [];\n  const len = parts.length;\n  for (let i = 1; i < len; i += 2) {\n    argExprs.push(parts[i]);\n    raw.push(parts[i + 1]);\n  }\n  const template = [...raw];\n  template.raw = raw;\n  return [['data', template], ...argExprs];\n});\n\nexport const reduceElisions = insulate(es => {\n  const reduced = [];\n  for (const e of es) {\n    if (e[0] === undefined) {\n      // Push the elisions.\n      e.forEach(_ => reduced.push(undefined));\n    } else {\n      // Push the individual expression.\n      reduced.push(e);\n    }\n  }\n  return reduced;\n});","// DO NOT EDIT - Generated automatically from quasi-justin.mjs.ts by tessc\n// Subsets of JavaScript, starting from the grammar as defined at\n// http://www.ecma-international.org/ecma-262/9.0/#sec-grammar-summary\n\n// Justin is the safe JavaScript expression language, a potentially\n// pure decidable superset of JSON and subset of Jessie, that relieves\n// many of the pain points of using JSON as a data format:\n//   * unquoted indentifier property names.\n//   * comments.\n//   * multi-line strings (via template literals).\n//   * undefined.\n//   * includes all floating point values: NaN, Infinity, -Infinity\n//   * will include BigInt once available.\n\n// Justin also includes most pure JavaScript expressions. Justin does not\n// include function expressions or variable or function\n// definitions. However, it does include free variable uses and\n// function calls; so the purity and decidability of Justin depends on\n// the endowments provided for these free variable bindings.\n\n// Justin is defined to be extended into the Jessie grammar, which is\n// defined to be extended into the JavaScript grammar.\n// See https://github.com/Agoric/Jessie/blob/master/README.md\n// for documentation of the Jessie grammar.\n\n// Justin is defined to be extended into the Chainmail grammar, to\n// provide its expression language in a JS-like style. Chainmail\n// expressions need to be pure and should be decidable.\n\n/// <reference path=\"peg.d.ts\"/>\n\nimport { qunpack as $i_qunpack } from './quasi-utils.mjs';const qunpack = insulate($i_qunpack);\n\nconst binary = insulate((left, rights) => {\n  return rights.reduce((prev, [op, right]) => [op, prev, right], left);\n});\n\nconst transformSingleQuote = insulate(s => {\n  let i = 0,qs = '';\n  while (i < s.length) {\n    const c = s.slice(i, i + 1);\n    if (c === '\\\\') {\n      // Skip one char.\n      qs += s.slice(i, i + 2);\n      i += 2;\n    } else if (c === '\"') {\n      // Quote it.\n      qs += '\\\\\"';\n      i++;\n    } else {\n      // Add it directly.\n      qs += c;\n      i++;\n    }\n  }\n  return `\"${qs}\"`;\n});\n\nconst makeJustin = insulate(peg => {\n  const { SKIP } = peg;\n  return peg`\n    # to be overridden or inherited\n    start <- _WS assignExpr _EOF                       ${v => (..._a) => v};\n\n    # A.1 Lexical Grammar\n\n    DOT <- \".\" _WS;\n    ELLIPSIS <- \"...\" _WS;\n    LEFT_PAREN <- \"(\" _WS;\n    PLUS <- \"+\" _WS;\n    QUESTION <- \"?\" _WS;\n    RIGHT_PAREN <- \")\" _WS;\n    STARSTAR <- \"**\" _WS;\n\n    # Define Javascript-style comments.\n    _WS <- super._WS (EOL_COMMENT / MULTILINE_COMMENT)?   ${_ => SKIP};\n    EOL_COMMENT <- \"//\" (~[\\n\\r] .)* _WS;\n    MULTILINE_COMMENT <- \"/*\" (~\"*/\" .)* \"*/\" _WS;\n\n    # Add single-quoted strings.\n    STRING <-\n      super.STRING\n    / \"'\" < (~\"'\" character)* > \"'\" _WS  ${s => transformSingleQuote(s)};\n\n    # Only match if whitespace doesn't contain newline\n    _NO_NEWLINE <- ~IDENT [ \\t]*     ${_ => SKIP};\n\n    IDENT_NAME <- ~(HIDDEN_PFX / \"__proto__\") (IDENT / RESERVED_WORD);\n\n    IDENT <- ~(HIDDEN_PFX / IMPORT_PFX) < [$A-Za-z_] [$A-Za-z0-9_]* > _WS;\n    HIDDEN_PFX <- \"$h_\";\n    IMPORT_PFX <- \"$i_\";\n\n    # Omit \"async\", \"arguments\", \"eval\", \"get\", and \"set\" from IDENT\n    # in Justin even though ES2017 considers them in IDENT.\n    RESERVED_WORD <-\n      (KEYWORD / RESERVED_KEYWORD / FUTURE_RESERVED_WORD\n    / \"null\" / \"false\" / \"true\"\n    / \"async\" / \"arguments\" / \"eval\" / \"get\" / \"set\") _WSN;\n\n    KEYWORD <-\n      (\"break\"\n    / \"case\" / \"catch\" / \"const\" / \"continue\"\n    / \"debugger\" / \"default\"\n    / \"else\" / \"export\"\n    / \"finally\" / \"for\" / \"function\"\n    / \"if\" / \"import\"\n    / \"return\"\n    / \"switch\"\n    / \"throw\" / \"try\" / \"typeof\"\n    / \"void\"\n    / \"while\") _WSN;\n\n    # Unused by Justin but enumerated here, in order to omit them\n    # from the IDENT token.\n    RESERVED_KEYWORD <-\n      (\"class\"\n    / \"delete\" / \"do\"\n    / \"extends\"\n    / \"in\" / \"instanceof\"\n    / \"new\"\n    / \"super\"\n    / \"this\"\n    / \"var\"\n    / \"with\"\n    / \"yield\") _WSN;\n\n    FUTURE_RESERVED_WORD <-\n      (\"await\" / \"enum\"\n    / \"implements\" / \"package\" / \"protected\"\n    / \"interface\" / \"private\" / \"public\") _WSN;\n\n    # Quasiliterals aka template literals\n    QUASI_CHAR <- \"\\\\\" . / ~\"\\`\" .;\n    QUASI_ALL <- \"\\`\" < (~\"\\${\" QUASI_CHAR)* > \"\\`\" _WS;\n    QUASI_HEAD <- \"\\`\" < (~\"\\${\" QUASI_CHAR)* > \"\\${\" _WS;\n    QUASI_MID <- \"}\" < (~\"\\${\" QUASI_CHAR)* > \"\\${\" _WS;\n    QUASI_TAIL <- \"}\" < (~\"\\${\" QUASI_CHAR)* > \"\\`\" _WS;\n\n\n    # A.2 Expressions\n\n    dataStructure <-\n      \"undefined\" _WSN     ${_ => ['data', undefined]}\n    / super.dataStructure;\n\n    # Optional trailing commas.\n    record <-\n      super.record\n    / LEFT_BRACE propDef ** _COMMA _COMMA? RIGHT_BRACE      ${(_, ps, _2) => ['record', ps]};\n\n    array <-\n      super.array\n    / LEFT_BRACKET element ** _COMMA _COMMA? RIGHT_BRACKET  ${(_, es, _2) => ['array', es]};\n\n    useVar <- IDENT                                       ${id => ['use', id]};\n\n    # Justin does not contain variable definitions, only uses. However,\n    # multiple languages that extend Justin will contain defining\n    # occurrences of variable names, so we put the defVar production\n    # here.\n    defVar <- IDENT                                       ${id => ['def', id]};\n\n\n    primaryExpr <-\n      super.primaryExpr\n    / quasiExpr\n    / LEFT_PAREN expr RIGHT_PAREN                         ${(_, e, _2) => e}\n    / useVar;\n\n    pureExpr <-\n      super.pureExpr\n    / LEFT_PAREN pureExpr RIGHT_PAREN                     ${(_, e, _2) => e}\n    / useVar;\n\n    element <-\n      super.element\n    / ELLIPSIS assignExpr                                 ${(_, e) => ['spread', e]};\n\n    propDef <-\n      super.propDef\n    / useVar                                              ${u => ['prop', u[1], u]}\n    / ELLIPSIS assignExpr                                 ${(_, e) => ['spreadObj', e]};\n\n    purePropDef <-\n      super.purePropDef\n    / useVar                                              ${u => ['prop', u[1], u]}\n    / ELLIPSIS assignExpr                                 ${(_, e) => ['spreadObj', e]};\n\n    # No computed property name\n    propName <-\n      super.propName\n    / IDENT_NAME\n    / NUMBER;\n\n    quasiExpr <-\n      QUASI_ALL                                            ${q => ['quasi', [q]]}\n    / QUASI_HEAD expr ** QUASI_MID QUASI_TAIL              ${(h, ms, t) => ['quasi', qunpack(h, ms, t)]};\n\n    # to be extended\n    memberPostOp <-\n      LEFT_BRACKET indexExpr RIGHT_BRACKET                 ${(_, e, _3) => ['index', e]}\n    / DOT IDENT_NAME                                       ${(_, id) => ['get', id]}\n    / quasiExpr                                            ${q => ['tag', q]};\n\n    # to be extended\n    callPostOp <-\n      memberPostOp\n    / args                                                 ${args => ['call', args]};\n\n    # Because Justin and Jessie have no \"new\" or \"super\", they don't need\n    # to distinguish callExpr from memberExpr. So justin omits memberExpr\n    # and newExpr. Instead, in Justin, callExpr jumps directly to\n    # primaryExpr and updateExpr jumps directly to callExpr.\n\n    # to be overridden.\n    callExpr <- primaryExpr callPostOp*                   ${binary};\n\n    # To be overridden rather than inherited.\n    # Introduced to impose a non-JS restriction\n    # Restrict index access to number-names, including\n    # floating point, NaN, Infinity, and -Infinity.\n    indexExpr <-\n      NUMBER                                               ${n => ['data', JSON.parse(n)]}\n    / PLUS unaryExpr                                       ${(_, e) => [`pre:+`, e]};\n\n    args <- LEFT_PAREN arg ** _COMMA RIGHT_PAREN            ${(_, args, _2) => args};\n\n    arg <-\n      assignExpr\n    / ELLIPSIS assignExpr                                  ${(_, e) => ['spread', e]};\n\n    # to be overridden\n    updateExpr <- callExpr;\n\n    unaryExpr <-\n      preOp unaryExpr                                      ${(op, e) => [op, e]}\n    / updateExpr;\n\n    # to be extended\n    # No prefix or postfix \"++\" or \"--\".\n    # No \"delete\".\n    preOp <- ((\"void\" / \"typeof\") _WSN / prePre);\n    prePre <- (\"+\" / \"-\" / \"~\" / \"!\") _WS                 ${op => `pre:${op}`};\n\n    # Different communities will think -x**y parses in different ways,\n    # so the EcmaScript grammar forces parens to disambiguate.\n    powExpr <-\n      updateExpr STARSTAR powExpr                          ${(x, op, y) => [op, x, y]}\n    / unaryExpr;\n\n    multExpr <- powExpr (multOp powExpr)*                  ${binary};\n    addExpr <- multExpr (addOp multExpr)*                  ${binary};\n    shiftExpr <- addExpr (shiftOp addExpr)*                ${binary};\n\n    # Non-standard, to be overridden\n    # In C-like languages, the precedence and associativity of the\n    # relational, equality, and bitwise operators is surprising, and\n    # therefore hazardous. Here, none of these associate with the\n    # others, forcing parens to disambiguate.\n    eagerExpr <- shiftExpr (eagerOp shiftExpr)?            ${binary};\n\n    andThenExpr <- eagerExpr (andThenOp eagerExpr)*       ${binary};\n    orElseExpr <- andThenExpr (orElseOp andThenExpr)*     ${binary};\n\n    multOp <- (\"*\" / \"/\" / \"%\") _WS;\n    addOp <- (\"+\" / \"-\") _WS;\n    shiftOp <- (\"<<\" / \">>>\" / \">>\") _WS;\n    relOp <- (\"<=\" / \"<\" / \">=\" / \">\") _WS;\n    eqOp <- (\"===\" / \"!==\") _WS;\n    bitOp <- (\"&\" / \"^\" / \"|\") _WS;\n\n    eagerOp <- relOp / eqOp / bitOp;\n\n    andThenOp <- \"&&\" _WS;\n    orElseOp <- \"||\" _WS;\n\n    condExpr <-\n      orElseExpr QUESTION assignExpr COLON assignExpr   ${(c, _, t, _2, e) => ['cond', c, t, e]}\n    / orElseExpr;\n\n    # override, to be extended\n    assignExpr <- condExpr;\n\n    # The comma expression is not in Jessie because we\n    # opt to pass only insulated expressions as the this-binding.\n    expr <- assignExpr;\n  `;\n});\n\nexport default insulate(makeJustin);","// DO NOT EDIT - Generated automatically from rewrite-define.mjs.ts by tessc\n\n\nconst hide = insulate(vname => `\\$h_${vname}`);\n\n// Return a string separated by separators.\nconst separate = insulate((strs, sep) => {\n  let ret = '';\n  let actualSep = '';\n  for (const str of strs) {\n    if (str !== '') {\n      ret += actualSep + str;\n      actualSep = sep;\n    }\n  }\n  return ret;\n});\n\nconst moduleRewriteDefine = insulate((moduleAST, DEFINE = hide('define')) => {\n  const EXPORTS = hide('exports');\n  const imports = makeMap();\n  const exportVars = makeSet();\n  let starName;\n  let nImport = 0;\n  const rewriters = {\n    as(imp, sym) {\n      if (imp === '*') {\n        starName = sym;\n        return '';\n      }\n      return `${imp}: ${sym}`;\n    },\n    bind(def, expr) {\n      const name = doRewrite(def);\n      return `${name} = ${doRewrite(expr)}`;\n    },\n    def(name) {\n      exportVars.add(name);\n      return name;\n    },\n    exportDefaultX(val) {\n      return `${EXPORTS}.default = ${doRewrite(val)};`;\n    },\n    exportX(qual, binds) {\n      exportVars.clear();\n      const bindings = separate(binds.map(doRewrite), ', ');\n      let assign = '';\n      for (const vname of exportVars.keys()) {\n        assign += `${EXPORTS}.${vname} = ${vname};\\n`;\n      }\n      exportVars.clear();\n      return `${qual} ${bindings};\\n${assign}`;\n    },\n    import(clause, fromModule) {\n      // Save the bindings.\n      starName = undefined;\n      const bindings = doRewrite(clause);\n      if (starName === undefined) {\n        starName = hide(`star${nImport++}`);\n      }\n      imports.set(fromModule, starName);\n      if (bindings) {\n        return `const {${bindings}} = ${starName};\\n`;\n      }\n      return '';\n    },\n    importBind(bindings) {\n      return separate(bindings.map(doRewrite), ', ');\n    },\n    matchArray(es) {\n      return `[${separate(es.map(doRewrite), ', ')}]`;\n    },\n    matchProp(kw, prop) {\n      const rewrite = doRewrite(prop);\n      if (kw === rewrite) {\n        return kw;\n      }\n      return `${kw}: ${rewrite}`;\n    },\n    matchRecord(es) {\n      return `{${separate(es.map(doRewrite), ', ')}}`;\n    },\n    moduleX(decls) {\n      const body = decls.reduce((prior, cur) => prior + doRewrite(cur), '');\n      const modules = [];\n      const names = [];\n      for (const [mod, name] of imports.entries()) {\n        modules.push(mod);\n        names.push(name);\n      }\n      const bindings = separate(names, ', ');\n      return `${DEFINE}(\n${JSON.stringify(modules)},\n(${bindings}) => {\nconst ${EXPORTS} = {};\n${body}\nreturn ${EXPORTS};\n})`;\n    },\n    rest(expr) {\n      return `...${doRewrite(expr)}`;\n    },\n    restObj(expr) {\n      return `...${doRewrite(expr)}`;\n    } };\n\n\n  const doRewrite = node => {\n    if (typeof node === 'string') {\n      return node;\n    }\n    const [name, ...args] = node;\n    const rewriter = rewriters[name];\n    if (!rewriter) {\n      throw slog.error`No rewriter for ${{ name }}`;\n    }\n    return rewriter(...args);\n  };\n  return doRewrite(moduleAST);\n});\n\nexport default insulate(moduleRewriteDefine);","// DO NOT EDIT - Generated automatically from tag-string.mjs.ts by tessc\n/// <reference path=\"./peg.d.ts\"/>\nconst tagString = insulate((tag, uri) => {\n\n\n  function tagged(templateOrFlag, ...args)\n  {\n    if (typeof templateOrFlag === 'string') {\n      return tagString(tag(templateOrFlag), uri);\n    }\n    const template = templateOrFlag;\n    const cooked = template.reduce((prior, t, i) => {\n      prior.push(t, String(args[i]));\n      return prior;\n    }, []);\n    cooked.push(template[template.length - 1]);\n    const cooked0 = cooked.join('');\n    const raw0 = args.reduce((prior, hole, i) => {\n      prior.push(String(hole), template.raw[i + 1]);\n      return prior;\n    }, [template.raw[0]]).join('');\n    const sources0 = {\n      byte: 0,\n      column: 1,\n      line: 1,\n      uri };\n\n    const tmpl = [cooked0];\n    tmpl.raw = [raw0];\n    tmpl.sources = [sources0];\n    return tag(tmpl);\n  }\n  tagged.parserCreator = tag.parserCreator;\n  tagged._asExtending = tag._asExtending;\n  return tagged;\n});\n\nexport default insulate(tagString);","// DO NOT EDIT - Generated automatically from translate.mjs.ts by tessc\nimport $i_bootPeg from './boot-peg.mjs';const bootPeg = insulate($i_bootPeg);\nimport $i_bootPegAst from './boot-pegast.mjs';const bootPegAst = insulate($i_bootPegAst);\nimport $i_makePeg from './quasi-peg.mjs';const makePeg = insulate($i_makePeg);\n\nimport $i_makeJessieModule from './quasi-jessie-module.mjs';const makeJessieModule = insulate($i_makeJessieModule);\nimport $i_makeJessie from './quasi-jessie.mjs';const makeJessie = insulate($i_makeJessie);\nimport $i_makeJSON from './quasi-json.mjs';const makeJSON = insulate($i_makeJSON);\nimport $i_makeJustin from './quasi-justin.mjs';const makeJustin = insulate($i_makeJustin);\nimport $i_rewriteModuleDefine from './rewrite-define.mjs';const rewriteModuleDefine = insulate($i_rewriteModuleDefine);\nimport $i_tagString from './tag-string.mjs';const tagString = insulate($i_tagString);\n\nconst pegTag = insulate(bootPeg(makePeg, bootPegAst));\nconst jsonTag = insulate(makeJSON(pegTag));\nconst justinTag = insulate(makeJustin(pegTag.extends(jsonTag)));\nconst [jessieTag] = insulate(makeJessie(pegTag, pegTag.extends(justinTag)));\nconst jessieModuleTag = insulate(makeJessieModule(pegTag.extends(jessieTag)));\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nexport const translate = insulate((sourceText, parameters) =>\n\nmakePromise(resolve => {\n  const { sourceType, target, targetType } = parameters;\n  if (sourceType !== 'jessie') {\n    throw slog.error`Unrecognized sourceType: ${{ sourceType }}`;\n  }\n  if (target !== 'jessie-frame') {\n    throw slog.error`Unrecognized target: ${{ target }}`;\n  }\n\n  switch (targetType) {\n    case 'function':{\n        const tag = tagString(jessieModuleTag, parameters.sourceURL);\n\n        // Throw an exception if the sourceText doesn't parse.\n        const moduleAst = tag`${sourceText}`;\n\n        // Rewrite the ESM imports/exports into an SES-honouring AMD form.\n        const translatedText = rewriteModuleDefine(moduleAst, '$h_define');\n        const result = {\n          ...parameters,\n          translatedText };\n\n        return resolve(result);\n      }\n    case 'module':{\n        const tag = tagString(jessieTag, parameters.sourceURL);\n\n        // Throw an exception if the sourceText doesn't parse.\n        tag`${sourceText}`;\n\n        // Return the sourceText verbatim.\n        const result = {\n          ...parameters,\n          translatedText: sourceText };\n\n        return resolve(result);\n      }\n    default:{\n        throw slog.error`Unrecognized targetType: ${{ targetType }}`;\n      }}\n\n\n}));","import iSES from './node_modules/ses/dist/ses.esm.js';\nimport globalEnv, {insulate} from '../nodejs/globalEnv.mjs';\nexport {translate} from '../../lib/translate.mjs';\n\nexport const globals = {...globalEnv, insulate};\nexport const SES = iSES;\n"]}